<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>【尚硅谷】Redis7实战（基础篇） | 時光</title><meta name="keywords" content="尚硅谷,Redis"><meta name="author" content="時光"><meta name="copyright" content="時光"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="【尚硅谷】Redis7实战（基础篇）"><meta name="application-name" content="【尚硅谷】Redis7实战（基础篇）"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="【尚硅谷】Redis7实战（基础篇）"><meta property="og:url" content="https://blog.shiguang666.eu.org/2024/09/10/818e370d0e76/index.html"><meta property="og:site_name" content="時光"><meta property="og:description" content="在线视频：尚硅谷Redis零基础到进阶，最强redis7教程，阳哥亲自带练（附redis面试题） 课程资料：尚硅谷Redis7教程 随堂代码 Gitee: https:&amp;#x2F;&amp;#x2F;gitee.com&amp;#x2F;an_shiguang&amp;#x2F;learn-redis GitHub: https:&amp;#x2F;&amp;#x2F;github.com&amp;#x2F;Sh"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://img.shiguangdev.cn/i/2024/08/28/66cedaf5d014a.jpeg"><meta property="article:author" content="時光"><meta property="article:tag" content="博客,時光,時光的博客,時光博客园子,实用博客,开源,共享"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://img.shiguangdev.cn/i/2024/08/28/66cedaf5d014a.jpeg"><meta name="description" content="在线视频：尚硅谷Redis零基础到进阶，最强redis7教程，阳哥亲自带练（附redis面试题） 课程资料：尚硅谷Redis7教程 随堂代码 Gitee: https:&amp;#x2F;&amp;#x2F;gitee.com&amp;#x2F;an_shiguang&amp;#x2F;learn-redis GitHub: https:&amp;#x2F;&amp;#x2F;github.com&amp;#x2F;Sh"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="https://blog.shiguang666.eu.org/2024/09/10/818e370d0e76/"><link rel="preconnect" href="//cdn.cbd.int"><meta name="google-site-verification" content="xxx"><meta name="baidu-site-verification" content="code-xxx"><meta name="msvalidate.01" content="xxx"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/swiper/swiper.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: {"enable":true,"title":"与各类博主无限进步","addFriendPlaceholder":"昵称（请勿包含博客等字样）：\n网站地址（要求博客地址，请勿提交个人主页）：\n头像图片url（请提供尽可能清晰的图片，我会上传到我自己的图床）：\n描述：\n站点截图（可选）：\n"},
  peoplecanvas: undefined,
  postHeadAiDescription: undefined,
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: {"enable":true,"default":"晚上好👋","list":[{"greeting":"晚安😴","startTime":0,"endTime":5},{"greeting":"早上好鸭👋, 祝你一天好心情！","startTime":6,"endTime":9},{"greeting":"上午好👋, 状态很好，鼓励一下～","startTime":10,"endTime":10},{"greeting":"11点多啦, 在坚持一下就吃饭啦～","startTime":11,"endTime":11},{"greeting":"午安👋, 宝贝","startTime":12,"endTime":14},{"greeting":"🌈充实的一天辛苦啦！","startTime":14,"endTime":18},{"greeting":"19点喽, 奖励一顿丰盛的大餐吧🍔。","startTime":19,"endTime":19},{"greeting":"晚上好👋, 在属于自己的时间好好放松😌~","startTime":20,"endTime":24}]},
  twikooEnvId: 'https://twikoo.shiguangdev.eu.org',
  commentBarrageConfig:{"enable":true,"maxBarrage":1,"barrageTime":4000,"accessToken":"","mailMd5":""},
  music_page_default: "nav_music",
  root: '/',
  preloader: {"source":3},
  friends_vue_info: {"apiurl":"https://fcircle.shiguangdev.cn/"},
  navMusic: true,
  mainTone: undefined,
  authorStatus: {"skills":["🌟 技术分享领航人","📚 终身学习倡导者","💡 创新思维启发源","📈 成长路径引路人","🚀 科技趋势探索者","🤖️ AI技术探索先锋","🌈 技术创新推动手","💬 社区互动活跃家","🛠️ 代码经验传授师","📢 知识传播倡导员"]},
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":true,"limitCount":300,"languages":{"author":"作者: 時光","link":"链接: ","source":"来源: 時光","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: true,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: '時光',
  title: '【尚硅谷】Redis7实战（基础篇）',
  postAI: '',
  pageFillDescription: 'Redis入门概述, 是什么, 官网解释, Redis之父安特雷兹, 能干吗, 主流功能与应用, Redis功能图解, Redis优势, , 性能极高, 数据类型丰富, 支持数据持久化, 支持数据备份, 小总结, 去哪下, 官网, 其他文档资料, 怎么玩, Redis迭代演化和Redis7新特性, Redis版本升级, 各版本抵达及推演过程, 里程碑的重要版本, 各版本命名规则, Redis7新特性, Redis7核心特性概览, Redis Functions, Client-eviction, Muti-part AOF, ACL V2, 新增命令, listpack代替ziplist, 底层性能提示, Redis安装配置, Windows安装, Linux安装, 准备gcc编译环境, 什么是gcc, 安装gcc, 查看gcc版本, Redis安装步骤, 1、下载获得安装包, 2、解压文件, 3、执行make命令, 4、将默认的redis.con拷贝到自定义目录, 5、修改备份目录下redis.conf配置文件做初始化设置, 6、启动服务, redis-cli连接和乒乓球, 解决警告问题, 7、6379端口的由来, 8、helloworld小练习, 9、关闭实例, Docker安装, Redis卸载, 停止redis-server服务, 删除 /usr/local/lib 目录下与redis相关的文件, Redis十大数据类型, String（字符串）, List（列表）, hash（哈希）, Set（集合）, zset（sorted set：有序集合）, GEO（地理空间）, HyperLogLog（基数统计）, Bitmap（位图）, Bitfield（位域）, Stream（流）, Redis常用命令, 如何查找命令, Redis keys 命令, 各数据类型命令, String（字符串）, 基本命令, 设置key, 获取key, 同时设置x2F获取多个键值, 获取指定区间范围内的值, 数值增减, 获取字符串长度以及内容追加, 分布式锁, List（列表）, hash（哈希）, Set（集合）, 常用命令, 集合运算, 应用场景, zset（sorted set：有序集合）, 常用命令, 应用场景, Bitmap（位图）, 基本命令, 应用场景, HyperLogLog（基数统计）, 基数统计介绍, 需求场景, 基本命令, GEO（地理空间）, 相关介绍, 原理, 常用命令, georadius、georadiusbymember, Redis GEO, Stream（流）, Redis消息队列的两种方案, List, 发布x2F订阅, 底层结构和原理说明, 基本命令, XADD, XRANGE, XREVRANGE, XDEL, XTRIM, XREAD, XGROUP CREATE, XREADGROUP GROUP, XPENGING, XACK, XINFO, Bitmap（位图）, 基本语法命令, 位域修改, 溢出控制, Redis持久化, 总体介绍, RDB（Redis DataBase）, 官网介绍, 作用, 案例演示, 配置文件变化, 操作步骤, 自动触发：, 手动触发：, RDB优势, 官网说明, 小总结, RDB劣势, 官网说明, 小总结, 数据丢失案例, 如何修复dump.rdb文件？, 哪些情况会触发RDB快照？, 如何禁用RDB快照？, RDB优化配置项, 小总结, AOF（Append Only File）, 官网介绍, AOF持久化工作流程, AOF缓冲区三种写回策略, AOF配置文件说明, 如何开启AOF?, AOF文件保存路径, AOF文件保存名称, AOF修复x2F恢复, 正常恢复, 异常修复, AOF优势, AOF劣势, AOF重写机制, 介绍, 触发机制, AOF重写原理, AOF优化配置项详解, 小总结, RDB + AOF混合模式, 纯缓存模式, 禁用AOF, Redis 事务, 介绍, 作用, Redis事务与数据库事务的区别, 使用, 常用命令, 不用场景说明, 场景一：正常执行, 场景二：放弃事务, 场景三：全体连坐, 场景四：冤头债主, 场景五：watch监控, Redis事务总结, Redis管道（pipeline）, 如何优化频繁命令往返造成的性能瓶颈？, Redis管道介绍, 案例演示, Redis管道小总结, Pipeline与原生批量命令对比, Pipeline与Redis事务对比, 使用Pipeline注意事项, Redis发布订阅, 介绍, 作用, 常用命令, 缺点, Redis复制（Replication）, 介绍, 作用, 使用, 注意点, 基本命令, 案例演示, 架构说明, 操作步骤, 修改配置文件细节, 三大命令, 一主二仆, 新货相传, 反客为主, 复制原理和工作流程, 复制缺点, Redis哨兵（Sentinel）, 介绍, 作用, 主要功能, 实战演练, 架构说明, 案例步骤, sentinel.conf参数说明, 配置文件变化, 其他说明, 哨兵运行流程和选举原理, 1、SDown主观下线（Subjectively Down）, 2、ODown客观下线(Objectively Down), 3、选举出领导者哨兵（哨兵中选出兵王）, 4、由兵王开始推动故障切换流程并选出一个新master, 第一步：新主登基, 第二步：群臣俯首, 第三步：旧主拜服, 小总结, 哨兵使用建议, Redis集群（Cluster）, 介绍, 作用, 集群算法：分片-槽位（slot）, 官网介绍, Slot介绍, 分片介绍, 插槽和分片的优势, Slot槽位映射方案, 方案一：哈希取余分区, 方案二：一致性哈希算法分区, 一致性Hash算法背景, 作用, 实现步骤, 优点, 缺点, 小总结, 方案三：哈希槽分区, 产生背景, 作用, 多少个hash 槽？, 为什么Redis集群的最大槽数是16384个？, 一个注意点, 集群环境案例步骤, 三主三从Redis集群配置, 查看并检验集群状态, info replication, cluster info, 输出内容：, cluster nodes, 输出内容：, 三主三从集群读写, 主从容错切换迁移案例, 案例演示, 手动故障迁移x2F节点从属调整, 命令格式, 参数说明, 功能, 注意事项, 示例, 主从扩容案例, 主从缩容案例, 集群常用操作命令和CRC16算法分析, 通识占位符, CRC16源码浅谈, 常用命令, cluster-require-full-coverage, CLUSTER COUNTKEYSINSLOT slot, CLUSTER KEYSLOT key, SpringBoot集成Redis, 总体概述, 常见问题, 集成Jedis, Jedis介绍, 步骤, POM依赖, YML配置, 主启动类, 入门案例, 集成Lettuce, Lettuce介绍, Jedis与Lettuce的区别, 案例, 改POM, 业务类, 集成RedisTemplate（推荐）, 连接单机, 改POM, 写YML, SwaggerConfig, controller, service, 序列号问题, 连接集群, 改YML, 问题在线视频尚硅谷零基础到进阶最强教程阳哥亲自带练附面试题课程资料尚硅谷教程随堂代码入门概述是什么远程字典服务器是一个开源的内存数据库遵守协议它提供了一个高性能的键值存储系统常用于缓存消息队列会话存储等应用场景官网解释官网简介是世界上速度最快的内存数据库它提供用于缓存矢量搜索和数据库的云和本地解决方案可无缝融入任何技术堆栈让数字客户能够轻松构建扩展和部署我们世界所运行的快速应用程序要使用您可以选择源可用许可证或服务器端公共许可证提供字符串哈希列表集合具有范围查询的有序集位图超级日志地理空间索引和流等数据结构具有内置复制脚本驱逐事务和不同级别的磁盘持久性并通过提供高可用性并通过提供自动分区您可以对这些类型运行原子操作例如附加到字符串增加哈希中的值将元素推送到列表计算集合的交集并集和差集或获取排序集合中排名最高的成员为了实现最佳性能使用内存数据集根据您的使用情况可以通过定期将数据集转储到磁盘或将每个命令附加到基于磁盘的日志来持久化您的数据如果您只需要功能丰富的联网内存缓存也可以禁用持久性支持异步复制具有快速无阻塞同步和网络分裂时自动重新连接以及部分重新同步的功能还包括交易发布订阅脚本具有有限生存时间的密钥密钥驱逐自动故障转移您可以在大多数编程语言中使用是用编写的可以在大多数系统如和上运行无需依赖外部系统和是开发和测试最多的两个操作系统我们建议使用进行部署可以在衍生的系统如上运行但支持是尽力而为的没有对版本的官方支持之父安特雷兹个人博客之父一名意大利程序员大家更习惯称呼他能干吗主流功能与应用分布式缓存挡在数据库之前的带刀护卫与传统数据库关系相比是数据库一种是关系型数据库数据操作主要在内存而主要存储在磁盘在某一些场景使用中要明显优于比如计数器排行榜等方面通常用于一些特定场景需要与一起配合使用两者并不是相互替换和竞争关系而是共用和配合使用内存存储和持久化支持异步将内存中的数据写到硬盘上同时不影响继续服务高可用架构搭配缓存穿透击穿雪崩分布式锁队列提供和操作这使得能作为一个很好的消息队列平台来使用我们常通过的队列功能做购买限制比如到节假日或者推广期间进行一些活动对用户购买行为进行限制限制今天只能购买几次商品或者一段时间内只能购买一次也比较适合适用排行榜点赞功能图解优势与其他存储有什么不同与其他存储系统的主要区别在于其提供了丰富的数据类型高性能的读写能力原子性操作持久化机制以及丰富的特性集以下是的一些独特之处丰富的数据类型不仅仅支持简单的类型的数据还提供了有序集合等数据结构的存储这些数据类型可以更好地满足特定的业务需求使得可以用于更广泛的应用场景高性能的读写能力能读的速度是次写的速度是次这种高性能主要得益于将数据存储在内存中从而显著提高了数据的访问速度原子性操作的所有操作都是原子性的这意味着操作要么完全执行要么完全不执行这种特性对于确保数据的一致性和完整性非常重要持久化机制支持数据的持久化可以将内存中的数据保存在磁盘中以便在系统重启后能够再次加载使用这为提供了数据安全性确保数据不会因为系统故障而丢失丰富的特性集还支持发布订阅模式通知过期等高级特性这些特性使得可以用于消息队列实时数据分析等复杂的应用场景主从复制和高可用性支持模式的数据备份提供了数据的备份和主从复制功能增强了数据的可用性和容错性支持脚本支持使用脚本来编写复杂的操作这些脚本可以在服务器端执行提供了更多的灵活性和强大的功能单线程模型尽管是单线程的但它通过高效的事件驱动模型来处理并发请求确保了高性能和低延迟性能极高能读的速度是次秒写的速度是次秒数据类型丰富不仅仅支持简单的类型的数据同时还提供等数据结构的存储支持数据持久化可以将内存中的数据保持在磁盘中重启的时候可以再次加载进行使用支持数据备份支持数据的备份即模式的数据备份小总结去哪下本课程采用版本官网官网中文网中文学习网其他文档资料源码地址在线测试貌似跑路了在线地址项目地址命令参考怎么玩多数据类型基本操作配置持久化和复制事务控制复制集群迭代演化和新特性版本升级之父安特雷兹的发言各版本抵达及推演过程里程碑的重要版本版本是直接升级到版本对于这个激进的升级之父表现得很有信心和兴奋所以第一时间发文来阐述的一些重大功能随后再接再厉直接王炸年爆款年月日正式发布了更新其实早在年月日已经预发布了经过社区的考验后确认没重大才会正式发布各版本命名规则从发布至今已经有十余年的时光了一直遵循着自己的命名规则版本号第二位如果是奇数则为非稳定版本如版本号第二位如果是偶数则为稳定版本如当前奇数版本就是下一个稳定版本的开发版本如版本是版本的开发版本我们可以通过官网来下载自己感兴趣的版本进行源码阅读历史发布版本的源码新特性核心特性概览年月正式发布的是目前历史版本中变化最大的版本首先它有超过个以上新增命令其次它有大量核心特性的新增和改进新增命令新增等新命令对于和命令新增了更多的命令参数选项例如的格式如下而是的阻塞版本代替是用来替代的新数据结构在版本已经没有的配置了版本仅部分数据类型作为过渡阶段在使用底层性能提示安装配置安装下载地址下载到的支持和根据自己实际情况选择将的内容到自定义盘符安装目录取名如打开一个窗口使用命令切换目录到运行如果想方便的话可以把的路径加到系统的环境变量里这样就省得再输路径了后面的那个可以省略如果省略会启用默认的输入之后会显示如下界面这时候另启一个窗口原来的不要关闭不然就无法访问服务端了切换到目录下运行设置键值对取出键值安装由于企业里面做开发都是版的运用和安装几乎不会涉及到版上一步的讲解只是为了知识的完整性版不作为重点同学可以下去自己玩企业实战就认一个版准备编译环境什么是是下的一个编译程序是程序的编译工具是计划提供的编译器家族它能够支持和等等程序设计语言前端同时能够运行在和等等几乎目前所有的硬件平台上鉴于这些特征以及编译代码的高效性使得成为绝大多数自由软件开发编译的首选工具虽然对于程序员们来说编译器只是一个工具除了开发和维护人员很少有人关注编译器的发展但是的影响力是如此之大它的性能提升甚至有望改善所有的自由软件的运行效率同时它的内部结构的变化也体现出现代编译器发展的新特征安装查看版本安装步骤官方建议升级到以上版本下载获得安装包下载后将它放入目录下可以在本地下载好上传到虚拟机也可直接使用命令下载查看压缩包信息解压文件切换到解压后的目录内执行命令出现如下界面代表执行无错误查看已安装文件下的类似系统的客户端操作入口集群使用性能测试工具服务启动后运行该命令可查看系统性能修复有问题的文件修复有问题的文件服务器启动命令将默认的拷贝到自定义目录修改备份目录下配置文件做初始化设置配置文件改完后确保生效记得重启记得重启默认改为默认改为默认直接注释掉只能本机访问或改成本机地址否则影响远程连接添加密码你的密码启动服务连接和乒乓球目录下运行启用备份文件目录下的文件解决警告问题这串输出并不是普通输出的标准输出包含两种标准输出标准错误我们的命令即包含也包含即是我们想要去除的提示解决办法将标准错误去除即可追加将标准错误丢弃即可就没有烦人的警告了端口的由来的默认端口是是由手机键盘字母的位置决定的在的朋友圈语言中是愚蠢和傻的代名词它源于意大利广告女郎在电视节目上说了一堆愚蠢的话之父对她有特殊印象就给她弄成端口号了小练习设置一个为值为获取关闭实例单实例关闭多实例关闭指定端口安装卸载停止服务删除目录下与相关的文件十大数据类型这里说的数据类型是的数据类型的类型都是字符串主要支持以下几种数据类型字符串基本的数据存储单元可以存储字符串整数或者浮点数哈希一个键值对集合可以存储多个字段列表一个简单的列表可以存储一系列的字符串元素集合一个无序集合可以存储不重复的字符串元素有序集合类似于集合但是每个元素都有一个分数与之关联位图基于字符串类型可以对每个位进行操作超日志用于基数统计可以估算集合中的唯一元素数量地理空间用于存储地理位置信息发布订阅一种消息通信模式允许客户端订阅消息通道并接收发布到该通道的消息流用于消息队列和日志存储支持消息的持久化和时间排序模块支持动态加载模块可以扩展的功能字符串是最基本的类型你可以理解成与一模一样的类型一个对应一个类型是二进制安全的意思是的可以包含任何数据比如图片或者序列化的对象类型是最基本的数据类型类型的值最大能存储列表列表是简单的字符串列表按照插入顺序排序你可以添加一个元素到列表的头部左边或者尾部右边它的底层实际是个双端链表最多可以包含个元素每个列表超过亿个元素哈希是一个键值对集合类似于一个小型的数据库是一个类型的和的映射表特别适合用于存储对象每个哈希最多可以存储个键值对集合的是类型的无序集合集合成员是唯一的这就意味着集合中不能出现重复的数据集合对象的编码可以是或者中集合是通过哈希表实现的所以添加删除查找的复杂度都是集合中最大的成员数为每个集合可存储多亿个成员有序集合和一样也是类型元素的集合且不允许重复的成员不同的是每个元素都会关联一个类型的分数正是通过分数来为集合中的成员进行从小到大的排序的成员是唯一的但分数却可以重复集合是通过哈希表实现的所以添加删除查找的复杂度都是集合中最大的成员数为地理空间主要用于存储地理位置信息并对存储的信息进行操作包括添加地理位置的坐标获取地理位置的坐标计算两个位置之间的距离根据用户给定的经纬度坐标来获取指定范围内的地理位置集合基数统计是用来做基数统计的算法的优点是在输入元素的数量或者体积非常非常大时计算基数所需的空间总是固定且是很小的在里面每个键只需要花费内存就可以计算接近个不同元素的基数这和计算基数时元素越多耗费内存就越多的集合形成鲜明对比但是因为只会根据输入元素来计算基数而不会储存输入元素本身所以不能像集合那样返回输入的各个元素常用于统计唯一值的近似值位图由和状态表现的二进制位的位数组可以对字符串进行位操作常用于实现布隆过滤器等位操作位域通过命令可以一次性操作多个比特位域指的是连续的多个比特位它会执行一系列操作并返回一个响应数组这个数组中的元素对应参数列表中的相应操作的执行结果说白了就是通过命令我们可以一次性对多个比特位域进行操作流是版本新增加的数据结构主要用于消息队列本身是有一个发布订阅来实现消息队列的功能但它有个缺点就是消息无法持久化如果出现网络断开宕机等消息就会被丢弃简单来说发布订阅可以分发消息但无法记录历史消息而提供了消息的持久化和主备复制功能可以让任何客户端访问任何时刻的数据并且能记住每一个客户端的访问位置还能保证消息不丢失日志数据类型支持时间序列数据用于消息队列和实时数据处理常用命令如何查找命令命令不区分大小写而是区分大小写的官网中文学习网使用类型获取指定类型下的所有命令如命令下表给出了与键相关的基本命令序号命令及描述该命令用于在存在时删除序列化给定并返回被序列化的值检查给定是否存在为给定设置过期时间以秒计的作用和类似都用于为设置过期时间不同在于命令接受的时间参数是时间戳设置的过期时间以毫秒计设置过期时间的时间戳以毫秒计查找所有符合给定模式的将当前数据库的移动到给定的数据库当中移除的过期时间将持久保持以毫秒为单位返回的剩余的过期时间以秒为单位返回给定的剩余生存时间从当前数据库中随机返回一个修改的名称仅当不存在时将改名为迭代数据库中的数据库键返回所储存的值的类型查看当前库所有的判断某个是否存在可以一次性输入多个返回实际存在的的数量查看的类型删除可以一次性输入多个返回删除成功的的数量非阻塞删除仅仅将从元数据中删除真正的删除会在后续异步中操作查看还有多少秒过期表示永不过期表示已过期秒钟为给定的设置过期时间将当前数据库的移动到给定的数据库当中一个默认有个数据库范围默认使用下标为的库切换数据库默认为查看当前数据库的数量清空当前库清空所有库各数据类型命令字符串单单基本命令设置命令有以及五个可选参数其中为版本添加的可选参数其它为版本添加的可选参数以秒为单位设置过期时间以毫秒为单位设置过期时间设置以秒为单位的时间戳所对应的时间为过期时间设置以毫秒为单位的时间戳所对应的时间为过期时间键不存在的时候设置键值键存在的时候设置键值保留设置前指定键的生存时间返回指定键原本的值若键不存在时返回命令使用参数其效果等同于命令根据官方文档的描述未来版本中命令可能会被淘汰以及为新增的可选参数使用参数时也可与连用为如返回值设置成功则返回失败返回如不满足条件等若使用参数则返回该键原来的值键不存在时返回如何获得设置指定过期的时间单位为秒获取设置指定过期的时间单位为秒获取获取指定的值同时设置获取多个键值同时设置一个或多个对同时获取一个或多个给定的值同时设置一个或多个对当且仅当所有给定都不存在获取指定区间范围内的值获取指定区间范围内的值类似的关系从零到负一表示全部设置指定区间范围内的值将指定偏移数后面与长度相等的内容覆盖数值增减只有数值类型才能进行增减数值递增给数值增加指定的整数数值递减给数值减小指定的整数应用场景点赞量浏览量喜欢量获取字符串长度以及内容追加获取的长度为在末尾追加指定字符分布式锁不存在时设置超时时设置在需要分布式锁的场景中采用以上两种方式设置这个就可以看做一个锁未被占用时才能设置成功列表单多一个双端链表的结构容量是个元素大概多亿主要功能有等一般用在栈队列消息队列等场景都可以插入添加如果键不存在创建新的链表如果键已存在新增内容如果值全移除对应的键也就消失了它的底层实际是个双向链表对两端的操作性能很高通过索引下标的操作中间的节点性能会较差下表列出了列表相关的基本命令序号命令及描述移出并获取列表的第一个元素如果列表没有元素会阻塞列表直到等待超时或发现可弹出元素为止移出并获取列表的最后一个元素如果列表没有元素会阻塞列表直到等待超时或发现可弹出元素为止从列表中弹出一个值将弹出的元素插入到另外一个列表中并返回它如果列表没有元素会阻塞列表直到等待超时或发现可弹出元素为止通过索引获取列表中的元素在列表的元素前或者后插入元素获取列表长度移出并获取列表的第一个元素将一个或多个值插入到列表头部将一个值插入到已存在的列表头部获取列表指定范围内的元素移除列表元素通过索引设置列表元素的值对一个列表进行修剪就是说让列表只保留指定区间内的元素不在指定区间之内的元素都将被删除移除列表的最后一个元素返回值为移除的元素移除列表的最后一个元素并将该元素添加到另一个列表并返回在列表中添加一个或多个值到列表尾部为已存在的列表添加值将一个或多个值插入到列表头部在列表中添加一个或多个值到列表尾部获取列表指定范围内的元素移出并获取列表的第一个元素移除列表的最后一个元素返回值为移除的元素通过索引获取列表中的元素获取列表长度移除列表元素对一个列表进行修剪就是说让列表只保留指定区间内的元素不在指定区间之内的元素都将被删除移除列表的最后一个元素并将该元素添加到另一个列表并返回通过索引设置列表元素的值在列表的元素前或者后插入元素哈希模式不变但是一个键值对相当于下表列出了基本的相关命令序号命令及描述删除一个或多个哈希表字段查看哈希表中指定的字段是否存在获取存储在哈希表中指定字段的值获取在哈希表中指定的所有字段和值为哈希表中的指定字段的整数值加上增量为哈希表中的指定字段的浮点数值加上增量获取哈希表中的所有字段获取哈希表中字段的数量获取所有给定字段的值同时将多个域值对设置到哈希表中将哈希表中的字段的值设为只有在字段不存在时设置哈希表字段的值获取哈希表中所有值迭代哈希表中的键值对将哈希表中的字段的值设为也支持将多个域值对设置到哈希表中与命令相同获取存储在哈希表中指定字段的值同时将多个域值对设置到哈希表中获取所有给定字段的值获取在哈希表中指定的所有字段和值删除一个或多个哈希表字段获取哈希表中字段的数量查看哈希表中指定的字段是否存在获取哈希表中的所有字段获取哈希表中所有值为哈希表中的指定字段的整数值加上增量为哈希表中的指定字段的浮点数值加上增量只有在字段不存在时设置哈希表字段的值应用场景京东购物车早期涉及目前不再采用当前小中厂可用新增商品新增商品增加商品数量商品总数全部选择集合单值多无序无重复下表列出了集合基本命令序号命令及描述向集合添加一个或多个成员获取集合的成员数返回第一个集合与其他集合之间的差异返回给定所有集合的差集并存储在中返回给定所有集合的交集返回给定所有集合的交集并存储在中判断元素是否是集合的成员返回集合中的所有成员将元素从集合移动到集合移除并返回集合中的一个随机元素返回集合中一个或多个随机数移除集合中一个或多个成员返回所有给定集合的并集所有给定集合的并集存储在集合中迭代集合中的元素常用命令向集合添加一个或多个成员返回集合中的所有成员判断元素是否是集合的成员移除集合中一个或多个成员获取集合的成员数返回集合中一个或多个随机元素移除并返回集合中的一个或多个随机元素将元素从集合移动到集合集合运算返回第一个集合与其他集合之间的差异返回所有给定集合的并集返回给定所有集合的交集的新命令返回由所有给定集合的交集产生的基数去重统计数应用场景抽奖小程序朋友圈点赞可能认识的人有序集合下表列出了有序集合的基本命令序号命令及描述向有序集合添加一个或多个成员或者更新已存在成员的分数获取有序集合的成员数计算在有序集合中指定区间分数的成员数有序集合中对指定成员的分数加上增量计算给定的一个或多个有序集的交集并将结果集存储在新的有序集合中在有序集合中计算指定字典区间内成员数量通过索引区间返回有序集合指定区间内的成员通过字典区间返回有序集合的成员通过分数返回有序集合指定区间内的成员返回有序集合中指定成员的索引移除有序集合中的一个或多个成员移除有序集合中给定的字典区间的所有成员移除有序集合中给定的排名区间的所有成员移除有序集合中给定的分数区间的所有成员返回有序集中指定区间内的成员通过索引分数从高到低返回有序集中指定分数区间内的成员分数从高到低排序返回有序集合中指定成员的排名有序集成员按分数值递减从大到小排序返回有序集中成员的分数值计算给定的一个或多个有序集的并集并存储在新的中迭代有序集合中的元素包括元素成员和元素分值常用命令向有序集合添加一个或多个成员或者更新已存在成员的分数通过索引区间按照顺序返回有序集合指定区间内的成员使用参数时会返回值返回有序集中指定区间内的成员通过索引分数从高到低通过分数返回有序集合指定区间内的成员代表不包含返回有序集中指定区间内的成员通过索引分数从高到低返回有序集中指定分数区间内的成员分数从高到低排序返回有序集中成员的分数值获取有序集合的成员数移除有序集合中的一个或多个成员有序集合中对指定成员的分数加上增量计算在有序集合中指定区间分数的成员数新命令从键名列表中的第一个非空排序集中弹出一个或多个元素它们是成员分数对返回有序集合中指定成员的索引返回有序集合中指定成员的排名有序集成员按分数值递减从大到小排序应用场景根据商品销售对商品进行排序显示位图由和状态表现的二进制数组常用于状态记录及统计基本命令给指定的值的第赋值值只能是或时间复杂度获取指定的第位置的值偏移量从开始时间复杂度统计占用多少字节数超过位后按照位一组一进行扩容返回指定中中为的数量时间复杂度对不同的二进制存储数据进行位运算将运算后的结果存储到一个新的集合中参数用于指定新集合的时间复杂度应用场景统计全年按天记录需占用字节数基数统计基数统计介绍基数统计用于统计一个集合中不重复的元素个数需求场景独立访客一般理解为客户统计时需去重统计某网站统计某个文章用户搜索网站关键词数量统计用户每天搜索不同字条个数基本命令下表列出了的基本命令序号命令及描述添加指定元素到中返回给定的基数估算值将多个合并为一个地理空间在版本以后增加了地图位置的处理功能相关介绍地球上的地理位置是使用二维的经纬度表示经度范围纬度范围只要我们确定一个点的经纬度就可以名取得他在地球的位置例如滴滴打车最直观的操作就是实时记录更新各个车的位置然后当我们要找车时在数据库中查找距离我们坐标附近公里范围内部的车辆使用如下即可存在的问题查询性能问题如果并发高数据量大这种查询是要搞垮数据库的这个查询的是一个矩形访问而不是以我为中心公里为半径的圆形访问精准度的问题我们知道地球不是平面坐标系而是一个圆球这种矩形计算在长距离计算时会有很大误差原理核心思想就是将球体转换为平面区块转换为一点主要分为三步将三维的地球变为二维的坐标再将二维的坐标转换为一维的点块最后将一维的点块转换为二进制再通过编码常用命令将多个精度维度位置名称添加到指定的中天安门故宫长城是的子集可以使用相关命令解决乱码问题从键里返回所有给定位置元素的位置精度和维度返回两个给定位置之间的距离米默认单位千米英里英尺以给定的经纬度为中心返回键包含的位置元素当中与中心的距离不超过给定最大距离的所有位置元素和命令一样都可以找出位于指定范围内的元素但是的中心点是由给定的位置元素决定的而不是使用经度和纬度来决定中心点与语法格式如下参数说明米默认单位千米英里英尺在返回位置元素的同时将位置元素与中心之间的距离也一并返回将位置元素的经度和纬度也一并返回以位有符号整数的形式返回位置元素经过原始编码的有序集合分值这个选项主要用于底层应用或者调试实际中的作用并不大限定返回的记录数查找结果根据距离从近到远排序查找结果根据从远到近排序使用来保存地理位置的坐标用于获取一个或多个位置元素的值语法格式如下实例流版的消息中间件阻塞队列新增该数据结构能够实现消息队列它支持消息的持久化支持自动生成全局唯一支持确认消息的模式支持消费者组模式等让消息队列更加稳定可靠消息队列的两种方案按照插入顺序排序你可以添加一个元素到列表的头部左边或者尾部右边所以常用来做异步队列使用将需要延后处理的任务结构体序列化成字符串塞进的列表另一个线程从这个列表中轮询数据进行处理左进右出右进左出发布订阅发布订阅有个缺点就是消息无法持久化如果出现网络断开宕机等消息就会被丢弃而且也没有机制来保证数据的可靠性假设一个消费者都没有那消息就直接被丢弃了底层结构和原理说明一个消息链表将所有加入的消息都串起来每个消息都有一个唯一的和对应的内容消息内容消费组通过命令创建同一个消费组可以有多个消费者游标每个消费组会有个游标任意一个消费者读取了消息都会使游标往前移动消费者消费组中的消费者消费者会有一个状态变量用于记录被当前消费已读取但未的消息如果客户端没有这个变量里面的消息会越来越多一旦某个消息被它就开始减少这个变量在官方被称之为记录了当前已经被客户端读取的消息但是还没有确认字符它用来确保客户端至少消费了消息一次而不会在网络传输的中途丢失了没处理基本命令消息队列相关命令添加消息到末尾对流进行修剪限制长度删除消息获取流包含的元素数量即消息长度获取消息列表会自动过滤已经删除的消息反向获取消息列表从大到小以阻塞或非阻塞方式获取消息列表消费者组相关命令创建消费者组读取消费者组中的消息将消息标记为已处理为消费者组设置新的最后递送消息删除消费者删除消费者组显示待处理消息的相关信息转移消息的归属权查看流和消费者组的相关信息打印消费者组的信息打印流信息使用向队列添加消息如果指定的队列不存在则创建一个队列语法格式队列名称如果不存在就创建消息我们使用表示由生成可以自定义但是要自己保证递增性记录实例使用获取消息列表会自动过滤已经删除的消息语法格式队列名开始值表示最小值结束值表示最大值数量实例使用获取消息列表会自动过滤已经删除的消息语法格式队列名结束值表示最大值开始值表示最小值数量实例使用删除消息语法格式队列名称消息实例使用对流进行修剪限制长度语法格式队列名称允许的最大长度允许的最小数量实例只会返回大于指定的消息使用以阻塞或非阻塞方式获取消息列表语法格式数量可选阻塞毫秒数没有设置就是非阻塞模式队列名消息实例从头部读取两条消息使用创建消费者组语法格式队列名称如果不存在就创建组名表示从尾部开始消费只接受新消息当前消息会全部忽略从头开始消费从尾部开始消费使用读取消费组中的消息语法格式消费组名消费者名读取数量阻塞毫秒数队列名消息代表从第一条尚未被消费的消息开始读取以组为单位一旦有一个消费者读取相同组内的其他消费者将无法读取已被读取的消息消费者组的目的让组内的多个消费者共同分担读取消息所以我们通常会让每个消费者读取部分消息从而实现消息读取负载在多个消费者间是均衡分布的显示待处理消息的相关信息即查询每个消费组内所有消费者已读取但尚未确认的消息将消息标记为已处理查看流和消费者组的相关信息打印消费者组的信息打印流信息位图即将一个字符串看作是一个由二进制位组成的数组并能对变长位宽和任意没有字节对齐的指定整型位域进行寻址和修改主要作用位域修改溢出控制基本语法命令码表位域修改溢出控制使用回绕方法处理有符号整数和无符号整数的溢出情况使用饱和计算方法处理溢出下溢计算的结果为最小的整数而上溢出的结果为最大的整数值命令将拒绝执行那些会导致上溢或下溢情况出现的计算并向用户返回空值表示计算未被执行持久化总体介绍将内存中的数据写到磁盘进行持久化保存官网介绍数据库持久性以指定的时间间隔执行数据集的时间点快照即在指定的时间间隔执行数据集的时间点快照作用在指定的时间间隔内将内存中的数据集快照写入磁盘也就是行话讲的内存快照它恢复时再将硬盘快照文件直接读回到内存里的数据都在内存中保存备份时它执行的是全量快照也就是说把内存中的所有数据都记录到磁盘中最终保存到文件中案例演示配置文件变化以前至操作步骤自动触发在版本中修改中的信息例如修改为秒内次修改则进行持久化保存到文件中修改文件路径默认情况下文件保存到与配置文件相同的目录内我可以将其保存到自定义目录中我们可以使用来获取配置文件中的参数信息修改文件名默认名称为我们可以修改自定义文件名比如加个端口号配置集群时方便区分触发备份时间间隔和写入次数同时满足时才会触发备份使用命令也会触发一次自动备份第一种情况一次性写入两个自动备份成功第二种情况先写入一个没有自动保存等待几秒中使其超过秒时间间隔再写入第二次时自动备份成功如何恢复将备份文件移动到安装目录并启动服务即可注意执行命令也会产生文件但里面是空的无意义所以物理恢复务必做到服务和备份分机隔离即不可以把备份文件和生产服务器放在同一台机器必须分开各自存储以防止生产机物理损坏后备份文件也挂了的窘境手动触发提供了两个命令来生成文件分别是和在主程序中执行会阻塞当前服务器直到持久化工作完成执行命令期间不能处理其他命令线上禁止使用命令进行备份操作默认会在后台异步进行快照操作不阻塞快照同时还可以响应客户端请求该触发方式会一个子进程由子进程复制持久化过程会使用对当前内存中的所有数据做快照这个操作是子进程在后台完成的这就允许主进程同时可以修改数据怎么理解生活中的案例上一份代码到自己仓库自己修改时不影响原有仓库在程序中会产生一个和父进程完全相同的子进程但子进程在此后会多执行系统调用出于效率考虑尽量避免膨胀可以通过命令获取最后一次成功执行快照的时间再中可以使用时间戳将时间戳转换为可以识别的日期时间优势官网说明小总结适合大规模的数据恢复按照业务定时备份对数据完整性和一致性要求不高文件在内存中的加载速度要比快得多劣势官网说明小总结在一定间隔时间做一次备份所以如果意外宕机就会丢失从当前至最近一次快照期间的数据快照之间的数据会丢失内存数据的全量同步如果数据量太大会导致严重影响服务器性能依赖于主进程的在更大的数据集中这可能会导致服务请求的瞬间延迟的时候内存中的数据被克隆了一份大致倍的膨胀性需要考虑数据丢失案例正常录入数据已进行备份写入后模拟服务器意外宕机使用命令杀掉进程恢复服务后重新查看数据数据丢失如何修复文件可以使用命令尝试修复但未必能够修复成功哪些情况会触发快照配置文件中默认的快照配置手动命令执行命令也会产生文件但里面是空的无意义执行且没有设置开启持久化主从复制时主节点自动触发如何禁用快照动态停止所有保存规则的方法禁用快照直接修改配置文件优化配置项小总结官网介绍以日志的形式来记录每个写操作将执行过的所有写指令记录下来读操作不记录只许追加文件但不可以改写文件启动之初会读取该文件重新构建数据换言之重启的话就根据日志文件的内容将写指令从前到后执行一次以完成数据的恢复工作默认情况下是没有开启的开启功能需要设置配置保存的是文件持久化工作流程缓冲区三种写回策略同步写回每个写命令执行完立刻同步地将日志写回磁盘每秒写回每个写命令执行完只是先把日志写到文件的内存缓冲区每隔秒把缓冲区中的内容写入磁盘操作系统控制的写回每个写命令执行完只是先把日志写到文件的内存缓冲区由操作系统决定何时将缓冲区内容写回磁盘配置文件说明如何开启使用默认写回策略每秒钟文件保存路径保存文件的位置和保存文件的位置一样都是通过配置文件的配置在原来目录的基础上多了一层目录最终目录为文件保存名称采用的设计即由多部份组成包含三部分基本文件增量文件清单文件中对应的配置项修复恢复正常恢复重启然后加载数据写入数据到然后服务器新生成了及文件备份新生成的然后删除文件重启然后重新加载结果无数据原因是也是写操作也回被记录到文件中再次停止服务器恢复原来备份的有数据的文件再重启服务查看数据恢复异常修复故意乱写正常的文件模拟网络中断导致文件写入错误重启之后就会进行文件的载入发现启动都不行异常修复命令进行修复重新启动并查询数据成功优势劣势重写机制介绍由于持久化是不断将写命令记录到文件中随着不断的进行的文件会越来越大文件越大占用服务器内存越大以及恢复要求时间越长为了解决这个问题新增了重写机制当文件的大小超过所设定的峰值时就会自动启动文件的内容压缩只保留可以恢复数据的最小指令集或者可以手动使用命令来重新触发机制官网默认配置自动触发满足配置文件中的选项后会记录上次重写时的大小默认配置是当文件大小是上次后大小的一倍且文件大于时手动触发客户端向服务器发送命令重写原理在重写开始前会创建一个重写子进程这个子进程会读取现有的文件并将其包含的指令进行分析压缩并写入到一个临时文件中与此同时主进程会将新接收到的写指令一边累积到内存缓冲区中一边继续写入到原有的文件中这样做是保证原有的文件的可用性避免在重写过程中出现意外当重写子进程完成重写工作后它会给父进程发一个信号父进程收到信号后就会将内存中缓存的写指令追加到新文件中当追加结束后就会用新文件来代替旧文件之后再有新的写指令就都会追加到新的文件中重写文件的操作并没有读取旧的文件而是将整个内存中的数据库内容用命令的方式重写了一个新的文件这点和快照有点类似优化配置项详解小总结混合模式特久化方式能够在指定的时间间隔能对你的数据进行快照存储持久化方式记录每次对服务器写的操作当服务器重启的时候会重新执行这些命令来恢复原始的数据命令以协议追加保存每次写的操作到文件末尾和两种持久化方式可以共存同时开启两种持久化方式时当重启的时候会优先载入文件来恢复原始的数据因为在通常情况下文件保存的数据集要比文件保存的数据集要完整的数据不实时同时使用两者时服务器重启也只会找文件那要不要只使用呢作者建议不要因为更适合用于备份数据库在不断变化不好备份留着作为一个万一的手段混合模式结合了和的优点既能快速加载又能避免丢失过多的数据开启混合方式设置设置的值为表示开启设置为表示禁用的混合方式结论镜像做全量持久化做增量持久化先使用进行快照存储然后使用持久化记录所有的写操作当重写策略满足或手动触发重写的时候将最新的数据存储为新的记录这样的话重启服务的时候会从和两部分恢复数据既保证了数据完整性又提高了恢复数据的性能简单来说混合持久化方式产生的文件一部分是格式一部分是格式包括了头部混写纯缓存模式即同时关闭及采用其他实现持久化操作只做缓存功能禁用禁用持久化模式下我们仍然可以使用命令生成文件配置禁用禁用特久化模式下我们仍然可以使用命令生成文件配置事务介绍可以一次执行多个命令本质是一组命令的集合一个事务中的所有命令都会序列化按顺序地串行化执行而不会被其它命令插入不许加塞作用一个队列中一次性顺序性排他性的执行一系列命令事务与数据库事务的区别单独的隔离操作的事务仅仅是保证事务里的操作会被连续独占的执行命令执行是单线程架构在执行完事务内所有指令前是不可能再去同时执行其他客户端的请求的没有隔离级别的概念因为事务提交前任何指令都不会被实际执行也就不存在事务内的查询要看到事务里的更新在事务外查询不能看到这种问题了不保证原子性的事务不保证原子性也就是不保证所有指令同时成功或同时失败只有决定是否开始执行全部指令的能力没有执行到一半进行回滚的能力排它性会保证一个事务内的命令依次执行而不会被其它命令插入使用常用命令下表列出了事务的相关命令序号命令及描述取消事务放弃执行事务块内的所有命令执行所有事务块内的命令标记一个事务块的开始取消命令对所有的监视监视一个或多个如果在事务执行之前这个或这些被其他命令所改动那么事务将被打断不用场景说明场景一正常执行场景二放弃事务场景三全体连坐场景四冤头债主非编译错误在执行时出错其他命令不受影响场景五监控使用来提供乐观锁定类以于回顾悲观锁悲观锁顾名思义就是很悲观每次去拿数据的时候都认为别人会修改所以每次在拿数据的时候都会上锁这样别人想拿这个数据就会直到它拿到锁乐观锁乐观锁顾名思义就是很乐观每次去拿数据的时候都认为别人不会修改所以不会上锁但是在更新的时候会判断一下在此期间别人有没有去更新这个数据乐观锁策略提交版本必须大于记录当前版本才能执行更新初始化和两个先监控再开启保证两变动在同一个事务内命令是一种乐观锁的实现在修改的时候会检测数据是否被更改如果更改了则执行失败第一个窗口蓝色框第步执行结果返回为空也就是相当于是失败笔记见最下面官网说明小结一旦执行了之前加的监控锁都会被取消当客户端连接丢失的时候比如退出链接所有东西都会被取消监视事务总结开启以开始一个事务入队将多个命令入队到事务中接到这些命令并不会立即执行而是放到等待执行的事务队列里面执行由命令触发事务管道开篇先来个面试题如何优化频繁命令往返造成的性能瓶颈是一种基于客户端服务端模型以及请求响应协议的服务一个请求会遵循以下步骤客户端向服务端发送命令分四步发送命令命令排队命令执行返回结果并监听返回通常以阻塞模式等待服务端响应服务端处理命令并将结果返回给客户端上述两步称为简称数据包往返于两端的时间如果同时需要执行大量的命令那么就要等待上一条命令应答后再执行这中间不仅仅多了而且还频繁调用系统发送网络请求同时需要调用多次和系统方法系统方法会将数据从用户态转移到内核态这样就会对进程上下文有比较大的影响了性能不太好对于上述问题的解决思路就是采用管道管道介绍官网介绍是为了解决往返回时仅仅是将命令打包一次性发送对整个的执行不造成其它任何影响是批做处理命令变种优化措施类似的原生批命令和案例演示可以将所有要批量执行的命令写入到一个文件中然后使用命令参数执行管道小总结与原生批量命令对比原生批量命令是原子性例如是非原子性原生批量命令一次只能执行一种命令支持批量执行不同命令原生批命令是服务端实现而需要服务端与客户端共同完成与事务对比事务具有原子性不保证管道不具有原子性管道一次性将多条命令发送到服务器事务是一条一条的发事务只有在接收到命令后才会执行管道不会执行事务时会阻塞其他命令的执行而执行管道中的命令时不会使用注意事项缓冲的指令只是会依次执行不保证原子性如果执行中指令发生异常将会继续执行后续的指令使用组装的命令个数不能太多不然数据量过大客户端阻塞的时间可能过久同时服务端此时也被迫回复一个队列答复占用很多内存发布订阅专业的事情交给专业的中间件处理了解即可介绍官网介绍是一种消息通信模式发送者发送消息订阅者接收消息可以实现进程间的消息传递可以实现消息中间件的功能通过发布订阅实现消息的引导和分流作用客户端可以订阅任意数量的频道类似我们微信关注多个公众号当有新消息通过命令发送给频道时常用命令下表列出了发布订阅常用命令序号命令及描述订阅一个或多个符合给定模式的频道查看订阅与发布系统状态将信息发送到指定的频道退订所有给定模式的频道订阅给定的一个或多个频道的信息指退订给定的频道推荐先执行订阅后再发布订阅成功之前发布的消息是收不到的缺点发布的消息在系统中不能持久化因此必须先执行订阅再等待消息发布如果先发布了消息那么该消息由于没有订阅者消息将被直接丢弃消息只管发送对于发布者而言消息是即发即失的不管接收也没有机制无法保证消息的消费成功以上的缺点导致的模式就像个小玩具在生产环境中几乎无用武之地为此版本新增了数据结构不但支持多播还支持数据持久化相比更加的强大复制介绍官网介绍就是主从复制以写为主以读为主当数据变化的时候自动将新的数据异步同步到其它数据库作用读写分离容灾恢复数据备份水平扩容支撑高并发使用注意点配从库不配主库如果配置了参数需要密码登陆那么就要配置来设置校验密码否则会拒绝的访问请求基本命令可以查看复制节点的主从关系和配置信息主库主库端口设置从节点的主节点一般写入进配置文件内主库主库端口每次与断开之后都需要重新连接除非你配置进文件在运行期间修改节点的信息如果该数据库已经是某个主数据库的从数据库那么会停上和原主数据库的同步关系转而和新的主数据库同步重新拜码头使当前数据库停止与其他数据库的同步转成主数据库自立为王案例演示架构说明个两个需要台虚机每台都安装操作步骤三边网络相互通且注意防火墙配置拷贝多个文件修改配置文件细节开启后台启动注释绑定关闭保护模式指定端口指定当前工作目录文件名字日志文件名称本机访问密码文件名称文件名称需启用可选步骤默认为从机访问主机的通行密码从机必须配置三大命令主从复制主库主库端口配从库不配主库该换门庭新主库新主库端自立为王一主二仆方案一配置文件固定写死主机主机端口配从不配主分别配置从机先启动后启动主从关系查看日志主机日志从机日志命令主机从机主从问题从机可以执行写命令吗答不可以从机切入点问题是从头开始复制还是从切入点开始复制启动写到跟着同时启动跟着写到写到后才启动那之前的是否也可以复制答是首次一锅端后续跟随写跟主机后从机会上位吗答不会从机不动原地待命从机数据可以正常使用等待主机重启动归来主机重启后主从关系还在吗从机还能否顺利复制答主从关系还在从机仍可以顺利复制某台从机后继续写入从机重启后还能读取新写入的内容吗答可以同问题方案二命令操作手动指定从机停机去掉配置文件中的配置项让台都是主机状态各不从属使用主库主库端口进行指定使用命令指定从机重启后主从关系还在吗答不再了使用命令指定是临时性的新货相传上一个可以是下一个的同样可以接收其他的连接和同步请求成为其他的本质仍然是不能执行写操作中途变更转向会清除之前的数据重新建立拷贝最新的反客为主使当前数据库停止与其他数据库的同步转成主数据库命令复制原理和工作流程启动同步初请启动成功连接到后会发送一个命令首次全新连接一次完全同步全量复制将被自动执行自身原有数据会被数据覆盖清除首次连接全量复制节点收到命令后会开始在后台保存快照即特久化主从复制时会触发同时收集所有接收到的用于修改数据集命令缓存起来节点执行持久化完后将快照文件和所有缓存的命令发送到所有以完成一次完全同步心跳持续保持通信可在配置文件修改包的周期发出包的周期默认是秒进入平稳增量复制继续将新的所有收集到的修改命令自动依次传给完成同步从机下线重连续传会检查里面的和都会保存一个复制的还有一个是保存在中的只会把已经复制的后面的数据复制给类似断点续传复制缺点复制延时信号衰减由于所有的写操作都是先在上操作然后同步更新到上所以从同步到机器有一定的延迟当系统很繁忙的时候延迟问题会更加严重机器数量的增加也会使这个问题更加严重宕机后从机不能上位为新的默认情况下不会在节点中自动重选一个需要进行人工干预哨兵介绍吹哨人巡查监控后台主机是否故障如果故障了根据投票数自动将某一个从库转换为新主库继续对外服务作用俗称无人值守运维监控运行状态包括和当机能自动将切换成新主要功能主从监控监控主从库运行是否正常故障转移如果异常则会进行主从切换将其中一个作为新消息通知哨兵可以将故障转移的结果发送给客户端配置中心客户端通过连接哨兵来获得当前服务的主节点地址实战演练架构说明个哨兵一主二从哨兵负责监控和维护集群不存放数据只是吹哨人一主二从用于数据读取和存放案例步骤目录下新建或拷贝文件文件名称不可改修改哨兵配置文件可将哨兵配置到不同机器此处全配置到配置文件如下配置一主二从关系机器上新建配置文件并设置项访问密码为不然后续可能报错因为下线变为从机后需要访问新的机器上新建配置文件设置好机器上新建配置文件设置好分别启动三台服务并测试主从复制是否正常分别启动三个哨兵或者主机服务如下一台服务三个哨兵服务查看其中一个哨兵日志手动将下线模拟宕机思考几个问题两台从机数据是否正常是否会从剩下两台机器中选出新的之前的重新恢复后谁是老大会不会冲突答案揭晓两台从机数据正常但是可能会出现下面两个问题认识是管道的意思管道里面是数据流通常是从文件或网络套接字读取的数据当该管道从另一端突然关闭时会发生数据突然中断即是对于来说可能是网络被拔出或另一端的进程崩溃解决问题当该异常产生的时候对于服务端来说并没有多少影响因为可能是某个客户端突然中止了进程导致了该错误总结这个异常是客户端读取超时关闭了连接这时候服务器端再向客户端已经断开的连接写数据时就发生了异常会重新投票选出新的之前的恢复后继续延用新选出的参数说明服务监听地址用于客户端连接默认本机地址是否以后台方式运行安全保护模式端口日志文件路径文件路径工作目录设置要监控的服务器表示最少有几个哨兵认可客观下线同意故障迁移的法定票数设置了密码连接服务的密码其他指定多少毫秒之后主节点没有应答哨兵此时哨兵主观上认为主节点下线表示允许并行同步的个数当挂了后哨兵会选出新的此时剩余的会向新的发起同步数据故障转移的超时时间进行故障转移时如果超过设置的毫秒表示故障转移失败配置当某一事件发生时所需要执行的脚本客户端重新配置主节点参数脚本配置文件变化配置文件的内容在运行期间会被动态进行更改切换后的和的内容都会发生改变中会多一行的配置的监控目标会随之调换其他说明生产都是不同机房不同服务器很少出现个哨兵全挂掉的情况可以同时监控多个一行一个哨兵运行流程和选举原理一般建议采取奇数台在选举新的主节点时需要达到法定人数奇数台可以更容易地达成多数派避免出现平局的情况主观下线主观不可用是单个自己主观上检测到的关于的状态从的角度来看如果发送了心跳后在一定时间内没有收到合法的回复就达到了的条件配置文件中的设置了判断主观下线的时间长度客观下线需要一定数量的多个哨兵达成一致意见才能认为一个客观上已经宕掉四个参数含义是对某个组合的一个区分标识一套可以监听多组这样的组合这个参数是进行客观下线的一个依据法定人数法定票数意思是至少有个认为这个有故障才会对这个进行下线以及故障转移因为有的时候某个节点可能因为自身网络原因导致无法连接而此时并没有出现故障所以这就需要多个都一致认为该有问题才可以进行下一步操作这就保证了公平性和高可用选举出领导者哨兵哨兵中选出兵王当主节点被判断客观下线以后各个哨兵节点会进行协商先选举出一个领导者哨兵节点兵王并由该领导者节点也即被选举出的兵王进行故障迁移哨兵领导者兵王如何洗出来的监视该主节点的所有哨兵都有可能被选为领导者选举使用的算法是算法算法的基本思路是先到先得即在一轮选举中哨兵向发送成为领导者的申请如果没有同意过其他哨兵则会同意成为领导者由兵王开始推动故障切换流程并选出一个新第一步新主登基某个被选中成为新选出新的规则剩余节点健康前提下文件中优先级或者最高的从节点数字越小优先级越高复制偏移位置最大的从节点最小的从节点字典顺序码第二步群臣俯首朝天子一朝臣换个码头重新拜执行命令让选出来的从节点成为新的主节点并通过命令让其他节点成为其从节点第三步旧主拜服老回来也认怂将之前已下线的老设置为新选出的新的从节点当老重新上线后它会成为新的从节点会让原来的降级为并恢复正常工作小总结上述的操作均由自己独自完成完全无需人工干预哨兵使用建议哨兵节点的数量应为多个哨兵本身应该集群保证高可用哨兵节点的数量应该是奇数个哨兵节点的配置应一致如果哨兵节点部署在等容器里面尤其要注意端口的正确映射哨兵集群主从复制并不保证数据零丢失集群介绍官网介绍由于数据量过大单个复制集难以承担因此需要对多个复制集进行集群形成水平扩展每个复制集只负责存储整个数据集的一部分这就是的集群其作用是提供在多个节点间共享数据的程序集集群是一个提供在多个节点间共享数据的程序集集群可以支持多个作用集群支持多个每个又可以挂载多个读写分离支持数据的高可用支持海量数据的读写存储操作由于自带的故障转移机制内置了高可用的支持无需再去使用哨兵功能客户端与的节点连接不再需要连接集群中所有的节点只需要任意连接集群中的一个可用节点即可槽位负责分配到各个物理服务节点由对应的集群来负责维护节点插槽和数据之间的关系集群算法分片槽位官网介绍介绍分片介绍插槽和分片的优势槽位映射方案方案一哈希取余分区方案二一致性哈希算法分区一致性算法背景一致性哈希算法在年由麻省理工学院中提出的设计目标是为了解决分布式缓存数据变动和映射问题某个机器宕机了分母数量改变了自然取余数不了作用提出一致性解决方案目的是当服务器个数发生变动时尽量减少影响客户端到服务器的映射关系实现步骤算法构建一致性哈希环服务器节点映射落到服务器的落键规则优点容错性方面拓展性方面缺点节点太少时会产生数据倾斜问题小总结为了在节点数目发生改变时尽可能少的迁移数据将所有的存储节点排列在收尾相接的环上每个在计算后会顺时针找到临近的存储节点存放而当有节点加入或退出时仅影响该节点在环上顺时针相邻的后续节点优点加入和删除节点只影响哈希环中顺时针方向的相邻的节点对其他节点无影响缺点数据的分布和节点的位置有关因为这些节点不是均匀的分布在哈希环上的所以数据在进行存储时达不到均匀分布的效果方案三哈希槽分区产生背景一致性哈希算法的数据倾斜问题哈希槽实质就是一个数组数组形成空间作用解决均匀分配的问题在数据和节点之间又加入了一层把这层称为哈希槽用于管理数据和节点之间的关系现在就相当于节点上放的是槽槽里放的是数据槽解决的是粒度问题相当于把粒度变大了这样便于数据移动哈希解决的是映射问题使用的哈希值来计算所在的槽便于数据分配多少个槽一个集群只能有个槽编号这些槽会分配给集群中的所有主节点分配策略没有要求集群会记录节点和槽的对应关系解决了节点和槽的关系后接下来就需要对求哈希值然后对取模余数是几就落入对应的槽里以槽为单位移动数据因为槽的数目是固定的处理起来比较容易这样数据移动问题就解决了为什么集群的最大槽数是个高频面试题集群并没有使用一致性而是引入了哈希槽的概念集群有个哈希槽每个通过校验后对取模来决定放置哪个槽集群的每个节点负责一部分槽但为什么哈希槽的数量是个呢算法产生的值有该算法可以产生个值换句话说值是分布在之间有更大的不用为什么只用就够作者在做运算的时候为什么不而选择为什么没启用作者在对于该问题的解答说明正常的心跳数据包带有节点的完整配置可以用幂等方式用旧的节点替换旧节点以便更新旧的配置这意味着它们包含原始节点的插槽配置该节点使用的空间和的插槽但是会使用的空间使用的插槽同时由于其他设计折衷集群不太可能扩展到个以上的主节点因此处于正确的范围内以确保每个主机具有足够的插槽最多可容纳个矩阵但数量足够少可以轻松地将插槽配置作为原始位图传播请注意在小型群集中位图将难以压缩因为当较小时位图将设置的位占设置位的很大百分比说明如果槽位为发送心跳信息的消息头达发送的心跳包过于庞大在消息头中最占空间的是当槽位为时这块的大小是在消息头中最占空间的是当槽位为时这块的大小是因为每秒钟节点需要发送一定数量的消息作为心跳包如果槽位为这个消息的消息头太大了浪费带宽的集群主节点数量基本不可能超过个集群节点越多心跳包的消息体内携带的数据越多如果节点过个也会导致网络拥堵因此作者不建议节点数量超过个那么对于节点数在以内的集群个槽位够用了没有必要拓展到个槽位越小节点少的情况下压缩比高容易传输主节点的配置信息中它所负责的哈希槽是通过一张的形式来保存的在传输过程中会对进行压缩但是如果的填充率很高的话表示节点数的压缩率就很低如果节点数很少而哈希槽数量很多的话的压缩率就很低计算结论一个注意点集群不保证强一致性这意味着在特定的条件下集群可能会丢掉一些被系统收到的写入请求命令集群环境案例步骤三主三从集群配置需要三台虚拟机分别创建用于存放集群配置文件的目录新建六个独立的实例服务我已为三台虚拟机分别配置固定的静态分别是其中和后面跟的是密码分别启动六台实例以这台虚拟机为例通过命令为六台机器构建集群关系通过选项集群会自动为每个主节点分配一个从节点以实现高可用性和数据冗余主从节点会尽量分布在不同的物理机器上以提高容错性提示创建三主三从并返回主从关系及主节点槽位信息询问是否接受输入以继续代表代表可以注意到从节点从节点从节点都在不同的虚拟机提示状态代表构建成功查看并检验集群状态命令用于获取实例的复制信息这个命令主要用于查看主从复制的状态和配置输出内容当前实例的角色可以是或连接的从节点数量主节点的复制主节点的复制偏移量从节点的复制偏移量如果是从节点从节点的优先级用于故障转移从节点是否只读主节点的地址如果是从节点主节点的端口号如果是从节点主从连接状态可以是或最后一次与主节点通信的时间秒从节点的复制偏移量从节点的优先级从节点是否只读命令用于获取集群的整体状态信息这个命令主要用于查看集群的健康状况和性能指标输出内容集群的状态可以是正常或故障已分配的槽位数量状态正常的槽位数量可能失败的槽位数量失败的槽位数量集群中已知的节点数量集群的大小主节点数量当前的集群纪元当前节点的纪元发送的消息数量接收的消息数量命令用于获取集群中所有节点的详细信息这个命令主要用于查看集群的拓扑结构和每个节点的状态输出内容节点每个节点的唯一标识符端口节点的地址和端口号节点的状态标志如等如果是从节点显示其主节点的最后一次发送的时间戳最后一次接收的时间戳节点的配置纪元节点的连接状态如或槽位范围如果是主节点显示其负责的槽位范围以端口的实例为例进行演示指定端口号登录使用查看单个实例的复制状态和配置使用查看整个集群的状态和性能指标仅启用这台服务器实例输入的信息如下启动所有虚拟机实例使用查看集群中所有节点的详细信息和拓扑结构三主三从集群读写对新增两个查看效果测试效果只能存入查询也只能查到存入时提示要到这台机器上操作原因写入时需要注意槽位的范围区间需要路由到位解决措施是命令行界面的一个选项它允许你以集群模式连接到集群当你使用参数启动时它会尝试与集群交互并且能够智能地将命令路由到正确的集群节点上使用方法基本的用法是这样的这里的和是集群中第一个节点的地址和是第二个节点的地址以此类推你需要提供集群中至少一个节点的信息但是为了更健壮的连接性通常提供多个节点的地址是更好的选择重要注意事项自动重定向当在集群模式下运行时如果命令需要在不同的槽上执行会自动处理重定向并将结果合并为单个输出集群拓扑发现会通过集群的内置机制来发现整个集群的拓扑结构数据分布集群通过哈希槽来分配数据共有个哈希槽这些哈希槽分布在集群中的各个节点上会根据这个分布情况来决定哪个命令应该发送到哪个节点如果你希望连接到一个集群确保你的环境中正确安装了支持集群功能的版本此外如果你的集群配置了认证还需要使用参数指定密码例如这里后面跟着的是集群节点的地址列表而则指定了访问集群所需的密码请注意实际的命令可能会有所不同具体取决于你的安装和集群的具体配置为防止路由失效可在登录客户端时添加参数以集群模式连接到集群即当我们再次尝试在写入时能够正常写入且写入时提示已自动重定向到对应的实例若要查看集群信息可用命令若要查看某个对应的槽位值可以使用命令主从容错切换迁移案例主节点和从节点切换演示案例演示思考两个问题主节点宕机从节点能否顺利上位为主节点宕机的主节点恢复后能否重新上位恢复如初先手动停止主节点实例从实例检查集群服务状态可以看到状态为成功上位变为主节点集群架构也从原来的三主三从变为三主二从再启动实例看能否重新上位为主机点可以看到即便实例重新恢复依旧是从节点即便恢复但已上位为主节点成为的从节点结论主节点宕机从节点能顺利上位为新的主节点宕机的主节点恢复不能再次恢复到主节点注意集群不保证数据一致性会有一定数据丢失情况如果某一台主节点宕机了从节点还没有成功上位在从节点上位的这个间隙内有新的写入操作数据将会丢失手动故障迁移节点从属调整由于上位为主节点恢复后又不能恢复到主节点我们想要让重新变为主节点该怎么做呢我们可以使用命令将重新调整为主节点是集群模式下的一个管理命令用于触发一个手动的故障转移过程在集群中每个主节点可以有多个从节点从节点主要用于读取操作或作为备份数据如果某个主节点出现故障集群可以通过自动故障转移机制将从节点提升为主节点以保持集群的可用性命令格式参数说明这是一个可选参数当指定此参数时不会重新配置从节点为新的主节点这意味着在故障转移后旧的从节点将成为新的主节点但它不会立即创建新的从节点这对于某些特定的故障转移场景可能有用比如当管理员想要手动控制后续的从节点设置时功能当你在集群中执行命令时将会发生以下事情手动触发故障转移强制将从节点提升为主节点以替代已知不可用的主节点重新分配槽新提升的主节点将接管原主节点负责的所有哈希槽重新配置从节点如果未指定参数则新的主节点将自动重新配置其从节点关系注意事项执行命令通常是在主节点确实已经确认不可用的情况下进行的如果集群中有足够的健康节点并且配置了复制关系那么自动故障转移通常会在后台默默地完成不需要人工干预在执行之前请确保了解集群的当前状态以及故障转移的影响范围示例假设你想要手动触发一个故障转移过程可以这样执行命令或者如果你想手动触发故障转移但不重新配置从节点可以这样执行请替换等为你集群中的节点信息确保你在执行命令前有足够的权限并且理解该命令对集群的影响在实例上使用重新配置为主节点重新变为主节点变为的从节点主从扩容案例在上新建两个实例并启动分别启动实例此时新加入的节点实例分别是自己的将新增的空槽号作为节点加入到原有集权密码自己实际地址自己实际地址就是将要作为新增节点就是原来集群节点里面的领路人相当于拜拜的码头从而找到组织加入集群在任意实例检查集群状态可以看到已经加入到集群但是也就是说暂时还没有分配到槽号重新分配槽号在任意一个实例使用命令重新分派槽号密码地址端口号例如此处我使用以下命令询问我们想要分配多少个槽号现在集群中一共有个节点一共个槽号平均分配询问我们新分配的槽号谁来接收复制的实例输入输入槽位重新分配后重新检查可以看到已经分配了个槽号另外可以看到新分配的的槽号是不连续的而之前的都是连续的为什么会出现这个情况呢原因是重新分配成本太高所以前家各自匀出来一部分从三个旧节点分别匀出个坑位给新节点为主节点分配从节点密码新端口新端口新主节点例如此处我使用的命令为重新检查集群状态可以看到集群已经变为四主四从且的主节点为主从缩容案例假设我们需要和下线恢复三主三从检查集群状况先获得从节点的节点从集群中将删除密码从机端口从机节点例如此处我使用命令重新检查集群状态可以看到下说明已经移除集群集群中只剩下个实例将槽号清空将槽号重新分配给实例输入等待分配完成重新检查集群状态可以看到节点变成了的从节点个槽位都指给它变成了个槽位相当于全部都给了不然要输入次一锅端将删除命令密码端口节点例如此处我使用以下命令重新检查集群状态可以看到集群又恢复到了三主三从集群常用操作命令和算法分析通识占位符不在同一个槽位下的多键操作支持不好不在同一个槽位下的键值无法使用等多键操作可以通过来定义同一个组的概念使中内相同内容的键值对放到一个槽位去源码浅谈集群有个哈希槽每个通过校验后对取模来决定放置哪个槽集群的每个节点负责一部分槽常用命令集群是否完整才对外提供服务查看该槽号是否被占用返回槽号尚未被占用返回槽号已经被占用指定键应该存放到哪个槽位上集成总体概述三者联系第一代第二代第三代生态体系常见问题设置未注释保护模式需设置为防火墙设置关闭或配置白名单服务器地址和密码是否正确忘记写的服务端口和密码集成介绍是官网推荐的一个面向客户端库文件实现了对各类进行封装调用步骤建改写主启动类业务类依赖通用依赖模块通用基础配置配置或者主启动类入门案例获取连接通过指定和端口指定访问服务器的密码获得了客户端可以像一样访问返回代表连接成功集成介绍是一个的驱动包翻译为生菜没错就是吃的那种生菜所以它的长这样与的区别和都是的客户端它们都可以连接服务器但是在之后默认都是使用的这个客户端连接服务器因为当使用客户端连接服务器的时候每个线程都要拿自己创建的实例去连接客户端当有很多个线程的时候不仅开销大需要反复的创建关闭一个连接而且也是线程不安全的一个线程通过实例更改服务器中的数据之后会影响另一个线程但是如果使用这个客户端连接服务器的时候就不会出现上面的情况底层使用的是当有多个线程都需要连接服务器的时候可以保证只创建一个连接使所有的线程共享这一个连接这样可以减少创建关闭一个连接时候的开销而目这种方式也是线程安全的不会出现一个线程通过更改服务器中的数据之后而影响另一个线程的情况案例改业务类若使用出错需检查版本使用构建器链式编程创建连接客户端通过创建操作的各种业务逻辑课后有问题请给我发邮件关闭和释放资源集成推荐连接单机改与整合依赖写关于错误详见快速使用在结合会提示空指针异常原因是在中将默认路径匹配策略从更改为导致出错解决办法是切换回之前单机修改为自己真实或者自定义配置在结合会提示空指针异常原因是在中将默认路径匹配策略从更改为导致出错解决办法是切换回之前单机你自己的利用构建接口文档整合订单接口新增订单根据查询订单京东订单序列号问题键和值都是通过提供的序列化到数据库的默认使用的是被序列化成这样线上通过去查询对应的非常不方便使用连接解决乱码问题可以在登录时使用命令序列化方式默认默认情况下使用该数据列化方式我们来看下源码方法解决方案使用的子类默认使用的是添加配置类实现和相同功能序列化的工具配置类下面这个请一定开启配置序列化过野生没有序列化过提供了操作类型的所有方法提供了操作类型的所有方法提供了操作的所有方法提供了操作表的所有方法提供了操作的所有方法设置序列化方式设置的序列化方式使用替换默认序列化连接集群改集群获取失败最大重定向次数或者集群最大重定向次数问题故障演练人为模拟机器意外宕机手动先对集群命令方式手动验证各种读写命令看看是否上位集群能自动感知并自动完成主备切换对应的会被选举为新的节点故障现象客户端没有动态感知到的最新集群信息集群部署采用了主从拓扑结构数据读写访问节点节点负责备份当宕机主从切换成功手动个经典故障原因分析版本默认的连接池采用当集群节点发生变化后默认是不会刷新节点拓扑解决方案排除采用不推荐重写连接工厂实例极度不推荐仅做参考不写不写不写按照周期刷新拓扑根据事件刷新拓扑命令超时时间超时后才会使用新的拓扑信息重新建立连接刷新节点集群拓扑动态感应推荐改写配置文件配置自适应拓扑刷新及定时刷新时间即可集群获取失败最大重定向次数支持集群拓扑动态感应刷新自适应拓扑刷新是否使用所有可用的更新默认关闭定时刷新或者配置集群配置支持集群拓扑动态感应刷新自适应拓扑刷新是否使用所有可用的更新默认关闭定时刷新参考菜鸟教程',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-12-17 10:03:35',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><script async="" defer="" src="https://umami.shiguangdev.cn/script.js" data-website-id="bc279f56-9a19-416a-a035-58c0abed887b"></script><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="時光" type="application/atom+xml">
</head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="/img/avatar.png"><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://www.shiguang666.eu.org" title="時光主页"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="時光主页"><span class="back-menu-item-text">時光主页</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://nav.shiguang666.eu.org" title="時光导航站"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://nav.shiguang666.eu.org/images/logo-collapsed@2x.png" alt="時光导航站"><span class="back-menu-item-text">時光导航站</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://love.shiguang666.eu.org" title="表白生成器"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://love.shiguang666.eu.org/favicon.ico" alt="表白生成器"><span class="back-menu-item-text">表白生成器</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://publish.shiguang666.eu.org/" title="時光站点发布页"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/homepage.png" alt="時光站点发布页"><span class="back-menu-item-text">時光站点发布页</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://release.shiguang666.eu.org/" title="地址发布页"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/homepage.png" alt="地址发布页"><span class="back-menu-item-text">地址发布页</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://qq.shiguang666.eu.org/" title="時光的QQ"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/qqavatar.jpg" alt="時光的QQ"><span class="back-menu-item-text">時光的QQ</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://game.shiguang666.eu.org" title="怀旧游戏机"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/chat.png" alt="怀旧游戏机"><span class="back-menu-item-text">怀旧游戏机</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://games.shiguang666.eu.org" title="H5小游戏合集"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://echeverra.cn/wp-content/uploads/2021/06/cropped-thmub-32x32.jpg" alt="H5小游戏合集"><span class="back-menu-item-text">H5小游戏合集</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">后台管理</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://umami.shiguangdev.cn/share/1CY8KW6pqM0UBUIL/blog.shiguangdev.cn" title="访客统计"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://umami.shiguangdev.cn/favicon.ico" alt="访客统计"><span class="back-menu-item-text">访客统计</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://img.shiguangdev.cn/" title="時光图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/favicon.ico" alt="時光图床"><span class="back-menu-item-text">時光图床</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://qexo.shiguang666.eu.org/" title="Qexo"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://unpkg.com/qexo-static@2.2.3/qexo/images/icon.png" alt="Qexo"><span class="back-menu-item-text">Qexo</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">時光</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 归档</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/charts/"><i class="fa fa-line-chart faa-tada"></i><span> 统计</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随机</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/news/"><i class="fa fa-newspaper faa-tada"></i><span> 早报亭</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/music/?id=10051718332&amp;server=netease"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/gallery/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/xjj/"><i class="fa fa-rocket faa-tada"></i><span> 养生堂</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><i class="anzhiyufont anzhiyu-icon-artstation faa-tada" style="font-size: 0.9em;"></i><span> 朋友圈</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comment/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于我</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button only-home" id="travellings_button" title="随机前往一个开往项目网站"><a class="site-page" onclick="anzhiyu.totraveling()" title="随机前往一个开往项目网站" href="javascript:void(0);" rel="external nofollow" data-pjax-state="external"><i class="anzhiyufont anzhiyu-icon-train"></i></a></div><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="/img/wechat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/wechat.png"></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/alipay.png"></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/12/"><span class="card-archive-list-date">十二月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">15</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/11/"><span class="card-archive-list-date">十一月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">8</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/10/"><span class="card-archive-list-date">十月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">31</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/09/"><span class="card-archive-list-date">九月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">38</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/08/"><span class="card-archive-list-date">八月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">9</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/07/"><span class="card-archive-list-date">七月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">18</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/06/"><span class="card-archive-list-date">六月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">30</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/05/"><span class="card-archive-list-date">五月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">20</span><span>篇</span></div></a></li></ul></div><hr></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item on" id="consoleCommentBarrage" onclick="anzhiyu.switchCommentBarrage()" title="热评开关"><a class="commentBarrage"><i class="anzhiyufont anzhiyu-icon-message"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" itemprop="url">学习笔记</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/%E5%B0%9A%E7%A1%85%E8%B0%B7/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>尚硅谷</span></a><a class="article-meta__tags" href="/tags/Redis/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>Redis</span></a></span></div></div><h1 class="post-title" itemprop="name headline">【尚硅谷】Redis7实战（基础篇）</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2024-09-10T10:48:52.000Z" title="发表于 2024-09-10 18:48:52">2024-09-10</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2024-12-17T02:03:35.385Z" title="更新于 2024-12-17 10:03:35">2024-12-17</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">31.6k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>114分钟</span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为上海"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>上海</span><span class="post-meta-separator"></span><span class="post-meta-commentcount"><i class="anzhiyufont anzhiyu-icon-comments post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/2024/09/10/818e370d0e76/#post-comment" tabindex="-1"><span id="twikoo-count"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></a></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://img.shiguangdev.cn/i/2024/08/28/66cedaf5d014a.jpeg"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope="" itemtype="https://blog.shiguang666.eu.org/2024/09/10/818e370d0e76/"><header><a class="post-meta-categories" href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" itemprop="url">学习笔记</a><a href="/tags/%E5%B0%9A%E7%A1%85%E8%B0%B7/" tabindex="-1" itemprop="url">尚硅谷</a><a href="/tags/Redis/" tabindex="-1" itemprop="url">Redis</a><h1 id="CrawlerTitle" itemprop="name headline">【尚硅谷】Redis7实战（基础篇）</h1><span itemprop="author" itemscope="" itemtype="http://schema.org/Person">時光</span><time itemprop="dateCreated datePublished" datetime="2024-09-10T10:48:52.000Z" title="发表于 2024-09-10 18:48:52">2024-09-10</time><time itemprop="dateCreated datePublished" datetime="2024-12-17T02:03:35.385Z" title="更新于 2024-12-17 10:03:35">2024-12-17</time></header><div id="postchat_postcontent"><blockquote>
<p>在线视频：<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV13R4y1v7sP">尚硅谷Redis零基础到进阶，最强redis7教程，阳哥亲自带练（附redis面试题）</a></p>
<p>课程资料：<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/16O-XG7_teVWMEl-2LNfhfg?pwd=5qi3">尚硅谷Redis7教程</a></p>
<p>随堂代码</p>
<p>Gitee: <a target="_blank" rel="noopener" href="https://gitee.com/an_shiguang/learn-redis">https://gitee.com/an_shiguang/learn-redis</a></p>
<p>GitHub: <a target="_blank" rel="noopener" href="https://github.com/Shiguang-coding/learn-redis">https://github.com/Shiguang-coding/learn-redis</a></p>
</blockquote>
<h1 id="Redis入门概述"><a href="#Redis入门概述" class="headerlink" title="Redis入门概述"></a>Redis入门概述</h1><h2 id="是什么"><a href="#是什么" class="headerlink" title="是什么"></a>是什么</h2><p>Redis：<font color="red"> Re</font>mote <font color="red"> Di</font>ctionary <font color="red"> S</font>erver（远程字典服务器）</p>
<p>Redis（Remote Dictionary Server）是一个开源的内存数据库，遵守 BSD 协议，它提供了一个高性能的键值（key-value）存储系统，常用于缓存、消息队列、会话存储等应用场景。</p>
<h3 id="官网解释"><a href="#官网解释" class="headerlink" title="官网解释"></a>官网解释</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://redis.io/about/">Redis 官网 简介</a></p>
</blockquote>
<p>Redis 是世界上速度最快的内存数据库。它提供用于缓存、矢量搜索和 NoSQL 数据库的云和本地解决方案，可无缝融入任何技术堆栈，让数字客户能够轻松构建、扩展和部署我们世界所运行的快速应用程序。</p>
<p>要使用 Redis，您可以选择 Redis 源可用许可证 2.0 (RSALv2) 或服务器端公共许可证 v1 (SSPLv1)。</p>
<p>Redis 提供 <a target="_blank" rel="noopener" href="https://redis.io/resources/data-types/strings/">字符串</a>、 <a target="_blank" rel="noopener" href="https://redis.io/resources/data-types/hashes/">哈希</a>、 <a target="_blank" rel="noopener" href="https://redis.io/resources/data-types/lists/">列表</a>、 <a target="_blank" rel="noopener" href="https://redis.io/resources/data-types/sets/">集合</a>、 具有范围查询的有序 <a target="_blank" rel="noopener" href="https://redis.io/resources/data-types/sorted-sets/">集、</a><a target="_blank" rel="noopener" href="https://redis.io/resources/data-types/bitmaps/">位图</a>、 <a target="_blank" rel="noopener" href="https://redis.io/resources/data-types/hyperloglogs/">超级日志</a>、 <a target="_blank" rel="noopener" href="https://redis.io/resources/data-types/geospatial/">地理空间索引</a>和 <a target="_blank" rel="noopener" href="https://redis.io/resources/data-types/streams/">流</a> 等 <a target="_blank" rel="noopener" href="https://redis.io/resources/data-types/">数据结构</a>。Redis 具有内置 <a target="_blank" rel="noopener" href="https://redis.io/topics/replication">复制</a>、 <a target="_blank" rel="noopener" href="https://redis.io/commands/eval">Lua 脚本</a>、 <a target="_blank" rel="noopener" href="https://redis.io/resources/reference/eviction/">LRU 驱逐</a>、 <a target="_blank" rel="noopener" href="https://redis.io/topics/transactions">事务</a>和不同级别的 <a target="_blank" rel="noopener" href="https://redis.io/topics/persistence">磁盘持久性，并通过</a><a target="_blank" rel="noopener" href="https://redis.io/topics/sentinel">Redis Sentinel</a>提供高可用性 并通过<a target="_blank" rel="noopener" href="https://redis.io/topics/cluster-tutorial">Redis Cluster</a> 提供自动分区 。</p>
<p>您可以 对这些类型 运行<strong>原子操作，例如</strong><a target="_blank" rel="noopener" href="https://redis.io/commands/append">附加到字符串</a>； <a target="_blank" rel="noopener" href="https://redis.io/commands/hincrby">增加哈希中的值</a>； <a target="_blank" rel="noopener" href="https://redis.io/commands/lpush">将元素推送到列表</a>； <a target="_blank" rel="noopener" href="https://redis.io/commands/sinter">计算集合的交集</a>、 <a target="_blank" rel="noopener" href="https://redis.io/commands/sunion">并集</a> 和 <a target="_blank" rel="noopener" href="https://redis.io/commands/sdiff">差集</a>；或 <a target="_blank" rel="noopener" href="https://redis.io/commands/zrange">获取排序集合中排名最高的成员</a>。</p>
<p>为了实现最佳性能，Redis 使用 <strong>内存数据集</strong>。根据您的使用情况，Redis 可以通过定期 <a target="_blank" rel="noopener" href="https://redis.io/topics/persistence#snapshotting">将数据集转储到磁盘</a> 或将 <a target="_blank" rel="noopener" href="https://redis.io/topics/persistence#append-only-file">每个命令附加到基于磁盘的日志来</a>持久化您的数据。如果您只需要功能丰富的联网内存缓存，也可以禁用持久性。</p>
<p>Redis 支持 <a target="_blank" rel="noopener" href="https://redis.io/topics/replication">异步复制</a>，具有快速无阻塞同步和网络分裂时自动重新连接以及部分重新同步的功能。</p>
<p>Redis 还包括：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://redis.io/topics/transactions">交易</a></li>
<li><a target="_blank" rel="noopener" href="https://redis.io/topics/pubsub">发布/订阅</a></li>
<li><a target="_blank" rel="noopener" href="https://redis.io/commands/eval">Lua 脚本</a></li>
<li><a target="_blank" rel="noopener" href="https://redis.io/commands/expire">具有有限生存时间的密钥</a></li>
<li><a target="_blank" rel="noopener" href="https://redis.io/resources/reference/eviction">LRU 密钥驱逐</a></li>
<li><a target="_blank" rel="noopener" href="https://redis.io/topics/sentinel">自动故障转移</a></li>
</ul>
<p>您可以在 <a target="_blank" rel="noopener" href="https://redis.io/clients">大多数编程语言</a>中使用 Redis 。</p>
<p>Redis 是用 <strong>ANSI C</strong>编写的 ，可以在大多数 POSIX 系统（如 Linux、*BSD 和 Mac OS X）上运行，无需依赖外部系统。Linux 和 OS X 是 Redis 开发和测试最多的两个操作系统，我们 <strong>建议使用 Linux 进行部署</strong>。Redis 可以在 Solaris 衍生的系统（如 SmartOS）上运行，但支持是 <em>尽力而为的</em>。没有对 Windows 版本的官方支持。</p>
<h3 id="Redis之父安特雷兹"><a href="#Redis之父安特雷兹" class="headerlink" title="Redis之父安特雷兹"></a>Redis之父安特雷兹</h3><blockquote>
<p>GitHub: <a target="_blank" rel="noopener" href="https://github.com/antirez">https://github.com/antirez</a></p>
<p>个人博客：<a target="_blank" rel="noopener" href="http://antirez.com/latest/0">http://antirez.com/latest/0</a></p>
</blockquote>
<p>Redis之父<code>Salvatore Sanfilippo</code>，一名意大利程序员，大家更习惯称呼他<code>Antirez</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/10/66e02bd08ed2c.png" alt="image-20240910192153544"></p>
<h2 id="能干吗"><a href="#能干吗" class="headerlink" title="能干吗"></a>能干吗</h2><h3 id="主流功能与应用"><a href="#主流功能与应用" class="headerlink" title="主流功能与应用"></a>主流功能与应用</h3><ol>
<li><p><strong><font color="red">分布式缓存，挡在mysql数据库之前的带刀护卫</font></strong></p>
<p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/10/66e02e71d778e.png" alt="image-20240910193307077"></p>
<p> 与传统数据库关系(mysql)相比，Redis是key-value数据库(NoSQL一种)，mysql是关系型数据库；</p>
<p> Redis数据操作主要在内存，而mysql主要存储在磁盘；</p>
<p> Redis在某一些场景使用中要明显优于mysql，比如计数器、排行榜等方面Redis通常用于一些特定场景，需要与Mysql一起配合使用，两者并不是相互替换和竞争关系，而是共用和配合使用。</p>
</li>
<li><p><strong>内存存储和持久化(RDB+AOF)</strong></p>
<p>redis支持异步将内存中的数据写到硬盘上，同时不影响继续服务</p>
</li>
<li><p><strong>高可用架构搭配</strong></p>
</li>
<li><p><strong>缓存穿透、击穿、雪崩</strong></p>
</li>
<li><p><strong>分布式锁</strong></p>
</li>
<li><p><strong>队列</strong></p>
<p>Reids提供list和set操作，这使得Redis能作为一个很好的消息队列平台来使用。</p>
<p>我们常通过Reids的队列功能做购买限制。比如到节假日或者推广期间，进行一些活动，对用户购买行为进行限制，限制今天只能购买几次商品或者一段时间内只能购买一次。也比较适合适用。</p>
</li>
<li><p><strong>排行榜+点赞</strong></p>
</li>
</ol>
<h3 id="Redis功能图解"><a href="#Redis功能图解" class="headerlink" title="Redis功能图解"></a>Redis功能图解</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/10/66e0311a6cbc7.png" alt="image-20240910194427374"></p>
<h3 id="Redis优势"><a href="#Redis优势" class="headerlink" title="Redis优势"></a>Redis优势</h3><blockquote>
<h4 id="Redis-与其他-key-value-存储有什么不同？"><a href="#Redis-与其他-key-value-存储有什么不同？" class="headerlink" title="Redis 与其他 key-value 存储有什么不同？"></a><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/redis-intro.html">Redis 与其他 key-value 存储有什么不同？</a></h4><p>Redis 与其他 key-value 存储系统的主要区别在于其提供了丰富的数据类型、高性能的读写能力、原子性操作、持久化机制、以及丰富的特性集。</p>
<p>以下是 Redis 的一些独特之处：</p>
<ul>
<li><strong>丰富的数据类型：</strong>Redis 不仅仅支持简单的 key-value 类型的数据，还提供了 list、set、zset（有序集合）、hash 等数据结构的存储。这些数据类型可以更好地满足特定的业务需求，使得 Redis 可以用于更广泛的应用场景。</li>
<li><strong>高性能的读写能力：</strong>Redis 能读的速度是 110000次/s，写的速度是 81000次/s。这种高性能主要得益于 Redis 将数据存储在内存中，从而显著提高了数据的访问速度。</li>
<li><strong>原子性操作：</strong>Redis 的所有操作都是原子性的，这意味着操作要么完全执行，要么完全不执行。这种特性对于确保数据的一致性和完整性非常重要。</li>
<li><strong>持久化机制：</strong>Redis 支持数据的持久化，可以将内存中的数据保存在磁盘中，以便在系统重启后能够再次加载使用。这为 Redis 提供了数据安全性，确保数据不会因为系统故障而丢失。</li>
<li><strong>丰富的特性集：</strong>Redis 还支持 publish/subscribe（发布/订阅）模式、通知、key 过期等高级特性。这些特性使得 Redis 可以用于消息队列、实时数据分析等复杂的应用场景。</li>
<li><strong>主从复制和高可用性：</strong>Redis 支持 master-slave 模式的数据备份，提供了数据的备份和主从复制功能，增强了数据的可用性和容错性。</li>
<li><strong>支持 Lua 脚本：</strong>Redis 支持使用 Lua 脚本来编写复杂的操作，这些脚本可以在服务器端执行，提供了更多的灵活性和强大的功能。</li>
<li><strong>单线程模型：</strong>尽管 Redis 是单线程的，但它通过高效的事件驱动模型来处理并发请求，确保了高性能和低延迟。</li>
</ul>
</blockquote>
<h4 id="性能极高"><a href="#性能极高" class="headerlink" title="性能极高"></a><strong>性能极高</strong></h4><p>Redis能读的速度是110000次/秒，写的速度是81000次/秒</p>
<h4 id="数据类型丰富"><a href="#数据类型丰富" class="headerlink" title="数据类型丰富"></a>数据类型丰富</h4><p>Redis不仅仅支持简单的key-value类型的数据，同时还提供List、Let、Zset、Hash等数据结构的存储</p>
<h4 id="支持数据持久化"><a href="#支持数据持久化" class="headerlink" title="支持数据持久化"></a>支持数据持久化</h4><p>Redis可以将内存中的数据保持在磁盘中，重启的时候可以再次加载进行使用</p>
<h4 id="支持数据备份"><a href="#支持数据备份" class="headerlink" title="支持数据备份"></a>支持数据备份</h4><p>Redis支持数据的备份，即<code>master-slave</code>模式的数据备份</p>
<h3 id="小总结"><a href="#小总结" class="headerlink" title="小总结"></a>小总结</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/10/66e033ba94807.png" alt="image-20240910195539756"></p>
<h2 id="去哪下"><a href="#去哪下" class="headerlink" title="去哪下"></a>去哪下</h2><blockquote>
<p>本课程采用 <a target="_blank" rel="noopener" href="https://github.com/redis/redis/releases/tag/7.0.0">7.0.0版本</a></p>
</blockquote>
<h3 id="官网"><a href="#官网" class="headerlink" title="官网"></a>官网</h3><p>Redis官网: <a target="_blank" rel="noopener" href="https://redis.io/downloads/">https://redis.io/downloads/</a></p>
<p>Redis中文网: <a target="_blank" rel="noopener" href="https://www.redis.net.cn/">https://www.redis.net.cn/</a></p>
<p>Redis中文学习网: <a target="_blank" rel="noopener" href="https://redis.com.cn/download.html">https://redis.com.cn/download.html</a></p>
<h3 id="其他文档资料"><a href="#其他文档资料" class="headerlink" title="其他文档资料"></a>其他文档资料</h3><p>Redis源码地址： <a target="_blank" rel="noopener" href="https://github.com/redis/redis">https://github.com/redis/redis</a></p>
<p>Redis在线测试(貌似跑路了)</p>
<p>在线地址：<a target="_blank" rel="noopener" href="https://try.redis.io/">https://try.redis.io</a></p>
<p>项目地址：<a target="_blank" rel="noopener" href="https://github.com/alexmchale/try.redis">https://github.com/alexmchale/try.redis</a></p>
<p>Redis命令参考：<a target="_blank" rel="noopener" href="http://doc.redisfans.com/">http://doc.redisfans.com</a></p>
<h2 id="怎么玩"><a href="#怎么玩" class="headerlink" title="怎么玩"></a>怎么玩</h2><ul>
<li>多数据类型基本操作配置</li>
<li>持久化和复制，RDB/AOF</li>
<li>事务控制</li>
<li>复制，集群</li>
<li>……</li>
</ul>
<h2 id="Redis迭代演化和Redis7新特性"><a href="#Redis迭代演化和Redis7新特性" class="headerlink" title="Redis迭代演化和Redis7新特性"></a>Redis迭代演化和Redis7新特性</h2><h3 id="Redis版本升级"><a href="#Redis版本升级" class="headerlink" title="Redis版本升级"></a>Redis版本升级</h3><p>Redis之父安特雷兹的发言: <strong><a target="_blank" rel="noopener" href="http://antirez.com/news/132">http://antirez.com/news/132</a></strong></p>
<h3 id="各版本抵达及推演过程"><a href="#各版本抵达及推演过程" class="headerlink" title="各版本抵达及推演过程"></a>各版本抵达及推演过程</h3><h4 id="里程碑的重要版本"><a href="#里程碑的重要版本" class="headerlink" title="里程碑的重要版本"></a>里程碑的重要版本</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/10/66e03d8654bd2.png" alt="image-20240910203725832"><br>5.0版本是直接升级到6.0版本，对于这个激进的升级，Redis之父antirez表现得很有信心和兴奋，所以第一时间发文来阐述6.0的一些重大功能”Redis 6.0.0 GA is out!”</p>
<p>随后Redis再接再厉，直接王炸Redis7.0  （2023年爆款）</p>
<p>2022年4月27日Redis正式发布了7.0更新（其实早在2022年1月31日，Redis已经预发布了7.0rc-1，经过社区的考验后，确认没重大Bug才会正式发布)</p>
<h4 id="各版本命名规则"><a href="#各版本命名规则" class="headerlink" title="各版本命名规则"></a>各版本命名规则</h4><p>Redis从发布至今，已经有十余年的时光了，一直遵循着自己的命名规则：</p>
<p><strong>版本号第二位如果是奇数，则为非稳定版本</strong> 如2.7、2.9、3.1</p>
<p><strong>版本号第二位如果是偶数，则为稳定版本</strong> 如2.6、2.8、3.0、3.2</p>
<p><strong>当前奇数版本就是下一个稳定版本的开发版本</strong>，如2.9版本是3.0版本的开发版本</p>
<p>我们可以通过redis.io官网来下载自己感兴趣的版本进行源码阅读：</p>
<p>历史发布版本的源码：<a target="_blank" rel="noopener" href="https://download.redis.io/releases/">https://download.redis.io/releases/</a></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/10/66e03e640287e.png" alt="image-20240910204107714"></p>
<h3 id="Redis7新特性"><a href="#Redis7新特性" class="headerlink" title="Redis7新特性"></a>Redis7新特性</h3><h4 id="Redis7核心特性概览"><a href="#Redis7核心特性概览" class="headerlink" title="Redis7核心特性概览"></a>Redis7核心特性概览</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/10/66e03f0b209a9.png" alt="image-20240910204354699"></p>
<p>2022 年 4 月正式发布的 Redis 7.0 是目前 Redis 历史版本中变化最大的版本。</p>
<p>首先，它有超过 50 个以上新增命令；其次，它有大量核心特性的新增和改进。</p>
<h4 id="Redis-Functions"><a href="#Redis-Functions" class="headerlink" title="Redis Functions"></a>Redis Functions</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/10/66e03fa4ada42.png" alt="image-20240910204628320"></p>
<h4 id="Client-eviction"><a href="#Client-eviction" class="headerlink" title="Client-eviction"></a>Client-eviction</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/10/66e03fca6c8ac.png" alt="image-20240910204706097"></p>
<h4 id="Muti-part-AOF"><a href="#Muti-part-AOF" class="headerlink" title="Muti-part AOF"></a>Muti-part AOF</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/10/66e03fe90060b.png" alt="image-20240910204736636"></p>
<h4 id="ACL-V2"><a href="#ACL-V2" class="headerlink" title="ACL V2"></a>ACL V2</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/10/66e0400283df3.png" alt="image-20240910204802134"></p>
<h4 id="新增命令"><a href="#新增命令" class="headerlink" title="新增命令"></a>新增命令</h4><p>新增ZMPOP，BZMPOP，LMPOP，BLMPOP等新命令，对于EXPIRE和SET命令，新增了更多的命令参数选项。例如，ZMPOP的格式如下：ZMPOP numkeys key[key…] MIN|MAX[COUNT count]，而BZMPOP是ZMPOP的阻塞版本。</p>
<h4 id="listpack代替ziplist"><a href="#listpack代替ziplist" class="headerlink" title="listpack代替ziplist"></a>listpack代替ziplist</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/10/66e040bd6998b.png" alt="image-20240910205109095"></p>
<p>listpack 是用来替代 ziplist 的新数据结构，在 7.0 版本已经没有 ziplist 的配置了（6.0版本仅部分数据类型作为过渡阶段在使用）</p>
<h4 id="底层性能提示"><a href="#底层性能提示" class="headerlink" title="底层性能提示"></a>底层性能提示</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/10/66e040fc0b523.png" alt="image-20240910205211448"></p>
<h1 id="Redis安装配置"><a href="#Redis安装配置" class="headerlink" title="Redis安装配置"></a>Redis安装配置</h1><h2 id="Windows安装"><a href="#Windows安装" class="headerlink" title="Windows安装"></a>Windows安装</h2><p>下载地址：<a target="_blank" rel="noopener" href="https://github.com/dmajkic/redis/downloads">https://github.com/dmajkic/redis/downloads</a></p>
<p>下载到的Redis支持32bit和64bit。根据自己实际情况选择，将64bit的内容cp到自定义盘符安装目录取名redis。 如 C:\reids</p>
<p>打开一个cmd窗口 使用cd命令切换目录到 C:\redis 运行 redis-server.exe redis.conf 。</p>
<p>如果想方便的话，可以把redis的路径加到系统的环境变量里，这样就省得再输路径了，后面的那个redis.conf可以省略，</p>
<p>如果省略，会启用默认的。输入之后，会显示如下界面：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/10/66e042f8aaecb.png" alt="image-20240910210040281"></p>
<p>这时候另启一个cmd窗口，原来的不要关闭，不然就无法访问服务端了。</p>
<p>切换到redis目录下运行 </p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli.exe -h 127.0.0.1 -p 6379 </span><br></pre></td></tr></tbody></table></figure>

<p>设置键值对 </p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> myKey abc</span><br></pre></td></tr></tbody></table></figure>

<p>取出键值</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">get myKey</span><br></pre></td></tr></tbody></table></figure>

<h2 id="Linux安装"><a href="#Linux安装" class="headerlink" title="Linux安装"></a>Linux安装</h2><blockquote>
<p>由于企业里面做Redis开发，99%都是Linux版的运用和安装，几乎不会涉及到Windows版，上一步的讲解只是为了知识的完整性，Windows版不作为重点，同学可以下去自己玩，企业实战就认一个版：Linux</p>
</blockquote>
<h3 id="准备gcc编译环境"><a href="#准备gcc编译环境" class="headerlink" title="准备gcc编译环境"></a>准备gcc编译环境</h3><h4 id="什么是gcc"><a href="#什么是gcc" class="headerlink" title="什么是gcc"></a>什么是gcc</h4><p>gcc是linux下的一个编译程序，是C程序的编译工具。</p>
<p>GCC(GNU Compiler Collection) 是 GNU(GNU’s Not Unix) 计划提供的编译器家族，它能够支持 C, C++, Objective-C, Fortran, Java 和 Ada 等等程序设计语言前端，同时能够运行在 x86, x86-64, IA-64, PowerPC, SPARC和Alpha 等等几乎目前所有的硬件平台上。鉴于这些特征，以及 GCC 编译代码的高效性，使得 GCC 成为绝大多数自由软件开发编译的首选工具。虽然对于程序员们来说，编译器只是一个工具，除了开发和维护人员，很少有人关注编译器的发展，但是 GCC 的影响力是如此之大，它的性能提升甚至有望改善所有的自由软件的运行效率，同时它的内部结构的变化也体现出现代编译器发展的新特征。</p>
<h4 id="安装gcc"><a href="#安装gcc" class="headerlink" title="安装gcc"></a>安装gcc</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install gcc-c++</span><br></pre></td></tr></tbody></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/10/66e043fa6d5d9.png" alt="image-20240910210458013"></p>
<h4 id="查看gcc版本"><a href="#查看gcc版本" class="headerlink" title="查看gcc版本"></a>查看gcc版本</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -v</span><br></pre></td></tr></tbody></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/10/66e0484715c37.png" alt="image-20240910212318799"></p>
<h3 id="Redis安装步骤"><a href="#Redis安装步骤" class="headerlink" title="Redis安装步骤"></a>Redis安装步骤</h3><blockquote>
<p>官方建议升级到6.0.8以上版本</p>
</blockquote>
<h4 id="1、下载获得安装包"><a href="#1、下载获得安装包" class="headerlink" title="1、下载获得安装包"></a>1、<strong>下载获得安装包</strong></h4><p>下载<code>redis-7.0.0.tar.gz</code>后将它放入<code>/opt</code> 目录下</p>
<p>可以在本地下载好上传到虚拟机，也可直接使用命令下载</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://download.redis.io/releases/redis-7.0.0.tar.gz</span><br></pre></td></tr></tbody></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/10/66e049ed0af33.png" alt="image-20240910213020739"></p>
<p>查看压缩包信息</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> -l redis-7.0.0.tar.gz</span><br></pre></td></tr></tbody></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/10/66e04a1b99226.png" alt="image-20240910213107321"></p>
<h4 id="2、解压文件"><a href="#2、解压文件" class="headerlink" title="2、解压文件"></a>2、<strong>解压文件</strong></h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf redis-7.0.0.tar.gz</span><br></pre></td></tr></tbody></table></figure>

<p>切换到解压后的目录内</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> redis-7.0.0</span><br></pre></td></tr></tbody></table></figure>

<h4 id="3、执行make命令"><a href="#3、执行make命令" class="headerlink" title="3、执行make命令"></a><strong>3、执行make命令</strong></h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></tbody></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/10/66e04c3148cb3.png" alt="image-20240910214000977"></p>
<p>出现如下界面代表执行无错误</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/10/66e04c57efb9d.png" alt="image-20240910214039706"></p>
<p>查看已安装文件</p>
<blockquote>
<p>Linux下的/usr/local类似windows系统的C:\\Proaram files</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/10/66e04e508a7db.png" alt="image-20240910214904343"></p>
<p><font color="red">redis-cli：Redis客户端，操作入口</font></p>
<p><font color="red">redis-sentinel：redis集群使用</font></p>
<p><code>redis-benchmark</code>： 性能测试工具，服务启动后运行该命令，可查看系统性能</p>
<p><code>redis-check-aof</code>：修复有问题的AOF文件</p>
<p><code>redis-check-dump</code>：修复有问题的<code>dump.rdb</code>文件</p>
<p><code>redis-server</code>：Redis服务器启动命令</p>
<h4 id="4、将默认的redis-con拷贝到自定义目录"><a href="#4、将默认的redis-con拷贝到自定义目录" class="headerlink" title="4、将默认的redis.con拷贝到自定义目录"></a><strong>4、将默认的<code>redis.con</code>拷贝到自定义目录</strong></h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/10/66e0508171051.png" alt="image-20240910215825175"></p>
<h4 id="5、修改备份目录下redis-conf配置文件做初始化设置"><a href="#5、修改备份目录下redis-conf配置文件做初始化设置" class="headerlink" title="5、修改备份目录下redis.conf配置文件做初始化设置"></a><font color="red">5、修改备份目录下redis.conf配置文件做初始化设置</font></h4><blockquote>
<p><code>redis.conf</code>配置文件，改完后确保生效，记得重启，记得重启</p>
</blockquote>
<p>1、默认<code>daemonize no</code> 改为 <code>daemonize yes</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/10/66e053d206824.png" alt="image-20240910221233770"></p>
<p>2、默认<code>protected-mode yes</code>  改为 <code>protected-mode no</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/10/66e05402ddb4f.png" alt="image-20240910221322720"></p>
<p>3、默认<code>bind 127.0.0.1</code>直接注释掉(127.0.0.1只能本机访问)或改成本机IP地址，否则影响远程IP连接</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/10/66e05436cf755.png" alt="image-20240910221414410"></p>
<p>4、添加redis密码 <code>requirepass &lt;你的密码&gt;</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/10/66e0544ec30a6.png" alt="image-20240910221438595"></p>
<h4 id="6、启动服务"><a href="#6、启动服务" class="headerlink" title="6、启动服务"></a>6、启动服务</h4><h5 id="redis-cli连接和“乒乓球”"><a href="#redis-cli连接和“乒乓球”" class="headerlink" title="redis-cli连接和“乒乓球”"></a>redis-cli连接和“乒乓球”</h5><p><code>usr/local/bin</code>目录下运行<code>redis-server</code>启用备份文件目录下的<code>redis.conf</code>文件</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/10/66e057498be49.png" alt="image-20240910222721292"></p>
<h5 id="解决警告问题"><a href="#解决警告问题" class="headerlink" title="解决警告问题"></a><strong>解决警告问题</strong></h5><blockquote>
<p>Warning: Using a password with ‘-a’ or ‘-u’ option on the command line interface may not be safe.</p>
</blockquote>
<p>warning 这串输出并不是普通输出</p>
<p>shell的标准输出包含两种：</p>
<p>1：（标准输出）</p>
<p>2：（标准错误）我们的命令，即包含1也包含2，2即是我们想要去除的提示。</p>
<p>解决办法将标准错误去除即可，追加<code>2&gt;/dev/nul</code>，将标准错误丢弃即可，就没有烦人的警告了。</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -a shiguang -p 6379 2&gt;/dev/nul</span><br></pre></td></tr></tbody></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/10/66e0587da078d.png" alt="image-20240910223229459"></p>
<h4 id="7、6379端口的由来"><a href="#7、6379端口的由来" class="headerlink" title="7、6379端口的由来"></a>7、6379端口的由来</h4><p>Redis的默认端口是<code>6379</code>，是由手机键盘字母<code>MERZ</code>的位置决定的。MERZ在Antirez的朋友圈语言中是”愚蠢和傻B”的代名词，它源于意大利广告女郎<code>Alessia Merz</code>在电视节目上说了一堆愚蠢的话，redis之父对她有”特殊”印象，就给她弄成端口号了</p>
<h4 id="8、helloworld小练习"><a href="#8、helloworld小练习" class="headerlink" title="8、helloworld小练习"></a>8、helloworld小练习</h4><p>设置一个key为key，值为 “helloworld”</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> key helloworld</span><br></pre></td></tr></tbody></table></figure>

<p>获取 key</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">get key</span><br></pre></td></tr></tbody></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/10/66e05e7fbb17c.png" alt="image-20240910225807549"></p>
<h4 id="9、关闭实例"><a href="#9、关闭实例" class="headerlink" title="9、关闭实例"></a>9、关闭实例</h4><p>单实例关闭</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -a &lt;your-password&gt; shutdown</span><br></pre></td></tr></tbody></table></figure>

<p>多实例关闭（指定端口）</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -p 6379 shutdown</span><br></pre></td></tr></tbody></table></figure>



<h2 id="Docker安装"><a href="#Docker安装" class="headerlink" title="Docker安装"></a>Docker安装</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1gr4y1U7CY/?p=39">https://www.bilibili.com/video/BV1gr4y1U7CY/?p=39</a></p>
</blockquote>
<h2 id="Redis卸载"><a href="#Redis卸载" class="headerlink" title="Redis卸载"></a>Redis卸载</h2><h3 id="停止redis-server服务"><a href="#停止redis-server服务" class="headerlink" title="停止redis-server服务"></a>停止redis-server服务</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/10/66e05fad4e907.png" alt="image-20240910230309058"></p>
<h3 id="删除-usr-local-lib-目录下与redis相关的文件"><a href="#删除-usr-local-lib-目录下与redis相关的文件" class="headerlink" title="删除 /usr/local/lib 目录下与redis相关的文件"></a>删除 <code>/usr/local/lib</code> 目录下与redis相关的文件</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/10/66e05ffdccb54.png" alt="image-20240910230429503"></p>
<h1 id="Redis十大数据类型"><a href="#Redis十大数据类型" class="headerlink" title="Redis十大数据类型"></a>Redis十大数据类型</h1><blockquote>
<p>这里说的数据类型是valuel的数据类型，key的类型都是字符串</p>
</blockquote>
<p>Redis 主要支持以下几种数据类型：</p>
<ul>
<li><strong>string（字符串）:</strong> 基本的数据存储单元，可以存储字符串、整数或者浮点数。</li>
<li>**hash（哈希）:**一个键值对集合，可以存储多个字段。</li>
<li>**list（列表）:**一个简单的列表，可以存储一系列的字符串元素。</li>
<li>**set（集合）:**一个无序集合，可以存储不重复的字符串元素。</li>
<li><strong>zset(sorted set：有序集合):</strong> 类似于集合，但是每个元素都有一个分数（score）与之关联。</li>
<li><strong>位图（Bitmaps）：</strong>基于字符串类型，可以对每个位进行操作。</li>
<li><strong>超日志（HyperLogLogs）：</strong>用于基数统计，可以估算集合中的唯一元素数量。</li>
<li><strong>地理空间（Geospatial）：</strong>用于存储地理位置信息。</li>
<li><strong>发布/订阅（Pub/Sub）：</strong>一种消息通信模式，允许客户端订阅消息通道，并接收发布到该通道的消息。</li>
<li><strong>流（Streams）：</strong>用于消息队列和日志存储，支持消息的持久化和时间排序。</li>
<li><strong>模块（Modules）：</strong>Redis 支持动态加载模块，可以扩展 Redis 的功能。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/11/66e117c0a522f.png" alt="image-20240911120833048"></p>
<h2 id="String（字符串）"><a href="#String（字符串）" class="headerlink" title="String（字符串）"></a>String（字符串）</h2><p>string 是 redis 最基本的类型，你可以理解成与 Memcached 一模一样的类型，一个 key 对应一个 value。</p>
<p>String类型是<font color="red">二进制安全的</font>。意思是 redis 的 string 可以包含任何数据，比如jpg图片或者序列化的对象。</p>
<p>string 类型是 Redis 最基本的数据类型，string 类型的值最大能存储 512MB。</p>
<h2 id="List（列表）"><a href="#List（列表）" class="headerlink" title="List（列表）"></a>List（列表）</h2><p>Redis列表是简单的字符串列表，按照插入顺序排序。</p>
<p>你可以添加一个元素到列表的<font color="blue">头部（左边）或者尾部（右边）</font></p>
<p>它的底层实际是个<font color="red">双端链表</font>，最多可以包含 <code>2^32 - 1</code> 个元素 (4294967295, 每个列表超过40亿个元素)</p>
<h2 id="hash（哈希）"><a href="#hash（哈希）" class="headerlink" title="hash（哈希）"></a><strong>hash（哈希）</strong></h2><p>Redis hash 是一个键值(key=&gt;value)对集合，类似于一个小型的 NoSQL 数据库。</p>
<p>Redis hash 是一个 string 类型的 field 和 value 的映射表，hash 特别适合用于存储对象。</p>
<p>每个哈希最多可以存储 <code>2^32 - 1</code> 个键值对。</p>
<h2 id="Set（集合）"><a href="#Set（集合）" class="headerlink" title="Set（集合）"></a>Set（集合）</h2><p>Redis 的 Set 是 String 类型的无序集合。</p>
<p>集合成员是唯一的，这就意味着集合中不能出现重复的数据，集合对象的编码可以是 <code>intset</code> 或者 <code>hashtable</code>。</p>
<p>Redis 中Set集合是通过哈希表实现的，所以添加，删除，查找的复杂度都是 <code>O(1)</code>。</p>
<p>集合中最大的成员数为 <code>2^32 - 1</code> (4294967295, 每个集合可存储40多亿个成员)</p>
<h2 id="zset（sorted-set：有序集合）"><a href="#zset（sorted-set：有序集合）" class="headerlink" title="zset（sorted set：有序集合）"></a>zset（sorted set：有序集合）</h2><p>Redis zset 和 set 一样也是string类型元素的集合,且不允许重复的成员。</p>
<p><font color="red">不同的是每个元素都会关联一个double类型的分数</font>，redis正是通过分数来为集合中的成员进行从小到大的排序。</p>
<p><font color="red">zset的成员是唯一的,但分数(score)却可以重复</font>。</p>
<p><font color="red">zset集合是通过哈希表实现的，所以添加，删除，查找的复杂度都是 O(1)。 集合中最大的成员数为 2^32 - 1</font></p>
<h2 id="GEO（地理空间）"><a href="#GEO（地理空间）" class="headerlink" title="GEO（地理空间）"></a>GEO（地理空间）</h2><p>Redis GEO 主要用于存储地理位置信息，并对存储的信息进行操作，包括：</p>
<ol>
<li>添加地理位置的坐标。</li>
<li>获取地理位置的坐标。</li>
<li>计算两个位置之间的距离。</li>
<li>根据用户给定的经纬度坐标来获取指定范围内的地理位置集合</li>
</ol>
<h2 id="HyperLogLog（基数统计）"><a href="#HyperLogLog（基数统计）" class="headerlink" title="HyperLogLog（基数统计）"></a>HyperLogLog（基数统计）</h2><p>HyperLogLog 是用来做<font color="red">基数统计</font>的算法，HyperLogLog 的优点是，在输入元素的数量或者体积非常非常大时，计算基数所需的空间总是固定且是很小的。</p>
<p>在 Redis 里面，每个 HyperLogLog 键只需要花费 12 KB 内存，就可以计算接近 2^64 个不同元素的基 数。这和计算基数时，元素越多耗费内存就越多的集合形成鲜明对比。</p>
<p>但是，因为 HyperLogLog 只会根据输入元素来计算基数，而不会储存输入元素本身，所以 HyperLogLog 不能像集合那样，返回输入的各个元素。</p>
<p>常用于统计唯一值的近似值</p>
<h2 id="Bitmap（位图）"><a href="#Bitmap（位图）" class="headerlink" title="Bitmap（位图）"></a>Bitmap（位图）</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/11/66e11e86e2ad6.png" alt="image-20240911123727500"></p>
<p>由0和1状态表现的二进制位的位（bit）数组，可以对字符串进行位操作。</p>
<p>常用于实现布隆过滤器等位操作。</p>
<h2 id="Bitfield（位域）"><a href="#Bitfield（位域）" class="headerlink" title="Bitfield（位域）"></a>Bitfield（位域）</h2><p>通过bitfield命令可以一次性操作多个<font color="red">比特位域(指的是连续的多个比特位)</font>，它会执行一系列操作并返回一个响应数组，这个数组中的元素对应参数列表中的相应操作的执行结果。</p>
<p>说白了就是通过bitfield命令我们可以一次性对多个比特位域进行操作。</p>
<h2 id="Stream（流）"><a href="#Stream（流）" class="headerlink" title="Stream（流）"></a>Stream（流）</h2><p>Redis Stream 是 Redis 5.0 版本新增加的数据结构。</p>
<p>Redis Stream 主要用于消息队列（MQ，Message Queue），Redis 本身是有一个 Redis 发布订阅 (pub/sub) 来实现消息队列的功能，但它有个缺点就是消息无法持久化，如果出现网络断开、Redis 宕机等，消息就会被丢弃。</p>
<p>简单来说发布订阅 (pub/sub) 可以分发消息，但无法记录历史消息。</p>
<p>而 Redis Stream 提供了消息的持久化和主备复制功能，可以让任何客户端访问任何时刻的数据，并且能记住每一个客户端的访问位置，还能保证消息不丢失</p>
<p>日志数据类型，支持时间序列数据。</p>
<p>用于消息队列和实时数据处理。</p>
<h1 id="Redis常用命令"><a href="#Redis常用命令" class="headerlink" title="Redis常用命令"></a>Redis常用命令</h1><h2 id="如何查找命令"><a href="#如何查找命令" class="headerlink" title="如何查找命令"></a>如何查找命令</h2><blockquote>
<p>命令不区分大小写，而key是区分大小写的</p>
</blockquote>
<p>官网：<a target="_blank" rel="noopener" href="https://redis.io/commands">https://redis.io/commands</a></p>
<p>Redis中文学习网：<a target="_blank" rel="noopener" href="https://redis.com.cn/commands.html">https://redis.com.cn/commands.html</a></p>
<p>使用<code>help @&lt;类型&gt;</code>  获取指定类型下的所有命令，如 <code>help @string</code></p>
<h2 id="Redis-keys-命令"><a href="#Redis-keys-命令" class="headerlink" title="Redis keys 命令"></a>Redis keys 命令</h2><p>下表给出了与 Redis 键相关的基本命令：</p>
<table>
<thead>
<tr>
<th align="left">序号</th>
<th align="left">命令及描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/keys-del.html">DEL key</a> 该命令用于在 key 存在时删除 key。</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/keys-dump.html">DUMP key</a> 序列化给定 key ，并返回被序列化的值。</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/keys-exists.html">EXISTS key</a> 检查给定 key 是否存在。</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/keys-expire.html">EXPIRE key</a> seconds 为给定 key 设置过期时间，以秒计。</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/keys-expireat.html">EXPIREAT key timestamp</a> EXPIREAT 的作用和 EXPIRE 类似，都用于为 key 设置过期时间。 不同在于 EXPIREAT 命令接受的时间参数是 UNIX 时间戳(unix timestamp)。</td>
</tr>
<tr>
<td align="left">6</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/keys-pexpire.html">PEXPIRE key milliseconds</a> 设置 key 的过期时间以毫秒计。</td>
</tr>
<tr>
<td align="left">7</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/keys-pexpireat.html">PEXPIREAT key milliseconds-timestamp</a> 设置 key 过期时间的时间戳(unix timestamp) 以毫秒计</td>
</tr>
<tr>
<td align="left">8</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/keys-keys.html">KEYS pattern</a> 查找所有符合给定模式( pattern)的 key 。</td>
</tr>
<tr>
<td align="left">9</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/keys-move.html">MOVE key db</a> 将当前数据库的 key 移动到给定的数据库 db 当中。</td>
</tr>
<tr>
<td align="left">10</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/keys-persist.html">PERSIST key</a> 移除 key 的过期时间，key 将持久保持。</td>
</tr>
<tr>
<td align="left">11</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/keys-pttl.html">PTTL key</a> 以毫秒为单位返回 key 的剩余的过期时间。</td>
</tr>
<tr>
<td align="left">12</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/keys-ttl.html">TTL key</a> 以秒为单位，返回给定 key 的剩余生存时间(TTL, time to live)。</td>
</tr>
<tr>
<td align="left">13</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/keys-randomkey.html">RANDOMKEY</a> 从当前数据库中随机返回一个 key 。</td>
</tr>
<tr>
<td align="left">14</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/keys-rename.html">RENAME key newkey</a> 修改 key 的名称</td>
</tr>
<tr>
<td align="left">15</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/keys-renamenx.html">RENAMENX key newkey</a> 仅当 newkey 不存在时，将 key 改名为 newkey 。</td>
</tr>
<tr>
<td align="left">16</td>
<td align="left">[SCAN cursor <a target="_blank" rel="noopener" href="https://www.runoob.com/redis/keys-scan.html">MATCH pattern] [COUNT count]</a> 迭代数据库中的数据库键。</td>
</tr>
<tr>
<td align="left">17</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/keys-type.html">TYPE key</a> 返回 key 所储存的值的类型。</td>
</tr>
</tbody></table>
<p><code>keys *</code>: 查看当前库所有的key</p>
<p><code>exists key</code>: 判断某个key是否存在，可以一次性输入多个key，返回实际存在的key的数量</p>
<p><code>type key</code>: 查看key的类型</p>
<p><code>del key</code> : 删除key,可以一次性输入多个key，返回删除成功的key的数量</p>
<p><code>unlink key</code>：非阻塞删除，仅仅将keys从keyspace元数据中删除，真正的删除会在后续异步中操作。</p>
<p><code>ttl key</code>：查看还有多少秒过期，<code>-1</code>表示永不过期，<code>-2</code>表示已过期</p>
<p><code>expire key 秒钟</code>: 为给定的key设置过期时间</p>
<p><code>move key dbindex</code>: 将当前数据库的key移动到给定的数据库当中，一个Redis默认有16个数据库，dbindex范围 [0-15]，默认使用下标为0的库</p>
<p><code>select dbindex</code>: 切换数据库，默认为0</p>
<p><code>dbsize</code>：查看当前数据库key的数量</p>
<p><code>flushdb</code>: 清空当前库</p>
<p><code>flushall</code>: 清空所有库</p>
<h2 id="各数据类型命令"><a href="#各数据类型命令" class="headerlink" title="各数据类型命令"></a>各数据类型命令</h2><h3 id="String（字符串）-1"><a href="#String（字符串）-1" class="headerlink" title="String（字符串）"></a>String（字符串）</h3><blockquote>
<p>单key单value</p>
</blockquote>
<h4 id="基本命令"><a href="#基本命令" class="headerlink" title="基本命令"></a>基本命令</h4><h5 id="设置key"><a href="#设置key" class="headerlink" title="设置key"></a>设置key</h5><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> key value [NX|XX] [GET] [EX seconds|PX milliseconds|EXAT unix-time-seconds|PXAT unix-time-milliseconds|KEEPTTL]</span><br></pre></td></tr></tbody></table></figure>

<p><code>SET</code>命令有<code>EX</code>、<code>PX</code>、<code>NX</code>、<code>XX</code>以及<code>KEEPTTL</code>五个可选参数，其中<code>KEEPTTL</code>为6.O版本添加的可选参数，其它为2.6.12版本添加的可选参数。</p>
<ul>
<li><code>EX seconds</code>：以秒为单位设置过期时间</li>
<li><code>PX milliseconds</code>：以毫秒为单位设置过期时间</li>
<li><code>EXAT timestamp</code>: 设置以秒为单位的UNIX时间戳所对应的时间为过期时间</li>
<li><code>PXAT milliseconds-timestamp</code>：设置以毫秒为单位的UNIX时间戳所对应的时间为过期时间</li>
<li><code>NX</code>：键不存在的时候设置键值</li>
<li><code>XX</code>：键存在的时候设置键值</li>
<li><code>KEEPTTL</code>: 保留设置前指定键的生存时间</li>
<li><code>GET</code>： 返回指定键原本的值，若键不存在时返回<code>nil</code></li>
</ul>
<p><code>SET</code>命令使用<code>EX</code>、<code>PX</code>、<code>NX</code>参数，其效果等同于<code>SETEX</code>、<code>PSETEX</code>、<code>SETNX</code>命令。根据官方文档的描述，未来版本中<code>SETEX</code>、<code>PSETEX</code>、<code>SETNX</code>命令可能会被淘汰。<br><code>EXAT</code>、<code>PXAT</code>以及<code>GET</code>为Redis 6.2新增的可选参数。</p>
<p>使用<code>GET</code>参数时，也可与<code>SET</code>连用为<code>GETSET</code> ，如<code>getset key1 val1</code></p>
<p><strong>返回值</strong><br>设置成功则返回<code>OK</code>，失败返回<code>nil</code>，如不满足<code>NX</code>、<code>XX</code>条件等。<br>若使用<code>GET</code>参数，则返回该键原来的值，键不存在时返回<code>nil</code>。</p>
<p><strong>如何获得设置指定key过期的Unix时间，单位为秒</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">    <span class="comment">// 获取设置指定key过期的Unix时间，单位为秒</span></span><br><span class="line">    System.out.println(System.currentTimeMillis()/<span class="number">1000L</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<h5 id="获取key"><a href="#获取key" class="headerlink" title="获取key"></a>获取key</h5><p><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/strings-get.html">GET key</a>:获取指定 key 的值。</p>
<h4 id="同时设置-获取多个键值"><a href="#同时设置-获取多个键值" class="headerlink" title="同时设置/获取多个键值"></a>同时设置/获取多个键值</h4><p><code>MSET key value [key value...]</code>: 同时设置一个或多个 key-value 对</p>
<p><code>MGET key [key...]</code>: 同时获取一个或多个给定 key 的值</p>
<p><code>MSETNX key value [key value..]</code>: 同时设置一个或多个 key-value 对，当且仅当所有给定 key 都不存在</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/11/66e1401360a63.png" alt="image-20240911150036062"></p>
<h4 id="获取指定区间范围内的值"><a href="#获取指定区间范围内的值" class="headerlink" title="获取指定区间范围内的值"></a>获取指定区间范围内的值</h4><p><code>GETRANGE key</code>: 获取指定区间范围内的值，类似between……and的关系,从零到负一表示全部</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/11/66e1411f5027a.png" alt="image-20240911150504082"></p>
<p><code>SETRANGE key offset value</code>: 设置指定区间范围内的值，将指定偏移数后面与value长度相等的内容覆盖</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/11/66e141a28ac55.png" alt="image-20240911150715317"></p>
<h4 id="数值增减"><a href="#数值增减" class="headerlink" title="数值增减"></a>数值增减</h4><blockquote>
<p>只有数值类型才能进行增减</p>
</blockquote>
<p><code>INCR key</code>： 数值递增</p>
<p><code>INCRBY key increment </code>  :  给数值增加指定的整数</p>
<p><code>DECR key</code>: 数值递减</p>
<p><code>DECRBY key decrement</code>: 给数值减小指定的整数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/11/66e143cc1fed1.png" alt="image-20240911151628839"></p>
<p><strong>应用场景</strong>：</p>
<ol>
<li>点赞量</li>
<li>浏览量</li>
<li>喜欢量</li>
<li>……</li>
</ol>
<h4 id="获取字符串长度以及内容追加"><a href="#获取字符串长度以及内容追加" class="headerlink" title="获取字符串长度以及内容追加"></a>获取字符串长度以及内容追加</h4><p><code>STRLEN key</code>： 获取key的长度</p>
<p><code>APPEND key value</code> : 为key在末尾追加指定字符</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/11/66e1448262d6e.png" alt="image-20240911151931164"></p>
<h4 id="分布式锁"><a href="#分布式锁" class="headerlink" title="分布式锁"></a>分布式锁</h4><p><code>SETNX key value</code>: set if not exist，key不存在时设置key</p>
<p><code>SETEX key value</code>: set with expire ，key超时时设置key</p>
<p>在需要分布式锁的场景中采用以上两种方式设置key，这个key就可以看做一个锁，未被占用时才能设置成功</p>
<h3 id="List（列表）-1"><a href="#List（列表）-1" class="headerlink" title="List（列表）"></a>List（列表）</h3><blockquote>
<p>单key多value</p>
</blockquote>
<p><font color="red">一个双端链表的结构</font>，容量是<code>2^32 - 1</code> 个元素，大概40多亿，主要功能有<code>push</code>/<code>pop</code>等，一般用在栈、队列、消息队列等场景。</p>
<p>left、right都可以插入添加；</p>
<p>如果键不存在，创建新的链表；</p>
<p>如果键已存在，新增内容；</p>
<p>如果值全移除，对应的键也就消失了。</p>
<p><font color="blue">它的底层实际是个<strong>双向链表，对两端的操作性能很高，通过索引下标的操作中间的节点性能会较差。</strong></font></p>
<p>下表列出了列表相关的基本命令：</p>
<table>
<thead>
<tr>
<th align="left">序号</th>
<th align="left">命令及描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left">[BLPOP key1 <a target="_blank" rel="noopener" href="https://www.runoob.com/redis/lists-blpop.html">key2 ] timeout</a> 移出并获取列表的第一个元素， 如果列表没有元素会阻塞列表直到等待超时或发现可弹出元素为止。</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">[BRPOP key1 <a target="_blank" rel="noopener" href="https://www.runoob.com/redis/lists-brpop.html">key2 ] timeout</a> 移出并获取列表的最后一个元素， 如果列表没有元素会阻塞列表直到等待超时或发现可弹出元素为止。</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/lists-brpoplpush.html">BRPOPLPUSH source destination timeout</a> 从列表中弹出一个值，将弹出的元素插入到另外一个列表中并返回它； 如果列表没有元素会阻塞列表直到等待超时或发现可弹出元素为止。</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/lists-lindex.html">LINDEX key index</a> 通过索引获取列表中的元素</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/lists-linsert.html">LINSERT key BEFORE|AFTER pivot value</a> 在列表的元素前或者后插入元素</td>
</tr>
<tr>
<td align="left">6</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/lists-llen.html">LLEN key</a> 获取列表长度</td>
</tr>
<tr>
<td align="left">7</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/lists-lpop.html">LPOP key</a> 移出并获取列表的第一个元素</td>
</tr>
<tr>
<td align="left">8</td>
<td align="left">[LPUSH key value1 <a target="_blank" rel="noopener" href="https://www.runoob.com/redis/lists-lpush.html">value2]</a> 将一个或多个值插入到列表头部</td>
</tr>
<tr>
<td align="left">9</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/lists-lpushx.html">LPUSHX key value</a> 将一个值插入到已存在的列表头部</td>
</tr>
<tr>
<td align="left">10</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/lists-lrange.html">LRANGE key start stop</a> 获取列表指定范围内的元素</td>
</tr>
<tr>
<td align="left">11</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/lists-lrem.html">LREM key count value</a> 移除列表元素</td>
</tr>
<tr>
<td align="left">12</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/lists-lset.html">LSET key index value</a> 通过索引设置列表元素的值</td>
</tr>
<tr>
<td align="left">13</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/lists-ltrim.html">LTRIM key start stop</a> 对一个列表进行修剪(trim)，就是说，让列表只保留指定区间内的元素，不在指定区间之内的元素都将被删除。</td>
</tr>
<tr>
<td align="left">14</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/lists-rpop.html">RPOP key</a> 移除列表的最后一个元素，返回值为移除的元素。</td>
</tr>
<tr>
<td align="left">15</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/lists-rpoplpush.html">RPOPLPUSH source destination</a> 移除列表的最后一个元素，并将该元素添加到另一个列表并返回</td>
</tr>
<tr>
<td align="left">16</td>
<td align="left">[RPUSH key value1 <a target="_blank" rel="noopener" href="https://www.runoob.com/redis/lists-rpush.html">value2]</a> 在列表中添加一个或多个值到列表尾部</td>
</tr>
<tr>
<td align="left">17</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/lists-rpushx.html">RPUSHX key value</a> 为已存在的列表添加值</td>
</tr>
</tbody></table>
<p><code>	LPUSH key value1 [value2]</code>: 将一个或多个值插入到列表头部</p>
<p><code>RPUSH key value1 [value2]</code>: 在列表中添加一个或多个值到列表尾部</p>
<p><code>LRANGE key start stop </code>: 获取列表指定范围内的元素</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/11/66e185f7b872c.png" alt="image-20240911195848619"></p>
<p><code>LPOP key</code>: 移出并获取列表的第一个元素</p>
<p><code>RPOP key</code>: 移除列表的最后一个元素，返回值为移除的元素。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/11/66e186d4e729b.png" alt="image-20240911200229870"></p>
<p><code>LINDEX key index </code>: 通过索引获取列表中的元素</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/11/66e187d568cda.png" alt="image-20240911200646365"></p>
<p><code>LLEN key </code>: 获取列表长度</p>
<p><code>LREM key count value </code>: 移除列表元素</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/11/66e188f77faa7.png" alt="image-20240911201136473"></p>
<p><code>LTRIM key start stop</code>: 对一个列表进行修剪(trim)，就是说，让列表只保留指定区间内的元素，不在指定区间之内的元素都将被删除。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/11/66e1899c75d44.png" alt="image-20240911201421422"></p>
<p><code>RPOPLPUSH source destination</code>: 移除列表的最后一个元素，并将该元素添加到另一个列表并返回</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/11/66e18c4546e43.png" alt="image-20240911202542212"></p>
<p><code>LSET key index value </code>: 通过索引设置列表元素的值</p>
<p><code>LINSERT key BEFORE|AFTER pivot value </code> : 在列表的元素前或者后插入元素</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/11/66e18d919c142.png" alt="image-20240911203114311"></p>
<h3 id="hash（哈希）-1"><a href="#hash（哈希）-1" class="headerlink" title="hash（哈希）"></a><strong>hash（哈希）</strong></h3><blockquote>
<p>KV模式不变，但V是一个键值对，相当于 Map&lt;String，Map&lt;Object,Object&gt;&gt;</p>
</blockquote>
<p>下表列出了 redis hash 基本的相关命令：</p>
<table>
<thead>
<tr>
<th align="left">序号</th>
<th align="left">命令及描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left">[HDEL key field1 <a target="_blank" rel="noopener" href="https://www.runoob.com/redis/hashes-hdel.html">field2]</a> 删除一个或多个哈希表字段</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/hashes-hexists.html">HEXISTS key field</a> 查看哈希表 key 中，指定的字段是否存在。</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/hashes-hget.html">HGET key field</a> 获取存储在哈希表中指定字段的值。</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/hashes-hgetall.html">HGETALL key</a> 获取在哈希表中指定 key 的所有字段和值</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/hashes-hincrby.html">HINCRBY key field increment</a> 为哈希表 key 中的指定字段的整数值加上增量 increment 。</td>
</tr>
<tr>
<td align="left">6</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/hashes-hincrbyfloat.html">HINCRBYFLOAT key field increment</a> 为哈希表 key 中的指定字段的浮点数值加上增量 increment 。</td>
</tr>
<tr>
<td align="left">7</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/hashes-hkeys.html">HKEYS key</a> 获取哈希表中的所有字段</td>
</tr>
<tr>
<td align="left">8</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/hashes-hlen.html">HLEN key</a> 获取哈希表中字段的数量</td>
</tr>
<tr>
<td align="left">9</td>
<td align="left">[HMGET key field1 <a target="_blank" rel="noopener" href="https://www.runoob.com/redis/hashes-hmget.html">field2]</a> 获取所有给定字段的值</td>
</tr>
<tr>
<td align="left">10</td>
<td align="left">[HMSET key field1 value1 <a target="_blank" rel="noopener" href="https://www.runoob.com/redis/hashes-hmset.html">field2 value2 ]</a> 同时将多个 field-value (域-值)对设置到哈希表 key 中。</td>
</tr>
<tr>
<td align="left">11</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/hashes-hset.html">HSET key field value</a> 将哈希表 key 中的字段 field 的值设为 value 。</td>
</tr>
<tr>
<td align="left">12</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/hashes-hsetnx.html">HSETNX key field value</a> 只有在字段 field 不存在时，设置哈希表字段的值。</td>
</tr>
<tr>
<td align="left">13</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/hashes-hvals.html">HVALS key</a> 获取哈希表中所有值。</td>
</tr>
<tr>
<td align="left">14</td>
<td align="left">[HSCAN key cursor <a target="_blank" rel="noopener" href="https://www.runoob.com/redis/hashes-hscan.html">MATCH pattern] [COUNT count]</a> 迭代哈希表中的键值对。</td>
</tr>
</tbody></table>
<p><code>HSET key field value</code>:  将哈希表 key 中的字段 field 的值设为 value 。也支持将多个 field-value (域-值)对设置到哈希表 key 中，与 <code>HMSET</code>命令相同</p>
<p><code>HGET key field </code>: 获取存储在哈希表中指定字段的值。</p>
<p><code>HMSET key field1 value1 [field2 value2 ]</code>：同时将多个 field-value (域-值)对设置到哈希表 key 中。</p>
<p><code>HMGET key field1 [field2]</code>: 获取所有给定字段的值</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/12/66e261f7186bb.png" alt="image-20240912113726971"></p>
<p><code>HGETALL key </code>: 获取在哈希表中指定 key 的所有字段和值</p>
<p><code>HDEL key field1 [field2]</code>: 删除一个或多个哈希表字段</p>
<p><code>HLEN key</code>: 获取哈希表中字段的数量</p>
<p><code>HEXISTS key field </code>: 查看哈希表 key 中，指定的字段是否存在。</p>
<p><code>HKEYS key</code>:  获取哈希表中的所有字段</p>
<p><code>HVALS key</code>: 获取哈希表中所有值。</p>
<p><code>HINCRBY key field increment</code> : 为哈希表 key 中的指定字段的整数值加上增量 increment 。</p>
<p><code>HINCRBYFLOAT key field increment</code>: 为哈希表 key 中的指定字段的浮点数值加上增量 increment 。</p>
<p><code>HSETNX key field value</code>: 只有在字段 field 不存在时，设置哈希表字段的值。</p>
<p><strong>应用场景：</strong></p>
<p>京东购物车早期，涉及目前不再采用，当前小中厂可用</p>
<p>新增商品 → hset shopcar:uid1024 334488 1</p>
<p>新增商品 → hset shopcar:uid1024 334477 1</p>
<p>增加商品数量 → hincrby shopcar:uid1024 334477 1</p>
<p>商品总数 → hlen shopcar:uid1024</p>
<p>全部选择 → hgetall shopcar:uid1024</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/12/66e2663c86b92.png" alt="image-20240912115541065"></p>
<h3 id="Set（集合）-1"><a href="#Set（集合）-1" class="headerlink" title="Set（集合）"></a>Set（集合）</h3><blockquote>
<p>单值多Value，无序无重复</p>
</blockquote>
<p>下表列出了 Redis 集合基本命令：</p>
<table>
<thead>
<tr>
<th align="left">序号</th>
<th align="left">命令及描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left">[SADD key member1 <a target="_blank" rel="noopener" href="https://www.runoob.com/redis/sets-sadd.html">member2]</a> 向集合添加一个或多个成员</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/sets-scard.html">SCARD key</a> 获取集合的成员数</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left">[SDIFF key1 <a target="_blank" rel="noopener" href="https://www.runoob.com/redis/sets-sdiff.html">key2]</a> 返回第一个集合与其他集合之间的差异。</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left">[SDIFFSTORE destination key1 <a target="_blank" rel="noopener" href="https://www.runoob.com/redis/sets-sdiffstore.html">key2]</a> 返回给定所有集合的差集并存储在 destination 中</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left">[SINTER key1 <a target="_blank" rel="noopener" href="https://www.runoob.com/redis/sets-sinter.html">key2]</a> 返回给定所有集合的交集</td>
</tr>
<tr>
<td align="left">6</td>
<td align="left">[SINTERSTORE destination key1 <a target="_blank" rel="noopener" href="https://www.runoob.com/redis/sets-sinterstore.html">key2]</a> 返回给定所有集合的交集并存储在 destination 中</td>
</tr>
<tr>
<td align="left">7</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/sets-sismember.html">SISMEMBER key member</a> 判断 member 元素是否是集合 key 的成员</td>
</tr>
<tr>
<td align="left">8</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/sets-smembers.html">SMEMBERS key</a> 返回集合中的所有成员</td>
</tr>
<tr>
<td align="left">9</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/sets-smove.html">SMOVE source destination member</a> 将 member 元素从 source 集合移动到 destination 集合</td>
</tr>
<tr>
<td align="left">10</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/sets-spop.html">SPOP key</a> 移除并返回集合中的一个随机元素</td>
</tr>
<tr>
<td align="left">11</td>
<td align="left">[SRANDMEMBER key <a target="_blank" rel="noopener" href="https://www.runoob.com/redis/sets-srandmember.html">count]</a> 返回集合中一个或多个随机数</td>
</tr>
<tr>
<td align="left">12</td>
<td align="left">[SREM key member1 <a target="_blank" rel="noopener" href="https://www.runoob.com/redis/sets-srem.html">member2]</a> 移除集合中一个或多个成员</td>
</tr>
<tr>
<td align="left">13</td>
<td align="left">[SUNION key1 <a target="_blank" rel="noopener" href="https://www.runoob.com/redis/sets-sunion.html">key2]</a> 返回所有给定集合的并集</td>
</tr>
<tr>
<td align="left">14</td>
<td align="left">[SUNIONSTORE destination key1 <a target="_blank" rel="noopener" href="https://www.runoob.com/redis/sets-sunionstore.html">key2]</a> 所有给定集合的并集存储在 destination 集合中</td>
</tr>
<tr>
<td align="left">15</td>
<td align="left">[SSCAN key cursor <a target="_blank" rel="noopener" href="https://www.runoob.com/redis/sets-sscan.html">MATCH pattern] [COUNT count]</a> 迭代集合中的元素</td>
</tr>
</tbody></table>
<h4 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h4><p><code>SADD key member1 [member2]</code>: 向集合添加一个或多个成员</p>
<p><code>SMEMBERS key</code>: 返回集合中的所有成员</p>
<p><code>SISMEMBER key member</code>: 判断 member 元素是否是集合 key 的成员</p>
<p><code>SREM key member1 [member2]</code>: 移除集合中一个或多个成员</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/12/66e268efb65cd.png" alt="image-20240912120712405"></p>
<p><code>SCARD key</code>: 获取集合的成员数</p>
<p><code>SRANDMEMBER key [count]</code>: 返回集合中一个或多个随机元素</p>
<p><code>SPOP key [count]</code>: 移除并返回集合中的一个或多个随机元素</p>
<p><code>SMOVE source destination member</code>: 将 member 元素从 source 集合移动到 destination 集合</p>
<h4 id="集合运算"><a href="#集合运算" class="headerlink" title="集合运算"></a>集合运算</h4><p><code>SDIFF key1 [key2]</code>: 返回第一个集合与其他集合之间的差异。A-B [-C…]</p>
<p><code>SUNION key1 [key2]</code>: 返回所有给定集合的并集</p>
<p><code>SINTER key1 [key2]</code>： 返回给定所有集合的交集</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/12/66e26fcede1cb.png" alt="image-20240912123631572"></p>
<p><code>SINTERCARD numkeys key [key...] [LIMIT limit]</code>:</p>
<p>Redis7的新命令，返回由所有给定集合的交集产生的基数（去重统计数）</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/12/66e272b743954.png" alt="image-20240912124855919"></p>
<h4 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h4><p>1、抽奖小程序<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/12/66e27311bfb07.png" alt="image-20240912125025925"></p>
<p>2、朋友圈点赞</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/12/66e273a71d572.png" alt="image-20240912125255607"></p>
<p>3、可能认识的人</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/12/66e273f3b47a6.png" alt="image-20240912125412416"></p>
<h3 id="zset（sorted-set：有序集合）-1"><a href="#zset（sorted-set：有序集合）-1" class="headerlink" title="zset（sorted set：有序集合）"></a>zset（sorted set：有序集合）</h3><p>下表列出了 redis 有序集合的基本命令:</p>
<table>
<thead>
<tr>
<th align="left">序号</th>
<th align="left">命令及描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left">[ZADD key score1 member1 <a target="_blank" rel="noopener" href="https://www.runoob.com/redis/sorted-sets-zadd.html">score2 member2]</a> 向有序集合添加一个或多个成员，或者更新已存在成员的分数</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/sorted-sets-zcard.html">ZCARD key</a> 获取有序集合的成员数</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/sorted-sets-zcount.html">ZCOUNT key min max</a> 计算在有序集合中指定区间分数的成员数</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/sorted-sets-zincrby.html">ZINCRBY key increment member</a> 有序集合中对指定成员的分数加上增量 increment</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left">[ZINTERSTORE destination numkeys key <a target="_blank" rel="noopener" href="https://www.runoob.com/redis/sorted-sets-zinterstore.html">key …]</a> 计算给定的一个或多个有序集的交集并将结果集存储在新的有序集合 destination 中</td>
</tr>
<tr>
<td align="left">6</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/sorted-sets-zlexcount.html">ZLEXCOUNT key min max</a> 在有序集合中计算指定字典区间内成员数量</td>
</tr>
<tr>
<td align="left">7</td>
<td align="left">[ZRANGE key start stop <a target="_blank" rel="noopener" href="https://www.runoob.com/redis/sorted-sets-zrange.html">WITHSCORES]</a> 通过索引区间返回有序集合指定区间内的成员</td>
</tr>
<tr>
<td align="left">8</td>
<td align="left">[ZRANGEBYLEX key min max <a target="_blank" rel="noopener" href="https://www.runoob.com/redis/sorted-sets-zrangebylex.html">LIMIT offset count]</a> 通过字典区间返回有序集合的成员</td>
</tr>
<tr>
<td align="left">9</td>
<td align="left">[ZRANGEBYSCORE key min max <a target="_blank" rel="noopener" href="https://www.runoob.com/redis/sorted-sets-zrangebyscore.html">WITHSCORES] [LIMIT]</a> 通过分数返回有序集合指定区间内的成员</td>
</tr>
<tr>
<td align="left">10</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/sorted-sets-zrank.html">ZRANK key member</a> 返回有序集合中指定成员的索引</td>
</tr>
<tr>
<td align="left">11</td>
<td align="left">[ZREM key member <a target="_blank" rel="noopener" href="https://www.runoob.com/redis/sorted-sets-zrem.html">member …]</a> 移除有序集合中的一个或多个成员</td>
</tr>
<tr>
<td align="left">12</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/sorted-sets-zremrangebylex.html">ZREMRANGEBYLEX key min max</a> 移除有序集合中给定的字典区间的所有成员</td>
</tr>
<tr>
<td align="left">13</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/sorted-sets-zremrangebyrank.html">ZREMRANGEBYRANK key start stop</a> 移除有序集合中给定的排名区间的所有成员</td>
</tr>
<tr>
<td align="left">14</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/sorted-sets-zremrangebyscore.html">ZREMRANGEBYSCORE key min max</a> 移除有序集合中给定的分数区间的所有成员</td>
</tr>
<tr>
<td align="left">15</td>
<td align="left">[ZREVRANGE key start stop <a target="_blank" rel="noopener" href="https://www.runoob.com/redis/sorted-sets-zrevrange.html">WITHSCORES]</a> 返回有序集中指定区间内的成员，通过索引，分数从高到低</td>
</tr>
<tr>
<td align="left">16</td>
<td align="left">[ZREVRANGEBYSCORE key max min <a target="_blank" rel="noopener" href="https://www.runoob.com/redis/sorted-sets-zrevrangebyscore.html">WITHSCORES]</a> 返回有序集中指定分数区间内的成员，分数从高到低排序</td>
</tr>
<tr>
<td align="left">17</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/sorted-sets-zrevrank.html">ZREVRANK key member</a> 返回有序集合中指定成员的排名，有序集成员按分数值递减(从大到小)排序</td>
</tr>
<tr>
<td align="left">18</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/sorted-sets-zscore.html">ZSCORE key member</a> 返回有序集中，成员的分数值</td>
</tr>
<tr>
<td align="left">19</td>
<td align="left">[ZUNIONSTORE destination numkeys key <a target="_blank" rel="noopener" href="https://www.runoob.com/redis/sorted-sets-zunionstore.html">key …]</a> 计算给定的一个或多个有序集的并集，并存储在新的 key 中</td>
</tr>
<tr>
<td align="left">20</td>
<td align="left">[ZSCAN key cursor <a target="_blank" rel="noopener" href="https://www.runoob.com/redis/sorted-sets-zscan.html">MATCH pattern] [COUNT count]</a> 迭代有序集合中的元素（包括元素成员和元素分值）</td>
</tr>
</tbody></table>
<h4 id="常用命令-1"><a href="#常用命令-1" class="headerlink" title="常用命令"></a>常用命令</h4><p><code>ZADD key score1 member1 [score2 member2]</code>:</p>
<p>向有序集合添加一个或多个成员，或者更新已存在成员的分数</p>
<p><code>ZRANGE key start stop [WITHSCORES]</code>: 通过索引区间按照顺序返回有序集合指定区间内的成员，使用<code>WITHSCORES</code>参数时会返回score值</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/12/66e279a5c03c9.png" alt="image-20240912131830425"></p>
<p><code>ZREVRANGE key start stop [WITHSCORES]</code>: 返回有序集中指定区间内的成员，通过索引，分数从高到低</p>
<p><code>ZRANGEBYSCORE key min max [WITHSCORES] [LIMIT offset count]</code>: </p>
<p>通过分数返回有序集合指定区间内的成员，<code>(</code> 代表不包含</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/12/66e27db091165.png" alt="image-20240912133545302"></p>
<p><code>ZREVRANGE key start stop [WITHSCORES]</code>: 返回有序集中指定区间内的成员，通过索引，分数从高到低</p>
<p><code>ZREVRANGEBYSCORE key max min [WITHSCORES]</code>: 返回有序集中指定分数区间内的成员，分数从高到低排序</p>
<p><code>ZSCORE key member</code>: 返回有序集中，成员的分数值</p>
<p><code>ZCARD key</code>: 获取有序集合的成员数</p>
<p><code>ZREM key member [member ...]</code>: 移除有序集合中的一个或多个成员</p>
<p><code>ZINCRBY key increment member</code>: 有序集合中对指定成员的分数加上增量 increment</p>
<p><code>ZCOUNT key min max</code>: 计算在有序集合中指定区间分数的成员数</p>
<p><code>ZMPOP numkeys key [key ...] MIN|MAX [COUNT count]</code>:</p>
<p>Resid7新命令，从键名列表中的第一个非空排序集中弹出一个或多个元素，它们是成员分数对</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/12/66e281edc0bc0.png" alt="image-20240912135350502"></p>
<p><code>ZRANK key member</code>: 返回有序集合中指定成员的索引</p>
<p><code>ZREVRANK key member</code>: 返回有序集合中指定成员的排名，有序集成员按分数值递减(从大到小)排序</p>
<h4 id="应用场景-1"><a href="#应用场景-1" class="headerlink" title="应用场景"></a>应用场景</h4><p>根据商品销售对商品进行排序显示</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/12/66e282a26960a.png" alt="image-20240912135651025"></p>
<h3 id="Bitmap（位图）-1"><a href="#Bitmap（位图）-1" class="headerlink" title="Bitmap（位图）"></a>Bitmap（位图）</h3><blockquote>
<p>由0和1状态表现的二进制bit数组，常用于状态记录及统计</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/12/66e2879f3c84d.png" alt="image-20240912141807830"></p>
<h4 id="基本命令-1"><a href="#基本命令-1" class="headerlink" title="基本命令"></a>基本命令</h4><p><code>SETBIT key offset value</code>: 给指定的值的第offset赋值，值只能是0或1，时间复杂度<code>O(1)</code></p>
<p><code>GETBIT key offset</code>： 获取指定key的第offset位置的值，偏移量从0开始，时间复杂度<code>O(1)</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/12/66e289f8528c1.png" alt="image-20240912142809052"></p>
<p><code>STRLEN key</code>: 统计占用多少字节数，超过8位后按照8位一组一byte进行扩容</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/12/66e28aa22a75e.png" alt="image-20240912143058943"></p>
<p><code>BITCOUNT key  [start end [BYTE|BIT]]</code>: 返回指定key中[start end]中为1的数量，时间复杂度<code>O(n)</code></p>
<p><code>BITOP operation destkey key</code>: </p>
<p>对不同的二进制存储数据进行位运算(ADN、OR、NOT、XOR)，将运算后的结果存储到一个新的集合中，参数<code>destkey </code>用于指定新集合的key，时间复杂度<code>O(n)</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/12/66e28ec8a9a16.png" alt="image-20240912144841340"></p>
<h4 id="应用场景-2"><a href="#应用场景-2" class="headerlink" title="应用场景"></a>应用场景</h4><p>统计全年（按365天）记录需占用字节数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/12/66e290518b685.png" alt="image-20240912145514324"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/12/66e2906a23b28.png" alt="image-20240912145538859"></p>
<h3 id="HyperLogLog（基数统计）-1"><a href="#HyperLogLog（基数统计）-1" class="headerlink" title="HyperLogLog（基数统计）"></a>HyperLogLog（基数统计）</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/12/66e294fd4b6c4.png" alt="image-20240912151510055"></p>
<h4 id="基数统计介绍"><a href="#基数统计介绍" class="headerlink" title="基数统计介绍"></a>基数统计介绍</h4><p>基数统计用于统计一个集合中不重复的元素个数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/12/66e294411828b.png" alt="image-20240912151201847"></p>
<h4 id="需求场景"><a href="#需求场景" class="headerlink" title="需求场景"></a>需求场景</h4><blockquote>
<p>UA（Unique Visitor）独立访客，一般理解为客户IP，统计时需去重</p>
</blockquote>
<ul>
<li>统计某网站UA、统计某个文章UA</li>
<li>用户搜索网站关键词数量</li>
<li>统计用户每天搜索不同字条个数</li>
<li>……</li>
</ul>
<h4 id="基本命令-2"><a href="#基本命令-2" class="headerlink" title="基本命令"></a>基本命令</h4><p>下表列出了 redis HyperLogLog 的基本命令：</p>
<table>
<thead>
<tr>
<th align="left">序号</th>
<th align="left">命令及描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left">[PFADD key element <a target="_blank" rel="noopener" href="https://www.runoob.com/redis/hyperloglog-pfadd.html">element …]</a> 添加指定元素到 HyperLogLog 中。</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">[PFCOUNT key <a target="_blank" rel="noopener" href="https://www.runoob.com/redis/hyperloglog-pfcount.html">key …]</a> 返回给定 HyperLogLog 的基数估算值。</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left">[PFMERGE destkey sourcekey <a target="_blank" rel="noopener" href="https://www.runoob.com/redis/hyperloglog-pfmerge.html">sourcekey …]</a> 将多个 HyperLogLog 合并为一个 HyperLogLog</td>
</tr>
</tbody></table>
<h3 id="GEO（地理空间）-1"><a href="#GEO（地理空间）-1" class="headerlink" title="GEO（地理空间）"></a>GEO（地理空间）</h3><blockquote>
<p>Redis在3.2版本以后增加了地图位置的处理功能</p>
</blockquote>
<h4 id="相关介绍"><a href="#相关介绍" class="headerlink" title="相关介绍"></a>相关介绍</h4><p>地球上的地理位置是使用二维的经纬度表示，经度范围 (-180, 180]，纬度范围 (-90, 90]，只要我们确定一个点的经纬度就可以名取得他在地球的位置。</p>
<p>例如滴滴打车，最直观的操作就是实时记录更新各个车的位置，然后当我们要找车时，在数据库中查找距离我们(坐标x0,y0)附近r公里范围内部的车辆</p>
<p>使用如下SQL即可：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> taxi from position <span class="built_in">where</span> x0-r &lt; x &lt; x0 + r and y0-r &lt; y &lt; y0+r</span><br></pre></td></tr></tbody></table></figure>

<p><strong>存在的问题</strong></p>
<p>1.查询性能问题，如果并发高，数据量大这种查询是要搞垮数据库的</p>
<p>2.这个查询的是一个矩形访问，而不是以我为中心r公里为半径的圆形访问。</p>
<p>3.精准度的问题，我们知道地球不是平面坐标系，而是一个圆球，这种矩形计算在长距离计算时会有很大误差</p>
<h4 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h4><p>核心思想就是将球体转换为平面，区块转换为一点</p>
<p>主要分为三步：</p>
<ol>
<li>将三维的地球变为二维的坐标</li>
<li>再将二维的坐标转换为一维的点块</li>
<li>最后将一维的点块转换为二进制再通过base32编码</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/12/66e2976e9486b.png" alt="image-20240912152535232"></p>
<h4 id="常用命令-2"><a href="#常用命令-2" class="headerlink" title="常用命令"></a>常用命令</h4><p><code>GEOADD key [NX|XX] [CH] longitude latitude member [longitude latitude member ...]</code>:</p>
<p>将多个精度（longitude）、维度（latitude）、位置名称（member）添加到指定的key中</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GEOADD city 116.403963 39.915119 <span class="string">"天安门"</span> 116.403414 39.924091 <span class="string">"故宫"</span> 116.024067 40.362639 <span class="string">"长城"</span></span><br></pre></td></tr></tbody></table></figure>

<p>GEO是ZSET的子集，可以使用ZSET相关命令</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/12/66e29ea21099d.png" alt="image-20240912155617986"></p>
<p><strong>解决乱码问题</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/12/66e29ee8674fe.png"></p>
<p><code>GEOPOS key member [member ...]</code>： 从键里返回所有给定位置元素的位置（精度和维度）</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/12/66e2a01377317.png" alt="image-20240912160228328"></p>
<p><code>GEODIST key member1 member2 [M|KM|FT|MI]</code>: 返回两个给定位置之间的距离</p>
<ul>
<li>m ：米，默认单位。</li>
<li>km ：千米。</li>
<li>mi ：英里。</li>
<li>ft ：英尺。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/12/66e2a0c6741fe.png" alt="image-20240912160527354"></p>
<h4 id="georadius、georadiusbymember"><a href="#georadius、georadiusbymember" class="headerlink" title="georadius、georadiusbymember"></a><strong>georadius、georadiusbymember</strong></h4><p>georadius 以给定的经纬度为中心， 返回键包含的位置元素当中， 与中心的距离不超过给定最大距离的所有位置元素。</p>
<p>georadiusbymember 和 GEORADIUS 命令一样， 都可以找出位于指定范围内的元素， 但是 georadiusbymember 的中心点是由给定的位置元素决定的， 而不是使用经度和纬度来决定中心点。</p>
<p>georadius 与 georadiusbymember 语法格式如下：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GEORADIUS key longitude latitude radius m|km|ft|mi [WITHCOORD] [WITHDIST] [WITHHASH] [COUNT count] [ASC|DESC] [STORE key] [STOREDIST key]</span><br><span class="line">GEORADIUSBYMEMBER key member radius m|km|ft|mi [WITHCOORD] [WITHDIST] [WITHHASH] [COUNT count] [ASC|DESC] [STORE key] [STOREDIST key]</span><br></pre></td></tr></tbody></table></figure>

<p><strong>参数说明</strong></p>
<ul>
<li>m ：米，默认单位。</li>
<li>km ：千米。</li>
<li>mi ：英里。</li>
<li>ft ：英尺。</li>
<li>WITHDIST: 在返回位置元素的同时， 将位置元素与中心之间的距离也一并返回。</li>
<li>WITHCOORD: 将位置元素的经度和纬度也一并返回。</li>
<li>WITHHASH: 以 52 位有符号整数的形式， 返回位置元素经过原始 geohash 编码的有序集合分值。 这个选项主要用于底层应用或者调试， 实际中的作用并不大。</li>
<li>COUNT 限定返回的记录数。</li>
<li>ASC: 查找结果根据距离从近到远排序。</li>
<li>DESC: 查找结果根据从远到近排序。</li>
</ul>
<h4 id="Redis-GEO"><a href="#Redis-GEO" class="headerlink" title="Redis GEO"></a>Redis GEO</h4><p>Redis GEO 使用 geohash 来保存地理位置的坐标。</p>
<p>geohash 用于获取一个或多个位置元素的 geohash 值。</p>
<p>geohash 语法格式如下：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GEOHASH key member [member ...]</span><br></pre></td></tr></tbody></table></figure>

<p>实例：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">redis&gt; GEOADD Sicily 13.361389 38.115556 <span class="string">"Palermo"</span> 15.087269 37.502669 <span class="string">"Catania"</span></span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line">redis&gt; GEOHASH Sicily Palermo Catania</span><br><span class="line">1) <span class="string">"sqc8b49rny0"</span></span><br><span class="line">2) <span class="string">"sqdtr74hyu0"</span></span><br><span class="line">redis&gt;</span><br></pre></td></tr></tbody></table></figure>



<h3 id="Stream（流）-1"><a href="#Stream（流）-1" class="headerlink" title="Stream（流）"></a>Stream（流）</h3><blockquote>
<p>Redis版的MQ消息中间件+阻塞队列，Redis5新增该数据结构、</p>
</blockquote>
<p>Redis Stream 能够实现消息队列，它支持消息的持久化、支持自动生成全局唯一ID、支持ack确认消息的模式、支持消费者组模式等、让消息队列更加稳定可靠</p>
<h4 id="Redis消息队列的两种方案"><a href="#Redis消息队列的两种方案" class="headerlink" title="Redis消息队列的两种方案"></a>Redis消息队列的两种方案</h4><h5 id="List"><a href="#List" class="headerlink" title="List"></a>List</h5><p>按照插入顺序排序，你可以添加一个元素到列表的头部（左边）或者尾部（右边）。 </p>
<p>所以<font color="red">常用来做异步队列使用</font>，将需要延后处理的任务结构体序列化成字符串塞进 Redis 的列表，另一个线程从这个列表中轮询数据进行处理。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/12/66e2a61a26a42.png" alt="image-20240912162810906"></p>
<p>LPUSH、RPOP 左进右出  RPUSH、LPOP 右进左出</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/12/66e2a62b7d692.png" alt="image-20240912162828325"></p>
<h5 id="发布-订阅"><a href="#发布-订阅" class="headerlink" title="发布/订阅"></a>发布/订阅</h5><p>Redis 发布订阅 (pub/sub) 有个缺点就是消息无法持久化，如果出现网络断开、Redis 宕机等，消息就会被丢弃。而且也没有 Ack 机制来保证数据的可靠性，假设一个消费者都没有，那消息就直接被丢弃了。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/12/66e2a64964087.png" alt="image-20240912162858111"></p>
<h4 id="底层结构和原理说明"><a href="#底层结构和原理说明" class="headerlink" title="底层结构和原理说明"></a>底层结构和原理说明</h4><p>一个消息链表，将所有加入的消息都串起来，每个消息都有一个唯一的 ID 和对应的内容</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/12/66e2a7105eab6.png" alt="image-20240912163217050"></p>
<table>
<thead>
<tr>
<th>1</th>
<th>Message Content</th>
<th>消息内容</th>
</tr>
</thead>
<tbody><tr>
<td>2</td>
<td>Consumer group</td>
<td>消费组，通过XGROUP CREATE 命令创建，同一个消费组可以有多个消费者</td>
</tr>
<tr>
<td>3</td>
<td>Last_delivered_id</td>
<td>游标，每个消费组会有个游标 last_delivered_id，任意一个消费者读取了消息都会使游标 last_delivered_id 往前移动。</td>
</tr>
<tr>
<td>4</td>
<td>Consumer</td>
<td>消费者，消费组中的消费者</td>
</tr>
<tr>
<td>5</td>
<td>Pending_ids</td>
<td>消费者会有一个状态变量，用于记录被当前消费已读取但未ack的消息Id，如果客户端没有ack，这个变量里面的消息ID会越来越多，一旦某个消息被ack它就开始减少。这个pending_ids变量在Redis官方被称之为 PEL(Pending Entries List)，记录了当前已经被客户端读取的消息，但是还没有 ack (Acknowledge character：确认字符），它用来确保客户端至少消费了消息一次，而不会在网络传输的中途丢失了没处理</td>
</tr>
</tbody></table>
<h4 id="基本命令-3"><a href="#基本命令-3" class="headerlink" title="基本命令"></a>基本命令</h4><p><strong>消息队列相关命令：</strong></p>
<ul>
<li><strong>XADD</strong> - 添加消息到末尾</li>
<li><strong>XTRIM</strong> - 对流进行修剪，限制长度</li>
<li><strong>XDEL</strong> - 删除消息</li>
<li><strong>XLEN</strong> - 获取流包含的元素数量，即消息长度</li>
<li><strong>XRANGE</strong> - 获取消息列表，会自动过滤已经删除的消息</li>
<li><strong>XREVRANGE</strong> - 反向获取消息列表，ID 从大到小</li>
<li><strong>XREAD</strong> - 以阻塞或非阻塞方式获取消息列表</li>
</ul>
<p><strong>消费者组相关命令：</strong></p>
<ul>
<li><strong>XGROUP CREATE</strong> - 创建消费者组</li>
<li><strong>XREADGROUP GROUP</strong> - 读取消费者组中的消息</li>
<li><strong>XACK</strong> - 将消息标记为”已处理”</li>
<li><strong>XGROUP SETID</strong> - 为消费者组设置新的最后递送消息ID</li>
<li><strong>XGROUP DELCONSUMER</strong> - 删除消费者</li>
<li><strong>XGROUP DESTROY</strong> - 删除消费者组</li>
<li><strong>XPENDING</strong> - 显示待处理消息的相关信息</li>
<li><strong>XCLAIM</strong> - 转移消息的归属权</li>
<li><strong>XINFO</strong> - 查看流和消费者组的相关信息；</li>
<li><strong>XINFO GROUPS</strong> - 打印消费者组的信息；</li>
<li><strong>XINFO STREAM</strong> - 打印流信息</li>
</ul>
<h5 id="XADD"><a href="#XADD" class="headerlink" title="XADD"></a><strong>XADD</strong></h5><p>使用 XADD 向队列添加消息，如果指定的队列不存在，则创建一个队列，XADD 语法格式：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XADD key ID field value [field value ...]</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><strong>key</strong> ：队列名称，如果不存在就创建</li>
<li><strong>ID</strong> ：消息 id，我们使用 * 表示由 redis 生成，可以自定义，但是要自己保证递增性。</li>
<li><strong>field value</strong> ： 记录。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/12/66e2aacf55852.png" alt="image-20240912164816073"></p>
<p><strong>实例</strong></p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">redis&gt; XADD mystream * name Sara surname OConnor</span><br><span class="line"><span class="string">"1601372323627-0"</span></span><br><span class="line">redis&gt; XADD mystream * field1 value1 field2 value2 field3 value3</span><br><span class="line"><span class="string">"1601372323627-1"</span></span><br><span class="line">redis&gt; XLEN mystream</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line">redis&gt; XRANGE mystream - +</span><br><span class="line">1) 1) <span class="string">"1601372323627-0"</span></span><br><span class="line">   2) 1) <span class="string">"name"</span></span><br><span class="line">      2) <span class="string">"Sara"</span></span><br><span class="line">      3) <span class="string">"surname"</span></span><br><span class="line">      4) <span class="string">"OConnor"</span></span><br><span class="line">2) 1) <span class="string">"1601372323627-1"</span></span><br><span class="line">   2) 1) <span class="string">"field1"</span></span><br><span class="line">      2) <span class="string">"value1"</span></span><br><span class="line">      3) <span class="string">"field2"</span></span><br><span class="line">      4) <span class="string">"value2"</span></span><br><span class="line">      5) <span class="string">"field3"</span></span><br><span class="line">      6) <span class="string">"value3"</span></span><br><span class="line">redis&gt;</span><br></pre></td></tr></tbody></table></figure>



<h5 id="XRANGE"><a href="#XRANGE" class="headerlink" title="XRANGE"></a>XRANGE</h5><p>使用 XRANGE 获取消息列表，会自动过滤已经删除的消息 ，语法格式：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XRANGE key start end [COUNT count]</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><strong>key</strong> ：队列名</li>
<li><strong>start</strong> ：开始值， <strong>-</strong> 表示最小值</li>
<li><strong>end</strong> ：结束值， <strong>+</strong> 表示最大值</li>
<li><strong>count</strong> ：数量</li>
</ul>
<p>实例</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">redis&gt; XADD writers * name Virginia surname Woolf</span><br><span class="line"><span class="string">"1601372577811-0"</span></span><br><span class="line">redis&gt; XADD writers * name Jane surname Austen</span><br><span class="line"><span class="string">"1601372577811-1"</span></span><br><span class="line">redis&gt; XADD writers * name Toni surname Morrison</span><br><span class="line"><span class="string">"1601372577811-2"</span></span><br><span class="line">redis&gt; XADD writers * name Agatha surname Christie</span><br><span class="line"><span class="string">"1601372577812-0"</span></span><br><span class="line">redis&gt; XADD writers * name Ngozi surname Adichie</span><br><span class="line"><span class="string">"1601372577812-1"</span></span><br><span class="line">redis&gt; XLEN writers</span><br><span class="line">(<span class="built_in">integer</span>) 5</span><br><span class="line">redis&gt; XRANGE writers - + COUNT 2</span><br><span class="line">1) 1) <span class="string">"1601372577811-0"</span></span><br><span class="line">   2) 1) <span class="string">"name"</span></span><br><span class="line">      2) <span class="string">"Virginia"</span></span><br><span class="line">      3) <span class="string">"surname"</span></span><br><span class="line">      4) <span class="string">"Woolf"</span></span><br><span class="line">2) 1) <span class="string">"1601372577811-1"</span></span><br><span class="line">   2) 1) <span class="string">"name"</span></span><br><span class="line">      2) <span class="string">"Jane"</span></span><br><span class="line">      3) <span class="string">"surname"</span></span><br><span class="line">      4) <span class="string">"Austen"</span></span><br><span class="line">redis&gt;</span><br></pre></td></tr></tbody></table></figure>

<h5 id="XREVRANGE"><a href="#XREVRANGE" class="headerlink" title="XREVRANGE"></a>XREVRANGE</h5><p>使用 XREVRANGE 获取消息列表，会自动过滤已经删除的消息 ，语法格式：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XREVRANGE key end start [COUNT count]</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><strong>key</strong> ：队列名</li>
<li><strong>end</strong> ：结束值， <strong>+</strong> 表示最大值</li>
<li><strong>start</strong> ：开始值， <strong>-</strong> 表示最小值</li>
<li><strong>count</strong> ：数量</li>
</ul>
<p><strong>实例</strong></p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">redis&gt; XADD writers * name Virginia surname Woolf</span><br><span class="line"><span class="string">"1601372731458-0"</span></span><br><span class="line">redis&gt; XADD writers * name Jane surname Austen</span><br><span class="line"><span class="string">"1601372731459-0"</span></span><br><span class="line">redis&gt; XADD writers * name Toni surname Morrison</span><br><span class="line"><span class="string">"1601372731459-1"</span></span><br><span class="line">redis&gt; XADD writers * name Agatha surname Christie</span><br><span class="line"><span class="string">"1601372731459-2"</span></span><br><span class="line">redis&gt; XADD writers * name Ngozi surname Adichie</span><br><span class="line"><span class="string">"1601372731459-3"</span></span><br><span class="line">redis&gt; XLEN writers</span><br><span class="line">(<span class="built_in">integer</span>) 5</span><br><span class="line">redis&gt; XREVRANGE writers + - COUNT 1</span><br><span class="line">1) 1) <span class="string">"1601372731459-3"</span></span><br><span class="line">   2) 1) <span class="string">"name"</span></span><br><span class="line">      2) <span class="string">"Ngozi"</span></span><br><span class="line">      3) <span class="string">"surname"</span></span><br><span class="line">      4) <span class="string">"Adichie"</span></span><br><span class="line">redis&gt;</span><br></pre></td></tr></tbody></table></figure>

<h5 id="XDEL"><a href="#XDEL" class="headerlink" title="XDEL"></a>XDEL</h5><p>使用 XDEL 删除消息，语法格式：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XDEL key ID [ID ...]</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><strong>key</strong>：队列名称</li>
<li><strong>ID</strong> ：消息 ID</li>
</ul>
<p><strong>实例</strong></p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&gt; XADD mystream * a 1</span><br><span class="line">1538561698944-0</span><br><span class="line">&gt; XADD mystream * b 2</span><br><span class="line">1538561700640-0</span><br><span class="line">&gt; XADD mystream * c 3</span><br><span class="line">1538561701744-0</span><br><span class="line">&gt; XDEL mystream 1538561700640-0</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; XRANGE mystream - +</span><br><span class="line">1) 1) 1538561698944-0</span><br><span class="line">   2) 1) <span class="string">"a"</span></span><br><span class="line">      2) <span class="string">"1"</span></span><br><span class="line">2) 1) 1538561701744-0</span><br><span class="line">   2) 1) <span class="string">"c"</span></span><br><span class="line">      2) <span class="string">"3"</span></span><br></pre></td></tr></tbody></table></figure>



<h5 id="XTRIM"><a href="#XTRIM" class="headerlink" title="XTRIM"></a>XTRIM</h5><p>使用 XTRIM 对流进行修剪，限制长度， 语法格式：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XTRIM key MAXLEN [~] count</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><strong>key</strong> ：队列名称</li>
<li><strong>MAXLEN</strong> ：允许的最大长度</li>
<li><strong>MINID</strong>: 允许的最小ID</li>
<li><strong>count</strong> ：数量</li>
</ul>
<p><strong>实例</strong></p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; XRANGE mystream - +</span><br><span class="line">1726131510503-0</span><br><span class="line">field1</span><br><span class="line">A</span><br><span class="line">field2</span><br><span class="line">B</span><br><span class="line">field3</span><br><span class="line">C</span><br><span class="line">field4</span><br><span class="line">D</span><br><span class="line">1726131675077-0</span><br><span class="line">field5</span><br><span class="line">E</span><br><span class="line">field6</span><br><span class="line">F</span><br><span class="line">field7</span><br><span class="line">G</span><br><span class="line">127.0.0.1:6379&gt; XTRIM mystream MAXLEN 1</span><br><span class="line">1</span><br><span class="line">127.0.0.1:6379&gt; XRANGE mystream - +</span><br><span class="line">1726131675077-0</span><br><span class="line">field5</span><br><span class="line">E</span><br><span class="line">field6</span><br><span class="line">F</span><br><span class="line">field7</span><br><span class="line">G</span><br><span class="line">127.0.0.1:6379&gt;</span><br></pre></td></tr></tbody></table></figure>

<h5 id="XREAD"><a href="#XREAD" class="headerlink" title="XREAD"></a>XREAD</h5><blockquote>
<p>只会返回大于指定ID的消息</p>
</blockquote>
<p>使用 XREAD 以阻塞或非阻塞方式获取消息列表 ，语法格式：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XREAD [COUNT count] [BLOCK milliseconds] STREAMS key [key ...] id [id ...]</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><strong>count</strong> ：数量</li>
<li><strong>milliseconds</strong> ：可选，阻塞毫秒数，没有设置就是非阻塞模式</li>
<li><strong>key</strong> ：队列名</li>
<li><strong>id</strong> ：消息 ID</li>
</ul>
<p><strong>实例</strong>:</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 从 Stream 头部读取两条消息</span></span><br><span class="line">&gt; XREAD COUNT 2 STREAMS mystream writers 0-0 0-0</span><br><span class="line">1) 1) <span class="string">"mystream"</span></span><br><span class="line">   2) 1) 1) 1526984818136-0</span><br><span class="line">         2) 1) <span class="string">"duration"</span></span><br><span class="line">            2) <span class="string">"1532"</span></span><br><span class="line">            3) <span class="string">"event-id"</span></span><br><span class="line">            4) <span class="string">"5"</span></span><br><span class="line">            5) <span class="string">"user-id"</span></span><br><span class="line">            6) <span class="string">"7782813"</span></span><br><span class="line">      2) 1) 1526999352406-0</span><br><span class="line">         2) 1) <span class="string">"duration"</span></span><br><span class="line">            2) <span class="string">"812"</span></span><br><span class="line">            3) <span class="string">"event-id"</span></span><br><span class="line">            4) <span class="string">"9"</span></span><br><span class="line">            5) <span class="string">"user-id"</span></span><br><span class="line">            6) <span class="string">"388234"</span></span><br><span class="line">2) 1) <span class="string">"writers"</span></span><br><span class="line">   2) 1) 1) 1526985676425-0</span><br><span class="line">         2) 1) <span class="string">"name"</span></span><br><span class="line">            2) <span class="string">"Virginia"</span></span><br><span class="line">            3) <span class="string">"surname"</span></span><br><span class="line">            4) <span class="string">"Woolf"</span></span><br><span class="line">      2) 1) 1526985685298-0</span><br><span class="line">         2) 1) <span class="string">"name"</span></span><br><span class="line">            2) <span class="string">"Jane"</span></span><br><span class="line">            3) <span class="string">"surname"</span></span><br><span class="line">            4) <span class="string">"Austen"</span></span><br></pre></td></tr></tbody></table></figure>





<h4 id="XGROUP-CREATE"><a href="#XGROUP-CREATE" class="headerlink" title="XGROUP CREATE"></a>XGROUP CREATE</h4><p>使用 XGROUP CREATE 创建消费者组，语法格式：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XGROUP [CREATE key groupname id-or-$] [SETID key groupname id-or-$] [DESTROY key groupname] [DELCONSUMER key groupname consumername]</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><strong>key</strong> ：队列名称，如果不存在就创建</li>
<li><strong>groupname</strong> ：组名。</li>
<li><strong>$</strong> ： 表示从尾部开始消费，只接受新消息，当前 Stream 消息会全部忽略。</li>
</ul>
<p>从头开始消费:</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XGROUP CREATE mystream consumer-group-name 0  </span><br></pre></td></tr></tbody></table></figure>

<p>从尾部开始消费:</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XGROUP CREATE mystream consumer-group-name $</span><br></pre></td></tr></tbody></table></figure>

<h4 id="XREADGROUP-GROUP"><a href="#XREADGROUP-GROUP" class="headerlink" title="XREADGROUP GROUP"></a>XREADGROUP GROUP</h4><p>使用 XREADGROUP GROUP 读取消费组中的消息，语法格式：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XREADGROUP GROUP group consumer [COUNT count] [BLOCK milliseconds] [NOACK] STREAMS key [key ...] ID [ID ...]</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><strong>group</strong> ：消费组名</li>
<li><strong>consumer</strong> ：消费者名。</li>
<li><strong>count</strong> ： 读取数量。</li>
<li><strong>milliseconds</strong> ： 阻塞毫秒数。</li>
<li><strong>key</strong> ： 队列名。</li>
<li><strong>ID</strong> ： 消息 ID。</li>
<li><code>&gt;</code> : 代表从第一条尚未被消费的消息开始读取</li>
</ul>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XREADGROUP GROUP consumer-group-name consumer-name COUNT 1 STREAMS mystream &gt;</span><br></pre></td></tr></tbody></table></figure>

<p>Stream以组为单位，一旦有一个消费者读取，相同组内的其他消费者将无法读取已被读取的消息</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/12/66e2cfee00058.png" alt="image-20240912192638240"></p>
<p><strong>消费者组的目的</strong></p>
<p>让组内的多个消费者共同分担读取消息，所以，我们通常会让每个消费者读取部分消息，从而实现消息读取负载在多个消费者间是均衡分布的</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/12/66e2d0a569bbd.png" alt="image-20240912192942297"></p>
<h4 id="XPENGING"><a href="#XPENGING" class="headerlink" title="XPENGING"></a>XPENGING</h4><p>显示待处理消息的相关信息，即查询每个消费组内所有消费者<font color="red">已读取，但尚未确认</font>的消息</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XPENDING key group [[IDLE min-idle-time] start end count [consumer]]</span><br></pre></td></tr></tbody></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/12/66e2d25a8592a.png" alt="image-20240912193659434"></p>
<h4 id="XACK"><a href="#XACK" class="headerlink" title="XACK"></a><strong>XACK</strong></h4><p>将消息标记为”已处理”</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/12/66e2d32950f91.png" alt="image-20240912194026194"></p>
<h4 id="XINFO"><a href="#XINFO" class="headerlink" title="XINFO"></a><strong>XINFO</strong></h4><p>查看流和消费者组的相关信息</p>
<p><strong>XINFO GROUPS</strong>：打印消费者组的信息</p>
<p><strong>XINFO STREAM</strong> ：打印流信息</p>
<h3 id="Bitmap（位图）-2"><a href="#Bitmap（位图）-2" class="headerlink" title="Bitmap（位图）"></a>Bitmap（位图）</h3><p>即将一个Redis字符串看作是一个由二进制位组成的数组并能对变长位宽和任意没有字节对齐的指定整型位域进行寻址和修改。</p>
<p><strong>主要作用</strong></p>
<ol>
<li>位域修改</li>
<li>溢出控制</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/12/66e2d66c65971.png" alt="image-20240912195421348"></p>
<h4 id="基本语法命令"><a href="#基本语法命令" class="headerlink" title="基本语法命令"></a>基本语法命令</h4><blockquote>
<p>Ascii码表: <a target="_blank" rel="noopener" href="https://ascii.org.cn/">https://ascii.org.cn/</a></p>
</blockquote>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BITFIELD key [GET type offset] [SET type offset value] [INCRBY type offset increment] [OVERFLOW WRAP|SAT|FAIL]</span><br></pre></td></tr></tbody></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/12/66e2d58421b75.png" alt="image-20240912195029003"></p>
<h4 id="位域修改"><a href="#位域修改" class="headerlink" title="位域修改"></a>位域修改</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BITFIELD key [GET <span class="built_in">type</span> offset]</span><br></pre></td></tr></tbody></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/12/66e2d68a3d847.png" alt="image-20240912195451127"></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BITFIELD key [SET type offset value]</span><br></pre></td></tr></tbody></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/12/66e2d9a0327b3.png" alt="image-20240912200801087"></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BITFIELD key [INCRBY type offset increment]</span><br></pre></td></tr></tbody></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/12/66e2d9bdc53fa.png" alt="image-20240912200830734"></p>
<h4 id="溢出控制"><a href="#溢出控制" class="headerlink" title="溢出控制"></a>溢出控制</h4><p><code>WRAP</code>: 使用回绕（wrap around）方法处理有符号整数和无符号整数的溢出情况</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/12/66e2da12a35ff.png" alt="image-20240912200955612"></p>
<p><code>SAT</code>：使用饱和计算（saturation arithmetic）方法处理溢出，下溢计算的结果为最小的整数，而上溢出的结果为最大的整数值（-128 - 127）</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/12/66e2dacd5adf6.png" alt="image-20240912201302354"></p>
<p><code>FAIL</code>: 命令将拒绝执行那些会导致上溢或下溢情况出现的计算，并向用户返回空值表示计算未被执行</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/12/66e2daf15e9b0.png" alt="image-20240912201338362"></p>
<h1 id="Redis持久化"><a href="#Redis持久化" class="headerlink" title="Redis持久化"></a>Redis持久化</h1><h2 id="总体介绍"><a href="#总体介绍" class="headerlink" title="总体介绍"></a>总体介绍</h2><p>将内存中的数据写到磁盘进行持久化保存</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/12/66e2dcbf0bcef.png" alt="image-20240912202119926"></p>
<h2 id="RDB（Redis-DataBase）"><a href="#RDB（Redis-DataBase）" class="headerlink" title="RDB（Redis DataBase）"></a>RDB（Redis DataBase）</h2><h3 id="官网介绍"><a href="#官网介绍" class="headerlink" title="官网介绍"></a>官网介绍</h3><p>RDB（Redis 数据库）：RDB 持久性以指定的时间间隔执行数据集的时间点快照。</p>
<p>即在指定的时间间隔，执行数据集的时间点快照</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e52b56a1882.png" alt="image-20240914142110450"></p>
<h3 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h3><p>在指定的时间间隔内将内存中的数据集快照写入磁盘，也就是行话讲的Snapshot内存快照，它恢复时再将硬盘<br>快照文件直接读回到内存里</p>
<p>Redis的数据都在内存中，保存备份时它执行的是，<font color="red">全量快照</font>，也就是说，把内存中的所有数据都记录到磁盘中。</p>
<p>最终保存到<code>dump.rdb</code>文件中</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e52c4c8afd2.png" alt="image-20240914142516453"></p>
<h3 id="案例演示"><a href="#案例演示" class="headerlink" title="案例演示"></a>案例演示</h3><h4 id="配置文件变化"><a href="#配置文件变化" class="headerlink" title="配置文件变化"></a>配置文件变化</h4><p><strong>Redis6.0.16以前：</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e52c8798657.png" alt="image-20240914142615377"></p>
<p><strong>Redis6.2至Redis7:</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e52cf722615.png" alt="image-20240914142806932"></p>
<h4 id="操作步骤"><a href="#操作步骤" class="headerlink" title="操作步骤"></a>操作步骤</h4><h5 id="自动触发："><a href="#自动触发：" class="headerlink" title="自动触发："></a><strong>自动触发：</strong></h5><p>在Redis7版本中，修改<code>redis.conf</code>中的 <code>save &lt;seconds&gt; &lt;changes&gt;</code> 信息</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e52ef55eb59.png" alt="image-20240914143637205"></p>
<p>例如修改为5秒内2次修改则进行持久化保存到rdb文件中</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e533d767175.png" alt="image-20240914145727338"></p>
<p><strong>修改dump文件路径</strong>：</p>
<p>默认情况下，<code>dump.rdb</code>文件保存到与<code>redis.conf</code>配置文件相同的目录内</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e52fb84ca7e.png" alt="image-20240914143952202"></p>
<p>我可以将其保存到自定义目录中</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e5305ba767e.png" alt="image-20240914144235598"></p>
<p>我们可以使用 <code>CONFIG GET parameter</code>来获取配置文件中的参数信息</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e5326ef10c4.png" alt="image-20240914145126875"></p>
<p><strong>修改dump文件名：</strong></p>
<p>默认名称为<code>dump.rdb</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e532be0a05d.png" alt="image-20240914145245942"></p>
<p>我们可以修改自定义文件名，比如加个端口号，配置集群时方便区分</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e5331b3a154.png" alt="image-20240914145419191"></p>
<p><strong>触发备份：</strong></p>
<blockquote>
<p>时间间隔和写入次数同时满足时才会触发备份</p>
<p>使用shutdown命令也会触发一次自动备份</p>
</blockquote>
<p>第一种情况：一次性写入两个key，自动备份成功</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e538157d1c5.png" alt="image-20240914151533335"></p>
<p>第二种情况：先写入一个key，没有自动保存，等待几秒中使其超过5秒时间间隔，再写入第二次时自动备份成功</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e5382e12397.png" alt="image-20240914151557905"></p>
<p><strong>如何恢复：</strong></p>
<p>将备份文件(dump.rdb)移动到redis安装目录并启动服务即可</p>
<p><font color="red">注意：执行flushall/flushdb命令也会产生dump.rdb文件，但里面是空的，无意义</font></p>
<p>所以物理恢复务必做到服务和备份<font color="red">分机隔离</font></p>
<p>即不可以把备份文件<code>dump.rdb</code>和生产redis服务器放在同一台机器，必须分开各自存储，以防止生产机物理损坏后备份文件也挂了的窘境。</p>
<h5 id="手动触发："><a href="#手动触发：" class="headerlink" title="手动触发："></a>手动触发：</h5><p>Redis提供了两个命令来生成RDB文件分别是<code>SAVE</code>和<code>BGSAVE</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e5424f581d1.png" alt="image-20240914155911204"></p>
<p><strong>SAVE:</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e5431c0b918.png" alt="image-20240914160235992"></p>
<p>在主程序中执行<font color="red">会阻塞</font>当前Redis服务器，</p>
<p><strong>直到持久化工作完成，执行save命令期间，Redis不能处理其他命令</strong>，<font color="red">线上禁止使用<code>SAVE</code>命令进行备份操作</font></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e54504ead3f.png" alt="image-20240914161044906"></p>
<p><strong>BGSAVE（默认）:</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e544c035d2d.png" alt="image-20240914160936169"></p>
<p>Redis会在后台异步进行快照操作，<font color="red">不阻塞</font><br>快照同时还可以响应客户端请求，该触发方式会fork一个子进程由子进程复制持久化过程</p>
<p>Redis会使用bgsave对当前内存中的所有数据做快照，这个操作是子进程在后台完成的，这就允许主进程同时可以修改数据。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e5451d66289.png" alt="image-20240914161109339"></p>
<p><strong>怎么理解Fork？：</strong></p>
<p>生活中的案例：GitHub上Fork一份代码到自己仓库，自己修改时不影响原有仓库</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e543fec644e.png" alt="image-20240914160622725"></p>
<p>在Linux程序中，<code>fork()</code>会产生一个和父进程完全相同的子进程，但子进程在此后会多执行系统调用，出于效率考虑，尽量避免膨胀。</p>
<p><strong>LASTSAVE:</strong></p>
<p>可以通过lastsave命令获取最后一次成功执行快照的时间</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e545c616872.png" alt="image-20240914161358023"></p>
<p>再Linux中可以使用 <code>date -d @时间戳</code>将时间戳转换为可以识别的日期时间</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e546009170a.png" alt="image-20240914161456587"></p>
<h3 id="RDB优势"><a href="#RDB优势" class="headerlink" title="RDB优势"></a>RDB优势</h3><h4 id="官网说明"><a href="#官网说明" class="headerlink" title="官网说明"></a>官网说明</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e547f6e02c1.png" alt="image-20240914162318774"></p>
<h4 id="小总结-1"><a href="#小总结-1" class="headerlink" title="小总结"></a>小总结</h4><ol>
<li>适合大规模的数据恢复</li>
<li>按照业务定时备份</li>
<li>对数据完整性和一致性要求不高</li>
<li>RDB文件在内存中的加载速度要比AOF快得多</li>
</ol>
<h3 id="RDB劣势"><a href="#RDB劣势" class="headerlink" title="RDB劣势"></a>RDB劣势</h3><h4 id="官网说明-1"><a href="#官网说明-1" class="headerlink" title="官网说明"></a>官网说明</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e548a914f15.png" alt="image-20240914162616917"></p>
<h4 id="小总结-2"><a href="#小总结-2" class="headerlink" title="小总结"></a>小总结</h4><ol>
<li>在一定间隔时间做一次备份，所以如果Redis意外宕机，就会丢失从当前至最近一次快照期间的数据，，<font color="red">快照之间的数据会丢失</font>。</li>
<li>内存数据的全量同步，如果数据量太大会导致I/0严重影响服务器性能</li>
<li>RDB依赖于主进程的Fok,在更大的数据集中，这可能会导致服务请求的瞬间延迟。Fork的时候内存中的数据被克隆了一份，大致2倍的膨胀性，需要考虑</li>
</ol>
<h3 id="数据丢失案例"><a href="#数据丢失案例" class="headerlink" title="数据丢失案例"></a>数据丢失案例</h3><p>正常录入数据，k1，k2已进行备份，写入k3后模拟服务器意外宕机</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e5498fa0acb.png" alt="image-20240914163007497"></p>
<p>使用<code>kill</code>命令杀掉<code>redis-server</code>进程</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e549b76e28d.png" alt="image-20240914163047448"></p>
<p>恢复服务后，重新查看数据，k3数据丢失</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e54a3888f2b.png" alt="image-20240914163256430"></p>
<h3 id="如何修复dump-rdb文件？"><a href="#如何修复dump-rdb文件？" class="headerlink" title="如何修复dump.rdb文件？"></a>如何修复<code>dump.rdb</code>文件？</h3><p>可以使用<code>redis-check-rdb</code> 命令尝试修复，但未必能够修复成功</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e54ae87f546.png" alt="image-20240914163552422"></p>
<h3 id="哪些情况会触发RDB快照？"><a href="#哪些情况会触发RDB快照？" class="headerlink" title="哪些情况会触发RDB快照？"></a>哪些情况会触发RDB快照？</h3><ol>
<li>配置文件中默认的快照配置</li>
<li>手动save/bgsave命令</li>
<li>执行flushall/flushdb命令也会产生<code>dump.rdb</code>文件，但里面是空的，无意义</li>
<li>执行shutdown且没有设置开启AOF持久化</li>
<li>主从复制时，主节点自动触发</li>
</ol>
<h3 id="如何禁用RDB快照？"><a href="#如何禁用RDB快照？" class="headerlink" title="如何禁用RDB快照？"></a>如何禁用RDB快照？</h3><ol>
<li>动态停止所有RDB保存规则的方法：<code>redis-cli config set save ""</code></li>
<li>禁用快照，直接修改<code>redis.conf</code>配置文件 <code>save ""</code></li>
</ol>
<p>​		<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e54cd4e8b6b.png" alt="image-20240914164404799"></p>
<h3 id="RDB优化配置项"><a href="#RDB优化配置项" class="headerlink" title="RDB优化配置项"></a>RDB优化配置项</h3><p>1、<code>SAVE&lt;seconds&gt; &lt;changes&gt;</code></p>
<p>2、<code>dbfilename</code></p>
<p>3、<code>dir</code></p>
<p>4、<code>stop-writes-on-bgsave-error</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e5703758c79.png" alt="image-20240914191503285"></p>
<p>5、<code>rdbcompression</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e570566898a.png" alt="image-20240914191534499"></p>
<p>6、<code>rdbchecksum</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e570671af25.png" alt="image-20240914191551140"></p>
<p>7、<code>rdb-del-sync-files</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e5708a65e93.png" alt="image-20240914191626413"></p>
<h3 id="小总结-3"><a href="#小总结-3" class="headerlink" title="小总结"></a>小总结</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e570a1ef344.png" alt="image-20240914191649979"></p>
<h2 id="AOF（Append-Only-File）"><a href="#AOF（Append-Only-File）" class="headerlink" title="AOF（Append Only File）"></a>AOF（Append Only File）</h2><h3 id="官网介绍-1"><a href="#官网介绍-1" class="headerlink" title="官网介绍"></a>官网介绍</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e571d1b1b15.png" alt="image-20240914192153654"></p>
<p><font color="red">以日志的形式来记录每个<strong>写</strong>操作</font>，将Rdis执行过的所有写指令记录下来（读操作不记录），只许追加文件但不可以改写文件，Redis启动之初会读取该文件重新构建数据，换言之，Redis重启的话就根据日志文件的内容将写指令从前到后执行一次以完成数据的恢复工作。</p>
<p>默认情况下，Redis是没有开启AOF(append only file)的。开启AOF功能需要设置配置：<code>appendonly yes</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e5728264b19.png" alt="image-20240914192450394"></p>
<p>Aof保存的是<code>appendonly.aof</code>文件</p>
<h3 id="AOF持久化工作流程"><a href="#AOF持久化工作流程" class="headerlink" title="AOF持久化工作流程"></a>AOF持久化工作流程</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e573eea6a35.png" alt="image-20240914193054676"></p>
<h3 id="AOF缓冲区三种写回策略"><a href="#AOF缓冲区三种写回策略" class="headerlink" title="AOF缓冲区三种写回策略"></a>AOF缓冲区三种写回策略</h3><p>1、Always</p>
<p>同步写回，每个写命令执行完立刻同步地将日志写回磁盘</p>
<p>2、everysec</p>
<p>每秒写回，每个写命令执行完，只是先把日志写到AOF文件的内存缓冲区，每隔1秒把缓冲区中的内容写入磁盘</p>
<p>3、no</p>
<p>操作系统控制的写回，每个写命令执行完，只是先把日志写到AOF文件的内存缓冲区，由操作系统决定何时将缓冲区内容写回磁盘</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e574e97cb4c.png" alt="image-20240914193505492"></p>
<h3 id="AOF配置文件说明"><a href="#AOF配置文件说明" class="headerlink" title="AOF配置文件说明"></a>AOF配置文件说明</h3><h4 id="如何开启AOF"><a href="#如何开启AOF" class="headerlink" title="如何开启AOF?"></a>如何开启AOF?</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e577c2719b2.png" alt="image-20240914194714460"></p>
<p>使用默认写回策略，每秒钟</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e577f54e11f.png" alt="image-20240914194805429"></p>
<h4 id="AOF文件保存路径"><a href="#AOF文件保存路径" class="headerlink" title="AOF文件保存路径"></a>AOF文件保存路径</h4><p><strong>Redis6:</strong></p>
<p>AOF保存文件的位置和RDB保存文件的位置一样，都是通过<code>redis.conf</code>配置文件的<code>dir</code>配置</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e5784a2e1d2.png" alt="image-20240914194930303"></p>
<p><strong>Redis7:</strong></p>
<p>Redis7在原来<code>dir</code>目录的基础上多了一层目录 <code>appenddirname</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e5788f72348.png" alt="image-20240914195039584"></p>
<p>AOF最终目录为： <code>dir</code>+ <code>appenddirname</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e578c5a6e14.png" alt="image-20240914195133723"></p>
<h4 id="AOF文件保存名称"><a href="#AOF文件保存名称" class="headerlink" title="AOF文件保存名称"></a>AOF文件保存名称</h4><p>Redis7采用 Multi Part AOF的设计，即由多部份组成</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e57920be843.png" alt="image-20240914195304813"></p>
<p>包含三部分：</p>
<p><strong>1、base基本文件</strong></p>
<p><strong>2、incr增量文件</strong></p>
<p><strong>3、mainfest清单文件</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e57943d0573.png" alt="image-20240914195339837"></p>
<p><strong>Redis7中对应的配置项</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e579d8c2dee.png" alt="image-20240914195608917"></p>
<h3 id="AOF修复-恢复"><a href="#AOF修复-恢复" class="headerlink" title="AOF修复/恢复"></a>AOF修复/恢复</h3><h4 id="正常恢复"><a href="#正常恢复" class="headerlink" title="正常恢复"></a>正常恢复</h4><p>1、重启Redis然后加载数据 OK</p>
<p>2、写入数据到Redis，然后flushdb + shutdown服务器</p>
<p>新生成了dump.rdb 及 aof 文件，备份新生成的aof.bak，然后删除aof文件，重启Redis然后重新加载</p>
<p>结果无数据，原因是flushdb也是写操作，也回被记录到aof文件中</p>
<p>再次停止服务器，恢复原来备份的有数据的aof文件再重启服务查看  数据恢复</p>
<h4 id="异常修复"><a href="#异常修复" class="headerlink" title="异常修复"></a>异常修复</h4><p>故意乱写正常的AOF文件，模拟网络中断导致文件写入错误</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e582f32953b.png" alt="image-20240914203459253"></p>
<p>重启Redis之后就会进行AOF文件的载入，发现启动都不行</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e583180ba34.png" alt="image-20240914203536164"></p>
<p>异常修复命令：<code>redis-check-aof--fiX</code>进行修复</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e5833c43dbb.png" alt="image-20240914203612349"></p>
<p>重新启动并查询数据成功</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e58365613e8.png" alt="image-20240914203653525"></p>
<h3 id="AOF优势"><a href="#AOF优势" class="headerlink" title="AOF优势"></a>AOF优势</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e5848a1fb23.png" alt="image-20240914204146184"></p>
<h3 id="AOF劣势"><a href="#AOF劣势" class="headerlink" title="AOF劣势"></a>AOF劣势</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e584da89f95.png" alt="image-20240914204306706"></p>
<h3 id="AOF重写机制"><a href="#AOF重写机制" class="headerlink" title="AOF重写机制"></a>AOF重写机制</h3><h4 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h4><p>由于AOF持久化是Redis不断将写命令记录到 AOF 文件中，随着Redis不断的进行，AOF 的文件会越来越大，文件越大，占用服务器内存越大以及 AOF 恢复要求时间越长。</p>
<p>为了解决这个问题，<font color="red"> Redis新增了重写机制</font>，当AOF文件的大小超过所设定的峰值时，Redis就会<font color="red">自动</font>启动AOF文件的内容压缩，只保留可以恢复数据的最小指令集或者可以<strong>手动使用命令 <code>bgrewriteaof</code> 来重新。</strong></p>
<h4 id="触发机制"><a href="#触发机制" class="headerlink" title="触发机制"></a>触发机制</h4><p><strong>官网默认配置：</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e588ee6dca7.png" alt="image-20240914210030508"></p>
<p><strong>自动触发：</strong></p>
<p>满足配置文件中的选项后，Rediss会记录上次重写时的AOF大小，默认配置是当AOF文件大小是上次rewrite后大小的一倍且文件大于64M时</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e58dd2c77d0.png" alt="image-20240914212122885"></p>
<p><strong>手动触发：</strong></p>
<p>客户端向服务器发送<code>bgrewriteaof</code>命令</p>
<h4 id="AOF重写原理"><a href="#AOF重写原理" class="headerlink" title="AOF重写原理"></a>AOF重写原理</h4><p>1：在重写开始前，redis会创建一个“重写子进程”，这个子进程会读取现有的AOF文件，并将其包含的指令进行分析压缩并写入到一个临时文件中。</p>
<p>2：与此同时，主进程会将新接收到的写指令一边累积到内存缓冲区中，一边继续写入到原有的AOF文件中，这样做是保证原有的AOF文件的可用性，避免在重写过程中出现意外。</p>
<p>3：当“重写子进程”完成重写工作后，它会给父进程发一个信号，父进程收到信号后就会将内存中缓存的写指令追加到新AOF文件中</p>
<p>4：当追加结束后，redis就会用新AOF文件来代替旧AOF文件，之后再有新的写指令，就都会追加到新的AOF文件中</p>
<p>5：重写aof文件的操作，并没有读取旧的aof文件，而是将整个内存中的数据库内容用命令的方式重写了一个新的aof文件，这点和快照有点类似</p>
<h3 id="AOF优化配置项详解"><a href="#AOF优化配置项详解" class="headerlink" title="AOF优化配置项详解"></a>AOF优化配置项详解</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e59321bdc13.png" alt="image-20240914214401816"></p>
<h4 id="小总结-4"><a href="#小总结-4" class="headerlink" title="小总结"></a>小总结</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e593476009f.png" alt="image-20240914214439473"></p>
<h2 id="RDB-AOF混合模式"><a href="#RDB-AOF混合模式" class="headerlink" title="RDB + AOF混合模式"></a>RDB + AOF混合模式</h2><p>RDB特久化方式能够在指定的时间间隔能对你的数据进行快照存储</p>
<p>AOF持久化方式记录每次对服务器写的操作，当服务器重启的时候会重新执行这些命令来恢复原始的数据，AOF命令以Redis协议追加保存每次写的操作到文件末尾</p>
<p>RDB 和 AOF两种持久化方式可以共存</p>
<p>同时开启两种持久化方式时，<font color="red">当Redis重启的时候会优先载入AOF文件来恢复原始的数据</font>,因为在通常情况下AOF文件保存的数据集要比RDB文件保存的数据集要完整。</p>
<p>RDB的数据不实时，同时使用两者时服务器重启也只会找AOF文件。那要不要只使用AOF呢？<br>作者建议不要，因为RDB更适合用于备份数据库(AOF在不断变化不好备份)，留着db作为一个万一的手段。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e594a30ff21.png" alt="image-20240914215027146"></p>
<p><strong>RDB + AOF混合模式：</strong></p>
<p>结合了RDB和AOF的优点，既能快速加载又能避免丢失过多的数据。</p>
<p>1、开启混合方式设置</p>
<p>设置<code>aof-use-rdb-preamble</code>的值为 <code>yes</code>  yes表示开启，设置为no表示禁用</p>
<p>2、 RDB+AOF的混合方式 结论：<font color="red">RDB镜像做全量持久化，AOF做增量持久化</font></p>
<p>先使用RDB进行快照存储，然后使用AOF持久化记录所有的写操作，当重写策略满足或手动触发重写的时候，<font color="red">将最新的数据存储为新的RDB记录</font>。这样的话，重启服务的时候会从RDB和AOF两部分恢复数据，既保证了数据完整性，又提高了恢复数据的性能。简单来说：混合持久化方式产生的文件一部分是RDB格式，一部分是AOF格式</p>
<p><strong><font color="red">AOF包括了RDB头部+AOF混写</font></strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e5957ddd27c.png" alt="image-20240914215406068"></p>
<h2 id="纯缓存模式"><a href="#纯缓存模式" class="headerlink" title="纯缓存模式"></a>纯缓存模式</h2><p>即同时关闭RDB及AOF，采用其他实现持久化操作，Redis只做缓存功能</p>
<p><strong>禁用RDB:</strong></p>
<blockquote>
<p>禁用rdb持久化模式下，我们仍然可以使用命令save、bgsave生成rdb文件</p>
</blockquote>
<p>配置 <code>save ""</code></p>
<h3 id="禁用AOF"><a href="#禁用AOF" class="headerlink" title="禁用AOF"></a>禁用AOF</h3><blockquote>
<p>禁用aof特久化模式下，我们仍然可以使用命令bgrewriteaof生成aof文件</p>
</blockquote>
<p>配置 <code>appendonly no</code></p>
<h1 id="Redis-事务"><a href="#Redis-事务" class="headerlink" title="Redis 事务"></a>Redis 事务</h1><h2 id="介绍-1"><a href="#介绍-1" class="headerlink" title="介绍"></a>介绍</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://redis.io/docs/manual/transactions/">https://redis.io/docs/manual/transactions/</a></p>
</blockquote>
<p>可以一次执行多个命令，本质是一组命令的集合。一个事务中的所有命令都会序列化，<font color="red">按顺序地串行化执行而不会被其它命令插入，不许加塞</font></p>
<h2 id="作用-1"><a href="#作用-1" class="headerlink" title="作用"></a>作用</h2><p>一个队列中，一次性、顺序性、排他性的执行一系列命令</p>
<h2 id="Redis事务与数据库事务的区别"><a href="#Redis事务与数据库事务的区别" class="headerlink" title="Redis事务与数据库事务的区别"></a>Redis事务与数据库事务的区别</h2><p>1 、单独的隔离操作</p>
<p>Redis的事务仅仅是保证事务里的操作会被连续独占的执行，<font color="red">redis命令执行是单线程架构</font>，在执行完事务内所有指令前是不可能再去同时执行其他客户端的请求的</p>
<p>2 、没有隔离级别的概念</p>
<p> 因为事务提交前任何指令都不会被实际执行，也就不存在”事务内的查询要看到事务里的更新，在事务外查询不能看到”这种问题了</p>
<p>3、不保证原子性</p>
<p> Redis的事务<font color="red">不保证原子性</font>，也就是不保证所有指令同时成功或同时失败，只有决定是否开始执行全部指令的能力，没有执行到一半进行回滚的能力</p>
<p>4、 排它性</p>
<p>Redis会保证一个事务内的命令依次执行，而不会被其它命令插入</p>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><h3 id="常用命令-3"><a href="#常用命令-3" class="headerlink" title="常用命令"></a>常用命令</h3><p>下表列出了 redis 事务的相关命令：</p>
<table>
<thead>
<tr>
<th align="left">序号</th>
<th align="left">命令及描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/transactions-discard.html">DISCARD</a> 取消事务，放弃执行事务块内的所有命令。</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/transactions-exec.html">EXEC</a> 执行所有事务块内的命令。</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/transactions-multi.html">MULTI</a> 标记一个事务块的开始。</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/transactions-unwatch.html">UNWATCH</a> 取消 WATCH 命令对所有 key 的监视。</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left">[WATCH key <a target="_blank" rel="noopener" href="https://www.runoob.com/redis/transactions-watch.html">key …]</a> 监视一个(或多个) key ，如果在事务执行之前这个(或这些) key 被其他命令所改动，那么事务将被打断。</td>
</tr>
</tbody></table>
<h3 id="不用场景说明"><a href="#不用场景说明" class="headerlink" title="不用场景说明"></a>不用场景说明</h3><h4 id="场景一：正常执行"><a href="#场景一：正常执行" class="headerlink" title="场景一：正常执行"></a>场景一：正常执行</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e59d2ec9934.png" alt="image-20240914222654977"></p>
<h4 id="场景二：放弃事务"><a href="#场景二：放弃事务" class="headerlink" title="场景二：放弃事务"></a>场景二：放弃事务</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e59d581dd47.png" alt="image-20240914222736269"></p>
<h4 id="场景三：全体连坐"><a href="#场景三：全体连坐" class="headerlink" title="场景三：全体连坐"></a>场景三：全体连坐</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e59d807edb6.png" alt="image-20240914222816627"></p>
<h4 id="场景四：冤头债主"><a href="#场景四：冤头债主" class="headerlink" title="场景四：冤头债主"></a>场景四：冤头债主</h4><p>非编译错误，在执行时出错，其他命令不受影响</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e59daade263.png" alt="image-20240914222859038"></p>
<h4 id="场景五：watch监控"><a href="#场景五：watch监控" class="headerlink" title="场景五：watch监控"></a>场景五：watch监控</h4><blockquote>
<p>Redis使用Watch来提供乐观锁定，类以于CAS(Check-and-Set）</p>
</blockquote>
<p><strong>CAS回顾：</strong></p>
<p>1、悲观锁</p>
<p> 悲观锁(Pessimistic Lock), 顾名思义，就是很悲观，每次去拿数据的时候都认为别人会修改，所以每次在拿数据的时候都会上锁，这样别人想拿这个数据就会block直到它拿到锁。</p>
<p>2、乐观锁</p>
<p> 乐观锁(Optimistic Lock), 顾名思义，就是很乐观，每次去拿数据的时候都认为别人不会修改，所以不会上锁，但是在更新的时候会判断一下在此期间别人有没有去更新这个数据。</p>
<p><font color="red">乐观锁策略:提交版本必须  大于  记录当前版本才能执行更新</font></p>
<p>3、CAS</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e59ea7bd7dd.png" alt="image-20240914223311951"></p>
<p><strong>Watch:</strong></p>
<p>初始化k1和balance两个key,先监控再开启multi，保证两key变动在同一个事务内</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e59ef67fa94.png" alt="image-20240914223430699"></p>
<p><strong>watch命令是一种乐观锁的实现，Redis在修改的时候会检测数据是否被更改，如果更改了，则执行失败</strong></p>
<p><strong>第一个窗口蓝色框第5步执行结果返回为空，也就是相当于是失败，笔记见最下面官网说明</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e59f293f77a.png" alt="image-20240914223521383"></p>
<p><strong>unwatch:</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e59f5173d87.png" alt="image-20240914223601622"></p>
<p><strong>小结：</strong></p>
<p>一旦执行了exec之前加的监控锁都会被取消</p>
<p>当客户端连接丢失的时候（比如退出链接），所有东西都会被取消监视</p>
<h2 id="Redis事务总结"><a href="#Redis事务总结" class="headerlink" title="Redis事务总结"></a>Redis事务总结</h2><p><strong>开启</strong>：以<code>MUTI</code>开始一个事务</p>
<p><strong>入队</strong>：将多个命令入队到事务中，接到这些命令并不会立即执行，而是放到等待执行的事务队列里面</p>
<p><strong>执行</strong>：由<code>EXEC</code>命令触发事务</p>
<h1 id="Redis管道（pipeline）"><a href="#Redis管道（pipeline）" class="headerlink" title="Redis管道（pipeline）"></a>Redis管道（pipeline）</h1><blockquote>
<p>开篇先来个面试题</p>
</blockquote>
<h2 id="如何优化频繁命令往返造成的性能瓶颈？"><a href="#如何优化频繁命令往返造成的性能瓶颈？" class="headerlink" title="如何优化频繁命令往返造成的性能瓶颈？"></a><strong>如何优化频繁命令往返造成的性能瓶颈？</strong></h2><p>Redis是一种基于<font color="red">客户端-服务端模型</font>以及请求/响应协议的TCP服务。一个请求会遵循以下步骤：</p>
<p>1 、客户端向服务端发送命令分四步(发送命令→命令排队→命令执行→返回结果)，并监听Socket返回，通常以阻塞模式等待服务端响应。</p>
<p>2、服务端处理命令，并将结果返回给客户端。</p>
<p><strong><font color="red">上述两步称为：Round Trip Time(简称RTT,数据包往返于两端的时间)</font></strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/15/66e65766c762e.png" alt="image-20240915114128063"></p>
<p>如果同时需要执行大量的命令，那么就要等待上一条命令应答后再执行，这中间不仅仅多了<strong>RTT</strong>（Round Time Trip），而且还频繁调用系统IO，发送网络请求，同时需要Redis调用多次<code>read()</code>和<code>write()</code>系统方法，系统方法会将数据从用户态转移到内核态，这样就会对进程上下文有比较大的影响了，性能不太好</p>
<p>对于上述问题的解决思路就是采用管道(pipeline)</p>
<h2 id="Redis管道介绍"><a href="#Redis管道介绍" class="headerlink" title="Redis管道介绍"></a>Redis管道介绍</h2><blockquote>
<p>官网介绍： <a target="_blank" rel="noopener" href="https://redis.io/docs/manual/pipelining/">https://redis.io/docs/manual/pipelining/</a></p>
</blockquote>
<p>Pipeline是为了解决RTT往返回时，仅仅是将命令打包一次性发送，对整个Redis的执行不造成其它任何影响</p>
<p><font color="red">是批做处理命令变种优化措施</font>，类似Redis的原生批命令(mget和mset)</p>
<h2 id="案例演示-1"><a href="#案例演示-1" class="headerlink" title="案例演示"></a>案例演示</h2><p>可以将所有要批量执行的命令写入到一个文件中，然后使用 <code>--pipe</code> 命令参数执行</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/15/66e6599b37c5e.png" alt="image-20240915115052536"></p>
<h2 id="Redis管道小总结"><a href="#Redis管道小总结" class="headerlink" title="Redis管道小总结"></a>Redis管道小总结</h2><h3 id="Pipeline与原生批量命令对比"><a href="#Pipeline与原生批量命令对比" class="headerlink" title="Pipeline与原生批量命令对比"></a>Pipeline与原生批量命令对比</h3><ol>
<li>原生批量命令是原子性（例如：mset,mget),pipeline是非原子性</li>
<li>原生批量命令一次只能执行一种命令，pipeline支持批量执行不同命令</li>
<li>原生批命令是服务端实现，而pipeline需要服务端与客户端共同完成</li>
</ol>
<h3 id="Pipeline与Redis事务对比"><a href="#Pipeline与Redis事务对比" class="headerlink" title="Pipeline与Redis事务对比"></a>Pipeline与Redis事务对比</h3><ol>
<li>事务具有原子性(不保证)，管道不具有原子性</li>
<li>管道一次性将多条命令发送到服务器，事务是一条一条的发，事务只有在接收到exec命令后才会执行，管道不会</li>
<li>执行事务时会阻塞其他命令的执行，而执行管道中的命令时不会</li>
</ol>
<h2 id="使用Pipeline注意事项"><a href="#使用Pipeline注意事项" class="headerlink" title="使用Pipeline注意事项"></a>使用Pipeline注意事项</h2><ol>
<li>pipelines缓冲的指令只是会依次执行，不保证原子性，如果执行中指令发生异常，将会继续执行后续的指令</li>
<li>使用pipeline组装的命令个数不能太多，不然数据量过大客户端阻塞的时间可能过久，同时服务端此时也被迫回复一个队列答复，占用很多内存。</li>
</ol>
<h1 id="Redis发布订阅"><a href="#Redis发布订阅" class="headerlink" title="Redis发布订阅"></a>Redis发布订阅</h1><blockquote>
<p>专业的事情交给专业的中间件处理，了解即可</p>
</blockquote>
<h2 id="介绍-2"><a href="#介绍-2" class="headerlink" title="介绍"></a>介绍</h2><blockquote>
<p>官网介绍： <a target="_blank" rel="noopener" href="https://redis.io/docs/manual/pubsub/">https://redis.io/docs/manual/pubsub/</a></p>
</blockquote>
<p>是一种消息通信模式：发送者(PUBLISH)发送消息，订阅者(SUBSCRIBE)接收消息，可以实现进程间的消息传递</p>
<p>Redis可以实现消息中间件MQ的功能，通过发布订阅实现消息的引导和分流。</p>
<h2 id="作用-2"><a href="#作用-2" class="headerlink" title="作用"></a>作用</h2><p>Redis客户端可以订阅任意数量的频道，类似我们微信关注多个公众号</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/15/66e65d50e0e1d.png" alt="image-20240915120642372"></p>
<p>当有新消息通过PUBLISH命令发送给频道channel1时</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/15/66e65d6c57b4c.png" alt="image-20240915120709832"></p>
<h2 id="常用命令-4"><a href="#常用命令-4" class="headerlink" title="常用命令"></a>常用命令</h2><p>下表列出了 redis 发布订阅常用命令：</p>
<table>
<thead>
<tr>
<th align="left">序号</th>
<th align="left">命令及描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left">[PSUBSCRIBE pattern <a target="_blank" rel="noopener" href="https://www.runoob.com/redis/pub-sub-psubscribe.html">pattern …]</a> 订阅一个或多个符合给定模式的频道。</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">[PUBSUB subcommand <a target="_blank" rel="noopener" href="https://www.runoob.com/redis/pub-sub-pubsub.html">argument [argument …]]</a> 查看订阅与发布系统状态。</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/pub-sub-publish.html">PUBLISH channel message</a> 将信息发送到指定的频道。</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left">[PUNSUBSCRIBE <a target="_blank" rel="noopener" href="https://www.runoob.com/redis/pub-sub-punsubscribe.html">pattern [pattern …]]</a> 退订所有给定模式的频道。</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left">[SUBSCRIBE channel <a target="_blank" rel="noopener" href="https://www.runoob.com/redis/pub-sub-subscribe.html">channel …]</a> 订阅给定的一个或多个频道的信息。</td>
</tr>
<tr>
<td align="left">6</td>
<td align="left">[UNSUBSCRIBE <a target="_blank" rel="noopener" href="https://www.runoob.com/redis/pub-sub-unsubscribe.html">channel [channel …]]</a> 指退订给定的频道。</td>
</tr>
</tbody></table>
<p><font color="red"> 推荐先执行订阅后再发布，订阅成功之前发布的消息是收不到的 </font></p>
<h2 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h2><ol>
<li>发布的消息在Rds系统中不能持久化，因此，必须先执行订阅，再等待消息发布。如果先发布了消息，那么该消息由于没有订阅者，消息将被直接丢弃。</li>
<li>消息只管发送对于发布者而言消息是即发即失的，不管接收，也没有ACK机制，无法保证消息的消费成功</li>
<li>以上的缺点导致Redis的Pub/Sub模式就像个小玩具，在生产环境中几乎无用武之地，为此Redis5.0版本新增了Stream数据结构，不但支持多播，还支持数据持久化，相比Pub/Sub更加的强大</li>
</ol>
<h1 id="Redis复制（Replication）"><a href="#Redis复制（Replication）" class="headerlink" title="Redis复制（Replication）"></a>Redis复制（Replication）</h1><h2 id="介绍-3"><a href="#介绍-3" class="headerlink" title="介绍"></a>介绍</h2><blockquote>
<p>官网介绍： <a target="_blank" rel="noopener" href="https://redis.io/docs/management/replication/">https://redis.io/docs/management/replication/</a></p>
</blockquote>
<p>就是主从复制，master以写为主，Slave以读为主</p>
<p>当master数据变化的时候，自动将新的数据异步同步到其它slave数据库</p>
<h2 id="作用-3"><a href="#作用-3" class="headerlink" title="作用"></a>作用</h2><ol>
<li>读写分离</li>
<li>容灾恢复</li>
<li>数据备份</li>
<li>水平扩容支撑高并发</li>
</ol>
<h2 id="使用-1"><a href="#使用-1" class="headerlink" title="使用"></a>使用</h2><h3 id="注意点"><a href="#注意点" class="headerlink" title="注意点"></a>注意点</h3><ol>
<li><font color="red">配从(库)不配主(库)</font></li>
<li>Master如果配置了<code>requirepass</code>参数，需要密码登陆，那么Slave就要配置<code>masterauth</code>来设置校验密码，<br>否则Master会拒绝Slave的访问请求</li>
</ol>
<h3 id="基本命令-4"><a href="#基本命令-4" class="headerlink" title="基本命令"></a>基本命令</h3><p>1、<strong>info replication</strong>：</p>
<p>可以查看复制节点的主从关系和配置信息</p>
<p>2、<strong>replicaof 主库IP 主库端口:</strong></p>
<p>设置从节点的主节点</p>
<p>一般写入进<code>redis.conf</code>配置文件内</p>
<p>3、<strong>slaveof 主库IP 主库端口:</strong></p>
<p>每次与master断开之后，都需要重新连接，除非你配置进<code>redis.conf</code>文件</p>
<p>在运行期间修改slave节点的信息，如果该数据库已经是某个主数据库的从数据库，那么会停上和原主数据库的同步关系<font color="red">转而和新的主数据库同步，重新拜码头</font></p>
<p>4、<strong>slaveof no one：</strong></p>
<p>使当前数据库停止与其他数据库的同步，<font color="red">转成主数据库，自立为王</font></p>
<h3 id="案例演示-2"><a href="#案例演示-2" class="headerlink" title="案例演示"></a>案例演示</h3><h4 id="架构说明"><a href="#架构说明" class="headerlink" title="架构说明"></a>架构说明</h4><p>个Master两个Slave，需要3台虚机，每台都安装redis</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/15/66e665e41549b.png" alt="image-20240915124317498"></p>
<h4 id="操作步骤-1"><a href="#操作步骤-1" class="headerlink" title="操作步骤"></a>操作步骤</h4><p>1、三边网络相互ping通且注意防火墙配置</p>
<p>2、拷贝多个<code>redis.conf</code>文件</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 192.168.10.66  redis_6379.conf</span></span><br><span class="line"><span class="built_in">bind</span> 0.0.0.0</span><br><span class="line">daemonize <span class="built_in">yes</span></span><br><span class="line">protected-mode no</span><br><span class="line">port 6379</span><br><span class="line">logfile <span class="string">"/my-redis7/redis6379.log"</span></span><br><span class="line">pidfile /my-redis7/redis6379.pid</span><br><span class="line"><span class="built_in">dir</span> /my-redis7</span><br><span class="line">dbfilename dump6379.rdb</span><br><span class="line">appendonly <span class="built_in">yes</span></span><br><span class="line">appendfilename <span class="string">"appendonly6379.aof"</span></span><br><span class="line">requirepass shiguang</span><br><span class="line">masterauth shiguang</span><br><span class="line"></span><br><span class="line"><span class="comment"># 192.168.10.88  redis_6378.conf</span></span><br><span class="line"><span class="built_in">bind</span> 0.0.0.0</span><br><span class="line">daemonize <span class="built_in">yes</span></span><br><span class="line">protected-mode no</span><br><span class="line">port 6378</span><br><span class="line">logfile <span class="string">"/my-redis7/redis6378.log"</span></span><br><span class="line">pidfile /my-redis7/redis6378.pid</span><br><span class="line"><span class="built_in">dir</span> /my-redis7</span><br><span class="line">dbfilename dump6378.rdb</span><br><span class="line">appendonly <span class="built_in">yes</span></span><br><span class="line">appendfilename <span class="string">"appendonly6378.aof"</span></span><br><span class="line">requirepass shiguang</span><br><span class="line">replicaof 192.168.10.66 6379</span><br><span class="line">masterauth shiguang</span><br><span class="line"></span><br><span class="line"><span class="comment"># 192.168.10.99  redis_6380.conf</span></span><br><span class="line"><span class="built_in">bind</span> 0.0.0.0</span><br><span class="line">daemonize <span class="built_in">yes</span></span><br><span class="line">protected-mode no</span><br><span class="line">port 6380</span><br><span class="line">logfile <span class="string">"/my-redis7/redis6380.log"</span></span><br><span class="line">pidfile /my-redis7/redis6380.pid</span><br><span class="line"><span class="built_in">dir</span> /my-redis7</span><br><span class="line">dbfilename dump6380.rdb</span><br><span class="line">appendonly <span class="built_in">yes</span></span><br><span class="line">appendfilename <span class="string">"appendonly6380.aof"</span></span><br><span class="line">requirepass shiguang</span><br><span class="line">replicaof 192.168.10.66 6379</span><br><span class="line">masterauth shiguang</span><br></pre></td></tr></tbody></table></figure>



<h3 id="修改配置文件细节"><a href="#修改配置文件细节" class="headerlink" title="修改配置文件细节"></a>修改配置文件细节</h3><p>1、开启后台启动<code>daemonize yes</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/15/66e6686649cb2.png" alt="image-20240915125359745"></p>
<p>2、注释绑定IP <code>bind 127.0.0.1</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/15/66e668b808a35.png" alt="image-20240915125521511"></p>
<p>3、关闭保护模式 <code>protected-mode no	</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/15/66e6691000d35.png" alt="image-20240915125649471"></p>
<p>4、指定端口 <code>port &lt;port&gt;</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/15/66e6694714508.png" alt="image-20240915125744593"></p>
<p>5、指定当前工作目录 <code>dir &lt;path&gt;</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/15/66e669742082c.png" alt="image-20240915125829644"></p>
<p>6、pid文件名字，<code>pidfile &lt;path&gt;</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/15/66e669c88ad27.png" alt="image-20240915125954069"></p>
<p>7、日志文件名称 <code>logfile &lt;path&gt;</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/15/66e66a1add136.png" alt="image-20240915130116384"></p>
<p>8、本机访问密码 <code>requirepass &lt;password&gt;</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/15/66e66a709387d.png" alt="image-20240915130242105"></p>
<p>9、<code>rdb</code>文件名称 <code>dbfilename &lt;filename&gt;</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/15/66e66acf41067.png" alt="image-20240915130416770"></p>
<p>10、<code>aof</code>文件名称  <code>appendfilename &lt;filename&gt;</code></p>
<p>需启用<code>aof</code>: <code>appendonly yes</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/15/66e66b11736a1.png" alt="image-20240915130522950"></p>
<p>可选步骤，默认为 <code>appendonly.aof</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/15/66e66b3aeea6f.png" alt="image-20240915130604458"></p>
<p><font color="red">11、从机访问主机的通行密码<code>masterauth</code>，从机必须配置</font></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/15/66e66c1f43f1c.png" alt="image-20240915130952748"></p>
<h4 id="三大命令"><a href="#三大命令" class="headerlink" title="三大命令"></a>三大命令</h4><p>1、<strong>主从复制：</strong></p>
<p>replicaof 主库IP 主库端口</p>
<p><font color="red">配从（库）不配主（库）</font></p>
<p>2、<strong>该换门庭：</strong></p>
<p>slaveof 新主库IP 新主库端</p>
<p>3、<strong>自立为王：</strong></p>
<p>slaveof no one</p>
<h4 id="一主二仆"><a href="#一主二仆" class="headerlink" title="一主二仆"></a>一主二仆</h4><p><strong>方案一：配置文件固定写死 <code>replicaof 主机IP 主机端口</code></strong></p>
<p>配从不配主，分别配置从机 <code>192.168.10.88</code>  :<code>redis_6378.conf</code>，<code>192.168.10.99</code>: <code> redis_6380.conf</code></p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 192.168.10.88  redis_6378.conf</span></span><br><span class="line">replicaof 192.168.10.66 6379</span><br><span class="line">masterauth shiguang</span><br><span class="line"></span><br><span class="line"><span class="comment"># 192.168.10.99  redis_6380.conf</span></span><br><span class="line">replicaof 192.168.10.66 6379</span><br><span class="line">masterauth shiguang</span><br></pre></td></tr></tbody></table></figure>

<p>先启动Master，后启动Slaver</p>
<p><strong>主从关系查看：</strong></p>
<p>1、日志</p>
<p>主机日志</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/15/66e6781d8cf9b.png" alt="image-20240915140102899"></p>
<p>从机日志</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/15/66e679023b657.png" alt="image-20240915140451708"></p>
<p>2、命令 <code>info replication</code></p>
<p>主机</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/15/66e6793e0fdd6.png" alt="image-20240915140551599"></p>
<p>从机</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/15/66e67953c723a.png" alt="image-20240915140613310"></p>
<p><strong>主从问题</strong></p>
<p><strong>1、从机可以执行写命令吗？</strong></p>
<p>答：不可以</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/15/66e679902fdf3.png" alt="image-20240915140713743"></p>
<p><strong>2、从机切入点问题</strong></p>
<p> slave是从头开始复制还是从切入点开始复制?</p>
<p> master启动，写到k3</p>
<p> slave1跟着master同时启动，跟着写到k3</p>
<p> slave2写到k3后才启动，那之前的是否也可以复制？</p>
<p>答： 是，首次一锅端，后续跟随，master写，slave跟</p>
<p><strong>3、主机shutdown后，从机会上位吗？</strong></p>
<p>答：不会，从机不动，原地待命，从机数据可以正常使用；等待主机重启动归来</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/15/66e67ab98509d.png" alt="image-20240915141211019"></p>
<p><strong>4、主机shutdown，重启后主从关系还在吗？从机还能否顺利复制？</strong></p>
<p>答： 主从关系还在，从机仍可以顺利复制</p>
<p><strong>5、某台从机shutdown后，master继续写入，从机重启后还能读取新写入的内容吗？</strong></p>
<p>答：可以，同问题2</p>
<p><strong>方案二：命令操作手动指定</strong></p>
<p>从机停机去掉配置文件中的配置项，让3台都是主机状态，各不从属</p>
<p>使用 <code>slaveof 主库IP 主库端口</code>进行指定</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/15/66e67ec708326.png" alt="image-20240915142928597"></p>
<p><strong>使用命令指定Master，从机重启后主从关系还在吗？</strong></p>
<p>答： 不再了，使用命令指定是临时性的。</p>
<h4 id="新货相传"><a href="#新货相传" class="headerlink" title="新货相传"></a>新货相传</h4><p>上一个slave可以是下一个slave的master,slavel同样可以接收其他slaves的连接和同步请求</p>
<p><font color="red"> slave成为其他slave的master，本质仍然是slave，不能执行写操作</font></p>
<p><font color="red">中途变更转向：会清除之前的数据，重新建立拷贝最新的</font></p>
<h4 id="反客为主"><a href="#反客为主" class="headerlink" title="反客为主"></a>反客为主</h4><p>使当前数据库停止与其他数据库的同步，转成主数据库</p>
<p>命令： <code>slaveof no one</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/15/66e682c550f06.png" alt="image-20240915144630864"></p>
<h2 id="复制原理和工作流程"><a href="#复制原理和工作流程" class="headerlink" title="复制原理和工作流程"></a>复制原理和工作流程</h2><p>1、slave启动，同步初请</p>
<p>slave启动成功连接到master后会发送一个<code>sync</code>命令</p>
<p>slave首次全新连接master,一次完全同步（全量复制）将被自动执行，slave自身原有数据会被master数据覆盖清除</p>
<p>2、首次连接，全量复制</p>
<p>naster节点收到<code>sync</code>命令后会开始在后台保存快照（即RDB特久化，主从复制时会触发RDB),同时收集所有接收到的用于修改数据集命令缓存起来，master节点执行RDB持久化完后，master将rdb快照文件和所有缓存的命令发送到所有slave,以完成一次完全同步</p>
<p>3、心跳持续，保持通信</p>
<p>可在配置文件修改ping包的周期，<code>repl-ping-replica-period &lt;second&gt;</code></p>
<p>master发出PING包的周期，默认是10秒</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/15/66e684f47ec72.png" alt="image-20240915145550079"></p>
<p>4、进入平稳，增量复制</p>
<p>Master继续将新的所有收集到的修改命令自动依次传给slave,完成同步</p>
<p>5、从机下线，重连续传</p>
<p>master会检查backlog里面的offset,master和slave都会保存一个复制的offseti还有一个masterId,offset是保存在backlog中的。<font color="red">Master只会把已经复制的offset后面的数据复制给Slave</font>,类似断点续传</p>
<h2 id="复制缺点"><a href="#复制缺点" class="headerlink" title="复制缺点"></a>复制缺点</h2><p>1、复制延时，信号衰减</p>
<p>由于所有的写操作都是先在Master上操作，然后同步更新到Slave上，所以从Master同步到Slave机器有一定的延迟，当系统很繁忙的时候，延迟问题会更加严重，Slave机器数量的增加也会使这个问题更加严重。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/15/66e68726d6440.png" alt="image-20240915150512401"></p>
<p>2、Masetr宕机后从机不能上位为新的Master</p>
<p>默认情况下，不会在slave节点中自动重选一个master，需要进行人工干预。</p>
<h1 id="Redis哨兵（Sentinel）"><a href="#Redis哨兵（Sentinel）" class="headerlink" title="Redis哨兵（Sentinel）"></a>Redis哨兵（Sentinel）</h1><h2 id="介绍-4"><a href="#介绍-4" class="headerlink" title="介绍"></a>介绍</h2><p>吹哨人巡查监控后台master主机是否故障，如果故障了根据<font color="red">投票数</font>自动将某一个从库转换为新主库，继续对外服务</p>
<h2 id="作用-4"><a href="#作用-4" class="headerlink" title="作用"></a>作用</h2><blockquote>
<p>俗称: 无人值守运维</p>
</blockquote>
<p>1、监控Redis运行状态，包括master和slave</p>
<p>2、当master down机，能自动将slave切换成新master</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/15/66e689d6eee7f.png" alt="image-20240915151640433"></p>
<h2 id="主要功能"><a href="#主要功能" class="headerlink" title="主要功能"></a>主要功能</h2><p>1、主从监控</p>
<p>监控主从Redis库运行是否正常</p>
<p>2、故障转移<br>如果Master异常，则会进行主从切换，将其中一个Slave作为新Master</p>
<p>3、消息通知<br>哨兵可以将故障转移的结果发送给客户端</p>
<p>4、配置中心</p>
<p>客户端通过连接哨兵来获得当前Redis服务的主节点地址</p>
<h2 id="实战演练"><a href="#实战演练" class="headerlink" title="实战演练"></a>实战演练</h2><h3 id="架构说明-1"><a href="#架构说明-1" class="headerlink" title="架构说明"></a>架构说明</h3><p>3个哨兵 + 一主二从</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/15/66e68c3dcb967.png" alt="image-20240915152655402"></p>
<p>哨兵负责监控和维护集群，不存放数据，只是吹哨人</p>
<p>一主二从用于数据读取和存放</p>
<h3 id="案例步骤"><a href="#案例步骤" class="headerlink" title="案例步骤"></a>案例步骤</h3><p>1、/my-redis7 目录下新建或拷贝<code>sentinel.conf</code>文件，文件名称不可改</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/15/66e68cf4646d5.png" alt="image-20240915152957908"></p>
<p>2、修改哨兵配置文件</p>
<blockquote>
<p>可将哨兵配置到不同机器，此处全配置到192.168.10.66</p>
</blockquote>
<p>配置文件如下</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sentinel26379.conf</span></span><br><span class="line"><span class="built_in">bind</span> 0.0.0.0</span><br><span class="line">daemonize <span class="built_in">yes</span></span><br><span class="line">protected-mode no</span><br><span class="line">port 26379</span><br><span class="line">logfile <span class="string">"/my-redis7/sentinel26379.log"</span></span><br><span class="line">pidfile /var/run/redis-sentinel26379.pid</span><br><span class="line"><span class="built_in">dir</span> /my-redis7</span><br><span class="line">sentinel monitor mymaster 192.168.10.66 6379 2</span><br><span class="line">sentinel auth-pass mymaster shiguang</span><br><span class="line"></span><br><span class="line"><span class="comment"># sentinel26380.conf</span></span><br><span class="line"><span class="built_in">bind</span> 0.0.0.0</span><br><span class="line">daemonize <span class="built_in">yes</span></span><br><span class="line">protected-mode no</span><br><span class="line">port 26380</span><br><span class="line">logfile <span class="string">"/my-redis7/sentinel26380.log"</span></span><br><span class="line">pidfile /var/run/redis-sentinel26380.pid</span><br><span class="line"><span class="built_in">dir</span> /my-redis7</span><br><span class="line">sentinel monitor mymaster 192.168.10.66 6379 2</span><br><span class="line">sentinel auth-pass mymaster shiguang</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># sentinel26381.conf</span></span><br><span class="line"><span class="built_in">bind</span> 0.0.0.0</span><br><span class="line">daemonize <span class="built_in">yes</span></span><br><span class="line">protected-mode no</span><br><span class="line">port 26381</span><br><span class="line">logfile <span class="string">"/my-redis7/sentinel26381.log"</span></span><br><span class="line">pidfile /var/run/redis-sentinel26381.pid</span><br><span class="line"><span class="built_in">dir</span> /my-redis7</span><br><span class="line">sentinel monitor mymaster 192.168.10.66 6379 2</span><br><span class="line">sentinel auth-pass mymaster shiguang</span><br></pre></td></tr></tbody></table></figure>

<p>3、配置一主二从关系</p>
<p>66机器上新建<code>redis6379.conf</code>配置文件并设置<code>masterauth</code>项访问密码为<code>shiguang</code>，不然后续可能报错<code>master_link_status:down</code>，因为Master下线变为从机后需要访问新的Master</p>
<p>88机器上新建<code>redis_6378.conf</code>配置文件，设置好<code>replicaof &lt;masterip&gt; &lt;masterport&gt;</code></p>
<p>99机器上新建<code>redis_6380.conf</code>配置文件，设置好<code>replicaof &lt;masterip&gt; &lt;masterport&gt;</code></p>
<p>4、分别启动三台服务并测试主从复制是否正常</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/15/66e69563723f9.png" alt="image-20240915160557045"></p>
<p>5、分别启动三个哨兵</p>
<p><code>redis-sentinel /path/to/sentinel.conf</code></p>
<p> 或者 </p>
<p><code>redis-server /path/to/sentinel.conf --sentinel</code></p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">redis-sentinel /my-redis7/sentinel26379.conf </span><br><span class="line">redis-sentinel /my-redis7/sentinel26380.conf </span><br><span class="line">redis-sentinel /my-redis7/sentinel26381.conf</span><br></pre></td></tr></tbody></table></figure>
<p>Master 主机服务如下，一台Redis服务，三个哨兵服务<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/15/66e697b03e4f2.png" alt="image-20240915161545829"></p>
<p>查看其中一个哨兵日志</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/15/66e6995e07c22.png" alt="image-20240915162255497"></p>
<p>6、手动shutdown将6379下线，模拟master宕机</p>
<p>思考几个问题</p>
<p><strong>1、两台从机数据是否正常?</strong></p>
<p><strong>2、是否会从剩下两台机器中选出新的master?</strong></p>
<p><strong>3、之前的master重新恢复后，谁是老大，会不会master冲突？</strong></p>
<p>答案揭晓</p>
<p><strong>1、两台从机数据正常，但是可能会出现下面两个问题</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/15/66e69cd10e5bd.png" alt="image-20240915163738652"></p>
<p><strong>认识broken pipe</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/15/66e69f61e6610.png" alt="image-20240915164835457"></p>
<p>pipe是管道的意思，管道里面是数据流，通常是从文件或网络套接字读取的数据。当该管道从另一端突然关闭时，会发生数据突然中断，即是broken，对于socket来说，可能是网络被拔出或另一端的进程崩溃</p>
<p><strong>解决问题</strong></p>
<p>当该异常产生的时候，对于服务端来说，并没有多少影响。因为可能是某个客户端突然中止了进程导致了该错误</p>
<p><strong>Broken Pipe总结</strong></p>
<p>这个异常是客户端读取超时关闭了连接,这时候服务器端再向客户端已经断开的连接写数据时就发生了broken pipe异常！</p>
<p><strong>2、会重新投票选出新的Master</strong><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/15/66e6a071a9405.png" alt="image-20240915165307143"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/15/66e6a0b8f0667.png" alt="image-20240915165418550"></p>
<p><strong>3、之前的Master恢复后继续延用新选出的Master</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/15/66e6a16b6784a.png" alt="image-20240915165717056"></p>
<h3 id="sentinel-conf参数说明"><a href="#sentinel-conf参数说明" class="headerlink" title="sentinel.conf参数说明"></a><code>sentinel.conf</code>参数说明</h3><p>1、<code>bind</code><br>服务监听地址，用于客户端连接，默认本机地址<br>2、<code>daemonize</code><br>是否以后台daemon方式运行<br>3、<code>protected-mode</code><br>安全保护模式<br>4、<code>port</code><br>端口<br>5、<code>logfile</code><br>日志文件路径<br>6、<code>pidfile</code><br>pid文件路径<br>7、<code>dir</code><br>工作目录</p>
<p>8、<code>sentinel monitor &lt;master-name&gt; &lt;ip&gt; &lt;redis-port&gt; &lt;quorum&gt;</code></p>
<p>设置要监控的master服务器</p>
<p><code>quorum</code>表示最少有几个哨兵认可客观下线，同意故障迁移的法定票数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/15/66e68de076031.png" alt="image-20240915153353886"></p>
<p>9、<code>sentinel auth-pass &lt;master-name&gt; &lt;password&gt;</code></p>
<p>master设置了密码，连接master服务的密码 </p>
<p>10、其他</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 指定多少毫秒之后，主节点没有应答哨兵，此时哨兵主观上认为主节点下线</span></span><br><span class="line"></span><br><span class="line">sentinel down-after-milliseconds &lt;master-name&gt; &lt;milliseconds&gt;：</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 表示允许并行同步的slave个数，当Master挂了后，哨兵会选出新的Master，此时，剩余的slave会向新的master发起同步数据</span></span><br><span class="line">sentinel parallel-syncs &lt;master-name&gt; &lt;nums&gt;：</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 故障转移的超时时间，进行故障转移时，如果超过设置的毫秒，表示故障转移失败</span></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">sentinel failover-timeout &lt;master-name&gt; &lt;milliseconds&gt;：</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置当某一事件发生时所需要执行的脚本</span></span><br><span class="line">sentinel notification-script &lt;master-name&gt; &lt;script-path&gt; ：</span><br><span class="line"></span><br><span class="line"> <span class="comment"># 客户端重新配置主节点参数脚本</span></span><br><span class="line"></span><br><span class="line">sentinel client-reconfig-script &lt;master-name&gt; &lt;script-path&gt;：</span><br></pre></td></tr></tbody></table></figure>



<h3 id="配置文件变化-1"><a href="#配置文件变化-1" class="headerlink" title="配置文件变化"></a>配置文件变化</h3><p><font color="red ">配置文件的内容，在运行期间会被sentinel动态进行更改</font></p>
<p><font color="red ">Master、Slave切换后，Master、Slave的<code>redis.conf</code>、和<code>sentinel.conf</code>的内容都会发生改变<br></font></p>
<p>Master <code>redis.conf</code>中会多一行<code>replicaof</code>的配置</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/15/66e6a1d91985f.png" alt="image-20240915165906659"></p>
<p><code>sentinel.conf</code>的监控目标会随之调换</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/15/66e6a28c9bf7b.png" alt="image-20240915170206207"></p>
<h3 id="其他说明"><a href="#其他说明" class="headerlink" title="其他说明"></a>其他说明</h3><p>1、生产都是不同机房不同服务器，很少出现3个哨兵全挂掉的情况</p>
<p>2、可以同时监控多个master,一行一个</p>
<h2 id="哨兵运行流程和选举原理"><a href="#哨兵运行流程和选举原理" class="headerlink" title="哨兵运行流程和选举原理"></a>哨兵运行流程和选举原理</h2><blockquote>
<p>一般建议sentinel采取奇数台，Sentinel 在选举新的主节点时需要达到法定人数。奇数台 Sentinel 可以更容易地达成多数派，避免出现平局的情况。</p>
</blockquote>
<h3 id="1、SDown主观下线（Subjectively-Down）"><a href="#1、SDown主观下线（Subjectively-Down）" class="headerlink" title="1、SDown主观下线（Subjectively Down）"></a>1、SDown主观下线（Subjectively Down）</h3><p>SDOWN(主观不可用)是<font color="red">单个sentinel自己主观上</font>检测到的关于master的状态，从sentinel的角度来看，如果发送了PING心跳后，在一定时间内没有收到合法的回复，就达到了SDOWN的条件。</p>
<p>Sentineli配置文件中的<code>down-after-millisecondsi</code>设置了判断主观下线的时间长度</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/15/66e6c5d35e56e.png" alt="image-20240915193236838"></p>
<h3 id="2、ODown客观下线-Objectively-Down"><a href="#2、ODown客观下线-Objectively-Down" class="headerlink" title="2、ODown客观下线(Objectively Down)"></a>2、ODown客观下线(Objectively Down)</h3><p>ODOWN需要一定数量的Sentinel,<font color="red">多个哨兵达成一致意见</font>才能认为一个master客观上已经宕掉</p>
<p>四个参数含义：</p>
<p>masterName是对某个master+slave组合的一个区分标识(一套sentinel可以监听多组master+slave这样的组合)</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/15/66e6c68c2210d.png" alt="image-20240915193541825"></p>
<p>**<font color="red">quorum这个参数是进行客观下线的一个依据</font>**，法定人数/法定票数</p>
<p>意思是至少有quorum个sentinel认为这个master有故障才会对这个master进行下线以及故障转移。因为有的时候，某个sentinel节点可能因为自身网络原因导致无法连接master，而此时master并没有出现故障，所以这就需要多个sentinel都一致认为该master有问题，才可以进行下一步操作，这就保证了公平性和高可用。</p>
<h3 id="3、选举出领导者哨兵（哨兵中选出兵王）"><a href="#3、选举出领导者哨兵（哨兵中选出兵王）" class="headerlink" title="3、选举出领导者哨兵（哨兵中选出兵王）"></a>3、选举出领导者哨兵（哨兵中选出兵王）</h3><p>当主节点被判断客观下线以后，各个哨兵节点会进行协商，先选举出一个领导者哨兵节点（兵王）并由该领导者节点，也即被选举出的兵王进行<code>failover</code>(故障迁移)</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/15/66e6c76b385da.png" alt="image-20240915193924865"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/15/66e6c77eeb7b6.png" alt="image-20240915193944530"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/15/66e6c791ea816.png" alt="image-20240915194003610"></p>
<p><strong>哨兵领导者，兵王如何洗出来的？</strong></p>
<p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/15/66e6c919e8707.png" alt="image-20240915194635656"></p>
<p>监视该主节点的所有哨兵都有可能被选为领导者，选举使用的算法是Raft算法；Raft算法的基本思路<strong>是先到先得</strong>：</p>
<p>即在一轮选举中，哨兵A向B发送成为领导者的申请，如果B没有同意过其他哨兵，则会同意A成为领导者</p>
<h3 id="4、由兵王开始推动故障切换流程并选出一个新master"><a href="#4、由兵王开始推动故障切换流程并选出一个新master" class="headerlink" title="4、由兵王开始推动故障切换流程并选出一个新master"></a>4、由兵王开始推动故障切换流程并选出一个新master</h3><h4 id="第一步：新主登基"><a href="#第一步：新主登基" class="headerlink" title="第一步：新主登基"></a>第一步：新主登基</h4><blockquote>
<p>某个Slave被选中成为新Master</p>
</blockquote>
<p><strong>选出新master的规则</strong>:</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/15/66e6ca617f13b.png" alt="image-20240915195203216"></p>
<p>1、剩余slave节点健康前提下，<code>redis.conf</code>文件中，优先级<code>slave-priority</code>或者<code>replica-priority</code>最高的从节点（数字越小优先级越高）</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/15/66e6c9b8791d8.png" alt="image-20240915194914157"></p>
<p>2、复制偏移位置offset最大的从节点</p>
<p>3、最小Run Id的从节点（字典顺序，ASCII码）</p>
<h4 id="第二步：群臣俯首"><a href="#第二步：群臣俯首" class="headerlink" title="第二步：群臣俯首"></a>第二步：群臣俯首</h4><blockquote>
<p>朝天子一朝臣，换个码头重新拜</p>
</blockquote>
<p>执行<code>slaveof no one</code>命令让选出来的从节点成为新的主节点，并通过<code>replicaof</code>命令让其他节点成为其从节点</p>
<h4 id="第三步：旧主拜服"><a href="#第三步：旧主拜服" class="headerlink" title="第三步：旧主拜服"></a>第三步：旧主拜服</h4><blockquote>
<p>老masterl回来也认怂</p>
</blockquote>
<p>将之前已下线的老masteri设置为新选出的新master的从节点，当老master重新上线后，它会成为新master的从节点</p>
<p>Sentinel leader会让原来的master降级为slave并恢复正常工作。</p>
<h4 id="小总结-5"><a href="#小总结-5" class="headerlink" title="小总结"></a>小总结</h4><p>上述的<code>failover</code>操作均由sentinel自己独自完成，完全无需人工干预，</p>
<h3 id="哨兵使用建议"><a href="#哨兵使用建议" class="headerlink" title="哨兵使用建议"></a>哨兵使用建议</h3><p>1、哨兵节点的数量应为多个，哨兵本身应该集群，保证高可用</p>
<p>2、哨兵节点的数量应该是奇数</p>
<p>3、个哨兵节点的配置应一致</p>
<p>4、如果哨兵节点部署在Docker等容器里面，尤其要注意端口的正确映射</p>
<p>5、<font color="red">哨兵集群+主从复制，并不保证数据零丢失</font></p>
<h1 id="Redis集群（Cluster）"><a href="#Redis集群（Cluster）" class="headerlink" title="Redis集群（Cluster）"></a>Redis集群（Cluster）</h1><h2 id="介绍-5"><a href="#介绍-5" class="headerlink" title="介绍"></a>介绍</h2><blockquote>
<p>官网介绍：<a target="_blank" rel="noopener" href="https://redis.io/docs/latest/operate/oss_and_stack/reference/cluster-spec/">https://redis.io/docs/latest/operate/oss_and_stack/reference/cluster-spec/</a></p>
</blockquote>
<p>**<font color="red">由于数据量过大</font>**，单个Master复制集难以承担，因此需要对多个复制集进行集群，形成水平扩展每个复制集只负责存储整个数据集的一部分，这就是Redis的集群，其作用是提供在多个Redis节点间共享数据的程序集。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/13/66e43bdd01010.png" alt="image-20240913211925153"></p>
<p>Redis集群是一个提供在多个Redis节点间共享数据的程序集，<font color="red">Redis集群可以支持多个Master</font></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/13/66e43c3d931a1.png" alt="image-20240913212102045"></p>
<h2 id="作用-5"><a href="#作用-5" class="headerlink" title="作用"></a>作用</h2><p>1、Redis集群支持多个Master,每个Master又可以挂载多个Slave</p>
<ul>
<li>读写分离</li>
<li>支持数据的高可用</li>
<li>支持海量数据的读写存储操作</li>
</ul>
<p>2、由于Cluster自带Sentinel的故障转移机制，内置了高可用的支持，<font color="red">无需再去使用哨兵功能</font></p>
<p>3、客户端与Rdis的节点连接，不再需要连接集群中所有的节点，只需要任意连接集群中的一个可用节点即可</p>
<p>4、<font color="red">槽位slot</font>负责分配到各个物理服务节点，由对应的集群来负责维护节点、插槽和数据之间的关系</p>
<h2 id="集群算法：分片-槽位（slot）"><a href="#集群算法：分片-槽位（slot）" class="headerlink" title="集群算法：分片-槽位（slot）"></a>集群算法：分片-槽位（slot）</h2><h3 id="官网介绍-2"><a href="#官网介绍-2" class="headerlink" title="官网介绍"></a>官网介绍</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/13/66e43ee8058d7.png" alt="image-20240913213224468"></p>
<h3 id="Slot介绍"><a href="#Slot介绍" class="headerlink" title="Slot介绍"></a>Slot介绍</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/13/66e43f0168350.png" alt="image-20240913213249967"></p>
<h3 id="分片介绍"><a href="#分片介绍" class="headerlink" title="分片介绍"></a>分片介绍</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/13/66e43f39294ab.png" alt="image-20240913213345658"></p>
<h3 id="插槽和分片的优势"><a href="#插槽和分片的优势" class="headerlink" title="插槽和分片的优势"></a>插槽和分片的优势</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/13/66e4401d9b682.png" alt="image-20240913213734120"></p>
<h3 id="Slot槽位映射方案"><a href="#Slot槽位映射方案" class="headerlink" title="Slot槽位映射方案"></a>Slot槽位映射方案</h3><h4 id="方案一：哈希取余分区"><a href="#方案一：哈希取余分区" class="headerlink" title="方案一：哈希取余分区"></a>方案一：哈希取余分区</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/13/66e4414598fda.png" alt="image-20240913214229846"></p>
<h4 id="方案二：一致性哈希算法分区"><a href="#方案二：一致性哈希算法分区" class="headerlink" title="方案二：一致性哈希算法分区"></a>方案二：一致性哈希算法分区</h4><h5 id="一致性Hash算法背景"><a href="#一致性Hash算法背景" class="headerlink" title="一致性Hash算法背景"></a><strong>一致性Hash算法背景</strong></h5><p>一致性哈希算法在1997年由麻省理工学院中提出的，设计目标是为了解决分布式缓存数据变动和映射问题，某个机器宕机了，分母数量改变了，自然取余数不OK了。</p>
<h5 id="作用-6"><a href="#作用-6" class="headerlink" title="作用"></a><strong>作用</strong></h5><p>提出一致性Hash解决方案。目的是当服务器个数发生变动时，尽量减少影响客户端到服务器的映射关系</p>
<h5 id="实现步骤"><a href="#实现步骤" class="headerlink" title="实现步骤"></a><strong>实现步骤</strong></h5><p>1、算法构建一致性哈希环</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/13/66e44357be879.png" alt="image-20240913215120251"></p>
<p>2、Redis服务器IP节点映射</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/13/66e444627ab0c.png" alt="image-20240913215546991"></p>
<p>3、Key落到Redis服务器的落键规则</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/13/66e444a4f2440.png" alt="image-20240913215653498"></p>
<h5 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h5><p>1、容错性方面</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/13/66e44605db722.png" alt="image-20240913220246324"></p>
<p>2、拓展性方面</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/13/66e44632b12ef.png" alt="image-20240913220331045"></p>
<h5 id="缺点-1"><a href="#缺点-1" class="headerlink" title="缺点"></a>缺点</h5><p>节点太少时，会产生数据倾斜问题</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/13/66e44656cc6bc.png" alt="image-20240913220407413"></p>
<h5 id="小总结-6"><a href="#小总结-6" class="headerlink" title="小总结"></a>小总结</h5><p>为了在节点数目发生改变时尽可能少的迁移数据，将所有的存储节点排列在收尾相接的Hash环上，每个key在计算Hash后会<font color="red">顺时针</font>找到临近的存储节点存放。而当有节点加入或退出时仅影响该节点在Hash环上<font color="red">顺时针相邻的后续节点</font>。</p>
<p><strong>优点</strong>：</p>
<p>加入和删除节点只影响哈希环中顺时针方向的相邻的节点，对其他节点无影响</p>
<p><strong>缺点 ：</strong></p>
<p>数据的分布和节点的位置有关，因为这些节点不是均匀的分布在哈希环上的，所以数据在进行存储时达不到均匀分布的效果。</p>
<h4 id="方案三：哈希槽分区"><a href="#方案三：哈希槽分区" class="headerlink" title="方案三：哈希槽分区"></a>方案三：哈希槽分区</h4><h5 id="产生背景"><a href="#产生背景" class="headerlink" title="产生背景"></a><strong>产生背景</strong></h5><p>一致性哈希算法的<font color="red">数据倾斜</font>问题</p>
<p>哈希槽实质就是一个数组，数组[0,2^14 -1]形成hash slot空间。</p>
<h5 id="作用-7"><a href="#作用-7" class="headerlink" title="作用"></a>作用</h5><p>解决均匀分配的问题，<font color="red">在数据和节点之间又加入了一层，把这层称为哈希槽（slot），用于管理数据和节点之间的关系</font>，现在就相当于节点上放的是槽，槽里放的是数据。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/13/66e44971d540a.png" alt="image-20240913221722519"></p>
<p>槽解决的是粒度问题，相当于把粒度变大了，这样便于数据移动。哈希解决的是映射问题，使用key的哈希值来计算所在的槽，便于数据分配</p>
<h5 id="多少个hash-槽？"><a href="#多少个hash-槽？" class="headerlink" title="多少个hash 槽？"></a>多少个hash 槽？</h5><p>一个集群只能有<code>16384</code>个槽，编号0-16383（0-2^14-1）。这些槽会分配给集群中的所有主节点，分配策略没有要求。</p>
<p>集群会记录节点和槽的对应关系，解决了节点和槽的关系后，接下来就需要对key求哈希值，然后对16384取模，余数是几key就落入对应的槽里。<code>HASH_SLOT = CRC16(key) mod 16384</code>。以槽为单位移动数据，因为槽的数目是固定的，处理起来比较容易，这样数据移动问题就解决了。</p>
<h5 id="为什么Redis集群的最大槽数是16384个？"><a href="#为什么Redis集群的最大槽数是16384个？" class="headerlink" title="为什么Redis集群的最大槽数是16384个？"></a><strong><font color="red">为什么Redis集群的最大槽数是16384个？</font></strong></h5><blockquote>
<p>高频面试题</p>
</blockquote>
<p>Redis集群并没有使用一致性hash而是引入了哈希槽的概念。<font color="red">Redis 集群有16384个哈希槽</font>，每个key通过<code>CRC16</code>校验后对16384取模来决定放置哪个槽，集群的每个节点负责一部分hash槽。但为什么哈希槽的数量是16384（2^14）个呢？</p>
<p>CRC16算法产生的hash值有16bit，该算法可以产生2^16=65536个值。换句话说值是分布在0~65535之间，有更大的65536不用为什么只用16384就够？作者在做mod运算的时候，为什么不mod65536，而选择mod16384？ HASH_SLOT = CRC16(key) mod 65536为什么没启用</p>
<blockquote>
<p>作者在GitHub对于该问题的解答：<a target="_blank" rel="noopener" href="https://github.com/redis/redis/issues/2576">https://github.com/redis/redis/issues/2576</a></p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/13/66e44bc537a5d.png" alt="image-20240913222717766"></p>
<p>1、<strong>说明1</strong></p>
<p><font color="red">正常的心跳数据包</font>带有节点的完整配置，可以用幂等方式用旧的节点替换旧节点，以便更新旧的配置。</p>
<p>这意味着它们包含原始节点的插槽配置，该节点使用2k的空间和16k的插槽，但是会使用8k的空间（使用65k的插槽）。</p>
<p>同时，由于其他设计折衷，Redis集群不太可能扩展到1000个以上的主节点。</p>
<p>因此16k处于正确的范围内，以确保每个主机具有足够的插槽，最多可容纳1000个矩阵，但数量足够少，可以轻松地将插槽配置作为原始位图传播。请注意，在小型群集中，位图将难以压缩，因为当N较小时，位图将设置的slot / N位占设置位的很大百分比。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/13/66e44c8d8083d.png" alt="image-20240913223038016"></p>
<p>2、<strong>说明2</strong></p>
<p>(1)<strong>如果槽位为65536，发送心跳信息的消息头达8k，发送的心跳包过于庞大</strong>。</p>
<p>在消息头中最占空间的是myslots[CLUSTER_SLOTS/8]。 当槽位为65536时，这块的大小是: 65536÷8÷1024=8kb </p>
<p>在消息头中最占空间的是myslots[CLUSTER_SLOTS/8]。 当槽位为16384时，这块的大小是: 16384÷8÷1024=2kb </p>
<p>因为每秒钟，redis节点需要发送一定数量的ping消息作为心跳包，如果槽位为65536，这个ping消息的消息头太大了，浪费带宽。</p>
<p>(2)<strong>redis的集群主节点数量基本不可能超过1000个</strong>。</p>
<p>集群节点越多，心跳包的消息体内携带的数据越多。如果节点过1000个，也会导致网络拥堵。因此redis作者不建议redis cluster节点数量超过1000个。 那么，对于节点数在1000以内的redis cluster集群，16384个槽位够用了。没有必要拓展到65536个。</p>
<p>(3)<strong>槽位越小，节点少的情况下，压缩比高，容易传输</strong></p>
<p>Redis主节点的配置信息中它所负责的哈希槽是通过一张bitmap的形式来保存的，在传输过程中会对bitmap进行压缩，但是如果bitmap的填充率slots / N很高的话(N表示节点数)，bitmap的压缩率就很低。 如果节点数很少，而哈希槽数量很多的话，bitmap的压缩率就很低。 </p>
<p>3、<strong>计算结论</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/13/66e44d78ed4be.png" alt="image-20240913223433457"></p>
<h3 id="一个注意点"><a href="#一个注意点" class="headerlink" title="一个注意点"></a>一个注意点</h3><p>Redis集群<font color="red">不保证强一致性</font>，这意味着在特定的条件下，Redis集群可能会丢掉一些被系统收到的写入请求命令</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/13/66e44e7e73bc9.png" alt="image-20240913223855083"></p>
<h2 id="集群环境案例步骤"><a href="#集群环境案例步骤" class="headerlink" title="集群环境案例步骤"></a>集群环境案例步骤</h2><h3 id="三主三从Redis集群配置"><a href="#三主三从Redis集群配置" class="headerlink" title="三主三从Redis集群配置"></a>三主三从Redis集群配置</h3><p>1、需要三台虚拟机，分别创建用于存放Redis集群配置文件的目录</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /my-redis7/cluster</span><br></pre></td></tr></tbody></table></figure>

<p>2、新建六个独立的Redis实例服务，我已为三台虚拟机分别配置固定的静态ip，分别是 66，88，99</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 192.168.10.66:6381  redis_cluster_6381.conf</span></span><br><span class="line"><span class="built_in">bind</span> 0.0.0.0</span><br><span class="line">daemonize <span class="built_in">yes</span></span><br><span class="line">protected-mode no</span><br><span class="line">port 6381</span><br><span class="line">logfile <span class="string">"/my-redis7/cluster/cluster6381.log"</span></span><br><span class="line">pidfile /my-redis7/cluster/cluster6381.pid</span><br><span class="line"><span class="built_in">dir</span> /my-redis7/cluster</span><br><span class="line">dbfilename dump6381.rdb</span><br><span class="line">appendonly <span class="built_in">yes</span></span><br><span class="line">appendfilename <span class="string">"appendonly6381.aof"</span></span><br><span class="line">requirepass shiguang</span><br><span class="line">masterauth shiguang</span><br><span class="line"> </span><br><span class="line">cluster-enabled <span class="built_in">yes</span></span><br><span class="line">cluster-config-file nodes-6381.conf</span><br><span class="line">cluster-node-timeout 5000</span><br><span class="line"></span><br><span class="line"><span class="comment"># 192.168.10.66:6382 redis_cluster_6382.conf</span></span><br><span class="line"><span class="built_in">bind</span> 0.0.0.0</span><br><span class="line">daemonize <span class="built_in">yes</span></span><br><span class="line">protected-mode no</span><br><span class="line">port 6382</span><br><span class="line">logfile <span class="string">"/my-redis7/cluster/cluster6382.log"</span></span><br><span class="line">pidfile /my-redis7/cluster/cluster6382.pid</span><br><span class="line"><span class="built_in">dir</span> /my-redis7/cluster</span><br><span class="line">dbfilename dump6382.rdb</span><br><span class="line">appendonly <span class="built_in">yes</span></span><br><span class="line">appendfilename <span class="string">"appendonly6382.aof"</span></span><br><span class="line">requirepass shiguang</span><br><span class="line">masterauth shiguang</span><br><span class="line"> </span><br><span class="line">cluster-enabled <span class="built_in">yes</span></span><br><span class="line">cluster-config-file nodes-6382.conf</span><br><span class="line">cluster-node-timeout 5000</span><br><span class="line"></span><br><span class="line"><span class="comment"># 192.168.10.88:6383 redis_cluster_6383.conf</span></span><br><span class="line"><span class="built_in">bind</span> 0.0.0.0</span><br><span class="line">daemonize <span class="built_in">yes</span></span><br><span class="line">protected-mode no</span><br><span class="line">port 6383</span><br><span class="line">logfile <span class="string">"/my-redis7/cluster/cluster6383.log"</span></span><br><span class="line">pidfile /my-redis7/cluster/cluster6383.pid</span><br><span class="line"><span class="built_in">dir</span> /my-redis7/cluster</span><br><span class="line">dbfilename dump6383.rdb</span><br><span class="line">appendonly <span class="built_in">yes</span></span><br><span class="line">appendfilename <span class="string">"appendonly6383.aof"</span></span><br><span class="line">requirepass shiguang</span><br><span class="line">masterauth shiguang</span><br><span class="line"> </span><br><span class="line">cluster-enabled <span class="built_in">yes</span></span><br><span class="line">cluster-config-file nodes-6383.conf</span><br><span class="line">cluster-node-timeout 5000</span><br><span class="line"></span><br><span class="line"><span class="comment"># 192.168.10.88:6384 redis_cluster_6384.conf</span></span><br><span class="line"><span class="built_in">bind</span> 0.0.0.0</span><br><span class="line">daemonize <span class="built_in">yes</span></span><br><span class="line">protected-mode no</span><br><span class="line">port 6384</span><br><span class="line">logfile <span class="string">"/my-redis7/cluster/cluster6384.log"</span></span><br><span class="line">pidfile /my-redis7/cluster/cluster6384.pid</span><br><span class="line"><span class="built_in">dir</span> /my-redis7/cluster</span><br><span class="line">dbfilename dump6384.rdb</span><br><span class="line">appendonly <span class="built_in">yes</span></span><br><span class="line">appendfilename <span class="string">"appendonly6384.aof"</span></span><br><span class="line">requirepass shiguang</span><br><span class="line">masterauth shiguang</span><br><span class="line"> </span><br><span class="line">cluster-enabled <span class="built_in">yes</span></span><br><span class="line">cluster-config-file nodes-6384.conf</span><br><span class="line">cluster-node-timeout 5000</span><br><span class="line"></span><br><span class="line"><span class="comment"># 192.168.10.99:6385 redis_cluster_6385.conf</span></span><br><span class="line"><span class="built_in">bind</span> 0.0.0.0</span><br><span class="line">daemonize <span class="built_in">yes</span></span><br><span class="line">protected-mode no</span><br><span class="line">port 6385</span><br><span class="line">logfile <span class="string">"/my-redis7/cluster/cluster6385.log"</span></span><br><span class="line">pidfile /my-redis7/cluster/cluster6385.pid</span><br><span class="line"><span class="built_in">dir</span> /my-redis7/cluster</span><br><span class="line">dbfilename dump6385.rdb</span><br><span class="line">appendonly <span class="built_in">yes</span></span><br><span class="line">appendfilename <span class="string">"appendonly6385.aof"</span></span><br><span class="line">requirepass shiguang</span><br><span class="line">masterauth shiguang</span><br><span class="line"> </span><br><span class="line">cluster-enabled <span class="built_in">yes</span></span><br><span class="line">cluster-config-file nodes-6385.conf</span><br><span class="line">cluster-node-timeout 5000</span><br><span class="line"></span><br><span class="line"><span class="comment"># 192.168.10.99:6386 redis_cluster_6386.conf</span></span><br><span class="line"><span class="built_in">bind</span> 0.0.0.0</span><br><span class="line">daemonize <span class="built_in">yes</span></span><br><span class="line">protected-mode no</span><br><span class="line">port 6386</span><br><span class="line">logfile <span class="string">"/my-redis7/cluster/cluster6386.log"</span></span><br><span class="line">pidfile /my-redis7/cluster/cluster6386.pid</span><br><span class="line"><span class="built_in">dir</span> /my-redis7/cluster</span><br><span class="line">dbfilename dump6386.rdb</span><br><span class="line">appendonly <span class="built_in">yes</span></span><br><span class="line">appendfilename <span class="string">"appendonly6386.aof"</span></span><br><span class="line">requirepass shiguang</span><br><span class="line">masterauth shiguang</span><br><span class="line"> </span><br><span class="line">cluster-enabled <span class="built_in">yes</span></span><br><span class="line">cluster-config-file nodes-6386.conf</span><br><span class="line">cluster-node-timeout 5000</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>其中，<code>requirepass</code> 和 <code>masterauth</code>后面跟的是密码</p>
<p>3、分别启动六台Redis实例，以 192.18.10.66 这台虚拟机为例</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/local/bin</span><br><span class="line">redis-server /my-redis7/cluster/redis_cluster_6381.conf</span><br><span class="line">redis-server /my-redis7/cluster/redis_cluster_6382.conf</span><br></pre></td></tr></tbody></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/13/66e45bf77bb68.png" alt="image-20240913233624151"></p>
<p>4、通过<code>redis-cli</code>命令为六台机器构建集群关系</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -a shiguang --cluster create --cluster-replicas 1 192.168.10.66:6381 192.168.10.66:6382 192.168.10.88:6383 192.168.10.88:6384 192.168.10.99:6385 192.168.10.99:6386</span><br></pre></td></tr></tbody></table></figure>

<p>通过 <code>--cluster-replicas 1</code> 选项，Redis 集群会自动为每个主节点分配一个从节点，以实现高可用性和数据冗余。<font color="red">主从节点会尽量分布在不同的物理机器上，以提高容错性</font>。</p>
<p>提示创建三主三从并返回主从关系及主节点槽位信息，询问是否接受，输入<code>yes</code>以继续</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/13/66e45e57c4b6d.png" alt="image-20240913234632394"></p>
<p><code>M</code>代表Master，<code>S</code>代表slave，可以注意到，6381从节点6384，6383从节点6386，6385从节点6382都在不同的虚拟机</p>
<p>提示<code>[OK]</code>状态代表构建成功</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/13/66e45e87bd126.png" alt="image-20240913234720399"></p>
<h3 id="查看并检验集群状态"><a href="#查看并检验集群状态" class="headerlink" title="查看并检验集群状态"></a>查看并检验集群状态</h3><h4 id="info-replication"><a href="#info-replication" class="headerlink" title="info replication"></a><code>info replication</code></h4><p><code>info replication</code> 命令用于获取 Redis 实例的复制（replication）信息。这个命令主要用于查看主从复制的状态和配置。</p>
<p>输出内容：</p>
<ul>
<li><strong>role</strong>: 当前实例的角色，可以是 <code>master</code> 或 <code>slave</code>。</li>
<li><strong>connected_slaves</strong>: 连接的从节点数量。</li>
<li><strong>master_replid</strong>: 主节点的复制 ID。</li>
<li><strong>master_repl_offset</strong>: 主节点的复制偏移量。</li>
<li><strong>slave_repl_offset</strong>: 从节点的复制偏移量（如果是从节点）。</li>
<li><strong>slave_priority</strong>: 从节点的优先级（用于故障转移）。</li>
<li><strong>slave_read_only</strong>: 从节点是否只读。</li>
<li><strong>master_host</strong>: 主节点的 IP 地址（如果是从节点）。</li>
<li><strong>master_port</strong>: 主节点的端口号（如果是从节点）。</li>
<li><strong>master_link_status</strong>: 主从连接状态，可以是 <code>up</code> 或 <code>down</code>。</li>
<li><strong>master_last_io_seconds_ago</strong>: 最后一次与主节点通信的时间（秒）。</li>
<li><strong>slave_repl_offset</strong>: 从节点的复制偏移量。</li>
<li><strong>slave_priority</strong>: 从节点的优先级。</li>
<li><strong>slave_read_only</strong>: 从节点是否只读。</li>
</ul>
<h4 id="cluster-info"><a href="#cluster-info" class="headerlink" title="cluster info"></a><code>cluster info</code></h4><p><code>cluster info</code> 命令用于获取 Redis 集群的整体状态信息。这个命令主要用于查看集群的健康状况和性能指标。</p>
<h4 id="输出内容："><a href="#输出内容：" class="headerlink" title="输出内容："></a>输出内容：</h4><ul>
<li><strong>cluster_state</strong>: 集群的状态，可以是 <code>ok</code>（正常）或 <code>fail</code>（故障）。</li>
<li><strong>cluster_slots_assigned</strong>: 已分配的槽位数量。</li>
<li><strong>cluster_slots_ok</strong>: 状态正常的槽位数量。</li>
<li><strong>cluster_slots_pfail</strong>: 可能失败的槽位数量。</li>
<li><strong>cluster_slots_fail</strong>: 失败的槽位数量。</li>
<li><strong>cluster_known_nodes</strong>: 集群中已知的节点数量。</li>
<li><strong>cluster_size</strong>: 集群的大小（主节点数量）。</li>
<li><strong>cluster_current_epoch</strong>: 当前的集群纪元。</li>
<li><strong>cluster_my_epoch</strong>: 当前节点的纪元。</li>
<li><strong>cluster_stats_messages_sent</strong>: 发送的消息数量。</li>
<li><strong>cluster_stats_messages_received</strong>: 接收的消息数量。</li>
</ul>
<h4 id="cluster-nodes"><a href="#cluster-nodes" class="headerlink" title="cluster nodes"></a><code>cluster nodes</code></h4><p><code>cluster nodes</code> 命令用于获取 Redis 集群中所有节点的详细信息。这个命令主要用于查看集群的拓扑结构和每个节点的状态。</p>
<h4 id="输出内容：-1"><a href="#输出内容：-1" class="headerlink" title="输出内容："></a>输出内容：</h4><ul>
<li><strong>节点 ID</strong>: 每个节点的唯一标识符。</li>
<li><strong>IP:端口</strong>: 节点的 IP 地址和端口号。</li>
<li><strong>flags</strong>: 节点的状态标志，如 <code>master</code>、<code>slave</code>、<code>myself</code>、<code>fail?</code>、<code>fail</code>、<code>handshake</code> 等。</li>
<li><strong>master ID</strong>: 如果是从节点，显示其主节点的 ID。</li>
<li><strong>ping-sent</strong>: 最后一次发送 ping 的时间戳。</li>
<li><strong>pong-received</strong>: 最后一次接收 pong 的时间戳。</li>
<li><strong>config-epoch</strong>: 节点的配置纪元。</li>
<li><strong>link-state</strong>: 节点的连接状态，如 <code>connected</code> 或 <code>disconnected</code>。</li>
<li><strong>槽位范围</strong>: 如果是主节点，显示其负责的槽位范围。</li>
</ul>
<p>以6381端口的Redis实例为例进行演示</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 指定端口号登录</span></span><br><span class="line"><span class="built_in">cd</span> /usr/local/bin</span><br><span class="line">redis-cli -a shiguang -p 6381</span><br></pre></td></tr></tbody></table></figure>

<p>使用**<code>info replication</code>**查看单个 Redis 实例的复制状态和配置。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/13/66e45f2edf39f.png" alt="image-20240913235007582"></p>
<p>使用**<code>cluster info</code>**查看整个 Redis 集群的状态和性能指标。</p>
<p>仅启用<code>192.168.10.66</code> 这台服务器Redis实例输入的信息如下</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e4e53dc17cf.png" alt="image-20240914092204520"></p>
<p>启动所有虚拟机实例</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e4e66b6c934.png" alt="image-20240914092707149"></p>
<p>使用 <strong><code>cluster nodes</code></strong> 查看集群中所有节点的详细信息和拓扑结构。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e4e6276214f.png" alt="image-20240914092559027"></p>
<h3 id="三主三从集群读写"><a href="#三主三从集群读写" class="headerlink" title="三主三从集群读写"></a>三主三从集群读写</h3><p>对6381新增两个key，查看效果</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e4eb218b5e5.png" alt="image-20240914094713315"></p>
<p>测试效果只能存入key2，查询也只能查到key2，存入key1时提示要到 6383这台机器上操作</p>
<p><strong>原因:</strong></p>
<p><font color="red"><strong>写入时需要注意槽位的范围区间，需要路由到位</strong></font></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e4ec35cb694.png" alt="image-20240914095149459"></p>
<p><strong>解决措施：</strong></p>
<blockquote>
<p><code>redis-cli -c</code> 是 Redis 命令行界面（CLI）的一个选项，它允许你以“集群模式”连接到 Redis 集群。当你使用 <code>-c</code> 参数启动 <code>redis-cli</code> 时，它会尝试与 Redis 集群交互，并且能够智能地将命令路由到正确的集群节点上。</p>
<p>使用方法</p>
<p>基本的用法是这样的：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -c host1 port1 host2 port2 ...</span><br></pre></td></tr></tbody></table></figure>

<p>这里的 <code>host1</code> 和 <code>port1</code> 是集群中第一个节点的地址，<code>host2</code> 和 <code>port2</code> 是第二个节点的地址，以此类推。你需要提供集群中至少一个节点的信息，但是为了更健壮的连接性，通常提供多个节点的地址是更好的选择。</p>
<p><strong>重要注意事项</strong></p>
<ul>
<li><strong>自动重定向</strong>：当在集群模式下运行时，如果命令需要在不同的槽上执行，<code>redis-cli</code> 会自动处理重定向，并将结果合并为单个输出。</li>
<li><strong>集群拓扑发现</strong>：<code>redis-cli</code> 会通过集群的内置机制来发现整个集群的拓扑结构。</li>
<li><strong>数据分布</strong>：Redis 集群通过哈希槽（hash slot）来分配数据，共有 16384 个哈希槽，这些哈希槽分布在集群中的各个节点上。<code>redis-cli -c</code> 会根据这个分布情况来决定哪个命令应该发送到哪个节点。</li>
</ul>
<p>如果你希望连接到一个 Redis 集群，确保你的环境中正确安装了支持集群功能的 <code>redis-cli</code> 版本。此外，如果你的 Redis 集群配置了认证，还需要使用 <code>-a password</code> 参数指定密码。</p>
<p>例如：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -c --cluster nodes 127.0.0.1 6379 --cluster-password your_password</span><br></pre></td></tr></tbody></table></figure>

<p>这里 <code>--cluster nodes</code> 后面跟着的是集群节点的地址列表，而 <code>--cluster-password</code> 则指定了访问集群所需的密码。请注意，实际的命令可能会有所不同，具体取决于你的 Redis 安装和集群的具体配置。</p>
</blockquote>
<p>为防止路由失效，可在登录客户端时添加参数 <code>-c</code>，以<strong>集群模式</strong>连接到Redis集群，c 即 cluster </p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e4ecdb9d977.png" alt="image-20240914095435385"></p>
<p>当我们再次尝试在6381写入key1 时能够正常写入，且写入时提示已自动重定向到对应的6383实例</p>
<p>若要查看集群信息，可用<code>CLUSTER NODES</code> 命令</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e4f0085fc13.png" alt="image-20240914100808110"></p>
<p>若要查看某个key对应的槽位值，可以使用 <code>CLUSTER KEYSLOT key</code> 命令</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e4f09b48247.png" alt="image-20240914101035055"></p>
<h3 id="主从容错切换迁移案例"><a href="#主从容错切换迁移案例" class="headerlink" title="主从容错切换迁移案例"></a>主从容错切换迁移案例</h3><blockquote>
<p>主节点6381和从节点6384切换演示</p>
</blockquote>
<h4 id="案例演示-3"><a href="#案例演示-3" class="headerlink" title="案例演示"></a>案例演示</h4><p><strong>思考两个问题：</strong></p>
<p><strong>1、主节点宕机，从节点能否顺利上位为主节点？</strong></p>
<p><strong>2、宕机的主节点恢复后，能否重新上位，恢复如初？</strong></p>
<p>先手动停止主节点6381实例</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e4f4e746d93.png" alt="image-20240914102855013"></p>
<p>从6382实例检查集群服务状态</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e4f6a7eb123.png" alt="image-20240914103623680"></p>
<p>可以看到，6381状态为<code>fail</code>，6384成功上位变为主节点，集群架构也从原来的三主三从变为三主二从</p>
<p>再启动6381实例，看能否重新上位为主机点</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e4f86f6028c.png" alt="image-20240914104359102"></p>
<p>可以看到，即便6381实例重新恢复，依旧是从节点</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e4f8d46ee71.png" alt="image-20240914104540203"></p>
<p>即便6381恢复，但6384已上位为主节点，6381成为6384的从节点</p>
<p><strong>结论</strong>：</p>
<p><strong>1、<font color="red">主节点宕机，从节点能顺利上位为新的主节点</font></strong></p>
<p><strong>2、<font color="red">宕机的主节点恢复，不能再次恢复到主节点</font></strong></p>
<p><strong>注意：</strong></p>
<p><strong><font color="red">集群不保证数据100%一致性，会有一定数据丢失情况</font></strong></p>
<p>如果某一台主节点宕机了，从节点还没有成功上位，在从节点上位的这个间隙内有新的写入操作，数据将会丢失</p>
<h4 id="手动故障迁移-节点从属调整"><a href="#手动故障迁移-节点从属调整" class="headerlink" title="手动故障迁移/节点从属调整"></a><strong>手动故障迁移/节点从属调整</strong></h4><p>由于6384上位为主节点，6381恢复后又不能恢复到主节点，我们想要让6381重新变为主节点该怎么做呢？</p>
<p>我们可以使用 <code>CLUSTER FAILOVER</code> 命令将6381重新调整为主节点</p>
<blockquote>
<p><code>CLUSTER FAILOVER</code> 是 Redis 集群模式下的一个管理命令，用于触发一个手动的故障转移过程。在 Redis 集群中，每个主节点（master）可以有多个从节点（slave），从节点主要用于读取操作或作为备份数据。如果某个主节点出现故障，Redis 集群可以通过自动故障转移机制将从节点提升为主节点，以保持集群的可用性。</p>
<h3 id="命令格式"><a href="#命令格式" class="headerlink" title="命令格式"></a>命令格式</h3><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CLUSTER FAILOVER [NO-RECONFIG]</span><br></pre></td></tr></tbody></table></figure>

<h4 id="参数说明"><a href="#参数说明" class="headerlink" title="参数说明"></a>参数说明</h4><ul>
<li><strong>NO-RECONFIG</strong>：这是一个可选参数，当指定此参数时，不会重新配置从节点为新的主节点。这意味着在故障转移后，旧的从节点将成为新的主节点，但它不会立即创建新的从节点。这对于某些特定的故障转移场景可能有用，比如当管理员想要手动控制后续的从节点设置时。</li>
</ul>
<h3 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h3><p>当你在 Redis 集群中执行 <code>CLUSTER FAILOVER</code> 命令时，将会发生以下事情：</p>
<ol>
<li><strong>手动触发故障转移</strong>：强制将从节点提升为主节点，以替代已知不可用的主节点。</li>
<li><strong>重新分配槽</strong>：新提升的主节点将接管原主节点负责的所有哈希槽。</li>
<li><strong>重新配置从节点</strong>：如果未指定 <code>NO-RECONFIG</code> 参数，则新的主节点将自动重新配置其从节点关系。</li>
</ol>
<h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><ul>
<li>执行 <code>CLUSTER FAILOVER</code> 命令通常是在主节点确实已经确认不可用的情况下进行的。</li>
<li>如果集群中有足够的健康节点，并且配置了复制关系，那么自动故障转移通常会在后台默默地完成，不需要人工干预。</li>
<li>在执行 <code>CLUSTER FAILOVER</code> 之前，请确保了解集群的当前状态以及故障转移的影响范围。</li>
</ul>
<h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><p>假设你想要手动触发一个故障转移过程，可以这样执行命令：</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -c &lt;cluster-node-1&gt; &lt;cluster-node-2&gt; ... cluster failover</span><br></pre></td></tr></tbody></table></figure>

<p>或者如果你想手动触发故障转移但不重新配置从节点，可以这样执行：</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -c &lt;cluster-node-1&gt; &lt;cluster-node-2&gt; ... cluster failover no-reconfig</span><br></pre></td></tr></tbody></table></figure>

<p>请替换 <code>&lt;cluster-node-1&gt;</code>、<code>&lt;cluster-node-2&gt;</code> 等为你集群中的节点信息。确保你在执行命令前有足够的权限，并且理解该命令对集群的影响。</p>
</blockquote>
<p>在6381实例上使用<code>CLUSTER FAILOVER</code>重新配置为主节点</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e4fce81d7e3.png" alt="image-20240914110303864"></p>
<p>6381重新变为主节点，6384变为6381的从节点</p>
<h3 id="主从扩容案例"><a href="#主从扩容案例" class="headerlink" title="主从扩容案例"></a>主从扩容案例</h3><p>1、在<code>192.168.10.99</code>上新建6387，6388两个实例并启动</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 192.168.10.99:6387 redis_cluster_6387.conf</span></span><br><span class="line"><span class="built_in">bind</span> 0.0.0.0</span><br><span class="line">daemonize <span class="built_in">yes</span></span><br><span class="line">protected-mode no</span><br><span class="line">port 6387</span><br><span class="line">logfile <span class="string">"/my-redis7/cluster/cluster6387.log"</span></span><br><span class="line">pidfile /my-redis7/cluster/cluster6387.pid</span><br><span class="line"><span class="built_in">dir</span> /my-redis7/cluster</span><br><span class="line">dbfilename dump6387.rdb</span><br><span class="line">appendonly <span class="built_in">yes</span></span><br><span class="line">appendfilename <span class="string">"appendonly6387.aof"</span></span><br><span class="line">requirepass shiguang</span><br><span class="line">masterauth shiguang</span><br><span class="line"> </span><br><span class="line">cluster-enabled <span class="built_in">yes</span></span><br><span class="line">cluster-config-file nodes-6387.conf</span><br><span class="line">cluster-node-timeout 5000</span><br><span class="line"></span><br><span class="line"><span class="comment"># 192.168.10.99:6388 redis_cluster_6388.conf</span></span><br><span class="line"><span class="built_in">bind</span> 0.0.0.0</span><br><span class="line">daemonize <span class="built_in">yes</span></span><br><span class="line">protected-mode no</span><br><span class="line">port 6388</span><br><span class="line">logfile <span class="string">"/my-redis7/cluster/cluster6388.log"</span></span><br><span class="line">pidfile /my-redis7/cluster/cluster6388.pid</span><br><span class="line"><span class="built_in">dir</span> /my-redis7/cluster</span><br><span class="line">dbfilename dump6388.rdb</span><br><span class="line">appendonly <span class="built_in">yes</span></span><br><span class="line">appendfilename <span class="string">"appendonly6388.aof"</span></span><br><span class="line">requirepass shiguang</span><br><span class="line">masterauth shiguang</span><br><span class="line"> </span><br><span class="line">cluster-enabled <span class="built_in">yes</span></span><br><span class="line">cluster-config-file nodes-6388.conf</span><br><span class="line">cluster-node-timeout 5000</span><br></pre></td></tr></tbody></table></figure>

<p>分别启动实例</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/local/bin</span><br><span class="line">redis-server /my-redis7/cluster/redis_cluster_6381.conf</span><br><span class="line">redis-server /my-redis7/cluster/redis_cluster_6382.conf</span><br></pre></td></tr></tbody></table></figure>

<p>此时新加入的6387，6388节点实例分别是自己的master</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e50228f25fa.png" alt="image-20240914112528741"></p>
<p>2、将新增的6387(空槽号)作为master节点加入到原有集权</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -a &lt;密码&gt; --cluster add-node &lt;自己实际IP地址&gt;:6387 &lt;自己实际IP地址&gt;:6381</span><br></pre></td></tr></tbody></table></figure>

<p>6387 就是将要作为master新增节点</p>
<p>6381 就是原来集群节点里面的领路人，相当于6387拜拜6381的码头从而找到组织加入集群</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -a shiguang --cluster add-node 192.168.10.99:6387 192.168.10.66:6381</span><br></pre></td></tr></tbody></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e503c21b11f.png" alt="image-20240914113217793"></p>
<p>3、在任意实例检查集群状态</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -a shiguang --cluster check 192.168.10.66:6381</span><br></pre></td></tr></tbody></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e50478cc346.png" alt="image-20240914113520554"></p>
<p>可以看到6387已经加入到集群，但是 0 slots，0 slaves，也就是说暂时还没有分配到槽号</p>
<p>4、重新分配槽号</p>
<p>在任意一个Redis实例使用 <code>RESHARD</code> 命令重新分派槽号</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -a 密码 --cluster reshard IP地址:端口号</span><br></pre></td></tr></tbody></table></figure>

<p>例如此处我使用以下命令</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -a shiguang --cluster reshard 192.168.10.66:6381</span><br></pre></td></tr></tbody></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e50620edc38.png" alt="image-20240914114224624"></p>
<p>询问我们想要分配多少个槽号，现在集群中一共有4个master节点，一共16384个槽号，平均分配 16384/4 = 4096</p>
<p>询问我们新分配的槽号谁来接收</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e50709045f1.png" alt="image-20240914114616840"></p>
<p>复制6387的实例ID</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e5074bd99af.png" alt="image-20240914114723660"></p>
<p>输入all</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e509102c708.png" alt="image-20240914115455966"></p>
<p>输入 yes</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e507ca4ce7d.png" alt="image-20240914114930087"></p>
<p>5、槽位重新分配后重新检查</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e509f86599c.png" alt="image-20240914115848112"></p>
<p>可以看到6387已经分配了4096个槽号</p>
<p>另外可以看到，新分配的6387的槽号是不连续的，[0-1364],[5461-6826],[10923-12287]，而之前的都是连续的</p>
<p>为什么会出现这个情况呢？<font color="red">原因是重新分配成本太高，所以前3家各自匀出来一部分，从6381/6383/6385三个旧节点分别匀出1364个坑位给新节点6387</font></p>
<p>6、为6387主节点分配从节点6388</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -a 密码 --cluster add-node ip:新slave端口 ip:新master端口 --cluster-slave --cluster-master-id 新主节点ID </span><br></pre></td></tr></tbody></table></figure>

<p>例如此处我使用的命令为：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -a shiguang --cluster add-node 192.168.10.99:6388 192.168.10.99:6387 --cluster-slave --cluster-master-id 54b2de0fa7adb6c014901108af6a2335fe088da8</span><br></pre></td></tr></tbody></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e50c8f18ce8.png" alt="image-20240914120950739"></p>
<p>7、重新检查集群状态</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e50d92c0940.png" alt="image-20240914121410557"></p>
<p>可以看到集群已经变为四主四从，且6388的主节点为6387</p>
<h3 id="主从缩容案例"><a href="#主从缩容案例" class="headerlink" title="主从缩容案例"></a>主从缩容案例</h3><blockquote>
<p>假设我们需要6387和6388下线，恢复三主三从</p>
</blockquote>
<p>1、检查集群状况，先获得从节点6388的节点ID</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -a shiguang --cluster check 192.168.10.99:6388</span><br></pre></td></tr></tbody></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e50f3288887.png" alt="image-20240914122106253"></p>
<p>2、从集群中将6388删除</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -a 密码 --cluster del-node ip:从机端口 从机6388节点ID</span><br></pre></td></tr></tbody></table></figure>

<p>例如此处我使用命令：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -a shiguang --cluster del-node 192.168.10.99:6388 025bd894baf8fd48144165d1d44f16c5b87f9108</span><br></pre></td></tr></tbody></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e5100d230b0.png" alt="image-20240914122444942"></p>
<p>3、重新检查集群状态</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e5107d0f2f3.png" alt="image-20240914122636786"></p>
<p>可以看到6387下0 slaves，说明6388已经移除集群，集群中只剩下7个实例</p>
<p>4、将6387槽号清空，将槽号重新分配给6381实例</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -a shiguang --cluster reshard 192.168.10.66:6381</span><br></pre></td></tr></tbody></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e51301dc520.png" alt="image-20240914123721593"></p>
<p>输入 <code>yes</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e51322acac5.png" alt="image-20240914123754515"></p>
<p>等待分配完成</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e513470c994.png" alt="image-20240914123830898"></p>
<p>5、重新检查集群状态</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -a shiguang --cluster check 192.168.10.66:6381</span><br></pre></td></tr></tbody></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e5143b4bbc7.png" alt="image-20240914124234999"></p>
<p>可以看到6387节点变成了6381的从节点</p>
<p>4096个槽位都指给6381，它变成了8192个槽位，相当于全部都给6381了，不然要输入3次，一锅端</p>
<p>6、将6387删除</p>
<p>命令：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -a 密码 --cluster del-node ip:端口 6387节点ID</span><br></pre></td></tr></tbody></table></figure>

<p>例如此处我使用以下命令；</p>
 <figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -a shiguang --cluster del-node 192.168.10.99:6387 54b2de0fa7adb6c014901108af6a2335fe088da8</span><br></pre></td></tr></tbody></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e516086bd11.png" alt="image-20240914125016254"></p>
<p>6、重新检查集群状态</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e5164e75013.png" alt="image-20240914125126204"></p>
<p>可以看到集群又恢复到了三主三从</p>
<h2 id="集群常用操作命令和CRC16算法分析"><a href="#集群常用操作命令和CRC16算法分析" class="headerlink" title="集群常用操作命令和CRC16算法分析"></a>集群常用操作命令和CRC16算法分析</h2><h3 id="通识占位符"><a href="#通识占位符" class="headerlink" title="通识占位符"></a>通识占位符</h3><p>不在同一个slot槽位下的多键操作支持不好，不在同一个slot槽位下的键值无法使用mset、mget等多键操作</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e517ee4312d.png" alt="image-20240914125822129"></p>
<p>可以通过<code>{}</code>来定义同一个组的概念，使key中<code>{}</code>内相同内容的键值对放到一个slot槽位去</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e518ab0003d.png" alt="image-20240914130130869"></p>
<h3 id="CRC16源码浅谈"><a href="#CRC16源码浅谈" class="headerlink" title="CRC16源码浅谈"></a>CRC16源码浅谈</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e519f9158af.png" alt="image-20240914130704719"></p>
<p>Redis集群有16384个哈希槽，每个key通过CRC16校验后对16384取模来决定放置哪个槽，集群的每个节点负责一部分hash槽。</p>
<h3 id="常用命令-5"><a href="#常用命令-5" class="headerlink" title="常用命令"></a>常用命令</h3><h4 id="cluster-require-full-coverage"><a href="#cluster-require-full-coverage" class="headerlink" title="cluster-require-full-coverage"></a>cluster-require-full-coverage</h4><p>集群是否完整才对外提供服务</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e51a5fc3938.png" alt="image-20240914130847546"></p>
<h4 id="CLUSTER-COUNTKEYSINSLOT-slot"><a href="#CLUSTER-COUNTKEYSINSLOT-slot" class="headerlink" title="CLUSTER COUNTKEYSINSLOT slot"></a>CLUSTER COUNTKEYSINSLOT slot</h4><p>查看该槽号是否被占用</p>
<ul>
<li>返回0，槽号尚未被占用</li>
<li>返回1，槽号已经被占用</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e51b8be1af0.png" alt="image-20240914131347782"></p>
<h3 id="CLUSTER-KEYSLOT-key"><a href="#CLUSTER-KEYSLOT-key" class="headerlink" title="CLUSTER KEYSLOT key"></a>CLUSTER KEYSLOT key</h3><p>指定键应该存放到哪个槽位上</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/14/66e51c1df16ec.png" alt="image-20240914131613897"></p>
<h1 id="SpringBoot集成Redis"><a href="#SpringBoot集成Redis" class="headerlink" title="SpringBoot集成Redis"></a>SpringBoot集成Redis</h1><h2 id="总体概述"><a href="#总体概述" class="headerlink" title="总体概述"></a>总体概述</h2><p><strong>jedis、lettuce、RedisTemplate三者联系</strong></p>
<p>第一代：jedis</p>
<p>第二代：lettuce</p>
<p>第三代：RedisTemplate（Spring 生态体系）</p>
<h2 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h2><ul>
<li>bind 设置未注释</li>
<li>保护模式需设置为no</li>
<li>Linux防火墙设置（关闭或配置白名单）</li>
<li>Redis服务器IP地址和密码是否正确</li>
<li>忘记写Redis的服务端口和auth密码</li>
</ul>
<h2 id="集成Jedis"><a href="#集成Jedis" class="headerlink" title="集成Jedis"></a>集成Jedis</h2><h3 id="Jedis介绍"><a href="#Jedis介绍" class="headerlink" title="Jedis介绍"></a>Jedis介绍</h3><p>Jedis Client是Redis官网推荐的一个面向java客户端，库文件实现了对各类API进行封装调用</p>
<h3 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h3><ol>
<li>建Module</li>
<li>改POM</li>
<li>写YML</li>
<li>主启动类</li>
<li>业务类</li>
</ol>
<h3 id="POM依赖"><a href="#POM依赖" class="headerlink" title="POM依赖"></a>POM依赖</h3><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.atguigu.redis7<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>redis7_study<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">junit.version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">junit.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">log4j.version</span>&gt;</span>1.2.17<span class="tag">&lt;/<span class="name">log4j.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">lombok.version</span>&gt;</span>1.16.18<span class="tag">&lt;/<span class="name">lombok.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--SpringBoot通用依赖模块--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--jedis--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--通用基础配置--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>${junit.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>${log4j.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>${lombok.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>



<h3 id="YML配置"><a href="#YML配置" class="headerlink" title="YML配置"></a>YML配置</h3><p><code>application.properties</code></p>
<figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server.port</span>=<span class="string">7777</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring.application.name</span>=<span class="string">learn-redis</span></span><br></pre></td></tr></tbody></table></figure>



<p>或者 <code>application.yml</code></p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">learn-redis</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="主启动类"><a href="#主启动类" class="headerlink" title="主启动类"></a>主启动类</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainApplication</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        SpringApplication.run(MainApplication.class,args);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="入门案例"><a href="#入门案例" class="headerlink" title="入门案例"></a>入门案例</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JedisDemo</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="comment">// 1、获取连接,通过指定ip和端口</span></span><br><span class="line">        <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span>  <span class="keyword">new</span> <span class="title class_">Jedis</span>(<span class="string">"192.168.10.66"</span>,<span class="number">6379</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、指定访问服务器的密码</span></span><br><span class="line">        jedis.auth(<span class="string">"shiguang"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、获得了jedis客户端,可以像JDBC一样访问Redis</span></span><br><span class="line">        System.out.println(jedis.ping()); <span class="comment">// 返回 PONG 代表连接成功</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// key2</span></span><br><span class="line">        Set&lt;String&gt; keys = jedis.keys(<span class="string">"*"</span>);</span><br><span class="line">        System.out.println(keys);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// String</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">set</span> <span class="operator">=</span> jedis.set(<span class="string">"key1"</span>, <span class="string">"val1"</span>);</span><br><span class="line">        System.out.println(set);</span><br><span class="line">        System.out.println(jedis.get(<span class="string">"key1"</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// list</span></span><br><span class="line">        jedis.lpush(<span class="string">"list"</span>, <span class="string">"Java"</span>, <span class="string">"Python"</span>, <span class="string">"Go"</span>);</span><br><span class="line">        List&lt;String&gt; list = jedis.lrange(<span class="string">"list"</span>, <span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (String element : list) {</span><br><span class="line">            System.out.println(element);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<h2 id="集成Lettuce"><a href="#集成Lettuce" class="headerlink" title="集成Lettuce"></a>集成Lettuce</h2><h3 id="Lettuce介绍"><a href="#Lettuce介绍" class="headerlink" title="Lettuce介绍"></a>Lettuce介绍</h3><p>Lettuce是一个Redis的Java驱动包，Lettuce翻译为生菜，没错，就是吃的那种生菜，所以它的Logo长这样</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/12/66e2e959414ad.png" alt="image-20240912211506130"></p>
<h3 id="Jedis与Lettuce的区别"><a href="#Jedis与Lettuce的区别" class="headerlink" title="Jedis与Lettuce的区别"></a>Jedis与Lettuce的区别</h3><p>Jedis和Lettuce都是Redis的客户端，它们都可以连接Redis服务器，但是<font color="red">在SpringBoot2.O之后默认都是使用的Lettuce这个客户端连接Redis服务器</font>。因为当使用Jedis客户端连接Redis服务器的时候，每个线程都要拿自己创建的Jedis实例去连接Redis客户端，当有很多个线程的时候，不仅开销大需要反复的创建关闭一个Jedis连接，而且也是线程不安全的，一个线程通过Jedis实例更改Redis服务器中的数据之后会影响另一个线程；</p>
<p>但是如果使用Lettuce这个客户端连接Redis服务器的时候，就不会出现上面的情况，<font color="red">Lettuce底层使用的是Netty</font>,<br>当有多个线程都需要连接Redis服务器的时候，可以保证只创建一个Lettuce连接，使所有的线程共享这一个Lettuce连接，这样可以减少创建关闭一个Lettuce连接时候的开销；而目这种方式也是线程安全的，不会出现一个线程通过Lettuce更改Redis服务器中的数据之后而影响另一个线程的情况。</p>
<h3 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h3><h4 id="改POM"><a href="#改POM" class="headerlink" title="改POM"></a>改POM</h4><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--lettuce--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.lettuce<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lettuce-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>6.2.1.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<h4 id="业务类"><a href="#业务类" class="headerlink" title="业务类"></a>业务类</h4><blockquote>
<p>若Slf4j使用出错需检查lombok版本</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LettuceDemo</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="comment">// 1、使用构建器链式编程 Builder RedisURI</span></span><br><span class="line">        <span class="type">RedisURI</span> <span class="variable">uri</span> <span class="operator">=</span> RedisURI.builder()</span><br><span class="line">                .redis(<span class="string">"192.168.111.181"</span>)</span><br><span class="line">                .withPort(<span class="number">6379</span>)</span><br><span class="line">                .withAuthentication(<span class="string">"default"</span>, <span class="string">"111111"</span>)</span><br><span class="line">                .build();</span><br><span class="line">        <span class="comment">// 2、创建连接客户端</span></span><br><span class="line">        <span class="type">RedisClient</span> <span class="variable">client</span> <span class="operator">=</span> RedisClient.create(uri);</span><br><span class="line">        <span class="type">StatefulRedisConnection</span> <span class="variable">conn</span> <span class="operator">=</span> client.connect();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、通过coond创建操作的command</span></span><br><span class="line">        RedisCommands&lt;String, String&gt; commands = conn.sync();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> 各种业务逻辑</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//keys</span></span><br><span class="line">        List&lt;String&gt; list = commands.keys(<span class="string">"*"</span>);</span><br><span class="line">        <span class="keyword">for</span> (String s : list) {</span><br><span class="line">            log.info(<span class="string">"key:{}"</span>, s);</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//String</span></span><br><span class="line">        commands.set(<span class="string">"k1"</span>, <span class="string">"1111"</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> commands.get(<span class="string">"k1"</span>);</span><br><span class="line">        System.out.println(<span class="string">"String s ==="</span> + s1);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//list</span></span><br><span class="line">        commands.lpush(<span class="string">"myList2"</span>, <span class="string">"v1"</span>, <span class="string">"v2"</span>, <span class="string">"v3"</span>);</span><br><span class="line">        List&lt;String&gt; list2 = commands.lrange(<span class="string">"myList2"</span>, <span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (String s : list2) {</span><br><span class="line">            System.out.println(<span class="string">"list ssss==="</span> + s);</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//set</span></span><br><span class="line">        commands.sadd(<span class="string">"mySet2"</span>, <span class="string">"v1"</span>, <span class="string">"v2"</span>, <span class="string">"v3"</span>);</span><br><span class="line">        Set&lt;String&gt; set = commands.smembers(<span class="string">"mySet2"</span>);</span><br><span class="line">        <span class="keyword">for</span> (String s : set) {</span><br><span class="line">            System.out.println(<span class="string">"set ssss==="</span> + s);</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//hash</span></span><br><span class="line">        Map&lt;String, String&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">"k1"</span>, <span class="string">"138xxxxxxxx"</span>);</span><br><span class="line">        map.put(<span class="string">"k2"</span>, <span class="string">"atguigu"</span>);</span><br><span class="line">        map.put(<span class="string">"k3"</span>, <span class="string">"zzyybs@126.com"</span>);<span class="comment">//课后有问题请给我发邮件</span></span><br><span class="line"></span><br><span class="line">        commands.hmset(<span class="string">"myHash2"</span>, map);</span><br><span class="line">        Map&lt;String, String&gt; retMap = commands.hgetall(<span class="string">"myHash2"</span>);</span><br><span class="line">        <span class="keyword">for</span> (String k : retMap.keySet()) {</span><br><span class="line">            System.out.println(<span class="string">"hash  k="</span> + k + <span class="string">" , v=="</span> + retMap.get(k));</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">//zset</span></span><br><span class="line">        commands.zadd(<span class="string">"myZset2"</span>, <span class="number">100.0</span>, <span class="string">"s1"</span>, <span class="number">110.0</span>, <span class="string">"s2"</span>, <span class="number">90.0</span>, <span class="string">"s3"</span>);</span><br><span class="line">        List&lt;String&gt; list3 = commands.zrange(<span class="string">"myZset2"</span>, <span class="number">0</span>, <span class="number">10</span>);</span><br><span class="line">        <span class="keyword">for</span> (String s : list3) {</span><br><span class="line">            System.out.println(<span class="string">"zset ssss==="</span> + s);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">//sort</span></span><br><span class="line">        <span class="type">SortArgs</span> <span class="variable">sortArgs</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SortArgs</span>();</span><br><span class="line">        sortArgs.alpha();</span><br><span class="line">        sortArgs.desc();</span><br><span class="line"></span><br><span class="line">        List&lt;String&gt; list4 = commands.sort(<span class="string">"myList2"</span>, sortArgs);</span><br><span class="line">        <span class="keyword">for</span> (String s : list4) {</span><br><span class="line">            System.out.println(<span class="string">"sort ssss==="</span> + s);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4、关闭和释放资源</span></span><br><span class="line">        conn.close();</span><br><span class="line">        client.shutdown();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="集成RedisTemplate（推荐）"><a href="#集成RedisTemplate（推荐）" class="headerlink" title="集成RedisTemplate（推荐）"></a><font color="red">集成RedisTemplate（推荐）</font></h2><h3 id="连接单机"><a href="#连接单机" class="headerlink" title="连接单机"></a>连接单机</h3><h4 id="改POM-1"><a href="#改POM-1" class="headerlink" title="改POM"></a>改POM</h4><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--SpringBoot与Redis整合依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-pool2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--swagger2--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<h4 id="写YML"><a href="#写YML" class="headerlink" title="写YML"></a>写YML</h4><blockquote>
<p>关于<code>documentationPluginsBootstrapper</code>错误详见 <a href="https://gitee.com/link?target=https://blog.shiguangdev.cn/2024/09/12/85b8e5222f2d/">Swagger 快速使用</a></p>
</blockquote>
<p><code>application.properties</code></p>
<figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server.port</span>=<span class="string">7777</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring.application.name</span>=<span class="string">redis7_study</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># ========================logging=====================</span></span><br><span class="line"><span class="attr">logging.level.root</span>=<span class="string">info</span></span><br><span class="line"><span class="attr">logging.level.com.atguigu.redis7</span>=<span class="string">info</span></span><br><span class="line"><span class="attr">logging.pattern.console</span>=<span class="string">%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger- %msg%n </span></span><br><span class="line"></span><br><span class="line"><span class="attr">logging.file.name</span>=<span class="string">D:/mylogs2023/redis7_study.log</span></span><br><span class="line"><span class="attr">logging.pattern.file</span>=<span class="string">%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger- %msg%n</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># ========================swagger=====================</span></span><br><span class="line"><span class="attr">spring.swagger2.enabled</span>=<span class="string">true</span></span><br><span class="line"><span class="comment">#在springboot2.6.X结合swagger2.9.X会提示documentationPluginsBootstrapper空指针异常，</span></span><br><span class="line"><span class="comment">#原因是在springboot2.6.X中将SpringMVC默认路径匹配策略从AntPathMatcher更改为PathPatternParser，</span></span><br><span class="line"><span class="comment"># 导致出错，解决办法是matching-strategy切换回之前ant_path_matcher</span></span><br><span class="line"><span class="attr">spring.mvc.pathmatch.matching-strategy</span>=<span class="string">ant_path_matcher</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># ========================redis单机=====================</span></span><br><span class="line"><span class="attr">spring.redis.database</span>=<span class="string">0</span></span><br><span class="line"><span class="comment"># 修改为自己真实IP</span></span><br><span class="line"><span class="attr">spring.redis.host</span>=<span class="string">192.168.111.185</span></span><br><span class="line"><span class="attr">spring.redis.port</span>=<span class="string">6379</span></span><br><span class="line"><span class="attr">spring.redis.password</span>=<span class="string">111111</span></span><br><span class="line"><span class="attr">spring.redis.lettuce.pool.max-active</span>=<span class="string">8</span></span><br><span class="line"><span class="attr">spring.redis.lettuce.pool.max-wait</span>=<span class="string">-1ms</span></span><br><span class="line"><span class="attr">spring.redis.lettuce.pool.max-idle</span>=<span class="string">8</span></span><br><span class="line"><span class="attr">spring.redis.lettuce.pool.min-idle</span>=<span class="string">0</span></span><br></pre></td></tr></tbody></table></figure>

<p>或者 <code>application.yml</code></p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">learn-redis</span></span><br><span class="line"><span class="comment">############################### 自定义Swigger配置 ###############################</span></span><br><span class="line">  <span class="comment">#在springboot2.6.X结合swagger2.9.X会提示documentationPluginsBootstrapper空指针异常，</span></span><br><span class="line">  <span class="comment">#原因是在springboot2.6.X中将SpringMVC默认路径匹配策略从AntPathMatcher更改为PathPatternParser，</span></span><br><span class="line">  <span class="comment"># 导致出错，解决办法是matching-strategy切换回之前ant_path_matcher</span></span><br><span class="line">  <span class="attr">mvc:</span></span><br><span class="line">    <span class="attr">pathmatch:</span></span><br><span class="line">      <span class="attr">matching-strategy:</span> <span class="string">ant_path_matcher</span></span><br><span class="line">  <span class="attr">swigger2:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">###############################  Redis 单机 ###############################</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">database:</span> <span class="number">0</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.10</span><span class="number">.66</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">shiguang</span></span><br><span class="line">    <span class="attr">lettuce:</span></span><br><span class="line">      <span class="attr">pool:</span></span><br><span class="line">        <span class="attr">max-active:</span> <span class="number">8</span></span><br><span class="line">        <span class="attr">max-wait:</span> <span class="string">-1ms</span></span><br><span class="line">        <span class="attr">max-idle:</span> <span class="number">8</span></span><br><span class="line">        <span class="attr">min-idle:</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">###############################  logging ###############################</span></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">root:</span> <span class="string">info</span></span><br><span class="line">    <span class="attr">com.shiguang:</span> <span class="string">info</span></span><br><span class="line">  <span class="attr">pattern:</span></span><br><span class="line">    <span class="attr">console:</span> <span class="string">"%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger- %msg%n"</span></span><br><span class="line">    <span class="attr">file:</span> <span class="string">"%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger- %msg%n"</span></span><br><span class="line">  <span class="attr">file:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">D:/Files/redis7/redis.log</span></span><br></pre></td></tr></tbody></table></figure>



<h4 id="SwaggerConfig"><a href="#SwaggerConfig" class="headerlink" title="SwaggerConfig"></a><code>SwaggerConfig</code></h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableSwagger2</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SwaggerConfig</span></span><br><span class="line">{</span><br><span class="line">    <span class="meta">@Value("${spring.swigger2.enabled}")</span></span><br><span class="line">    <span class="keyword">private</span> Boolean enabled;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Docket <span class="title function_">createRestApi</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Docket</span>(DocumentationType.SWAGGER_2)</span><br><span class="line">                .apiInfo(apiInfo())</span><br><span class="line">                .enable(enabled)</span><br><span class="line">                .select()</span><br><span class="line">                .apis(RequestHandlerSelectors.basePackage(<span class="string">"com.shiguang"</span>)) <span class="comment">//你自己的package</span></span><br><span class="line">                .paths(PathSelectors.any())</span><br><span class="line">                .build();</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">public</span> ApiInfo <span class="title function_">apiInfo</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ApiInfoBuilder</span>()</span><br><span class="line">                .title(<span class="string">"springboot利用swagger2构建api接口文档 "</span>+<span class="string">"\t"</span>+ DateTimeFormatter.ofPattern(<span class="string">"yyyy-MM-dd"</span>).format(LocalDateTime.now()))</span><br><span class="line">                .description(<span class="string">"springboot+redis整合"</span>)</span><br><span class="line">                .version(<span class="string">"1.0"</span>)</span><br><span class="line">                .termsOfServiceUrl(<span class="string">"https://blog.shiguangdev.cn/"</span>)</span><br><span class="line">                .build();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h4 id="controller"><a href="#controller" class="headerlink" title="controller"></a>controller</h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Api(tags = "订单接口")</span></span><br><span class="line"><span class="meta">@RequestMapping("order")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderController</span> {</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> OrderService orderService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation("新增订单")</span></span><br><span class="line">    <span class="meta">@PostMapping()</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addOrder</span><span class="params">()</span>{</span><br><span class="line">        orderService.addOrder();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation("根据keyId 查询订单")</span></span><br><span class="line">    <span class="meta">@GetMapping("{id}")</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getOrderById</span><span class="params">(<span class="meta">@PathVariable()</span> Integer id)</span>{</span><br><span class="line">        orderService.getOrderById(id);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<h4 id="service"><a href="#service" class="headerlink" title="service"></a>service</h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderService</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ORDER_KEY</span> <span class="operator">=</span> <span class="string">"order:"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addOrder</span><span class="params">()</span> {</span><br><span class="line">        <span class="type">int</span> <span class="variable">keyId</span> <span class="operator">=</span> ThreadLocalRandom.current().nextInt(<span class="number">1000</span>) + <span class="number">1</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">orderNo</span> <span class="operator">=</span> UUID.randomUUID().toString();</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> ORDER_KEY + keyId;</span><br><span class="line">        <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> <span class="string">"京东订单"</span> + orderNo;</span><br><span class="line">        redisTemplate.opsForValue().set(key, value);</span><br><span class="line">        log.info(<span class="string">"key:{}"</span>,key);</span><br><span class="line">        log.info(<span class="string">"value:{}"</span>,value);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getOrderById</span><span class="params">(Integer id)</span> {</span><br><span class="line">        <span class="keyword">return</span> (String) redisTemplate.opsForValue().get(ORDER_KEY + id);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<h4 id="序列号问题"><a href="#序列号问题" class="headerlink" title="序列号问题"></a>序列号问题</h4><p>键(key)和值(value)都是通过Spring提供的SerializerF序列化到数据库的。<br><code>RedisTemplate</code>默认使用的是<code>JdkSerializationRedisSerializer</code>。KEY被序列化成这样，线上通过KEY去查询对应的VALUE非常不方便。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/13/66e42c58b80ec.png" alt="image-20240913201313042"></p>
<p>使用<code>redis-cli</code>连接解决乱码问题可以在登录时使用<code>--raw</code>命令</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/13/66e43216d4e27.png" alt="image-20240913203743476"></p>
<p>JDK 序列化方式 （默认）</p>
<p><code>org.springframework.data.redis.serializer.JdkSerializationRedisSerializer</code> ，</p>
<p>默认情况下，<code>RedisTemplate</code> 使用该数据列化方式，我们来看下源码 <code>afterPropertiesSet()</code>方法</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/13/66e430717a0ac.png" alt="image-20240913203041819"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/13/66e430553e4df.png" alt="image-20240913203013672"></p>
<p><strong>解决方案</strong></p>
<p>1、使用 <code>RedisTemplate</code>的子类<code>StringRedisTemplate</code>，默认使用的是<code>StringRedisSerializer</code></p>
<p>2、添加配置类实现和 <code>StringRedisTemplate</code>相同功能</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisConfig</span></span><br><span class="line">{</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * redis序列化的工具配置类，下面这个请一定开启配置</span></span><br><span class="line"><span class="comment">     * 127.0.0.1:6379&gt; keys *</span></span><br><span class="line"><span class="comment">     * 1) "ord:102"  序列化过</span></span><br><span class="line"><span class="comment">     * 2) "\xac\xed\x00\x05t\x00\aord:102"   野生，没有序列化过</span></span><br><span class="line"><span class="comment">     * this.redisTemplate.opsForValue(); //提供了操作string类型的所有方法</span></span><br><span class="line"><span class="comment">     * this.redisTemplate.opsForList(); // 提供了操作list类型的所有方法</span></span><br><span class="line"><span class="comment">     * this.redisTemplate.opsForSet(); //提供了操作set的所有方法</span></span><br><span class="line"><span class="comment">     * this.redisTemplate.opsForHash(); //提供了操作hash表的所有方法</span></span><br><span class="line"><span class="comment">     * this.redisTemplate.opsForZSet(); //提供了操作zset的所有方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> lettuceConnectionFactory</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RedisTemplate&lt;String, Object&gt; <span class="title function_">redisTemplate</span><span class="params">(LettuceConnectionFactory lettuceConnectionFactory)</span></span><br><span class="line">    {</span><br><span class="line">        RedisTemplate&lt;String,Object&gt; redisTemplate = <span class="keyword">new</span> <span class="title class_">RedisTemplate</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        redisTemplate.setConnectionFactory(lettuceConnectionFactory);</span><br><span class="line">        <span class="comment">//设置key序列化方式string</span></span><br><span class="line">        redisTemplate.setKeySerializer(<span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>());</span><br><span class="line">        <span class="comment">//设置value的序列化方式json，使用GenericJackson2JsonRedisSerializer替换默认序列化</span></span><br><span class="line">        redisTemplate.setValueSerializer(<span class="keyword">new</span> <span class="title class_">GenericJackson2JsonRedisSerializer</span>());</span><br><span class="line"></span><br><span class="line">        redisTemplate.setHashKeySerializer(<span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>());</span><br><span class="line">        redisTemplate.setHashValueSerializer(<span class="keyword">new</span> <span class="title class_">GenericJackson2JsonRedisSerializer</span>());</span><br><span class="line"></span><br><span class="line">        redisTemplate.afterPropertiesSet();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> redisTemplate;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<h3 id="连接集群"><a href="#连接集群" class="headerlink" title="连接集群"></a>连接集群</h3><h4 id="改YML"><a href="#改YML" class="headerlink" title="改YML"></a>改YML</h4><p><code>application.properties</code></p>
<figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ========================redis集群=====================</span></span><br><span class="line"><span class="attr">spring.redis.password</span>=<span class="string">111111</span></span><br><span class="line"><span class="comment"># 获取失败 最大重定向次数</span></span><br><span class="line"><span class="attr">spring.redis.cluster.max-redirects</span>=<span class="string">3</span></span><br><span class="line"><span class="attr">spring.redis.lettuce.pool.max-active</span>=<span class="string">8</span></span><br><span class="line"><span class="attr">spring.redis.lettuce.pool.max-wait</span>=<span class="string">-1ms</span></span><br><span class="line"><span class="attr">spring.redis.lettuce.pool.max-idle</span>=<span class="string">8</span></span><br><span class="line"><span class="attr">spring.redis.lettuce.pool.min-idle</span>=<span class="string">0</span></span><br><span class="line"><span class="attr">spring.redis.cluster.nodes</span>=<span class="string">192.168.111.175:6381,192.168.111.175:6382,192.168.111.172:6383,192.168.111.172:6384,192.168.111.174:6385,192.168.111.174:6386</span></span><br></pre></td></tr></tbody></table></figure>

<p>或者 <code>application.yml</code></p>
<figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span>  </span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">database:</span> <span class="number">0</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.10</span><span class="number">.66</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">shiguang</span></span><br><span class="line">    <span class="attr">lettuce:</span></span><br><span class="line">      <span class="attr">pool:</span></span><br><span class="line">        <span class="attr">max-active:</span> <span class="number">8</span></span><br><span class="line">        <span class="attr">max-wait:</span> <span class="string">-1ms</span></span><br><span class="line">        <span class="attr">max-idle:</span> <span class="number">8</span></span><br><span class="line">        <span class="attr">min-idle:</span> <span class="number">0</span></span><br><span class="line">    <span class="comment">## 集群</span></span><br><span class="line">    <span class="attr">cluster:</span></span><br><span class="line">      <span class="attr">nodes:</span> <span class="string">"192.168.10.66:6381,192.168.10.66:6382,192.168.10.88:6383,192.168.10.88:6384,192.168.10.99:6385,192.168.10.99:6386"</span></span><br><span class="line">      <span class="comment"># 最大重定向次数</span></span><br><span class="line">      <span class="attr">max-redirects:</span> <span class="number">3</span></span><br></pre></td></tr></tbody></table></figure>

<h4 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h4><p><strong>故障演练：</strong></p>
<p>人为模拟，master-6381机器意外宕机，手动shutdown，先对redis集群命令方式，手动验证各种读写命令，看看6384是否上位，Redis Cluster集群能自动感知并自动完成主备切换，对应的slaver 6384会被选举为新的master节点</p>
<p><strong>故障现象</strong>：</p>
<p><font color="red">SpringBoot客户端没有动态感知到RedisCluster的最新集群信息</font></p>
<p>Redis Cluster集群部署采用了3主3从拓扑结构，数据读写访问master节点， slave节点负责备份。当master宕机主从切换成功，redis手动OK，but 2个经典故障</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/13/66e43624a7348.png" alt="image-20240913205446061"></p>
<p><strong>原因分析：</strong></p>
<p>SpringBoot2,X版本，Redis默认的连接池采用Lettuce，当Redis集群节点发生变化后，Letture默认是不会刷新节点拓扑</p>
<p><strong>解决方案：</strong></p>
<p>1、排除lettuce采用jedis<font color="red">（不推荐）</font></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/13/66e4371232f15.png" alt="image-20240913205858788"></p>
<p>2、重写连接工厂实例<font color="red">（极度不推荐）</font></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//仅做参考，不写，不写，不写。</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> DefaultClientResources <span class="title function_">lettuceClientResources</span><span class="params">()</span> {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> DefaultClientResources.create();</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> LettuceConnectionFactory <span class="title function_">lettuceConnectionFactory</span><span class="params">(RedisProperties redisProperties, ClientResources clientResources)</span> {</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">    <span class="type">ClusterTopologyRefreshOptions</span> <span class="variable">topologyRefreshOptions</span> <span class="operator">=</span> ClusterTopologyRefreshOptions.builder()</span><br><span class="line"></span><br><span class="line">            .enablePeriodicRefresh(Duration.ofSeconds(<span class="number">30</span>)) <span class="comment">//按照周期刷新拓扑</span></span><br><span class="line"></span><br><span class="line">            .enableAllAdaptiveRefreshTriggers() <span class="comment">//根据事件刷新拓扑</span></span><br><span class="line"></span><br><span class="line">            .build();</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">    <span class="type">ClusterClientOptions</span> <span class="variable">clusterClientOptions</span> <span class="operator">=</span> ClusterClientOptions.builder()</span><br><span class="line"></span><br><span class="line">            <span class="comment">//redis命令超时时间,超时后才会使用新的拓扑信息重新建立连接</span></span><br><span class="line"></span><br><span class="line">            .timeoutOptions(TimeoutOptions.enabled(Duration.ofSeconds(<span class="number">10</span>)))</span><br><span class="line"></span><br><span class="line">            .topologyRefreshOptions(topologyRefreshOptions)</span><br><span class="line"></span><br><span class="line">            .build();</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">    <span class="type">LettuceClientConfiguration</span> <span class="variable">clientConfiguration</span> <span class="operator">=</span> LettuceClientConfiguration.builder()</span><br><span class="line"></span><br><span class="line">            .clientResources(clientResources)</span><br><span class="line"></span><br><span class="line">            .clientOptions(clusterClientOptions)</span><br><span class="line"></span><br><span class="line">            .build();</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">    <span class="type">RedisClusterConfiguration</span> <span class="variable">clusterConfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RedisClusterConfiguration</span>(redisProperties.getCluster().getNodes());</span><br><span class="line"></span><br><span class="line">    clusterConfig.setMaxRedirects(redisProperties.getCluster().getMaxRedirects());</span><br><span class="line"></span><br><span class="line">    clusterConfig.setPassword(RedisPassword.of(redisProperties.getPassword()));</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">    <span class="type">LettuceConnectionFactory</span> <span class="variable">lettuceConnectionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LettuceConnectionFactory</span>(clusterConfig, clientConfiguration);</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> lettuceConnectionFactory;</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>3、刷新节点集群拓扑动态感应<font color="green">（推荐）</font></p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/lettuce-io/lettuce-core/wiki/Redis-Cluster#user-content-refreshing-the-cluster-topology-view">https://github.com/lettuce-io/lettuce-core/wiki/Redis-Cluster#user-content-refreshing-the-cluster-topology-view</a></p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/09/13/66e437ef39394.png" alt="image-20240913210239688"></p>
<p>改写配置文件配置自适应拓扑刷新及定时刷新时间即可</p>
<p><code>application.properties</code></p>
<figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ========================redis集群=====================</span></span><br><span class="line"><span class="attr">spring.redis.password</span>=<span class="string">111111</span></span><br><span class="line"><span class="comment"># 获取失败 最大重定向次数</span></span><br><span class="line"><span class="attr">spring.redis.cluster.max-redirects</span>=<span class="string">3</span></span><br><span class="line"><span class="attr">spring.redis.lettuce.pool.max-active</span>=<span class="string">8</span></span><br><span class="line"><span class="attr">spring.redis.lettuce.pool.max-wait</span>=<span class="string">-1ms</span></span><br><span class="line"><span class="attr">spring.redis.lettuce.pool.max-idle</span>=<span class="string">8</span></span><br><span class="line"><span class="attr">spring.redis.lettuce.pool.min-idle</span>=<span class="string">0</span></span><br><span class="line"><span class="comment">#支持集群拓扑动态感应刷新,自适应拓扑刷新是否使用所有可用的更新，默认false关闭</span></span><br><span class="line"><span class="attr">spring.redis.lettuce.cluster.refresh.adaptive</span>=<span class="string">true</span></span><br><span class="line"><span class="comment">#定时刷新</span></span><br><span class="line"><span class="attr">spring.redis.lettuce.cluster.refresh.period</span>=<span class="string">2000</span></span><br><span class="line"><span class="attr">spring.redis.cluster.nodes</span>=<span class="string">192.168.111.175:6381,192.168.111.175:6382,192.168.111.172:6383,192.168.111.172:6384,192.168.111.174:6385,192.168.111.174:6386</span></span><br></pre></td></tr></tbody></table></figure>

<p>或者</p>
<p><code>application.yml</code></p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###############################  Redis 配置  ###############################</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">database:</span> <span class="number">0</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.10</span><span class="number">.66</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">shiguang</span></span><br><span class="line">    <span class="attr">lettuce:</span></span><br><span class="line">      <span class="attr">pool:</span></span><br><span class="line">        <span class="attr">max-active:</span> <span class="number">8</span></span><br><span class="line">        <span class="attr">max-wait:</span> <span class="string">-1ms</span></span><br><span class="line">        <span class="attr">max-idle:</span> <span class="number">8</span></span><br><span class="line">        <span class="attr">min-idle:</span> <span class="number">0</span></span><br><span class="line">    <span class="comment">###### Redis集群配置</span></span><br><span class="line">      <span class="attr">cluster:</span></span><br><span class="line">        <span class="attr">refresh:</span></span><br><span class="line">          <span class="comment">## 支持集群拓扑动态感应刷新,自适应拓扑刷新是否使用所有可用的更新，默认false关闭</span></span><br><span class="line">          <span class="attr">adaptive:</span> <span class="literal">true</span></span><br><span class="line">          <span class="comment">## 定时刷新</span></span><br><span class="line">          <span class="attr">period:</span> <span class="number">2000</span></span><br><span class="line">    <span class="attr">cluster:</span></span><br><span class="line">      <span class="attr">nodes:</span> <span class="string">"192.168.10.66:6381,192.168.10.66:6382,192.168.10.66:6383,192.168.10.66:6384,192.168.10.66:6385,192.168.10.66:6386"</span></span><br></pre></td></tr></tbody></table></figure>







<p><strong>参考</strong></p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/redis-tutorial.html">菜鸟教程</a></p>
</blockquote>
</div></article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/avatar.png" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/avatar.png" title="头像" alt="头像"></a><div class="post-copyright__author_name">時光</div><div class="post-copyright__author_desc">心寄朗朗乾坤，胸怀真修之道。</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="https://blog.shiguang666.eu.org/2024/09/10/818e370d0e76/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('https://blog.shiguang666.eu.org/2024/09/10/818e370d0e76/')">【尚硅谷】Redis7实战（基础篇）</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="/img/wechat.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/wechat.png" alt="微信"></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/alipay.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/alipay.png" alt="支付宝"></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://blog.shiguang666.eu.org/2024/09/10/818e370d0e76/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=【尚硅谷】Redis7实战（基础篇）&amp;url=https://blog.shiguang666.eu.org/2024/09/10/818e370d0e76/&amp;pic=https://img.shiguangdev.cn/i/2024/08/28/66cedaf5d014a.jpeg" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://blog.shiguang666.eu.org" target="_blank">時光</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/%E5%B0%9A%E7%A1%85%E8%B0%B7/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>尚硅谷<span class="tagsPageCount">43</span></a><a class="post-meta__box__tags" href="/tags/Redis/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>Redis<span class="tagsPageCount">2</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://img.shiguangdev.cn/i/2024/12/20/67655fe410474.webp" data-sites="wechat,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/09/10/e2c85322eace/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/08/28/66cedaf5d014a.jpeg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">【尚硅谷】终极实战：SpringBoot版微头条实战</div></div></a></div><div class="next-post pull-right"><a href="/2024/09/12/85b8e5222f2d/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/17/6760fad41d6bc.webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Swagger快速使用</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/2024/09/18/847c1ec4d4cd/" title="【尚硅谷】Docker快速通关"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/08/28/66cedaf5d014a.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-09-18</div><div class="title">【尚硅谷】Docker快速通关</div></div></a></div><div><a href="/2024/09/17/56a6db38519d/" title="【尚硅谷】JAVA基础-IO流"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/08/28/66cedaf5d014a.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-09-17</div><div class="title">【尚硅谷】JAVA基础-IO流</div></div></a></div><div><a href="/2024/09/16/a32606420cb2/" title="【尚硅谷】JAVA基础-API"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/08/28/66cedaf5d014a.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-09-16</div><div class="title">【尚硅谷】JAVA基础-API</div></div></a></div><div><a href="/2024/09/17/ef5bcf52c331/" title="【尚硅谷】JAVA基础-JDK新特性"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/08/28/66cedaf5d014a.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-09-17</div><div class="title">【尚硅谷】JAVA基础-JDK新特性</div></div></a></div><div><a href="/2024/09/16/277ab91cb5a0/" title="【尚硅谷】JAVA基础-多线程"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/08/28/66cedaf5d014a.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-09-16</div><div class="title">【尚硅谷】JAVA基础-多线程</div></div></a></div><div><a href="/2024/09/16/fadbedc8dc87/" title="【尚硅谷】JAVA基础-异常&amp;Object"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/08/28/66cedaf5d014a.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-09-16</div><div class="title">【尚硅谷】JAVA基础-异常&amp;Object</div></div></a></div></div></div><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)" style="display: none">匿名评论</a><a href="/privacy" style="margin-left: 4px">隐私政策</a></div><div class="comment-tips" id="comment-tips"><span>✅ 你无需删除空行，直接评论以获取最佳展示效果</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://emotion.acs.pw/emotion/Heo/送福.png" alt="status"></div></div><div class="author-info__description">代码成就万事基积沙镇海,<br>梦想永在凌云意意气风发。</div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">時光</h1><div class="author-info__desc">心寄朗朗乾坤，胸怀真修之道。</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/shiguang-coding" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a></div></div></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bullhorn anzhiyu-shake"></i><span>公告</span></div><div class="announcement_content"><span>🌟欢迎光临時光的博客园子🌟</span><br> <span><a target="_blank" rel="noopener" href="https://blog.shiguangdev.cn"><b>blog.shiguangdev.cn</b></a></span><br> <span><a target="_blank" rel="noopener" href="https://blog.shiguang88.icu"><b>blog.shiguang88.icu</b></a></span><br> <span><a href="https://blog.shiguang666.eu.org"><b>blog.shiguang666.eu.org</b></a></span><br> <span>🤔 如有问题欢迎评论区交流！</span><br> <span>📧 如需联系我：<a href="mailto:an_shiguang@163.com"><b>发送邮件🚀</b></a></span> <div id="welcome-info"></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis%E5%85%A5%E9%97%A8%E6%A6%82%E8%BF%B0"><span class="toc-number">1.</span> <span class="toc-text">Redis入门概述</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-number">1.1.</span> <span class="toc-text">是什么</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%98%E7%BD%91%E8%A7%A3%E9%87%8A"><span class="toc-number">1.1.1.</span> <span class="toc-text">官网解释</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis%E4%B9%8B%E7%88%B6%E5%AE%89%E7%89%B9%E9%9B%B7%E5%85%B9"><span class="toc-number">1.1.2.</span> <span class="toc-text">Redis之父安特雷兹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%83%BD%E5%B9%B2%E5%90%97"><span class="toc-number">1.2.</span> <span class="toc-text">能干吗</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E6%B5%81%E5%8A%9F%E8%83%BD%E4%B8%8E%E5%BA%94%E7%94%A8"><span class="toc-number">1.2.1.</span> <span class="toc-text">主流功能与应用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis%E5%8A%9F%E8%83%BD%E5%9B%BE%E8%A7%A3"><span class="toc-number">1.2.2.</span> <span class="toc-text">Redis功能图解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis%E4%BC%98%E5%8A%BF"><span class="toc-number">1.2.3.</span> <span class="toc-text">Redis优势</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Redis-%E4%B8%8E%E5%85%B6%E4%BB%96-key-value-%E5%AD%98%E5%82%A8%E6%9C%89%E4%BB%80%E4%B9%88%E4%B8%8D%E5%90%8C%EF%BC%9F"><span class="toc-number">1.2.3.1.</span> <span class="toc-text">Redis 与其他 key-value 存储有什么不同？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%A7%E8%83%BD%E6%9E%81%E9%AB%98"><span class="toc-number">1.2.3.2.</span> <span class="toc-text">性能极高</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E4%B8%B0%E5%AF%8C"><span class="toc-number">1.2.3.3.</span> <span class="toc-text">数据类型丰富</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%94%AF%E6%8C%81%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-number">1.2.3.4.</span> <span class="toc-text">支持数据持久化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%94%AF%E6%8C%81%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD"><span class="toc-number">1.2.3.5.</span> <span class="toc-text">支持数据备份</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%8F%E6%80%BB%E7%BB%93"><span class="toc-number">1.2.4.</span> <span class="toc-text">小总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%BB%E5%93%AA%E4%B8%8B"><span class="toc-number">1.3.</span> <span class="toc-text">去哪下</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%98%E7%BD%91"><span class="toc-number">1.3.1.</span> <span class="toc-text">官网</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E6%96%87%E6%A1%A3%E8%B5%84%E6%96%99"><span class="toc-number">1.3.2.</span> <span class="toc-text">其他文档资料</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%8E%E4%B9%88%E7%8E%A9"><span class="toc-number">1.4.</span> <span class="toc-text">怎么玩</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis%E8%BF%AD%E4%BB%A3%E6%BC%94%E5%8C%96%E5%92%8CRedis7%E6%96%B0%E7%89%B9%E6%80%A7"><span class="toc-number">1.5.</span> <span class="toc-text">Redis迭代演化和Redis7新特性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis%E7%89%88%E6%9C%AC%E5%8D%87%E7%BA%A7"><span class="toc-number">1.5.1.</span> <span class="toc-text">Redis版本升级</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%84%E7%89%88%E6%9C%AC%E6%8A%B5%E8%BE%BE%E5%8F%8A%E6%8E%A8%E6%BC%94%E8%BF%87%E7%A8%8B"><span class="toc-number">1.5.2.</span> <span class="toc-text">各版本抵达及推演过程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%87%8C%E7%A8%8B%E7%A2%91%E7%9A%84%E9%87%8D%E8%A6%81%E7%89%88%E6%9C%AC"><span class="toc-number">1.5.2.1.</span> <span class="toc-text">里程碑的重要版本</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%84%E7%89%88%E6%9C%AC%E5%91%BD%E5%90%8D%E8%A7%84%E5%88%99"><span class="toc-number">1.5.2.2.</span> <span class="toc-text">各版本命名规则</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis7%E6%96%B0%E7%89%B9%E6%80%A7"><span class="toc-number">1.5.3.</span> <span class="toc-text">Redis7新特性</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Redis7%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7%E6%A6%82%E8%A7%88"><span class="toc-number">1.5.3.1.</span> <span class="toc-text">Redis7核心特性概览</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Redis-Functions"><span class="toc-number">1.5.3.2.</span> <span class="toc-text">Redis Functions</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Client-eviction"><span class="toc-number">1.5.3.3.</span> <span class="toc-text">Client-eviction</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Muti-part-AOF"><span class="toc-number">1.5.3.4.</span> <span class="toc-text">Muti-part AOF</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ACL-V2"><span class="toc-number">1.5.3.5.</span> <span class="toc-text">ACL V2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B0%E5%A2%9E%E5%91%BD%E4%BB%A4"><span class="toc-number">1.5.3.6.</span> <span class="toc-text">新增命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#listpack%E4%BB%A3%E6%9B%BFziplist"><span class="toc-number">1.5.3.7.</span> <span class="toc-text">listpack代替ziplist</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BA%95%E5%B1%82%E6%80%A7%E8%83%BD%E6%8F%90%E7%A4%BA"><span class="toc-number">1.5.3.8.</span> <span class="toc-text">底层性能提示</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE"><span class="toc-number">2.</span> <span class="toc-text">Redis安装配置</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Windows%E5%AE%89%E8%A3%85"><span class="toc-number">2.1.</span> <span class="toc-text">Windows安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Linux%E5%AE%89%E8%A3%85"><span class="toc-number">2.2.</span> <span class="toc-text">Linux安装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%86%E5%A4%87gcc%E7%BC%96%E8%AF%91%E7%8E%AF%E5%A2%83"><span class="toc-number">2.2.1.</span> <span class="toc-text">准备gcc编译环境</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFgcc"><span class="toc-number">2.2.1.1.</span> <span class="toc-text">什么是gcc</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85gcc"><span class="toc-number">2.2.1.2.</span> <span class="toc-text">安装gcc</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8Bgcc%E7%89%88%E6%9C%AC"><span class="toc-number">2.2.1.3.</span> <span class="toc-text">查看gcc版本</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis%E5%AE%89%E8%A3%85%E6%AD%A5%E9%AA%A4"><span class="toc-number">2.2.2.</span> <span class="toc-text">Redis安装步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81%E4%B8%8B%E8%BD%BD%E8%8E%B7%E5%BE%97%E5%AE%89%E8%A3%85%E5%8C%85"><span class="toc-number">2.2.2.1.</span> <span class="toc-text">1、下载获得安装包</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81%E8%A7%A3%E5%8E%8B%E6%96%87%E4%BB%B6"><span class="toc-number">2.2.2.2.</span> <span class="toc-text">2、解压文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E3%80%81%E6%89%A7%E8%A1%8Cmake%E5%91%BD%E4%BB%A4"><span class="toc-number">2.2.2.3.</span> <span class="toc-text">3、执行make命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%E3%80%81%E5%B0%86%E9%BB%98%E8%AE%A4%E7%9A%84redis-con%E6%8B%B7%E8%B4%9D%E5%88%B0%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9B%AE%E5%BD%95"><span class="toc-number">2.2.2.4.</span> <span class="toc-text">4、将默认的redis.con拷贝到自定义目录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5%E3%80%81%E4%BF%AE%E6%94%B9%E5%A4%87%E4%BB%BD%E7%9B%AE%E5%BD%95%E4%B8%8Bredis-conf%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%81%9A%E5%88%9D%E5%A7%8B%E5%8C%96%E8%AE%BE%E7%BD%AE"><span class="toc-number">2.2.2.5.</span> <span class="toc-text">5、修改备份目录下redis.conf配置文件做初始化设置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6%E3%80%81%E5%90%AF%E5%8A%A8%E6%9C%8D%E5%8A%A1"><span class="toc-number">2.2.2.6.</span> <span class="toc-text">6、启动服务</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#redis-cli%E8%BF%9E%E6%8E%A5%E5%92%8C%E2%80%9C%E4%B9%92%E4%B9%93%E7%90%83%E2%80%9D"><span class="toc-number">2.2.2.6.1.</span> <span class="toc-text">redis-cli连接和“乒乓球”</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E8%AD%A6%E5%91%8A%E9%97%AE%E9%A2%98"><span class="toc-number">2.2.2.6.2.</span> <span class="toc-text">解决警告问题</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7%E3%80%816379%E7%AB%AF%E5%8F%A3%E7%9A%84%E7%94%B1%E6%9D%A5"><span class="toc-number">2.2.2.7.</span> <span class="toc-text">7、6379端口的由来</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8%E3%80%81helloworld%E5%B0%8F%E7%BB%83%E4%B9%A0"><span class="toc-number">2.2.2.8.</span> <span class="toc-text">8、helloworld小练习</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9%E3%80%81%E5%85%B3%E9%97%AD%E5%AE%9E%E4%BE%8B"><span class="toc-number">2.2.2.9.</span> <span class="toc-text">9、关闭实例</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker%E5%AE%89%E8%A3%85"><span class="toc-number">2.3.</span> <span class="toc-text">Docker安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis%E5%8D%B8%E8%BD%BD"><span class="toc-number">2.4.</span> <span class="toc-text">Redis卸载</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%81%9C%E6%AD%A2redis-server%E6%9C%8D%E5%8A%A1"><span class="toc-number">2.4.1.</span> <span class="toc-text">停止redis-server服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4-usr-local-lib-%E7%9B%AE%E5%BD%95%E4%B8%8B%E4%B8%8Eredis%E7%9B%B8%E5%85%B3%E7%9A%84%E6%96%87%E4%BB%B6"><span class="toc-number">2.4.2.</span> <span class="toc-text">删除 /usr/local/lib 目录下与redis相关的文件</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis%E5%8D%81%E5%A4%A7%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.</span> <span class="toc-text">Redis十大数据类型</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#String%EF%BC%88%E5%AD%97%E7%AC%A6%E4%B8%B2%EF%BC%89"><span class="toc-number">3.1.</span> <span class="toc-text">String（字符串）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#List%EF%BC%88%E5%88%97%E8%A1%A8%EF%BC%89"><span class="toc-number">3.2.</span> <span class="toc-text">List（列表）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#hash%EF%BC%88%E5%93%88%E5%B8%8C%EF%BC%89"><span class="toc-number">3.3.</span> <span class="toc-text">hash（哈希）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Set%EF%BC%88%E9%9B%86%E5%90%88%EF%BC%89"><span class="toc-number">3.4.</span> <span class="toc-text">Set（集合）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#zset%EF%BC%88sorted-set%EF%BC%9A%E6%9C%89%E5%BA%8F%E9%9B%86%E5%90%88%EF%BC%89"><span class="toc-number">3.5.</span> <span class="toc-text">zset（sorted set：有序集合）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GEO%EF%BC%88%E5%9C%B0%E7%90%86%E7%A9%BA%E9%97%B4%EF%BC%89"><span class="toc-number">3.6.</span> <span class="toc-text">GEO（地理空间）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HyperLogLog%EF%BC%88%E5%9F%BA%E6%95%B0%E7%BB%9F%E8%AE%A1%EF%BC%89"><span class="toc-number">3.7.</span> <span class="toc-text">HyperLogLog（基数统计）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Bitmap%EF%BC%88%E4%BD%8D%E5%9B%BE%EF%BC%89"><span class="toc-number">3.8.</span> <span class="toc-text">Bitmap（位图）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Bitfield%EF%BC%88%E4%BD%8D%E5%9F%9F%EF%BC%89"><span class="toc-number">3.9.</span> <span class="toc-text">Bitfield（位域）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Stream%EF%BC%88%E6%B5%81%EF%BC%89"><span class="toc-number">3.10.</span> <span class="toc-text">Stream（流）</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">4.</span> <span class="toc-text">Redis常用命令</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E6%9F%A5%E6%89%BE%E5%91%BD%E4%BB%A4"><span class="toc-number">4.1.</span> <span class="toc-text">如何查找命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis-keys-%E5%91%BD%E4%BB%A4"><span class="toc-number">4.2.</span> <span class="toc-text">Redis keys 命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%91%BD%E4%BB%A4"><span class="toc-number">4.3.</span> <span class="toc-text">各数据类型命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#String%EF%BC%88%E5%AD%97%E7%AC%A6%E4%B8%B2%EF%BC%89-1"><span class="toc-number">4.3.1.</span> <span class="toc-text">String（字符串）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4"><span class="toc-number">4.3.1.1.</span> <span class="toc-text">基本命令</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AEkey"><span class="toc-number">4.3.1.1.1.</span> <span class="toc-text">设置key</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96key"><span class="toc-number">4.3.1.1.2.</span> <span class="toc-text">获取key</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8C%E6%97%B6%E8%AE%BE%E7%BD%AE-%E8%8E%B7%E5%8F%96%E5%A4%9A%E4%B8%AA%E9%94%AE%E5%80%BC"><span class="toc-number">4.3.1.2.</span> <span class="toc-text">同时设置/获取多个键值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%8C%87%E5%AE%9A%E5%8C%BA%E9%97%B4%E8%8C%83%E5%9B%B4%E5%86%85%E7%9A%84%E5%80%BC"><span class="toc-number">4.3.1.3.</span> <span class="toc-text">获取指定区间范围内的值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E5%80%BC%E5%A2%9E%E5%87%8F"><span class="toc-number">4.3.1.4.</span> <span class="toc-text">数值增减</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E9%95%BF%E5%BA%A6%E4%BB%A5%E5%8F%8A%E5%86%85%E5%AE%B9%E8%BF%BD%E5%8A%A0"><span class="toc-number">4.3.1.5.</span> <span class="toc-text">获取字符串长度以及内容追加</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81"><span class="toc-number">4.3.1.6.</span> <span class="toc-text">分布式锁</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#List%EF%BC%88%E5%88%97%E8%A1%A8%EF%BC%89-1"><span class="toc-number">4.3.2.</span> <span class="toc-text">List（列表）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hash%EF%BC%88%E5%93%88%E5%B8%8C%EF%BC%89-1"><span class="toc-number">4.3.3.</span> <span class="toc-text">hash（哈希）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Set%EF%BC%88%E9%9B%86%E5%90%88%EF%BC%89-1"><span class="toc-number">4.3.4.</span> <span class="toc-text">Set（集合）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">4.3.4.1.</span> <span class="toc-text">常用命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9B%86%E5%90%88%E8%BF%90%E7%AE%97"><span class="toc-number">4.3.4.2.</span> <span class="toc-text">集合运算</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">4.3.4.3.</span> <span class="toc-text">应用场景</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#zset%EF%BC%88sorted-set%EF%BC%9A%E6%9C%89%E5%BA%8F%E9%9B%86%E5%90%88%EF%BC%89-1"><span class="toc-number">4.3.5.</span> <span class="toc-text">zset（sorted set：有序集合）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4-1"><span class="toc-number">4.3.5.1.</span> <span class="toc-text">常用命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF-1"><span class="toc-number">4.3.5.2.</span> <span class="toc-text">应用场景</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Bitmap%EF%BC%88%E4%BD%8D%E5%9B%BE%EF%BC%89-1"><span class="toc-number">4.3.6.</span> <span class="toc-text">Bitmap（位图）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4-1"><span class="toc-number">4.3.6.1.</span> <span class="toc-text">基本命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF-2"><span class="toc-number">4.3.6.2.</span> <span class="toc-text">应用场景</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HyperLogLog%EF%BC%88%E5%9F%BA%E6%95%B0%E7%BB%9F%E8%AE%A1%EF%BC%89-1"><span class="toc-number">4.3.7.</span> <span class="toc-text">HyperLogLog（基数统计）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%95%B0%E7%BB%9F%E8%AE%A1%E4%BB%8B%E7%BB%8D"><span class="toc-number">4.3.7.1.</span> <span class="toc-text">基数统计介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%9C%BA%E6%99%AF"><span class="toc-number">4.3.7.2.</span> <span class="toc-text">需求场景</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4-2"><span class="toc-number">4.3.7.3.</span> <span class="toc-text">基本命令</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GEO%EF%BC%88%E5%9C%B0%E7%90%86%E7%A9%BA%E9%97%B4%EF%BC%89-1"><span class="toc-number">4.3.8.</span> <span class="toc-text">GEO（地理空间）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E4%BB%8B%E7%BB%8D"><span class="toc-number">4.3.8.1.</span> <span class="toc-text">相关介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%9F%E7%90%86"><span class="toc-number">4.3.8.2.</span> <span class="toc-text">原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4-2"><span class="toc-number">4.3.8.3.</span> <span class="toc-text">常用命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#georadius%E3%80%81georadiusbymember"><span class="toc-number">4.3.8.4.</span> <span class="toc-text">georadius、georadiusbymember</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Redis-GEO"><span class="toc-number">4.3.8.5.</span> <span class="toc-text">Redis GEO</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Stream%EF%BC%88%E6%B5%81%EF%BC%89-1"><span class="toc-number">4.3.9.</span> <span class="toc-text">Stream（流）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Redis%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%96%B9%E6%A1%88"><span class="toc-number">4.3.9.1.</span> <span class="toc-text">Redis消息队列的两种方案</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#List"><span class="toc-number">4.3.9.1.1.</span> <span class="toc-text">List</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%91%E5%B8%83-%E8%AE%A2%E9%98%85"><span class="toc-number">4.3.9.1.2.</span> <span class="toc-text">发布/订阅</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BA%95%E5%B1%82%E7%BB%93%E6%9E%84%E5%92%8C%E5%8E%9F%E7%90%86%E8%AF%B4%E6%98%8E"><span class="toc-number">4.3.9.2.</span> <span class="toc-text">底层结构和原理说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4-3"><span class="toc-number">4.3.9.3.</span> <span class="toc-text">基本命令</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#XADD"><span class="toc-number">4.3.9.3.1.</span> <span class="toc-text">XADD</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#XRANGE"><span class="toc-number">4.3.9.3.2.</span> <span class="toc-text">XRANGE</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#XREVRANGE"><span class="toc-number">4.3.9.3.3.</span> <span class="toc-text">XREVRANGE</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#XDEL"><span class="toc-number">4.3.9.3.4.</span> <span class="toc-text">XDEL</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#XTRIM"><span class="toc-number">4.3.9.3.5.</span> <span class="toc-text">XTRIM</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#XREAD"><span class="toc-number">4.3.9.3.6.</span> <span class="toc-text">XREAD</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#XGROUP-CREATE"><span class="toc-number">4.3.9.4.</span> <span class="toc-text">XGROUP CREATE</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#XREADGROUP-GROUP"><span class="toc-number">4.3.9.5.</span> <span class="toc-text">XREADGROUP GROUP</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#XPENGING"><span class="toc-number">4.3.9.6.</span> <span class="toc-text">XPENGING</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#XACK"><span class="toc-number">4.3.9.7.</span> <span class="toc-text">XACK</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#XINFO"><span class="toc-number">4.3.9.8.</span> <span class="toc-text">XINFO</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Bitmap%EF%BC%88%E4%BD%8D%E5%9B%BE%EF%BC%89-2"><span class="toc-number">4.3.10.</span> <span class="toc-text">Bitmap（位图）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95%E5%91%BD%E4%BB%A4"><span class="toc-number">4.3.10.1.</span> <span class="toc-text">基本语法命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%8D%E5%9F%9F%E4%BF%AE%E6%94%B9"><span class="toc-number">4.3.10.2.</span> <span class="toc-text">位域修改</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%BA%A2%E5%87%BA%E6%8E%A7%E5%88%B6"><span class="toc-number">4.3.10.3.</span> <span class="toc-text">溢出控制</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-number">5.</span> <span class="toc-text">Redis持久化</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E4%BD%93%E4%BB%8B%E7%BB%8D"><span class="toc-number">5.1.</span> <span class="toc-text">总体介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RDB%EF%BC%88Redis-DataBase%EF%BC%89"><span class="toc-number">5.2.</span> <span class="toc-text">RDB（Redis DataBase）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%98%E7%BD%91%E4%BB%8B%E7%BB%8D"><span class="toc-number">5.2.1.</span> <span class="toc-text">官网介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8"><span class="toc-number">5.2.2.</span> <span class="toc-text">作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E6%BC%94%E7%A4%BA"><span class="toc-number">5.2.3.</span> <span class="toc-text">案例演示</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%8F%98%E5%8C%96"><span class="toc-number">5.2.3.1.</span> <span class="toc-text">配置文件变化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4"><span class="toc-number">5.2.3.2.</span> <span class="toc-text">操作步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E8%A7%A6%E5%8F%91%EF%BC%9A"><span class="toc-number">5.2.3.2.1.</span> <span class="toc-text">自动触发：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%89%8B%E5%8A%A8%E8%A7%A6%E5%8F%91%EF%BC%9A"><span class="toc-number">5.2.3.2.2.</span> <span class="toc-text">手动触发：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RDB%E4%BC%98%E5%8A%BF"><span class="toc-number">5.2.4.</span> <span class="toc-text">RDB优势</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%98%E7%BD%91%E8%AF%B4%E6%98%8E"><span class="toc-number">5.2.4.1.</span> <span class="toc-text">官网说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%8F%E6%80%BB%E7%BB%93-1"><span class="toc-number">5.2.4.2.</span> <span class="toc-text">小总结</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RDB%E5%8A%A3%E5%8A%BF"><span class="toc-number">5.2.5.</span> <span class="toc-text">RDB劣势</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%98%E7%BD%91%E8%AF%B4%E6%98%8E-1"><span class="toc-number">5.2.5.1.</span> <span class="toc-text">官网说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%8F%E6%80%BB%E7%BB%93-2"><span class="toc-number">5.2.5.2.</span> <span class="toc-text">小总结</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E4%B8%A2%E5%A4%B1%E6%A1%88%E4%BE%8B"><span class="toc-number">5.2.6.</span> <span class="toc-text">数据丢失案例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E4%BF%AE%E5%A4%8Ddump-rdb%E6%96%87%E4%BB%B6%EF%BC%9F"><span class="toc-number">5.2.7.</span> <span class="toc-text">如何修复dump.rdb文件？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%93%AA%E4%BA%9B%E6%83%85%E5%86%B5%E4%BC%9A%E8%A7%A6%E5%8F%91RDB%E5%BF%AB%E7%85%A7%EF%BC%9F"><span class="toc-number">5.2.8.</span> <span class="toc-text">哪些情况会触发RDB快照？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E7%A6%81%E7%94%A8RDB%E5%BF%AB%E7%85%A7%EF%BC%9F"><span class="toc-number">5.2.9.</span> <span class="toc-text">如何禁用RDB快照？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RDB%E4%BC%98%E5%8C%96%E9%85%8D%E7%BD%AE%E9%A1%B9"><span class="toc-number">5.2.10.</span> <span class="toc-text">RDB优化配置项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%8F%E6%80%BB%E7%BB%93-3"><span class="toc-number">5.2.11.</span> <span class="toc-text">小总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AOF%EF%BC%88Append-Only-File%EF%BC%89"><span class="toc-number">5.3.</span> <span class="toc-text">AOF（Append Only File）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%98%E7%BD%91%E4%BB%8B%E7%BB%8D-1"><span class="toc-number">5.3.1.</span> <span class="toc-text">官网介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AOF%E6%8C%81%E4%B9%85%E5%8C%96%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="toc-number">5.3.2.</span> <span class="toc-text">AOF持久化工作流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AOF%E7%BC%93%E5%86%B2%E5%8C%BA%E4%B8%89%E7%A7%8D%E5%86%99%E5%9B%9E%E7%AD%96%E7%95%A5"><span class="toc-number">5.3.3.</span> <span class="toc-text">AOF缓冲区三种写回策略</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AOF%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%B4%E6%98%8E"><span class="toc-number">5.3.4.</span> <span class="toc-text">AOF配置文件说明</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%BC%80%E5%90%AFAOF"><span class="toc-number">5.3.4.1.</span> <span class="toc-text">如何开启AOF?</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AOF%E6%96%87%E4%BB%B6%E4%BF%9D%E5%AD%98%E8%B7%AF%E5%BE%84"><span class="toc-number">5.3.4.2.</span> <span class="toc-text">AOF文件保存路径</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AOF%E6%96%87%E4%BB%B6%E4%BF%9D%E5%AD%98%E5%90%8D%E7%A7%B0"><span class="toc-number">5.3.4.3.</span> <span class="toc-text">AOF文件保存名称</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AOF%E4%BF%AE%E5%A4%8D-%E6%81%A2%E5%A4%8D"><span class="toc-number">5.3.5.</span> <span class="toc-text">AOF修复/恢复</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%AD%A3%E5%B8%B8%E6%81%A2%E5%A4%8D"><span class="toc-number">5.3.5.1.</span> <span class="toc-text">正常恢复</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%82%E5%B8%B8%E4%BF%AE%E5%A4%8D"><span class="toc-number">5.3.5.2.</span> <span class="toc-text">异常修复</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AOF%E4%BC%98%E5%8A%BF"><span class="toc-number">5.3.6.</span> <span class="toc-text">AOF优势</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AOF%E5%8A%A3%E5%8A%BF"><span class="toc-number">5.3.7.</span> <span class="toc-text">AOF劣势</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AOF%E9%87%8D%E5%86%99%E6%9C%BA%E5%88%B6"><span class="toc-number">5.3.8.</span> <span class="toc-text">AOF重写机制</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D"><span class="toc-number">5.3.8.1.</span> <span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A6%E5%8F%91%E6%9C%BA%E5%88%B6"><span class="toc-number">5.3.8.2.</span> <span class="toc-text">触发机制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AOF%E9%87%8D%E5%86%99%E5%8E%9F%E7%90%86"><span class="toc-number">5.3.8.3.</span> <span class="toc-text">AOF重写原理</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AOF%E4%BC%98%E5%8C%96%E9%85%8D%E7%BD%AE%E9%A1%B9%E8%AF%A6%E8%A7%A3"><span class="toc-number">5.3.9.</span> <span class="toc-text">AOF优化配置项详解</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%8F%E6%80%BB%E7%BB%93-4"><span class="toc-number">5.3.9.1.</span> <span class="toc-text">小总结</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RDB-AOF%E6%B7%B7%E5%90%88%E6%A8%A1%E5%BC%8F"><span class="toc-number">5.4.</span> <span class="toc-text">RDB + AOF混合模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BA%AF%E7%BC%93%E5%AD%98%E6%A8%A1%E5%BC%8F"><span class="toc-number">5.5.</span> <span class="toc-text">纯缓存模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A6%81%E7%94%A8AOF"><span class="toc-number">5.5.1.</span> <span class="toc-text">禁用AOF</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis-%E4%BA%8B%E5%8A%A1"><span class="toc-number">6.</span> <span class="toc-text">Redis 事务</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D-1"><span class="toc-number">6.1.</span> <span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8-1"><span class="toc-number">6.2.</span> <span class="toc-text">作用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis%E4%BA%8B%E5%8A%A1%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8B%E5%8A%A1%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">6.3.</span> <span class="toc-text">Redis事务与数据库事务的区别</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8"><span class="toc-number">6.4.</span> <span class="toc-text">使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4-3"><span class="toc-number">6.4.1.</span> <span class="toc-text">常用命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8D%E7%94%A8%E5%9C%BA%E6%99%AF%E8%AF%B4%E6%98%8E"><span class="toc-number">6.4.2.</span> <span class="toc-text">不用场景说明</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%BA%E6%99%AF%E4%B8%80%EF%BC%9A%E6%AD%A3%E5%B8%B8%E6%89%A7%E8%A1%8C"><span class="toc-number">6.4.2.1.</span> <span class="toc-text">场景一：正常执行</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%BA%E6%99%AF%E4%BA%8C%EF%BC%9A%E6%94%BE%E5%BC%83%E4%BA%8B%E5%8A%A1"><span class="toc-number">6.4.2.2.</span> <span class="toc-text">场景二：放弃事务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%BA%E6%99%AF%E4%B8%89%EF%BC%9A%E5%85%A8%E4%BD%93%E8%BF%9E%E5%9D%90"><span class="toc-number">6.4.2.3.</span> <span class="toc-text">场景三：全体连坐</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%BA%E6%99%AF%E5%9B%9B%EF%BC%9A%E5%86%A4%E5%A4%B4%E5%80%BA%E4%B8%BB"><span class="toc-number">6.4.2.4.</span> <span class="toc-text">场景四：冤头债主</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%BA%E6%99%AF%E4%BA%94%EF%BC%9Awatch%E7%9B%91%E6%8E%A7"><span class="toc-number">6.4.2.5.</span> <span class="toc-text">场景五：watch监控</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis%E4%BA%8B%E5%8A%A1%E6%80%BB%E7%BB%93"><span class="toc-number">6.5.</span> <span class="toc-text">Redis事务总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis%E7%AE%A1%E9%81%93%EF%BC%88pipeline%EF%BC%89"><span class="toc-number">7.</span> <span class="toc-text">Redis管道（pipeline）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E4%BC%98%E5%8C%96%E9%A2%91%E7%B9%81%E5%91%BD%E4%BB%A4%E5%BE%80%E8%BF%94%E9%80%A0%E6%88%90%E7%9A%84%E6%80%A7%E8%83%BD%E7%93%B6%E9%A2%88%EF%BC%9F"><span class="toc-number">7.1.</span> <span class="toc-text">如何优化频繁命令往返造成的性能瓶颈？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis%E7%AE%A1%E9%81%93%E4%BB%8B%E7%BB%8D"><span class="toc-number">7.2.</span> <span class="toc-text">Redis管道介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E6%BC%94%E7%A4%BA-1"><span class="toc-number">7.3.</span> <span class="toc-text">案例演示</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis%E7%AE%A1%E9%81%93%E5%B0%8F%E6%80%BB%E7%BB%93"><span class="toc-number">7.4.</span> <span class="toc-text">Redis管道小总结</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Pipeline%E4%B8%8E%E5%8E%9F%E7%94%9F%E6%89%B9%E9%87%8F%E5%91%BD%E4%BB%A4%E5%AF%B9%E6%AF%94"><span class="toc-number">7.4.1.</span> <span class="toc-text">Pipeline与原生批量命令对比</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Pipeline%E4%B8%8ERedis%E4%BA%8B%E5%8A%A1%E5%AF%B9%E6%AF%94"><span class="toc-number">7.4.2.</span> <span class="toc-text">Pipeline与Redis事务对比</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8Pipeline%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number">7.5.</span> <span class="toc-text">使用Pipeline注意事项</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85"><span class="toc-number">8.</span> <span class="toc-text">Redis发布订阅</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D-2"><span class="toc-number">8.1.</span> <span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8-2"><span class="toc-number">8.2.</span> <span class="toc-text">作用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4-4"><span class="toc-number">8.3.</span> <span class="toc-text">常用命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%BA%E7%82%B9"><span class="toc-number">8.4.</span> <span class="toc-text">缺点</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis%E5%A4%8D%E5%88%B6%EF%BC%88Replication%EF%BC%89"><span class="toc-number">9.</span> <span class="toc-text">Redis复制（Replication）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D-3"><span class="toc-number">9.1.</span> <span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8-3"><span class="toc-number">9.2.</span> <span class="toc-text">作用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-1"><span class="toc-number">9.3.</span> <span class="toc-text">使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F%E7%82%B9"><span class="toc-number">9.3.1.</span> <span class="toc-text">注意点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4-4"><span class="toc-number">9.3.2.</span> <span class="toc-text">基本命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E6%BC%94%E7%A4%BA-2"><span class="toc-number">9.3.3.</span> <span class="toc-text">案例演示</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9E%B6%E6%9E%84%E8%AF%B4%E6%98%8E"><span class="toc-number">9.3.3.1.</span> <span class="toc-text">架构说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-1"><span class="toc-number">9.3.3.2.</span> <span class="toc-text">操作步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%BB%86%E8%8A%82"><span class="toc-number">9.3.4.</span> <span class="toc-text">修改配置文件细节</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%89%E5%A4%A7%E5%91%BD%E4%BB%A4"><span class="toc-number">9.3.4.1.</span> <span class="toc-text">三大命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%80%E4%B8%BB%E4%BA%8C%E4%BB%86"><span class="toc-number">9.3.4.2.</span> <span class="toc-text">一主二仆</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B0%E8%B4%A7%E7%9B%B8%E4%BC%A0"><span class="toc-number">9.3.4.3.</span> <span class="toc-text">新货相传</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%8D%E5%AE%A2%E4%B8%BA%E4%B8%BB"><span class="toc-number">9.3.4.4.</span> <span class="toc-text">反客为主</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%8D%E5%88%B6%E5%8E%9F%E7%90%86%E5%92%8C%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="toc-number">9.4.</span> <span class="toc-text">复制原理和工作流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%8D%E5%88%B6%E7%BC%BA%E7%82%B9"><span class="toc-number">9.5.</span> <span class="toc-text">复制缺点</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis%E5%93%A8%E5%85%B5%EF%BC%88Sentinel%EF%BC%89"><span class="toc-number">10.</span> <span class="toc-text">Redis哨兵（Sentinel）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D-4"><span class="toc-number">10.1.</span> <span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8-4"><span class="toc-number">10.2.</span> <span class="toc-text">作用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BB%E8%A6%81%E5%8A%9F%E8%83%BD"><span class="toc-number">10.3.</span> <span class="toc-text">主要功能</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E6%88%98%E6%BC%94%E7%BB%83"><span class="toc-number">10.4.</span> <span class="toc-text">实战演练</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%B6%E6%9E%84%E8%AF%B4%E6%98%8E-1"><span class="toc-number">10.4.1.</span> <span class="toc-text">架构说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E6%AD%A5%E9%AA%A4"><span class="toc-number">10.4.2.</span> <span class="toc-text">案例步骤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sentinel-conf%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E"><span class="toc-number">10.4.3.</span> <span class="toc-text">sentinel.conf参数说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%8F%98%E5%8C%96-1"><span class="toc-number">10.4.4.</span> <span class="toc-text">配置文件变化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E8%AF%B4%E6%98%8E"><span class="toc-number">10.4.5.</span> <span class="toc-text">其他说明</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%93%A8%E5%85%B5%E8%BF%90%E8%A1%8C%E6%B5%81%E7%A8%8B%E5%92%8C%E9%80%89%E4%B8%BE%E5%8E%9F%E7%90%86"><span class="toc-number">10.5.</span> <span class="toc-text">哨兵运行流程和选举原理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81SDown%E4%B8%BB%E8%A7%82%E4%B8%8B%E7%BA%BF%EF%BC%88Subjectively-Down%EF%BC%89"><span class="toc-number">10.5.1.</span> <span class="toc-text">1、SDown主观下线（Subjectively Down）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81ODown%E5%AE%A2%E8%A7%82%E4%B8%8B%E7%BA%BF-Objectively-Down"><span class="toc-number">10.5.2.</span> <span class="toc-text">2、ODown客观下线(Objectively Down)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E9%80%89%E4%B8%BE%E5%87%BA%E9%A2%86%E5%AF%BC%E8%80%85%E5%93%A8%E5%85%B5%EF%BC%88%E5%93%A8%E5%85%B5%E4%B8%AD%E9%80%89%E5%87%BA%E5%85%B5%E7%8E%8B%EF%BC%89"><span class="toc-number">10.5.3.</span> <span class="toc-text">3、选举出领导者哨兵（哨兵中选出兵王）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E7%94%B1%E5%85%B5%E7%8E%8B%E5%BC%80%E5%A7%8B%E6%8E%A8%E5%8A%A8%E6%95%85%E9%9A%9C%E5%88%87%E6%8D%A2%E6%B5%81%E7%A8%8B%E5%B9%B6%E9%80%89%E5%87%BA%E4%B8%80%E4%B8%AA%E6%96%B0master"><span class="toc-number">10.5.4.</span> <span class="toc-text">4、由兵王开始推动故障切换流程并选出一个新master</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E6%AD%A5%EF%BC%9A%E6%96%B0%E4%B8%BB%E7%99%BB%E5%9F%BA"><span class="toc-number">10.5.4.1.</span> <span class="toc-text">第一步：新主登基</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E6%AD%A5%EF%BC%9A%E7%BE%A4%E8%87%A3%E4%BF%AF%E9%A6%96"><span class="toc-number">10.5.4.2.</span> <span class="toc-text">第二步：群臣俯首</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E6%AD%A5%EF%BC%9A%E6%97%A7%E4%B8%BB%E6%8B%9C%E6%9C%8D"><span class="toc-number">10.5.4.3.</span> <span class="toc-text">第三步：旧主拜服</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%8F%E6%80%BB%E7%BB%93-5"><span class="toc-number">10.5.4.4.</span> <span class="toc-text">小总结</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%93%A8%E5%85%B5%E4%BD%BF%E7%94%A8%E5%BB%BA%E8%AE%AE"><span class="toc-number">10.5.5.</span> <span class="toc-text">哨兵使用建议</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis%E9%9B%86%E7%BE%A4%EF%BC%88Cluster%EF%BC%89"><span class="toc-number">11.</span> <span class="toc-text">Redis集群（Cluster）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D-5"><span class="toc-number">11.1.</span> <span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8-5"><span class="toc-number">11.2.</span> <span class="toc-text">作用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9B%86%E7%BE%A4%E7%AE%97%E6%B3%95%EF%BC%9A%E5%88%86%E7%89%87-%E6%A7%BD%E4%BD%8D%EF%BC%88slot%EF%BC%89"><span class="toc-number">11.3.</span> <span class="toc-text">集群算法：分片-槽位（slot）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%98%E7%BD%91%E4%BB%8B%E7%BB%8D-2"><span class="toc-number">11.3.1.</span> <span class="toc-text">官网介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Slot%E4%BB%8B%E7%BB%8D"><span class="toc-number">11.3.2.</span> <span class="toc-text">Slot介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E7%89%87%E4%BB%8B%E7%BB%8D"><span class="toc-number">11.3.3.</span> <span class="toc-text">分片介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%92%E6%A7%BD%E5%92%8C%E5%88%86%E7%89%87%E7%9A%84%E4%BC%98%E5%8A%BF"><span class="toc-number">11.3.4.</span> <span class="toc-text">插槽和分片的优势</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Slot%E6%A7%BD%E4%BD%8D%E6%98%A0%E5%B0%84%E6%96%B9%E6%A1%88"><span class="toc-number">11.3.5.</span> <span class="toc-text">Slot槽位映射方案</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%A1%88%E4%B8%80%EF%BC%9A%E5%93%88%E5%B8%8C%E5%8F%96%E4%BD%99%E5%88%86%E5%8C%BA"><span class="toc-number">11.3.5.1.</span> <span class="toc-text">方案一：哈希取余分区</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%A1%88%E4%BA%8C%EF%BC%9A%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C%E7%AE%97%E6%B3%95%E5%88%86%E5%8C%BA"><span class="toc-number">11.3.5.2.</span> <span class="toc-text">方案二：一致性哈希算法分区</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%80%E8%87%B4%E6%80%A7Hash%E7%AE%97%E6%B3%95%E8%83%8C%E6%99%AF"><span class="toc-number">11.3.5.2.1.</span> <span class="toc-text">一致性Hash算法背景</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8-6"><span class="toc-number">11.3.5.2.2.</span> <span class="toc-text">作用</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4"><span class="toc-number">11.3.5.2.3.</span> <span class="toc-text">实现步骤</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BC%98%E7%82%B9"><span class="toc-number">11.3.5.2.4.</span> <span class="toc-text">优点</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BC%BA%E7%82%B9-1"><span class="toc-number">11.3.5.2.5.</span> <span class="toc-text">缺点</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B0%8F%E6%80%BB%E7%BB%93-6"><span class="toc-number">11.3.5.2.6.</span> <span class="toc-text">小总结</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%A1%88%E4%B8%89%EF%BC%9A%E5%93%88%E5%B8%8C%E6%A7%BD%E5%88%86%E5%8C%BA"><span class="toc-number">11.3.5.3.</span> <span class="toc-text">方案三：哈希槽分区</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BA%A7%E7%94%9F%E8%83%8C%E6%99%AF"><span class="toc-number">11.3.5.3.1.</span> <span class="toc-text">产生背景</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8-7"><span class="toc-number">11.3.5.3.2.</span> <span class="toc-text">作用</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A4%9A%E5%B0%91%E4%B8%AAhash-%E6%A7%BD%EF%BC%9F"><span class="toc-number">11.3.5.3.3.</span> <span class="toc-text">多少个hash 槽？</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88Redis%E9%9B%86%E7%BE%A4%E7%9A%84%E6%9C%80%E5%A4%A7%E6%A7%BD%E6%95%B0%E6%98%AF16384%E4%B8%AA%EF%BC%9F"><span class="toc-number">11.3.5.3.4.</span> <span class="toc-text">为什么Redis集群的最大槽数是16384个？</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E4%B8%AA%E6%B3%A8%E6%84%8F%E7%82%B9"><span class="toc-number">11.3.6.</span> <span class="toc-text">一个注意点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9B%86%E7%BE%A4%E7%8E%AF%E5%A2%83%E6%A1%88%E4%BE%8B%E6%AD%A5%E9%AA%A4"><span class="toc-number">11.4.</span> <span class="toc-text">集群环境案例步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E4%B8%BB%E4%B8%89%E4%BB%8ERedis%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE"><span class="toc-number">11.4.1.</span> <span class="toc-text">三主三从Redis集群配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E5%B9%B6%E6%A3%80%E9%AA%8C%E9%9B%86%E7%BE%A4%E7%8A%B6%E6%80%81"><span class="toc-number">11.4.2.</span> <span class="toc-text">查看并检验集群状态</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#info-replication"><span class="toc-number">11.4.2.1.</span> <span class="toc-text">info replication</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cluster-info"><span class="toc-number">11.4.2.2.</span> <span class="toc-text">cluster info</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BE%93%E5%87%BA%E5%86%85%E5%AE%B9%EF%BC%9A"><span class="toc-number">11.4.2.3.</span> <span class="toc-text">输出内容：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cluster-nodes"><span class="toc-number">11.4.2.4.</span> <span class="toc-text">cluster nodes</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BE%93%E5%87%BA%E5%86%85%E5%AE%B9%EF%BC%9A-1"><span class="toc-number">11.4.2.5.</span> <span class="toc-text">输出内容：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E4%B8%BB%E4%B8%89%E4%BB%8E%E9%9B%86%E7%BE%A4%E8%AF%BB%E5%86%99"><span class="toc-number">11.4.3.</span> <span class="toc-text">三主三从集群读写</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E4%BB%8E%E5%AE%B9%E9%94%99%E5%88%87%E6%8D%A2%E8%BF%81%E7%A7%BB%E6%A1%88%E4%BE%8B"><span class="toc-number">11.4.4.</span> <span class="toc-text">主从容错切换迁移案例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E6%BC%94%E7%A4%BA-3"><span class="toc-number">11.4.4.1.</span> <span class="toc-text">案例演示</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%8B%E5%8A%A8%E6%95%85%E9%9A%9C%E8%BF%81%E7%A7%BB-%E8%8A%82%E7%82%B9%E4%BB%8E%E5%B1%9E%E8%B0%83%E6%95%B4"><span class="toc-number">11.4.4.2.</span> <span class="toc-text">手动故障迁移/节点从属调整</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E6%A0%BC%E5%BC%8F"><span class="toc-number">11.4.5.</span> <span class="toc-text">命令格式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E"><span class="toc-number">11.4.5.1.</span> <span class="toc-text">参数说明</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD"><span class="toc-number">11.4.6.</span> <span class="toc-text">功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number">11.4.7.</span> <span class="toc-text">注意事项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B"><span class="toc-number">11.4.8.</span> <span class="toc-text">示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E4%BB%8E%E6%89%A9%E5%AE%B9%E6%A1%88%E4%BE%8B"><span class="toc-number">11.4.9.</span> <span class="toc-text">主从扩容案例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E4%BB%8E%E7%BC%A9%E5%AE%B9%E6%A1%88%E4%BE%8B"><span class="toc-number">11.4.10.</span> <span class="toc-text">主从缩容案例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9B%86%E7%BE%A4%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C%E5%91%BD%E4%BB%A4%E5%92%8CCRC16%E7%AE%97%E6%B3%95%E5%88%86%E6%9E%90"><span class="toc-number">11.5.</span> <span class="toc-text">集群常用操作命令和CRC16算法分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E8%AF%86%E5%8D%A0%E4%BD%8D%E7%AC%A6"><span class="toc-number">11.5.1.</span> <span class="toc-text">通识占位符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CRC16%E6%BA%90%E7%A0%81%E6%B5%85%E8%B0%88"><span class="toc-number">11.5.2.</span> <span class="toc-text">CRC16源码浅谈</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4-5"><span class="toc-number">11.5.3.</span> <span class="toc-text">常用命令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#cluster-require-full-coverage"><span class="toc-number">11.5.3.1.</span> <span class="toc-text">cluster-require-full-coverage</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CLUSTER-COUNTKEYSINSLOT-slot"><span class="toc-number">11.5.3.2.</span> <span class="toc-text">CLUSTER COUNTKEYSINSLOT slot</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CLUSTER-KEYSLOT-key"><span class="toc-number">11.5.4.</span> <span class="toc-text">CLUSTER KEYSLOT key</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SpringBoot%E9%9B%86%E6%88%90Redis"><span class="toc-number">12.</span> <span class="toc-text">SpringBoot集成Redis</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E4%BD%93%E6%A6%82%E8%BF%B0"><span class="toc-number">12.1.</span> <span class="toc-text">总体概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98"><span class="toc-number">12.2.</span> <span class="toc-text">常见问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9B%86%E6%88%90Jedis"><span class="toc-number">12.3.</span> <span class="toc-text">集成Jedis</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Jedis%E4%BB%8B%E7%BB%8D"><span class="toc-number">12.3.1.</span> <span class="toc-text">Jedis介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4"><span class="toc-number">12.3.2.</span> <span class="toc-text">步骤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#POM%E4%BE%9D%E8%B5%96"><span class="toc-number">12.3.3.</span> <span class="toc-text">POM依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#YML%E9%85%8D%E7%BD%AE"><span class="toc-number">12.3.4.</span> <span class="toc-text">YML配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E5%90%AF%E5%8A%A8%E7%B1%BB"><span class="toc-number">12.3.5.</span> <span class="toc-text">主启动类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B"><span class="toc-number">12.3.6.</span> <span class="toc-text">入门案例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9B%86%E6%88%90Lettuce"><span class="toc-number">12.4.</span> <span class="toc-text">集成Lettuce</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Lettuce%E4%BB%8B%E7%BB%8D"><span class="toc-number">12.4.1.</span> <span class="toc-text">Lettuce介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Jedis%E4%B8%8ELettuce%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">12.4.2.</span> <span class="toc-text">Jedis与Lettuce的区别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B"><span class="toc-number">12.4.3.</span> <span class="toc-text">案例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%94%B9POM"><span class="toc-number">12.4.3.1.</span> <span class="toc-text">改POM</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E7%B1%BB"><span class="toc-number">12.4.3.2.</span> <span class="toc-text">业务类</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9B%86%E6%88%90RedisTemplate%EF%BC%88%E6%8E%A8%E8%8D%90%EF%BC%89"><span class="toc-number">12.5.</span> <span class="toc-text">集成RedisTemplate（推荐）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E5%8D%95%E6%9C%BA"><span class="toc-number">12.5.1.</span> <span class="toc-text">连接单机</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%94%B9POM-1"><span class="toc-number">12.5.1.1.</span> <span class="toc-text">改POM</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%99YML"><span class="toc-number">12.5.1.2.</span> <span class="toc-text">写YML</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SwaggerConfig"><span class="toc-number">12.5.1.3.</span> <span class="toc-text">SwaggerConfig</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#controller"><span class="toc-number">12.5.1.4.</span> <span class="toc-text">controller</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#service"><span class="toc-number">12.5.1.5.</span> <span class="toc-text">service</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BA%8F%E5%88%97%E5%8F%B7%E9%97%AE%E9%A2%98"><span class="toc-number">12.5.1.6.</span> <span class="toc-text">序列号问题</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E9%9B%86%E7%BE%A4"><span class="toc-number">12.5.2.</span> <span class="toc-text">连接集群</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%94%B9YML"><span class="toc-number">12.5.2.1.</span> <span class="toc-text">改YML</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%AE%E9%A2%98"><span class="toc-number">12.5.2.2.</span> <span class="toc-text">问题</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/12/20/faa89baba309/" title="ChatGPT 桌面版免费发布：体验多种应用交互模式！"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/20/67655fe410474.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ChatGPT 桌面版免费发布：体验多种应用交互模式！"></a><div class="content"><a class="title" href="/2024/12/20/faa89baba309/" title="ChatGPT 桌面版免费发布：体验多种应用交互模式！">ChatGPT 桌面版免费发布：体验多种应用交互模式！</a><time datetime="2024-12-20T12:12:05.000Z" title="发表于 2024-12-20 20:12:05">2024-12-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/12/20/fddf53a80c95/" title="【尚硅谷】JVM-运行时内存篇"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/08/28/66cedaf5d014a.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【尚硅谷】JVM-运行时内存篇"></a><div class="content"><a class="title" href="/2024/12/20/fddf53a80c95/" title="【尚硅谷】JVM-运行时内存篇">【尚硅谷】JVM-运行时内存篇</a><time datetime="2024-12-20T03:27:30.000Z" title="发表于 2024-12-20 11:27:30">2024-12-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/12/19/e500390e9a1c/" title="【Hexo】安知鱼主题添加文章统计页面"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/19/67641af764140.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【Hexo】安知鱼主题添加文章统计页面"></a><div class="content"><a class="title" href="/2024/12/19/e500390e9a1c/" title="【Hexo】安知鱼主题添加文章统计页面">【Hexo】安知鱼主题添加文章统计页面</a><time datetime="2024-12-19T13:01:29.000Z" title="发表于 2024-12-19 21:01:29">2024-12-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/12/18/59743779c169/" title="【白嫖福利】注册US.KG免费域名"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/18/6762e71b2e658.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【白嫖福利】注册US.KG免费域名"></a><div class="content"><a class="title" href="/2024/12/18/59743779c169/" title="【白嫖福利】注册US.KG免费域名">【白嫖福利】注册US.KG免费域名</a><time datetime="2024-12-18T14:53:30.000Z" title="发表于 2024-12-18 22:53:30">2024-12-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/12/16/d5e9d59f93d4/" title="博客、论坛必备：一键填充评论区昵称、邮箱、网址"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/16/675fdff3aa4bb.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="博客、论坛必备：一键填充评论区昵称、邮箱、网址"></a><div class="content"><a class="title" href="/2024/12/16/d5e9d59f93d4/" title="博客、论坛必备：一键填充评论区昵称、邮箱、网址">博客、论坛必备：一键填充评论区昵称、邮箱、网址</a><time datetime="2024-12-16T06:35:35.000Z" title="发表于 2024-12-16 14:35:35">2024-12-16</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="footer_deal"><a class="deal_link" target="_blank" rel="noopener" href="https://github.com/shiguang-coding" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="deal_link" href="mailto:an_shiguang@163.com" title="email"><i class="anzhiyufont anzhiyu-icon-envelope"></i></a><img class="footer_mini_logo" title="返回顶部" alt="返回顶部" onclick="anzhiyu.scrollToDest(0, 500)" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/avatar.png" size="50px"><a class="deal_link" href="/atom.xml" title="RSS"><i class="anzhiyufont anzhiyu-icon-rss"></i></a><a class="deal_link" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC"><i class="anzhiyufont anzhiyu-icon-copyright-line"></i></a></div><div id="anzhiyu-footer"><div class="footer-group"><div class="footer-title">服务</div><div class="footer-links"><a class="footer-item" title="开往" target="_blank" rel="noopener" href="https://www.travellings.cn/go.html">开往</a><a class="footer-item" title="异次元之旅" target="_blank" rel="noopener" href="https://travel.moe/go.html?travel=on">异次元之旅</a><a class="footer-item" title="列表导航" target="_blank" rel="noopener" href="https://zhblogs.ohyee.cc/">列表导航</a><a class="footer-item" title="十年之约" target="_blank" rel="noopener" href="https://www.foreverblog.cn/">十年之约</a></div></div><div class="footer-group"><div class="footer-title">文章</div><div class="footer-links"><a class="footer-item" title="归档" href="/archives/">归档</a><a class="footer-item" title="分类" href="/categories/">分类</a><a class="footer-item" title="标签" href="/tags/">标签</a><a class="footer-item" title="RSS" href="/tom.xml">RSS</a></div></div><div class="footer-group"><div class="footer-title">导航</div><div class="footer-links"><a class="footer-item" title="即刻短文" href="/essay/">即刻短文</a><a class="footer-item" title="留言板" href="/comment/">留言板</a><a class="footer-item" title="关于我" href="/about/">关于我</a></div></div><div class="footer-group"><div class="footer-title-group"><div class="footer-title">友链</div><a class="random-friends-btn" id="footer-random-friends-btn" href="javascript:addFriendLinksInFooter();" title="换一批友情链接"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right"></i></a></div><div class="footer-links" id="friend-links-in-footer"></div></div></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" data-title="博客框架为Hexo_v5.4.0" title="博客框架为Hexo_v5.4.0"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Frame-Hexo.svg" alt="博客框架为Hexo_v5.4.0"></a><a class="github-badge" target="_blank" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" style="margin-inline:5px" data-title="本站使用AnZhiYu主题" title="本站使用AnZhiYu主题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.9/img/Theme-AnZhiYu-2E67D3.svg" alt="本站使用AnZhiYu主题"></a><a class="github-badge" target="_blank" href="https://icp.gov.moe/?keyword=blog.shiguangdev.cn" style="margin-inline:5px" data-title="萌ICP备20246006号" title="萌ICP备20246006号"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shields.io/badge/%E8%90%8Cicp%E5%A4%87-20246006%E5%8F%B7-FF1485" alt="萌ICP备20246006号"></a><a class="github-badge" target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px" data-title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可" title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.2.0/img/badge/Copyright-BY-NC-SA.svg" alt="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"></a></p></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">©2023 - 2025 By <a class="footer-bar-link" href="/" title="時光" target="_blank">時光</a></div></div><div id="footer-type-tips"></div><div class="js-pjax"><script>function subtitleType () {
  fetch('https://v1.hitokoto.cn')
    .then(response => response.json())
    .then(data => {
      if (true) {
        const from = '出自 ' + data.from
        const sub = []
        sub.unshift(data.hitokoto, from)
        window.typed = new Typed('#footer-type-tips', {
          strings: sub,
          startDelay: 300,
          typeSpeed: 150,
          loop: true,
          backSpeed: 50,
        })
      } else {
        document.getElementById('footer-type-tips').innerHTML = data.hitokoto
      }
    })
}

if (true) {
  if (typeof Typed === 'function') {
    subtitleType()
  } else {
    getScript('https://cdn.cbd.int/typed.js@2.1.0/dist/typed.umd.js').then(subtitleType)
  }
} else {
  subtitleType()
}
</script></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a><a class="footer-bar-link" target="_blank" rel="noopener" href="https://img.shiguangdev.cn/" title="图床">图床</a><a class="footer-bar-link" target="_blank" rel="noopener" href="https://beian.miit.gov.cn/" title="豫ICP备2024070732号">豫ICP备2024070732号</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">260</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">188</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">17</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://www.shiguang666.eu.org" title="時光主页"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="時光主页"><span class="back-menu-item-text">時光主页</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://nav.shiguang666.eu.org" title="時光导航站"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://nav.shiguang666.eu.org/images/logo-collapsed@2x.png" alt="時光导航站"><span class="back-menu-item-text">時光导航站</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://love.shiguang666.eu.org" title="表白生成器"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://love.shiguang666.eu.org/favicon.ico" alt="表白生成器"><span class="back-menu-item-text">表白生成器</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://publish.shiguang666.eu.org/" title="時光站点发布页"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/homepage.png" alt="時光站点发布页"><span class="back-menu-item-text">時光站点发布页</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://release.shiguang666.eu.org/" title="地址发布页"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/homepage.png" alt="地址发布页"><span class="back-menu-item-text">地址发布页</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://qq.shiguang666.eu.org/" title="時光的QQ"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/qqavatar.jpg" alt="時光的QQ"><span class="back-menu-item-text">時光的QQ</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://game.shiguang666.eu.org" title="怀旧游戏机"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/chat.png" alt="怀旧游戏机"><span class="back-menu-item-text">怀旧游戏机</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://games.shiguang666.eu.org" title="H5小游戏合集"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://echeverra.cn/wp-content/uploads/2021/06/cropped-thmub-32x32.jpg" alt="H5小游戏合集"><span class="back-menu-item-text">H5小游戏合集</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">后台管理</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://umami.shiguangdev.cn/share/1CY8KW6pqM0UBUIL/blog.shiguangdev.cn" title="访客统计"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://umami.shiguangdev.cn/favicon.ico" alt="访客统计"><span class="back-menu-item-text">访客统计</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://img.shiguangdev.cn/" title="時光图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/favicon.ico" alt="時光图床"><span class="back-menu-item-text">時光图床</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://qexo.shiguang666.eu.org/" title="Qexo"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://unpkg.com/qexo-static@2.2.3/qexo/images/icon.png" alt="Qexo"><span class="back-menu-item-text">Qexo</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 归档</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/charts/"><i class="fa fa-line-chart faa-tada"></i><span> 统计</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随机</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/news/"><i class="fa fa-newspaper faa-tada"></i><span> 早报亭</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/music/?id=10051718332&amp;server=netease"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/gallery/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/xjj/"><i class="fa fa-rocket faa-tada"></i><span> 养生堂</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><i class="anzhiyufont anzhiyu-icon-artstation faa-tada" style="font-size: 0.9em;"></i><span> 朋友圈</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comment/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于我</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/AI/" style="font-size: 0.88rem;">AI<sup>10</sup></a><a href="/tags/Alist/" style="font-size: 0.88rem;">Alist<sup>3</sup></a><a href="/tags/CentOS/" style="font-size: 0.88rem;">CentOS<sup>1</sup></a><a href="/tags/ChatGPT/" style="font-size: 0.88rem;">ChatGPT<sup>14</sup></a><a href="/tags/ChatGPt/" style="font-size: 0.88rem;">ChatGPt<sup>1</sup></a><a href="/tags/Chrome/" style="font-size: 0.88rem;">Chrome<sup>1</sup></a><a href="/tags/CloudFlare/" style="font-size: 0.88rem;">CloudFlare<sup>3</sup></a><a href="/tags/DNS/" style="font-size: 0.88rem;">DNS<sup>1</sup></a><a href="/tags/Ecology/" style="font-size: 0.88rem;">Ecology<sup>1</sup></a><a href="/tags/GPT-4o/" style="font-size: 0.88rem;">GPT-4o<sup>2</sup></a><a href="/tags/Gemini/" style="font-size: 0.88rem;">Gemini<sup>2</sup></a><a href="/tags/Git/" style="font-size: 0.88rem;">Git<sup>8</sup></a><a href="/tags/GitHub/" style="font-size: 0.88rem;">GitHub<sup>6</sup></a><a href="/tags/Hexo/" style="font-size: 0.88rem;">Hexo<sup>25</sup></a><a href="/tags/IDEA/" style="font-size: 0.88rem;">IDEA<sup>3</sup></a><a href="/tags/KeyBoardTestUtility/" style="font-size: 0.88rem;">KeyBoardTestUtility<sup>1</sup></a><a href="/tags/Linux/" style="font-size: 0.88rem;">Linux<sup>4</sup></a><a href="/tags/Lombok/" style="font-size: 0.88rem;">Lombok<sup>1</sup></a><a href="/tags/Markdown/" style="font-size: 0.88rem;">Markdown<sup>2</sup></a><a href="/tags/MindManager/" style="font-size: 0.88rem;">MindManager<sup>1</sup></a><a href="/tags/Mysql/" style="font-size: 0.88rem;">Mysql<sup>2</sup></a><a href="/tags/Perplexity-AI/" style="font-size: 0.88rem;">Perplexity AI<sup>1</sup></a><a href="/tags/PicGo/" style="font-size: 0.88rem;">PicGo<sup>1</sup></a><a href="/tags/QQ/" style="font-size: 0.88rem;">QQ<sup>1</sup></a><a href="/tags/SQL/" style="font-size: 0.88rem;">SQL<sup>12</sup></a><a href="/tags/SSL/" style="font-size: 0.88rem;">SSL<sup>3</sup></a><a href="/tags/Sqlserver/" style="font-size: 0.88rem;">Sqlserver<sup>1</sup></a><a href="/tags/Typora/" style="font-size: 0.88rem;">Typora<sup>5</sup></a><a href="/tags/drawio/" style="font-size: 0.88rem;">drawio<sup>1</sup></a><a href="/tags/git/" style="font-size: 0.88rem;">git<sup>1</sup></a><a href="/tags/mysql/" style="font-size: 0.88rem;">mysql<sup>1</sup></a><a href="/tags/svn/" style="font-size: 0.88rem;">svn<sup>2</sup></a><a href="/tags/%E5%9B%BE%E5%90%A7%E5%B7%A5%E5%85%B7%E7%AE%B1/" style="font-size: 0.88rem;">图吧工具箱<sup>1</sup></a><a href="/tags/%E5%9B%BE%E5%BA%8A/" style="font-size: 0.88rem;">图床<sup>7</sup></a><a href="/tags/%E5%BC%80%E6%BA%90%E5%88%86%E4%BA%AB/" style="font-size: 0.88rem;">开源分享<sup>6</sup></a><a href="/tags/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E/" style="font-size: 0.88rem;">搜索引擎<sup>2</sup></a><a href="/tags/%E6%95%B0%E6%8D%AE%E6%81%A2%E5%A4%8D/" style="font-size: 0.88rem;">数据恢复<sup>1</sup></a><a href="/tags/%E6%A8%A1%E6%9D%BF/" style="font-size: 0.88rem;">模板<sup>4</sup></a><a href="/tags/%E8%B8%A9%E5%9D%91/" style="font-size: 0.88rem;">踩坑<sup>6</sup></a><a href="/tags/%E9%B1%BC%E7%9A%AE/" style="font-size: 0.88rem;">鱼皮<sup>11</sup></a></div></div><hr></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><a id="switch-commentBarrage" href="javascript:anzhiyu.switchCommentBarrage();" title="开关弹幕"><i class="anzhiyufont anzhiyu-icon-danmu"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="10051718332" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="is-center" id="loading-database"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-pulse-icon"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"></div></div><hr><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://music.163.com/#/my/m/music/playlist?id=10051718332&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async="" src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("05/01/2023 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2023 By 安知鱼 V1.6.14",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 時光 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async="" src="/anzhiyu/random.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>(() => {
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://twikoo.shiguangdev.eu.org',
      region: '',
      onCommentLoaded: () => {
        anzhiyu.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') setTimeout(runFn,0)
    else getScript('https://cdn.cbd.int/twikoo@1.6.39/dist/twikoo.all.min.js').then(runFn)
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo.shiguangdev.eu.org',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const runFn = () => {
    init();
    GLOBAL_CONFIG_SITE.isPost && getCount()
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) anzhiyu.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else {
      loadTwikoo()
    }
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"><script async="" src="/js/anzhiyu/comment_barrage.js"></script></div><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getComment = () => {
    const runTwikoo = () => {
      twikoo.getRecentComments({
        envId: 'https://twikoo.shiguangdev.eu.org',
        region: '',
        pageSize: 6,
        includeReply: true
      }).then(function (res) {
        const twikooArray = res.map(e => {
          return {
            'content': changeContent(e.comment),
            'avatar': e.avatar,
            'nick': e.nick,
            'url': e.url + '#' + e.id,
            'date': new Date(e.created).toISOString()
          }
        })

        saveToLocal.set('twikoo-newest-comments', JSON.stringify(twikooArray), 10/(60*24))
        generateHtml(twikooArray)
      }).catch(function (err) {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "无法获取评论，请确认相关配置是否正确"
      })
    }

    if (typeof twikoo === 'object') {
      runTwikoo()
    } else {
      getScript('https://cdn.cbd.int/twikoo@1.6.39/dist/twikoo.all.min.js').then(runTwikoo)
    }
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'><div class='name'><span>${array[i].nick} </span></div></a>`
        }
        
        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom && ($dom.innerHTML= result)
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('twikoo-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script async="" data-pjax="" src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><script src="/js/custom/footer-animal.js" defer=""></script><script src="/api/card-welcome.js"></script><script src="https://cdn.bootcdn.net/ajax/libs/echarts/4.9.0-rc.1/echarts.min.js"></script><script id="click-heart" src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/click-heart.min.js" async="async" mobile="false"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["meta[property=\"og:image\"]","meta[property=\"og:title\"]","meta[property=\"og:url\"]","meta[property=\"og:type\"]","meta[property=\"og:site_name\"]","meta[property=\"og:description\"]","head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div><!-- hexo injector body_end start -->
  <script data-pjax="" src="/js/hexo_githubcalendar.js"></script>
  <script data-pjax="">
        function GithubCalendarConfig(){
            var git_githubapiurl ="https://githubcalendarapi.shiguang666.eu.org/api?user=shiguang-coding";
            var git_color =['#ebedf0', '#a2f7af', '#6ce480', '#54ad63', '#469252', '#31753c', '#1f5f2a', '#13531f', '#084111', '#032b09', '#000000'];
            var git_user ="shiguang-coding";
            var parent_div_git = document.getElementById('recent-posts');
            var git_div_html = '<div class="recent-post-item" style="width:100%;height:auto;padding:10px;"><div id="github_loading" style="width:10%;height:100%;margin:0 auto;display: block"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"  viewBox="0 0 50 50" style="enable-background:new 0 0 50 50" xml:space="preserve"><path fill="#d0d0d0" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z" transform="rotate(275.098 25 25)"><animateTransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animateTransform></path></svg></div><div id="github_container"></div></div>';
            if(parent_div_git && location.pathname =='/'){
                console.log("已挂载hexo-github-calendar https://github.com/Barry-Flynn/hexo-github-calendar");
                // parent_div_git.innerHTML=git_div_html+parent_div_git.innerHTML // 无报错，但不影响使用(支持pjax跳转)
                parent_div_git.insertAdjacentHTML("afterbegin",git_div_html) // 有报错，但不影响使用(支持pjax跳转)
            };
            GithubCalendar(git_githubapiurl,git_color,git_user)
        }
        if(document.getElementById('recent-posts')){
            GithubCalendarConfig()
        }
    </script>
    <style>#github_container{min-height:280px}@media screen and (max-width:650px) {#github_container{background-image:;min-height:0px}}</style>
    <style></style><!-- hexo injector body_end end -->
    <link rel="stylesheet" href="https://ai.tianli0.top/static/public/postChatUser_summary.min.css">
    <script>
        let tianliGPT_key = '75439fb77e5551eacf54f0df75565616dcf2ad';
        let tianliGPT_postSelector = '#article-container';
        let tianliGPT_Title = '文章摘要';
        let tianliGPT_postURL = '/^https?://[^/]+/[0-9]{4}/[0-9]{2}/[0-9]{2}/';
        let tianliGPT_blacklist = '';
        let tianliGPT_wordLimit = '1000';
        let tianliGPT_typingAnimate = true;
        var postChatConfig = {
          backgroundColor: "#3e86f6",
          bottom: "16px",
          left: "16px",
          fill: "#FFFFFF",
          width: "44px",
          frameWidth: "375px",
          frameHeight: "600px",
          defaultInput: true,
          upLoadWeb: true,
          showInviteLink: true,
          userTitle: "PostChat",
          userDesc: "如果你对网站的内容有任何疑问，可以来问我哦～",
          addButton: true,
          beginningText: "这篇文章介绍了"
        };
    </script>
    <script data-postchat_key="75439fb77e5551eacf54f0df75565616dcf2ad" src="https://ai.tianli0.top/static/public/postChatUser_summary.min.js"></script>
  </body></html>