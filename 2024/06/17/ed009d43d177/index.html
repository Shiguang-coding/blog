<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>【定制化代码生成项目】03-代码生成 | 時光</title><meta name="keywords" content="项目,定制化代码生成项目"><meta name="author" content="時光"><meta name="copyright" content="時光"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="【定制化代码生成项目】03-代码生成"><meta name="application-name" content="【定制化代码生成项目】03-代码生成"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="【定制化代码生成项目】03-代码生成"><meta property="og:url" content="https://blog.shiguang666.eu.org/2024/06/17/ed009d43d177/index.html"><meta property="og:site_name" content="時光"><meta property="og:description" content="重点内容：  完成项目的初始化 静态文件生成 动态文件代码生成 FreeMarker 模板引擎入门及实战 动静结合 - ACM 示例项目模板代码生成  一、项目初始化1、初始化根目录由于我们的项目包含多个阶段，本质上是多个项目，所以为了统一管理整个项目，我们创建一个干净的 yuzi-generato"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://img.shiguangdev.cn/i/2024/10/18/67125168b4f6a.png?_r_=133f57da-f767-a7cc-eb11-f5006393e988"><meta property="article:author" content="時光"><meta property="article:tag" content="博客,時光,時光的博客,時光博客园子,实用博客,开源,共享"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://img.shiguangdev.cn/i/2024/10/18/67125168b4f6a.png?_r_=133f57da-f767-a7cc-eb11-f5006393e988"><meta name="description" content="重点内容：  完成项目的初始化 静态文件生成 动态文件代码生成 FreeMarker 模板引擎入门及实战 动静结合 - ACM 示例项目模板代码生成  一、项目初始化1、初始化根目录由于我们的项目包含多个阶段，本质上是多个项目，所以为了统一管理整个项目，我们创建一个干净的 yuzi-generato"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="https://blog.shiguang666.eu.org/2024/06/17/ed009d43d177/"><link rel="preconnect" href="//cdn.cbd.int"><meta name="google-site-verification" content="xxx"><meta name="baidu-site-verification" content="code-xxx"><meta name="msvalidate.01" content="xxx"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/swiper/swiper.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: {"enable":true,"title":"与各类博主无限进步","addFriendPlaceholder":"昵称（请勿包含博客等字样）：\n网站地址（要求博客地址，请勿提交个人主页）：\n头像图片url（请提供尽可能清晰的图片，我会上传到我自己的图床）：\n描述：\n站点截图（可选）：\n"},
  peoplecanvas: undefined,
  postHeadAiDescription: undefined,
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: {"enable":true,"default":"晚上好👋","list":[{"greeting":"晚安😴","startTime":0,"endTime":5},{"greeting":"早上好鸭👋, 祝你一天好心情！","startTime":6,"endTime":9},{"greeting":"上午好👋, 状态很好，鼓励一下～","startTime":10,"endTime":10},{"greeting":"11点多啦, 在坚持一下就吃饭啦～","startTime":11,"endTime":11},{"greeting":"午安👋, 宝贝","startTime":12,"endTime":14},{"greeting":"🌈充实的一天辛苦啦！","startTime":14,"endTime":18},{"greeting":"19点喽, 奖励一顿丰盛的大餐吧🍔。","startTime":19,"endTime":19},{"greeting":"晚上好👋, 在属于自己的时间好好放松😌~","startTime":20,"endTime":24}]},
  twikooEnvId: 'https://twikoo.shiguangdev.eu.org',
  commentBarrageConfig:{"enable":true,"maxBarrage":1,"barrageTime":4000,"accessToken":"","mailMd5":""},
  music_page_default: "nav_music",
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: {"skills":["🌟 技术分享领航人","📚 终身学习倡导者","💡 创新思维启发源","📈 成长路径引路人","🚀 科技趋势探索者","🤖️ AI技术探索先锋","🌈 技术创新推动手","💬 社区互动活跃家","🛠️ 代码经验传授师","📢 知识传播倡导员"]},
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":true,"limitCount":300,"languages":{"author":"作者: 時光","link":"链接: ","source":"来源: 時光","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: true,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: '時光',
  title: '【定制化代码生成项目】03-代码生成',
  postAI: '',
  pageFillDescription: '一、项目初始化, 1、初始化根目录, 2、忽略无用提交, 3、创建 Demo 示例代码工程, ACM 示例代码模板介绍, 4、创建本地代码生成器项目, 二、实现流程, 需求拆解, 实现步骤, 三、静态文件生成, 1、现成的工具库复制目录, 2、递归遍历, 文件操作 API, 示例代码, 完整代码, 扩展思路, 四、动态文件生成思路, 明确动态生成需求, 动态生成的核心原理, 五、FreeMarker 模板引擎入门, 什么是模板引擎？为什么需要它？, 什么是 FreeMarker？, 模板引擎的作用, 模板, 数据模型, Demo 实战, 1、引入依赖, 2、创建配置对象, 3、准备模版并加载, 4、创建数据模型, 5、指定生成的文件, 6、生成文件, 7、完整代码, 常用语法, 1、插值, 2、分支和判空, 3、默认值, 4、循环, 5、宏定义, 6、内建函数, 7、其他, 问题解决示例, 更多学习资源, 六、动态文件生成实现, 1、定义数据模型, 2、编写动态模板, 3、组合生成, 4、完善优化, 完善模板, 抽取方法, 完整代码, 七、动静结合 - 生成完整代码, 最后, 本期作业, 本期代码重点内容完成项目的初始化静态文件生成动态文件代码生成模板引擎入门及实战动静结合示例项目模板代码生成一项目初始化初始化根目录由于我们的项目包含多个阶段本质上是多个项目所以为了统一管理整个项目我们创建一个干净的空文件夹作为整个项目的根目录后续各阶段的项目和目录都放到它之下这样做还有一个好处就是让不同项目模块可以用相对路径寻找文件便于整个项目的开源共享建议大家养成习惯使用来管理项目如果使用开发工具来创建新项目可以直接勾选工具会自动帮你初始化项目为仓库如下图当然也可以进入项目根目录执行命令创建仓库忽略无用提交创建好新项目后使用开发工具打开项目进入底部的标签会发现很多和项目无关的自动生成的工程文件被添加到了托管但我们是不希望提交这些文件的没有意义所以需要使用文件来忽略这些文件不让它们被托管如何编写文件呢其实很简单不用自己编写我们在的中搜索插件并安装然后在项目根目录处选中右键使用插件创建文件插件提供了很多默认的模板根据自己的项目类型和使用的开发工具进行选择此处我们选择和模板然后可以在项目根目录看到生成的文件模板已经包含了常用的项目忽略清单比如编译后的文件日志文件压缩包等让我们再手动添加几个要忽略的目录和文件比如打包生成的目录但是我们会发现即使有些文件已经添加到了文件中在中显示的还是绿色已被托管状态如下图这是因为这些文件已经被跟踪而文件仅影响未跟踪的文件如果文件已经被跟踪那么文件对它们没有影响所以我们需要打开终端在项目根目录下执行如下命令取消跟踪执行效果如图可以看到文件变成了红色未被托管或黄色被忽略状态然后让我们将文件添加到暂存区让它能够被管理项目根目录就初始化完成了建议大家像鱼皮一样在项目根目录中新建一个文件用于介绍项目记录自己的学习和开发过程等创建示例代码工程为了制作代码生成器我们需要一些示例模板代码后续会基于这些模板代码来定制生成比如第一阶段我们会用到一套鱼皮提前编写好的示例模板代码从而制作定制化模板代码生成器在第二阶段我们会用到一套初始化项目模板让我们新建一个目录统一存放所有的示例代码然后将鱼皮准备的模板项目复制到该目录下模板项目可通过云盘下载提取码整个项目的目录结构如下图示例代码模板介绍鱼皮准备的示例代码模板非常简单只是一个干净的项目没有使用和任何第三方依赖结构如下核心组成是静态文件和代码文件内容如图仅包含了简单的描述文本是一段示例输入代码作用是计算并输出多数之和完整代码如下输入模板多数之和读取输入元素个数读取数组处理问题逻辑根据需要进行输出示例计算数组元素的和在第一阶段的教程中我们将改造这个代码文件让它能同时支持多种不同的输入方式创建本地代码生成器项目使用开发工具在项目根目录中新建工程创建模块需要注意以下几点项目存放位置在目录下取消仓库勾选因为已经在外层进行托管使用管理项目选择不要追求新版本高级设置中指定和完整配置如图注意鱼皮视频中实际创建的是而文档中创建的是并将文件添加到暂存区如下图需要在项目的文件中引入一些依赖主要是一些工具类和单元测试便于后续提高开发效率依赖代码如下引入依赖后刷新然后执行生成的项目中自带的文件看到下图的输出则项目初始化完成较低版本的可能没有示例代码比如我使用的版本就没有默认方法是输出二实现流程第一阶段我们的目标是制作本地代码生成器基于命令行的脚手架要求能够根据用户的输入生成不同的示例代码模板对于完全没开发过类似项目的同学来说可能会觉得比较困难需求拆解遇到这种情况我们首先要根据业务实际情况对需求进行拆解把一个复杂的大目标拆解为一步一步的小工作如何拆解呢那就先把需求分为段本地代码生成器基于命令行的脚手架首先思考如何制作本地代码生成器先看看我们要生成的项目文件结构吧前面也提到过示例代码模板的核心文件是和其中的作用仅仅是描述项目并不影响开发者的使用所以我们要生成代码时完全不用修改的任何内容直接复制即可我们将这类文件定义为静态文件而是开发者实际要使用的输入模板文件默认是包含了循环接受输入的逻辑的示例代码如下但如果用户不需要循环输入只要保留其他代码呢像下面这样删除代码片段也就是说这个文件是需要作为一个基础模板能够接受用户的输入从而支持定制化生成的我们将这类文件定义为动态文件将文件划分为静态和动态后我们就可以将需求拆解为生成静态文件和生成动态文件两个步骤了同理我们再思考如何制作基于命令行的脚手架在制作命令行工具前我们是不是可以先通过直接运行方法在方法中写死输入参数的方式实现完整的代码生成逻辑呢然后只需要把在方法中写死的输入参数改为读取命令行来接收剩下的逻辑不都可以复用了么最后可以再改变执行方式把方法运行改为调用包脚本实现步骤通过上面的需求拆解后第一阶段的实现方案和流程就非常清晰了生成静态文件通过方法运行生成动态文件通过方法运行同时生成静态和动态文件通过方法运行得到完整代码生成开发命令行工具接受用户的输入并生成完整代码将工具封装为包和脚本供用户调用明确了实现步骤后你会发现每一步都只需要解决一个小问题不再像最初定的目标一样让我们毫无头绪了接下来我们就一步一步实现即可本节教程会完成第步即编写一个通过方法生成完整代码的程序三静态文件生成此处的静态文件是我们根据需求下的一个定义指生成时可以直接复制不做任何改动的文件那我们就先定个小目标输入一个项目的目录在另一个位置生成一模一样的项目文件你会如何实现呢其实本质上就是复制文件嘛这里提供种方法使用现成的工具库直接复制完整目录手动递归复制目录和文件现成的工具库复制目录我们在初始化项目时就已经引入了库的依赖是一个功能非常齐全的工具集包含了请求日期时间处理集合类处理文件处理处理等能够大幅提高开发效率的工具类官方文档现在我们想复制目录下的所有文件可以直接使用的方法方法信息如下图一定要格外注意输入参数的含义让我们在包下创建一个类作为静态文件生成的代码先编写一个公开的静态方法方法中的核心代码就一行直接调用提供的方法就能实现指定目录下所有文件的复制拷贝文件实现会将输入目录完整拷贝到输出目录下输入路径输出路径然后编写一个方法来调用这个方法即可完整复制我们之前准备好的示例代码模板建议使用相对路径示例代码如下注意上述代码中我们通过获取到的路径是而不是所以才用的方式去获取父目录的路径如果在你实际运行代码的过程中发现获取到的路径已经是了那可以不用获取父目录的路径代码如下完整代码如下静态文件生成器输入路径获取相对路径不同操作系统可能有所不同输出路径输入路径输出路径拷贝文件实现会将输入目录完整拷贝到输出目录下输入路径输出路径执行后就能看到项目目录下成功复制了完整的目录这种方式的优点显而易见非常简单但缺点就是不够灵活只能整个目录生成如果想忽略目录中的某个文件就得生成后再删除浪费性能递归遍历第二种复制目录的方式就是手动编写递归算法依次遍历所有目录和文件对于学过算法和数据结构的同学来说递归并不难但如果没学过递归算法实现起来就比较费脑筋了遇到这种情况我们也有比较巧妙的方法比如参考前人的代码实现以为例点进方法的源码注意如果看不到源码里的中文注释则需要在里下载完整的源码按两下然后输入就能找到下载源码指令了源码并不是很复杂能够发现整体的思路为递归复制看了别人的源码后哪怕不能完全理解递归算法我们也能够学习到一些关键的文件操作比如下面这些文件操作拷贝文件创建多级文件夹哪怕中间有目录不存在判断是否为目录文件是否存在掌握这些就能完成检测目录创建目录复制文件的一条龙操作了示例代码递归算法的实现还是有一定复杂度的核心思路就是先在目标位置创建和源项目相同的目录然后依次遍历源目录下的所有子文件并复制如果子文件又是一个目录则再遍历子文件下的所有孙文件如此循环往复鱼皮这里直接给出示例代码将它放到文件中建议大家自己一下来帮助理解递归拷贝文件递归实现会将输入目录完整拷贝到输出目录下输入路径输出路径文件复制失败文件目录则文件放在目录下文件文件则文件覆盖文件目录目录则目录放在目录下核心思路先创建目录然后遍历目录内的文件依次复制输入路径输出路径区分是文件还是目录如果是目录首先创建目标目录获取目录下的所有文件和子目录无子文件直接结束递归拷贝下一层文件是文件直接复制到目标目录下这种方式的优点是更灵活可以依次对每一个文件进行处理还能顺便复习算法缺点是需要自己实现不仅麻烦还有可能出现小完整代码整个静态文件生成器的完整代码如下静态文件生成器输入路径获取相对路径不同操作系统可能有所不同输出路径输入路径输出路径拷贝文件实现会将输入目录完整拷贝到输出目录下输入路径输出路径递归拷贝文件递归实现会将输入目录完整拷贝到输出目录下输入路径输出路径文件复制失败文件目录则文件放在目录下文件文件则文件覆盖文件目录目录则目录放在目录下核心思路先创建目录然后遍历目录内的文件依次复制输入路径输出路径区分是文件还是目录如果是目录首先创建目标目录获取目录下的所有文件和子目录无子文件直接结束递归拷贝下一层文件是文件直接复制到目标目录下扩展思路如果自己实现递归遍历就可以很轻松地得到目录的完整结构树信息可以由此制作出文件对比工具目录分析工具目录总结工具等等四动态文件生成思路实现了静态文件生成复制目录后接下来让我们思考下如何对某个基础文件进行定制根据用户的输入参数动态生成文件明确动态生成需求对于示例模板项目我们可以怎么定制生成呢让我们先明确几个动态生成的需求在代码开头增加作者注释增加代码修改程序输出的信息提示替换代码将循环读取输入改为单次读取可选代码举个例子想要得到的示例代码如下输入模板多数之和增加作者注释可选是否循环读取输入元素个数读取数组处理问题逻辑根据需要进行输出示例计算数组元素的和输出信息可以修改求和结果可以在用户输入时给一些提示例如输入模板多数之和请输入元素个数读取输入元素个数读取数组请输入第个元素处理问题逻辑根据需要进行输出示例计算数组元素的和个元素总和为动态生成的核心原理那么如何实现这些功能呢在开篇教程中就已经讲过了我们再复习一遍最经典的实现方法就是提前基于基础文件挖坑编写模板文件然后将用户输入的参数填坑替换到模板文件中从而生成完整代码举个例子用户输入参数模板文件代码将参数注入到模板文件中得到生成的完整代码如果想要使用这套模板文件来生成其他的代码只需要改变输入参数的值即可而不需要改变模板文件听起来好像很简单那么问题来了如何编写模板文件呢程序怎么知道应该把哪些变量替换为用户实际输入的参数呢又该如何执行替换操作呢难道需要自己定义一套模板语法和规则比如指定两个尖括号参数中的内容为需要替换的参数然后通过正则表达式或者字符串匹配扫描文件来进行替换么显然这太麻烦了而且如果我需要根据用户的输入来生成不同次数的重复代码也就是循环又该如何实现呢所以建议大家直接使用已有的模板引擎技术轻松实现模板编写和动态内容生成五模板引擎入门什么是模板引擎为什么需要它模板引擎是一种用于生成动态内容的类库或框架通过将预定义的模板与特定数据合并来生成最终的输出使用模板引擎有很多的优点首先就是提供现成的模板文件语法和解析能力开发者只要按照特定要求去编写模板文件比如使用参数语法模板引擎就能自动将参数注入到模板中得到完整文件不用再自己编写解析逻辑了其次模板引擎可以将数据和模板分离让不同的开发人员独立工作比如后端专心开发业务逻辑提供数据前端专心写模板等让系统更易于维护此外模板引擎可能还具有一些安全特性比如防止跨站脚本攻击等所以强烈大家掌握至少一种模板引擎的用法有很多现成的模板引擎技术比如的前端的等本项目中我会以知名的稳定的经典模板引擎为例带大家掌握模板引擎的使用方法什么是是的开源模板引擎优点是入门简单灵活易扩展它不用和开发框架环境第三方依赖绑定任何项目都可以使用我个人推荐的学习方式是直接阅读官方文档虽然是英文的但每一节基本都有代码示例还是比较好理解的官方文档看不懂英文也没关系鱼皮下面就带大家学习只讲常用的特性主打一个快速入门中文官方参考手册模板引擎的作用上面已经讲过了模板引擎的作用这里就再用官网的一张图强化下大家的理解如下图模板引擎的作用就是接受模板和对象对它们进行处理输出完整的内容下面我们先依次来学习的核心概念模板和数据模型然后通过一个快速入门模板拥有自己的模板编写规则一般用表示模板语言比如就是一个的模板文件模板文件由个核心部分组成文本固定的内容会按原样输出插值用语法来占位尖括号中的内容在经过计算和替换后才会输出指令有点像的标签语法通过来实现各种特殊功能比如实现循环输出注释和注释类似使用语法注释中的内容不会输出让我们以時光官网为例举一个模板文件的例子学过前端开发框架的同学应该会觉得很眼熟時光官网欢迎来到時光官网循环渲染导航条底部版权信息注释部分不会被输出時光官网数据模型我们把为模板准备的所有数据整体统称为数据模型在中数据模型一般是树形结构可以是复杂的对象也可以是等更通用的结构比如为上述鱼皮官网模板准备的数据模型结构可能是这样的時光主页時光的博客园子時光导航站实战在了解模板和数据模型后让我们通过对二者进行组合处理引入依赖首先创建一个项目这里就用我们的项目在中引入如果是项目的话可以直接引入依赖创建配置对象在目录下新建一个单元测试类在方法中创建一个的全局配置对象可以统一指定模板文件所在的路径模板文件的字符集等示例代码如下出对象参数为版本号指定模板文件所在的路径设置模板文件使用的字符集准备模版并加载我们将上述時光官网的模板代码保存为文件存放在上面指定的目录下准备好模板文件后通过创建对象来加载该模板示例代码如下创建模板对象加载指定模板创建数据模型如果想保证数据的质量和规范性可以使用对象来保存喂给模板的数据反之如果想更灵活地构造数据模型推荐使用结构比如我们想构造鱼皮官网的数据模型需要制定当前年份和导航菜单项示例代码如下数据模型時光主页時光博客园子時光导航站指定生成的文件可以直接使用对象指定生成的文件路径和名称生成文件一切准备就绪最后只需要调用对象的方法就可以处理并生成文件了示例代码如下生成后的文件如下時光官网欢迎来到時光官网時光主页時光博客园子時光导航站時光官网运行如下所示这里添加是为了防止在预览时乱码如果出现乱码问题可参考文章环境解决网页中文乱码的问题完整代码组合上面的所有代码并执行发现在项目的根路径下生成了网页文件至此结束很简单吧文件的完整代码出对象参数为版本号指定模板文件所在的路径设置模板文件使用的字符集创建模板对象加载指定模板数据模型時光主页時光博客园子時光导航站关闭输出流常用语法学会了的基本开发流程后我们来学习一些中的实用特性注意的语法和特性非常多本文仅带大家学习常用的易用的语法无需记忆日后需要用到时再去对照官方文档查漏补缺即可插值在上面的中已经给大家演示了差值的基本语法但插值还有很多花样可以玩比如支持传递表达式表达式不过个人不建议在模板文件中写表达式为什么不在创建数据模型时就计算好要展示的值呢分支和判空和程序开发一样模板也支持分支表达式示例代码如下鱼皮我是鱼皮我是猪皮分支语句的一个常用场景就是判空比如要判断参数是否存在可以用下面的语法存在用户用户不存在默认值对变量的空值校验是很严格的如果模板中某个对象为空将会报错而导致模板生成中断为了防止这个问题建议给可能为空的参数都设置默认值使用表达式默认值的语法示例代码如下用户为空上述代码中如果对象为空则会输出用户为空字符串循环在上述实战部分已经给大家演示了循环的用法即表达式可以遍历某个序列类型的参数并重复输出多条内容示例代码如下其中是整个列表而是遍历列表每个元素时临时存储的变量跟循环一样会依次输出每个的值宏定义学过语言和的同学应该对宏这个词并不陌生可以把宏理解为一个预定义的模板片段支持给宏传入变量来复用模板片段其实类似于前端开发中组件复用的思想在中使用指令来定义宏让我们来定义一个宏用于输出特定格式的用户昵称比如其中是宏的名称是宏接受的参数可以用语法来使用宏示例代码如下鱼皮二黑实际生成的输出结果为鱼皮二黑宏标签中支持嵌套内容不过还是有些复杂的再讲下去就成前端课了大家需要用到时查看官方文档就好自定义指令内建函数内建函数是为了提高开发者处理参数效率而提供的的语法糖可以通过来调用内建函数比如将字符串转为大写比如输出序列的长度把内建函数想象成调用对象的方法就很好理解了内建函数是非常强大的一个能力比如想在循环语法中依次输出元素的下标就可以使用循环表达式自带的内建函数内建函数种类丰富数量极多因此不建议大家记忆需要用到的时候去查阅官方文档即可内建函数大全参考其他还有更多特性比如命名空间其实就相当于中的包用于隔离代码宏变量等不过没必要细讲因为掌握上述常用语法后基本就能够开发大多数模板文件了更多内容自主查阅官方文档学习即可问题解决示例给大家分享一个通过查阅官方文档解决具体问题的例子比如之前生成的网站文件中我们发现数字中间加了一个逗号分割符如下图这是因为使用平台的本地化敏感的数字格式信息如果想把分割符取消掉怎么办呢我们可以通过查阅官方文档看到以下信息地址按照文档的提示修改配置类的设置即可调整默认生成的数字格式啦更多学习资源官方文档中文教程教程网六动态文件生成实现学完了模板引擎后让我们立刻实战一番实现示例模板项目的动态生成吧核心步骤为定义数据模型编写动态模板组合生成完善优化定义数据模型针对上述需求我们在包下新建一个模板配置对象用来接收要传递给模板的参数注意要根据替换需求选择参数的类型比如可选生成用字符串替换用示例代码如下静态模板配置明确需求在代码开头增加作者注释增加代码修改程序输出的信息提示替换代码将循环读取输入改为单次读取可选代码是否生成循环作者注释输出信息其实也可以使用但是不如定义对象更清晰更规范编写动态模板在目录下新建模板文件模板和上面定义的数据模型名称保持一致制作模板的方法很简单先复制原始代码再挖坑完整动态模板代码如下输入模板多数之和读取输入元素个数读取数组处理问题逻辑根据需要进行输出示例计算数组元素的和其中我们使用插值表达式接受作者名称使用分支来控制是否生成循环代码使用控制输出信息组合生成同静态文件生成器一样我们在目录下新建动态文件生成器类和上述实战一样在方法中编写生成逻辑依次完成创建对象模板对象创建数据模型指定输出路径执行生成完整代码如下出对象参数为版本号指定模板文件所在的路径设置模板文件使用的字符集使用平台的本地化敏感的数字格式信息默认的本地化数字格式可能是分组或其他不想要的格式为了避免这种情况你不得不使用设置中的来重写平台建议的数字格式设置数字格式不显示逗号分隔符创建模板对象加载指定模板数据模型時光输出结果关闭输出流执行后可以发现在项目根目录下生成了文件内容符合我们的预期完善优化虽然已经实现了动态文件生成但我们还要进一步优化代码的健壮性灵活性完善模板经过测试发现如果数据模型的字符串变量不设置任何值那么会报如下错误所以建议给所有字符串指定一个默认值这里有两种方法方法直接给设置默认值方法使用的默认值操作符个人更推荐第一种方式不用多学一套语法也不用让其他开发者理解模板文件让我们修改文件给数据模型增加默认值抽取方法上述代码中我们是把模板文件路径数据模型输出路径全部硬编码在了方法中而为了提高代码的可复用性我们可以将生成逻辑封装为一个方法将硬编码的参数作为方法输入参数可以用调用方指定代码如下生成文件模板文件输入路径输出路径数据模型出对象参数为版本号指定模板文件所在的路径设置模板文件使用的字符集设置数字格式不显示分隔符创建模板对象加载指定模板生成生成文件后别忘了关闭哦然后方法调用方的代码就可以大大简化了如下数据模型時光输出结果注意上述代码中我们通过获取到的路径是那么需要给再拼接路径如果在你实际运行代码的过程中发现获取到的路径是那么可以直接使用相对路径获取到模板地址完整代码整个动态文件生成器的完整代码如下动态文件生成器数据模型時光输出结果生成文件模板文件输入路径输出路径数据模型出对象参数为版本号指定模板文件所在的路径设置模板文件使用的字符集设置数字格式不显示分隔符创建模板对象加载指定模板生成生成文件后别忘了关闭哦七动静结合生成完整代码完成了静态和动态文件生成后我们想要生成一套完整的模板代码就非常简单了只需要编写一个类组合调用这两个生成器先复制静态文件再动态生成文件来覆盖即可在包下新建类编写一个生成方法接受外层传来的数据模型完整代码如下求和结果执行上述代码我们就能够完整地生成示例代码模板了改变方法中的数据模型参数就能修改生成的模板代码需要注意的是上述代码中无论是要复制的静态文件还是要生成的动态模板文件我们都是在代码中写死了文件的路径对于制作一个本地的代码生成器而言这么做就足够了但如果要生成一个动态文件非常多的项目难道要一个个去指定动态文件所在的路径么这个问题留给大家去思考最后以上就是本期教程我们已经实现了本地的代码生成器但是现在这种方式实现的代码生成器虽然可以让懂编程的同学来使用只需要修改方法中的数据模型但如果是没学过的同学呢有没有更方便快捷的使用方式呢下期教程带大家解决这个问题本期作业学习拆解需求和实现步骤的思路掌握静态文件和模板引擎动态生成文件的方法提前思考最后一个问题如何提高现有程序的易用性自己编写代码实现本节项目并且在自己的代码仓库完成一次提交本期代码',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-12-14 17:12:11',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><script async="" defer="" src="https://umami.shiguangdev.cn/script.js" data-website-id="bc279f56-9a19-416a-a035-58c0abed887b"></script><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="時光" type="application/atom+xml">
</head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="/img/avatar.png"><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://www.shiguang666.eu.org" title="時光主页"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="時光主页"><span class="back-menu-item-text">時光主页</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://nav.shiguang666.eu.org" title="時光导航站"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="時光导航站"><span class="back-menu-item-text">時光导航站</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://game.shiguang666.eu.org" title="怀旧游戏机"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="怀旧游戏机"><span class="back-menu-item-text">怀旧游戏机</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://games.shiguang666.eu.org" title="在线小游戏"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="在线小游戏"><span class="back-menu-item-text">在线小游戏</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">后台管理</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://img.shiguangdev.cn/" title="時光图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/favicon.ico" alt="時光图床"><span class="back-menu-item-text">時光图床</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://qexo.shiguang666.eu.org/" title="Hexo管理面板"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://qexo.shiguang666.eu.org/favicon.ico" alt="Hexo管理面板"><span class="back-menu-item-text">Hexo管理面板</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">時光</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 归档</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随机</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/news/"><i class="fa fa-calendar faa-tada"></i><span> 早报亭</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/music/?id=10051718332&amp;server=netease"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/gallery/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/xjj/"><i class="fa fa-rocket faa-tada"></i><span> 养生堂</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/flink/"><i class="anzhiyufont anzhiyu-icon-artstation faa-tada" style="font-size: 0.9em;"></i><span> 朋友圈</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comment/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于我</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button only-home" id="travellings_button" title="随机前往一个开往项目网站"><a class="site-page" onclick="anzhiyu.totraveling()" title="随机前往一个开往项目网站" href="javascript:void(0);" rel="external nofollow" data-pjax-state="external"><i class="anzhiyufont anzhiyu-icon-train"></i></a></div><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="/img/wechat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/wechat.png"></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/alipay.png"></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/12/"><span class="card-archive-list-date">十二月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">11</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/11/"><span class="card-archive-list-date">十一月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">8</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/10/"><span class="card-archive-list-date">十月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">31</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/09/"><span class="card-archive-list-date">九月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">38</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/08/"><span class="card-archive-list-date">八月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">9</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/07/"><span class="card-archive-list-date">七月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">18</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/06/"><span class="card-archive-list-date">六月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">30</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/05/"><span class="card-archive-list-date">五月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">20</span><span>篇</span></div></a></li></ul></div><hr></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item on" id="consoleCommentBarrage" onclick="anzhiyu.switchCommentBarrage()" title="热评开关"><a class="commentBarrage"><i class="anzhiyufont anzhiyu-icon-message"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/" itemprop="url">项目笔记</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/%E9%A1%B9%E7%9B%AE/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>项目</span></a><a class="article-meta__tags" href="/tags/%E5%AE%9A%E5%88%B6%E5%8C%96%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90%E9%A1%B9%E7%9B%AE/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>定制化代码生成项目</span></a></span></div></div><h1 class="post-title" itemprop="name headline">【定制化代码生成项目】03-代码生成</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2024-06-17T07:00:00.000Z" title="发表于 2024-06-17 15:00:00">2024-06-17</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2024-12-14T09:12:11.079Z" title="更新于 2024-12-14 17:12:11">2024-12-14</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">12.1k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>46分钟</span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为上海"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>上海</span><span class="post-meta-separator"></span><span class="post-meta-commentcount"><i class="anzhiyufont anzhiyu-icon-comments post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/2024/06/17/ed009d43d177/#post-comment" tabindex="-1"><span id="twikoo-count"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></a></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://img.shiguangdev.cn/i/2024/10/18/67125168b4f6a.png?_r_=133f57da-f767-a7cc-eb11-f5006393e988"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope="" itemtype="https://blog.shiguang666.eu.org/2024/06/17/ed009d43d177/"><header><a class="post-meta-categories" href="/categories/%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/" itemprop="url">项目笔记</a><a href="/tags/%E9%A1%B9%E7%9B%AE/" tabindex="-1" itemprop="url">项目</a><a href="/tags/%E5%AE%9A%E5%88%B6%E5%8C%96%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90%E9%A1%B9%E7%9B%AE/" tabindex="-1" itemprop="url">定制化代码生成项目</a><h1 id="CrawlerTitle" itemprop="name headline">【定制化代码生成项目】03-代码生成</h1><span itemprop="author" itemscope="" itemtype="http://schema.org/Person">時光</span><time itemprop="dateCreated datePublished" datetime="2024-06-17T07:00:00.000Z" title="发表于 2024-06-17 15:00:00">2024-06-17</time><time itemprop="dateCreated datePublished" datetime="2024-12-14T09:12:11.079Z" title="更新于 2024-12-14 17:12:11">2024-12-14</time></header><div id="postchat_postcontent"><p><strong>重点内容</strong>：</p>
<ol>
<li>完成项目的初始化</li>
<li>静态文件生成</li>
<li>动态文件代码生成</li>
<li>FreeMarker 模板引擎入门及实战</li>
<li>动静结合 - ACM 示例项目模板代码生成</li>
</ol>
<h2 id="一、项目初始化"><a href="#一、项目初始化" class="headerlink" title="一、项目初始化"></a>一、项目初始化</h2><h3 id="1、初始化根目录"><a href="#1、初始化根目录" class="headerlink" title="1、初始化根目录"></a>1、初始化根目录</h3><p>由于我们的项目包含多个阶段，本质上是多个项目，所以为了统一管理整个项目，我们创建一个干净的 <code>yuzi-generator</code> 空文件夹，作为整个项目的根目录，后续各阶段的项目和目录都放到它之下。</p>
<p>这样做还有一个好处，就是让不同项目模块可以用 <strong>相对路径</strong> 寻找文件，便于整个项目的开源共享。</p>
<p>建议大家养成习惯，使用 Git 来管理项目。如果使用 IDEA 开发工具来创建新项目，可以直接勾选 <code>Create Git repository</code> ，工具会自动帮你初始化项目为 Git 仓库。</p>
<p>如下图：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/10/17/6710c04a66aba.png" alt="image-20240617135530598"></p>
<blockquote>
<p>当然，也可以进入项目根目录，执行 <code>git init</code> 命令创建 Git 仓库。</p>
</blockquote>
<h3 id="2、忽略无用提交"><a href="#2、忽略无用提交" class="headerlink" title="2、忽略无用提交"></a>2、忽略无用提交</h3><p>创建好新项目后，使用 IDEA 开发工具打开项目，进入底部的 <code>Git</code> 标签，会发现很多和项目无关的 IDEA 自动生成的工程文件被添加到了 Git 托管。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/10/17/6710c04ad1c63.png" alt="image-20240617131346352"></p>
<p>但我们是不希望提交这些文件的，没有意义，所以需要使用 <code>.gitignore</code> 文件来忽略这些文件，不让它们被 Git 托管。</p>
<p>如何编写 <code>.gitignore </code>文件呢？</p>
<p>其实很简单，不用自己编写！我们在 IDEA 的 <code>Settings =&gt; Plugins</code> 中搜索 <code>.ignore</code> 插件并安装：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/10/17/6710c04b63be8.png" alt="image-20240617131145122"></p>
<p>然后在项目根目录处选中右键，使用 <code>.ignore</code> 插件创建 <code>.gitignore</code> 文件：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/10/17/6710c04c23581.png" alt="image-20240617131152336"></p>
<p>.ignore 插件提供了很多默认的 .gitignore 模板，根据自己的项目类型和使用的开发工具进行选择，此处我们选择 Java 和 JetBrains 模板：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/10/17/6710c04ca2b56.png" alt="image-20240617131201647"></p>
<p>然后可以在项目根目录看到生成的 .gitignore 文件，模板已经包含了常用的 Java 项目忽略清单，比如编译后的文件、日志文件、压缩包等：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/10/17/6710c04d225d0.png" alt="image-20240617131209262"></p>
<p>让我们再手动添加几个要忽略的目录和文件，比如打包生成的 target 目录：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/10/17/6710c04d70fee.png" alt="image-20240617131215112"></p>
<p>但是，我们会发现，即使有些文件已经添加到了 .gitignore 文件中，在 IDEA 中显示的还是绿色（已被 Git 托管）状态。如下图：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/10/17/6710c04dd0a87.png" alt="image-20240617131220729"></p>
<p>这是因为这些文件已经被 Git 跟踪。而 .gitignore 文件仅影响未跟踪的文件，如果文件已经被 Git 跟踪，那么 .gitignore 文件对它们没有影响。</p>
<p>所以我们需要打开终端，在项目根目录下执行如下命令，取消 Git 跟踪：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">rm</span> -rf --cached .</span><br></pre></td></tr></tbody></table></figure>

<p>执行效果如图：</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/10/17/6710c246171bc.png" alt="image-20241017155238292" style="zoom:150%;">

<p>可以看到文件变成了红色（未被 Git 托管）或黄色（被忽略）状态：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/10/17/6710c04e2a182.png" alt="image-20240617131233764"></p>
<p>然后，让我们将 .gitignore 文件添加到 Git 暂存区，让它能够被 Git 管理。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/10/17/6710c04ea0608.png" alt="image-20240617131239398"></p>
<p>项目根目录就初始化完成了，建议大家像鱼皮一样在项目根目录中新建一个 <code>README.md</code> 文件，用于介绍项目、记录自己的学习和开发过程等~</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/10/17/6710c04f74484.png" alt="image-20240617131247517"></p>
<h3 id="3、创建-Demo-示例代码工程"><a href="#3、创建-Demo-示例代码工程" class="headerlink" title="3、创建 Demo 示例代码工程"></a>3、创建 Demo 示例代码工程</h3><p>为了制作代码生成器，我们需要一些示例模板代码，后续会基于这些模板代码来定制生成。</p>
<p>比如第一阶段，我们会用到一套鱼皮提前编写好的 ACM 示例模板代码，从而制作定制化 ACM 模板代码生成器；在第二阶段，我们会用到一套 Spring Boot 初始化项目模板。</p>
<p>让我们新建一个 <code>yuzi-generator-demo-projects</code> 目录，统一存放所有的示例代码，然后将鱼皮准备的 ACM 模板项目（acm-template）复制到该目录下。</p>
<blockquote>
<p>ACM 模板项目，可通过云盘下载： <a target="_blank" rel="noopener" href="https://www.alipan.com/s/vzzRbJEjTxA">https://www.alipan.com/s/vzzRbJEjTxA</a> 提取码: h5z0</p>
</blockquote>
<p>整个项目的目录结构如下图：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/10/17/6710c04ff1a0d.png" alt="image-20240617131256240"></p>
<h4 id="ACM-示例代码模板介绍"><a href="#ACM-示例代码模板介绍" class="headerlink" title="ACM 示例代码模板介绍"></a>ACM 示例代码模板介绍</h4><p>鱼皮准备的 ACM 示例代码模板非常简单，只是一个干净的 Java 项目，没有使用 Maven 和任何第三方依赖。</p>
<p>结构如下，核心组成是静态文件 <code>README.md</code> 和代码文件 <code>MainTemplate</code>：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/10/17/6710c05044e33.png" alt="image-20240617131302597"></p>
<p><code>README.md</code> 内容如图，仅包含了简单的描述文本：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/10/17/6710c0508e7ec.png" alt="image-20240617131308234"></p>
<p><code>MainTemplate.java</code> 是一段 ACM 示例输入代码，作用是计算并输出多数之和。</p>
<p>完整代码如下：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.shiguang.acm;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ACM 输入模板（多数之和）</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainTemplate</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (scanner.hasNext()) {</span><br><span class="line">            <span class="comment">// 读取输入元素个数</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> scanner.nextInt();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 读取数组</span></span><br><span class="line">            <span class="type">int</span>[] arr = <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) {</span><br><span class="line">                arr[i] = scanner.nextInt();</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 处理问题逻辑，根据需要进行输出</span></span><br><span class="line">            <span class="comment">// 示例：计算数组元素的和</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> num : arr) {</span><br><span class="line">                sum += num;</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">"Sum: "</span> + sum);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        scanner.close();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>在第一阶段的教程中，我们将改造这个 Java 代码文件，让它能同时支持多种不同的输入方式。</p>
<h3 id="4、创建本地代码生成器项目"><a href="#4、创建本地代码生成器项目" class="headerlink" title="4、创建本地代码生成器项目"></a>4、创建本地代码生成器项目</h3><p>使用 IDEA 开发工具，在项目根目录中新建工程，创建 <code>yuzi-generator-basic</code> 模块。需要注意以下几点：</p>
<ol>
<li>项目存放位置在 <code>yuzi-generator</code> 目录下</li>
<li>取消 Git 仓库勾选（因为已经在外层进行 Git 托管）</li>
<li>使用 Maven 管理项目</li>
<li>JDK 选择 1.8！不要追求新版本</li>
<li>高级设置中，指定 GroupId 和 ArtifactId</li>
</ol>
<p>完整配置如图：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/10/17/6710c050d492b.png" alt="image-20240617230841574"></p>
<p><strong>注意，鱼皮视频中实际创建的是Model，而文档中创建的是Project</strong></p>
<p>并将文件添加（add）到 Git 暂存区，如下图：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/10/17/6710c0514e1a1.png" alt="image-20240617131415637"></p>
<p>需要在项目的 <code>pom.xml</code> 文件中引入一些依赖，主要是一些工具类和单元测试，便于后续提高开发效率。</p>
<p>依赖代码如下：</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!-- https://doc.hutool.cn/ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.hutool<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hutool-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.8.16<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.commons/commons-collections4 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-collections4<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!-- https://projectlombok.org/ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.30<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.13.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>引入依赖后，刷新 Maven，然后执行 IDEA 生成的项目中自带的 Main 文件，看到下图的输出，则项目初始化完成：</p>
<p>较低版本的IDEA可能没有示例代码，比如我使用的2022.3.2版本就没有，默认main方法是输出helloworld</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/10/17/6710c051cf0f5.png" alt="image-20240617131425585"></p>
<h2 id="二、实现流程"><a href="#二、实现流程" class="headerlink" title="二、实现流程"></a>二、实现流程</h2><p>第一阶段我们的目标是制作本地代码生成器（基于命令行的脚手架），要求能够根据用户的输入生成不同的 ACM 示例代码模板。</p>
<p>对于完全没开发过类似项目的同学来说，可能会觉得比较困难。</p>
<h3 id="需求拆解"><a href="#需求拆解" class="headerlink" title="需求拆解"></a>需求拆解</h3><p>遇到这种情况，我们首先要根据业务实际情况对需求进行 <strong>拆解</strong> ，把一个复杂的大目标拆解为一步一步的小工作。</p>
<p>如何拆解呢？</p>
<p>那就先把需求分为 2 段，本地代码生成器 + 基于命令行的脚手架。</p>
<p>首先思考如何制作本地代码生成器。先看看我们要生成的项目文件结构吧！前面也提到过，ACM 示例代码模板的核心文件是 <code>README.md</code> 和 <code>MainTemplate.java</code>。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/10/17/6710c052293a7.png" alt="image-20240617131432030"></p>
<p>其中，README.md 的作用仅仅是描述项目，并不影响开发者的使用。所以我们要生成代码时，完全不用修改 README.md 的任何内容，直接复制即可。我们将这类文件定义为 “静态文件”。</p>
<p>而 MainTemplate.java 是开发者实际要使用的 ACM 输入模板文件，默认是包含了循环接受输入的逻辑的。示例代码如下：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (scanner.hasNext()) {</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> scanner.nextInt();</span><br><span class="line">    ...</span><br><span class="line">    System.out.println(<span class="string">"Sum: "</span> + sum);</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>但如果用户不需要循环输入，只要保留其他代码呢？像下面这样删除 while 代码片段：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> scanner.nextInt();</span><br><span class="line">...</span><br><span class="line">System.out.println(<span class="string">"Sum: "</span> + sum);</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>也就是说，这个文件是需要作为一个 <strong>基础模板</strong> ，能够接受用户的输入从而支持定制化生成的。我们将这类文件定义为 “动态文件”。</p>
<p>将文件划分为静态和动态后，我们就可以将需求拆解为 “生成静态文件” 和 “生成动态文件” 两个步骤了。</p>
<p>同理，我们再思考如何制作基于命令行的脚手架。在制作命令行工具前，我们是不是可以先通过直接运行 Main 方法、在 Main 方法中写死输入参数的方式实现完整的代码生成逻辑呢？然后只需要把在 Main 方法中写死的输入参数改为读取命令行来接收，剩下的逻辑不都可以复用了么？最后，可以再改变执行方式，把 Main 方法运行改为调用 jar 包（脚本）。</p>
<h3 id="实现步骤"><a href="#实现步骤" class="headerlink" title="实现步骤"></a>实现步骤</h3><p>通过上面的需求拆解后，第一阶段的实现方案和流程就非常清晰了：</p>
<p>1）生成静态文件，通过 Main 方法运行</p>
<p>2）生成动态文件，通过 Main 方法运行</p>
<p>3）同时生成静态和动态文件，通过 Main 方法运行，得到完整代码生成</p>
<p>4）开发命令行工具，接受用户的输入并生成完整代码</p>
<p>5）将工具封装为 jar 包和脚本，供用户调用</p>
<p>明确了实现步骤后，你会发现每一步都只需要解决一个小问题，不再像最初定的目标一样让我们毫无头绪了。</p>
<p>接下来我们就一步一步实现即可，本节教程会完成第 1 - 3 步，即编写一个通过 Main 方法生成完整代码的程序。</p>
<h2 id="三、静态文件生成"><a href="#三、静态文件生成" class="headerlink" title="三、静态文件生成"></a>三、静态文件生成</h2><p>此处的静态文件，是我们根据需求下的一个定义，指生成时可以直接复制、不做任何改动的文件。</p>
<p>那我们就先定个小目标：输入一个项目的目录，在另一个位置生成一模一样的项目文件。</p>
<p>你会如何实现呢？</p>
<p>其实本质上就是复制文件嘛！</p>
<p>这里提供 2 种方法：</p>
<ol>
<li>使用现成的工具库直接复制完整目录</li>
<li>手动递归复制目录和文件</li>
</ol>
<h3 id="1、现成的工具库复制目录"><a href="#1、现成的工具库复制目录" class="headerlink" title="1、现成的工具库复制目录"></a>1、现成的工具库复制目录</h3><p>我们在初始化 <code>yuzi-generator-basic</code> 项目时，就已经引入了 Hutool 库的依赖。</p>
<p>Hutool 是一个功能非常齐全的工具集，包含了 HTTP 请求、日期时间处理、集合类处理、文件处理、JSON 处理等能够大幅提高开发效率的工具类。</p>
<blockquote>
<p>Hutool 官方文档：<a target="_blank" rel="noopener" href="https://www.hutool.cn/">https://www.hutool.cn/</a></p>
</blockquote>
<p>现在我们想复制目录下的所有文件，可以直接使用 Hutool 的 copy 方法，方法信息如下图，一定要格外注意输入参数的含义：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/10/17/6710c052839ba.png" alt="image-20240617131441982"></p>
<p>让我们在 <code>com.shiguang.generator</code> 包下创建一个 <code>StaticGenerator</code> 类，作为静态文件生成的代码。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/10/17/6710c052c609c.png" alt="image-20240617131447775"></p>
<p>先编写一个公开的静态方法 <code>copyFilesByHutool</code>，方法中的核心代码就一行，直接调用 Hutool 提供的 <code>FileUtil.copy</code> 方法，就能实现指定目录下所有文件的复制！</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 拷贝文件（Hutool 实现，会将输入目录完整拷贝到输出目录下）</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> inputPath 输入路径</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> outputPath 输出路径</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">copyFilesByHutool</span><span class="params">(String inputPath, String outputPath)</span> {</span><br><span class="line">    FileUtil.copy(inputPath, outputPath, <span class="literal">false</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>然后编写一个 Main 方法来调用这个方法即可，完整复制我们之前准备好的 ACM 示例代码模板（建议使用相对路径）。</p>
<p>示例代码如下：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">    </span><br><span class="line">    <span class="type">String</span> <span class="variable">projectPath</span> <span class="operator">=</span> System.getProperty(<span class="string">"user.dir"</span>);</span><br><span class="line">    <span class="type">File</span> <span class="variable">parentFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(projectPath).getParentFile();</span><br><span class="line">    </span><br><span class="line">    <span class="type">String</span> <span class="variable">inputPath</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(parentFile, <span class="string">"yuzi-generator-demo-projects/acm-template"</span>).getAbsolutePath();</span><br><span class="line">    </span><br><span class="line">    <span class="type">String</span> <span class="variable">outputPath</span> <span class="operator">=</span> projectPath;</span><br><span class="line">    copyFilesByHutool(inputPath, outputPath);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>注意，上述代码中，我们通过 <code>System.getProperty("user.dir")</code> 获取到的路径是 <code>yuzi-generator/yuzi-generator-basic</code> ，而不是 <code>yuzi-generator</code>，所以才用 <code>getParentFile()</code> 的方式去获取父目录 <code>yuzi-generator</code> 的路径。</p>
<p>如果在你实际运行代码的过程中发现 <code>System.getProperty("user.dir")</code> 获取到的路径已经是 <code>yuzi-generator</code> 了，那可以不用获取父目录的路径，代码如下：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">    </span><br><span class="line">    <span class="type">String</span> <span class="variable">projectPath</span> <span class="operator">=</span> System.getProperty(<span class="string">"user.dir"</span>);</span><br><span class="line">    <span class="type">File</span> <span class="variable">projectFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(projectPath);</span><br><span class="line">    </span><br><span class="line">    <span class="type">String</span> <span class="variable">inputPath</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(projectFile, <span class="string">"yuzi-generator-demo-projects/acm-template"</span>).getAbsolutePath();</span><br><span class="line">    </span><br><span class="line">    <span class="type">String</span> <span class="variable">outputPath</span> <span class="operator">=</span> projectPath;</span><br><span class="line">    copyFilesByHutool(inputPath, outputPath);</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>完整代码如下</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.shiguang.generator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.io.FileUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 静态文件生成器</span></span><br><span class="line"><span class="comment"> * Created By Shiguang On 2024/6/17 15:39</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StaticGenerator</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">projectPath</span> <span class="operator">=</span> System.getProperty(<span class="string">"user.dir"</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 输入路径,获取相对路径,不同操作系统可能有所不同</span></span><br><span class="line">        <span class="comment">// D:\Workspace\shiguang-coding\yuzi-generator\yuzi-generator-demo-projects\acm-template</span></span><br><span class="line">        <span class="comment">// File parentFile = new File(projectPath).getParentFile();</span></span><br><span class="line">        <span class="comment">// String inputPath = new File(parentFile, "yuzi-generator-demo-projects" + File.separator + "acm-template").getAbsolutePath();</span></span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">inputPath</span> <span class="operator">=</span> projectPath + File.separator + <span class="string">"yuzi-generator-demo-projects"</span> + File.separator + <span class="string">"acm-template"</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 输出路径</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">outputPath</span> <span class="operator">=</span> projectPath;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"输入路径: "</span> + inputPath);</span><br><span class="line">        System.out.println(<span class="string">"输出路径: "</span> + outputPath);</span><br><span class="line"></span><br><span class="line">        copyFilesByHutool(inputPath, outputPath);</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 拷贝文件（Hutool 实现，会将输入目录完整拷贝到输出目录下）</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> inputPath  输入路径</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> outputPath 输出路径</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">copyFilesByHutool</span><span class="params">(String inputPath, String outputPath)</span> {</span><br><span class="line">        FileUtil.copy(inputPath, outputPath, <span class="literal">false</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>



<p>执行后就能看到项目目录下成功复制了完整的目录：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/10/17/6710c0531383a.png" alt="image-20240617161125754"></p>
<p>这种方式的优点显而易见，非常简单；但缺点就是不够灵活，只能整个目录生成，如果想忽略目录中的某个文件，就得生成后再删除，浪费性能。</p>
<h3 id="2、递归遍历"><a href="#2、递归遍历" class="headerlink" title="2、递归遍历"></a>2、递归遍历</h3><p>第二种复制目录的方式就是手动编写递归算法依次遍历所有目录和文件。</p>
<p>对于学过算法和数据结构的同学来说，递归并不难，但如果没学过递归算法，实现起来就比较费脑筋了。</p>
<p>遇到这种情况，我们也有比较巧妙的方法，比如参考前人的代码实现。</p>
<p>以 <code>Hutool</code> 为例，点进 <code>FileUtil.copy</code> 方法的源码：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/10/17/6710c0538af91.png" alt="image-20240617131504492"></p>
<p>注意，如果看不到源码里的中文注释，则需要在 IDEA 里下载完整的 sources 源码：</p>
<blockquote>
<p>按两下 shift，然后输入 sources 就能找到下载源码指令了</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/10/17/6710c053e669a.png" alt="image-20240617131938899"></p>
<p>源码并不是很复杂，能够发现整体的思路为 <strong>递归复制</strong> ：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/10/17/6710c05459749.png" alt="image-20240617131931951"></p>
<p>看了别人的源码后，哪怕不能完全理解递归算法，我们也能够学习到一些关键的文件操作 API。比如下面这些：</p>
<h4 id="文件操作-API"><a href="#文件操作-API" class="headerlink" title="文件操作 API"></a>文件操作 API</h4><p>1）拷贝文件：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Files.copy(src.toPath(), dest.toPath(), optionList.toArray(<span class="keyword">new</span> <span class="title class_">CopyOption</span>[<span class="number">0</span>]));</span><br></pre></td></tr></tbody></table></figure>

<p>2）创建多级文件夹（哪怕中间有目录不存在）：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">File dest;</span><br><span class="line">dest.mkdirs();</span><br></pre></td></tr></tbody></table></figure>

<p>3）判断是否为目录：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">File dest;</span><br><span class="line">dest.isDirectory();</span><br></pre></td></tr></tbody></table></figure>

<p>4）文件是否存在：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">File dest;</span><br><span class="line">dest.exists()</span><br></pre></td></tr></tbody></table></figure>

<p>掌握这些 API，就能完成检测目录、创建目录、复制文件的一条龙操作了。</p>
<h4 id="示例代码"><a href="#示例代码" class="headerlink" title="示例代码"></a>示例代码</h4><p>递归算法的实现还是有一定复杂度的。核心思路就是先在目标位置创建和源项目相同的目录，然后依次遍历源目录下的所有子文件并复制；如果子文件又是一个目录，则再遍历子文件下的所有 “孙” 文件，如此循环往复。</p>
<p>鱼皮这里直接给出示例代码，将它放到 <code>StaticGenerator</code> 文件中，建议大家自己 Debug 一下来帮助理解：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 递归拷贝文件（递归实现，会将输入目录完整拷贝到输出目录下）</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> inputPath 输入路径</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> outputPath 输出路径</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">copyFilesByRecursive</span><span class="params">(String inputPath, String outputPath)</span> {</span><br><span class="line">       <span class="type">File</span> <span class="variable">inputFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(inputPath);</span><br><span class="line">       <span class="type">File</span> <span class="variable">outputFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(outputPath);</span><br><span class="line">       <span class="keyword">try</span> {</span><br><span class="line">           copyFileByRecursive(inputFile, outputFile);</span><br><span class="line">       } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">           System.err.println(<span class="string">"文件复制失败"</span>);</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">       }</span><br><span class="line">   }</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 文件 A =&gt; 目录 B，则文件 A 放在目录 B 下</span></span><br><span class="line"><span class="comment">    * 文件 A =&gt; 文件 B，则文件 A 覆盖文件 B</span></span><br><span class="line"><span class="comment">    * 目录 A =&gt; 目录 B，则目录 A 放在目录 B 下</span></span><br><span class="line"><span class="comment">    * &lt;p&gt;</span></span><br><span class="line"><span class="comment">    * 核心思路：先创建目录，然后遍历目录内的文件，依次复制</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> inputFile 输入路径</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> outputFile 输出路径</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">copyFileByRecursive</span><span class="params">(File inputFile, File outputFile)</span> <span class="keyword">throws</span> IOException {</span><br><span class="line">       <span class="comment">// 区分是文件还是目录</span></span><br><span class="line">       <span class="keyword">if</span> (inputFile.isDirectory()) {</span><br><span class="line">           System.out.println(inputFile.getName());</span><br><span class="line">           <span class="type">File</span> <span class="variable">destOutputFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(outputFile, inputFile.getName());</span><br><span class="line">           <span class="comment">// 如果是目录，首先创建目标目录</span></span><br><span class="line">           <span class="keyword">if</span> (!destOutputFile.exists()) {</span><br><span class="line">               destOutputFile.mkdirs();</span><br><span class="line">           }</span><br><span class="line">           <span class="comment">// 获取目录下的所有文件和子目录</span></span><br><span class="line">           File[] files = inputFile.listFiles();</span><br><span class="line">           <span class="comment">// 无子文件，直接结束</span></span><br><span class="line">           <span class="keyword">if</span> (ArrayUtil.isEmpty(files)) {</span><br><span class="line">               <span class="keyword">return</span>;</span><br><span class="line">           }</span><br><span class="line">           <span class="keyword">for</span> (File file : files) {</span><br><span class="line">               <span class="comment">// 递归拷贝下一层文件</span></span><br><span class="line">               copyFileByRecursive(file, destOutputFile);</span><br><span class="line">           }</span><br><span class="line">       } <span class="keyword">else</span> {</span><br><span class="line">           <span class="comment">// 是文件，直接复制到目标目录下</span></span><br><span class="line">           <span class="type">Path</span> <span class="variable">destPath</span> <span class="operator">=</span> outputFile.toPath().resolve(inputFile.getName());</span><br><span class="line">           Files.copy(inputFile.toPath(), destPath, StandardCopyOption.REPLACE_EXISTING);</span><br><span class="line">       }</span><br><span class="line">   }</span><br></pre></td></tr></tbody></table></figure>

<p>这种方式的优点是更灵活，可以依次对每一个文件进行处理（还能顺便复习算法）；缺点是需要自己实现，不仅麻烦，还有可能出现小 Bug。</p>
<h4 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h4><p>整个静态文件生成器 <code>StaticGenerator.java</code> 的完整代码如下：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.shiguang.generator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.io.FileUtil;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.util.ArrayUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Path;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.StandardCopyOption;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 静态文件生成器</span></span><br><span class="line"><span class="comment"> * Created By Shiguang On 2024/6/17 15:39</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StaticGenerator</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">projectPath</span> <span class="operator">=</span> System.getProperty(<span class="string">"user.dir"</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 输入路径,获取相对路径,不同操作系统可能有所不同</span></span><br><span class="line">        <span class="comment">// D:\Workspace\shiguang-coding\yuzi-generator\yuzi-generator-demo-projects\acm-template</span></span><br><span class="line">        <span class="comment">// File parentFile = new File(projectPath).getParentFile();</span></span><br><span class="line">        <span class="comment">// String inputPath = new File(parentFile, "yuzi-generator-demo-projects" + File.separator + "acm-template").getAbsolutePath();</span></span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">inputPath</span> <span class="operator">=</span> projectPath + File.separator + <span class="string">"yuzi-generator-demo-projects"</span> + File.separator + <span class="string">"acm-template"</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 输出路径</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">outputPath</span> <span class="operator">=</span> projectPath;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"输入路径: "</span> + inputPath);</span><br><span class="line">        System.out.println(<span class="string">"输出路径: "</span> + outputPath);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        copyFilesByHutool(inputPath, outputPath);</span></span><br><span class="line">        copyFilesByRecursive(inputPath, outputPath);</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 拷贝文件（Hutool 实现，会将输入目录完整拷贝到输出目录下）</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> inputPath  输入路径</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> outputPath 输出路径</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">copyFilesByHutool</span><span class="params">(String inputPath, String outputPath)</span> {</span><br><span class="line">        FileUtil.copy(inputPath, outputPath, <span class="literal">false</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 递归拷贝文件（递归实现，会将输入目录完整拷贝到输出目录下）</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> inputPath  输入路径</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> outputPath 输出路径</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">copyFilesByRecursive</span><span class="params">(String inputPath, String outputPath)</span> {</span><br><span class="line">        <span class="type">File</span> <span class="variable">inputFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(inputPath);</span><br><span class="line">        <span class="type">File</span> <span class="variable">outputFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(outputPath);</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            copyFileByRecursive(inputFile, outputFile);</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            System.err.println(<span class="string">"文件复制失败"</span>);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文件 A =&gt; 目录 B，则文件 A 放在目录 B 下</span></span><br><span class="line"><span class="comment">     * 文件 A =&gt; 文件 B，则文件 A 覆盖文件 B</span></span><br><span class="line"><span class="comment">     * 目录 A =&gt; 目录 B，则目录 A 放在目录 B 下</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 核心思路：先创建目录，然后遍历目录内的文件，依次复制</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> inputFile  输入路径</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> outputFile 输出路径</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">copyFileByRecursive</span><span class="params">(File inputFile, File outputFile)</span> <span class="keyword">throws</span> IOException {</span><br><span class="line">        <span class="comment">// 区分是文件还是目录</span></span><br><span class="line">        <span class="keyword">if</span> (inputFile.isDirectory()) {</span><br><span class="line">            System.out.println(inputFile.getName());</span><br><span class="line">            <span class="type">File</span> <span class="variable">destOutputFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(outputFile, inputFile.getName());</span><br><span class="line">            <span class="comment">// 如果是目录，首先创建目标目录</span></span><br><span class="line">            <span class="keyword">if</span> (!destOutputFile.exists()) {</span><br><span class="line">                destOutputFile.mkdirs();</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">// 获取目录下的所有文件和子目录</span></span><br><span class="line">            File[] files = inputFile.listFiles();</span><br><span class="line">            <span class="comment">// 无子文件，直接结束</span></span><br><span class="line">            <span class="keyword">if</span> (ArrayUtil.isEmpty(files)) {</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">for</span> (File file : files) {</span><br><span class="line">                <span class="comment">// 递归拷贝下一层文件</span></span><br><span class="line">                copyFileByRecursive(file, destOutputFile);</span><br><span class="line">            }</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            <span class="comment">// 是文件，直接复制到目标目录下</span></span><br><span class="line">            <span class="type">Path</span> <span class="variable">destPath</span> <span class="operator">=</span> outputFile.toPath().resolve(inputFile.getName());</span><br><span class="line">            Files.copy(inputFile.toPath(), destPath, StandardCopyOption.REPLACE_EXISTING);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h4 id="扩展思路"><a href="#扩展思路" class="headerlink" title="扩展思路"></a>扩展思路</h4><p>如果自己实现递归遍历，就可以很轻松地得到目录的完整结构树信息，可以由此制作出文件对比工具、目录分析工具、目录总结工具等等。</p>
<h2 id="四、动态文件生成思路"><a href="#四、动态文件生成思路" class="headerlink" title="四、动态文件生成思路"></a>四、动态文件生成思路</h2><p>实现了静态文件生成（复制目录）后，接下来让我们思考下如何对某个基础文件进行定制，根据用户的输入参数动态生成文件。</p>
<h3 id="明确动态生成需求"><a href="#明确动态生成需求" class="headerlink" title="明确动态生成需求"></a>明确动态生成需求</h3><p>对于 ACM 示例模板项目，我们可以怎么定制生成呢？</p>
<p>让我们先明确几个动态生成的需求：</p>
<ol>
<li>在代码开头增加作者 @Author 注释（增加代码）</li>
<li>修改程序输出的信息提示（替换代码）</li>
<li>将循环读取输入改为单次读取（可选代码）</li>
</ol>
<p>举个例子，想要得到的示例代码如下：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.shiguang.acm;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ACM 输入模板（多数之和）</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> yupi（1. 增加作者注释）</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainTemplate</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 可选是否循环</span></span><br><span class="line"><span class="comment">//        while (scanner.hasNext()) {</span></span><br><span class="line">            <span class="comment">// 读取输入元素个数</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> scanner.nextInt();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 读取数组</span></span><br><span class="line">            <span class="type">int</span>[] arr = <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) {</span><br><span class="line">                arr[i] = scanner.nextInt();</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 处理问题逻辑，根据需要进行输出</span></span><br><span class="line">            <span class="comment">// 示例：计算数组元素的和</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> num : arr) {</span><br><span class="line">                sum += num;</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 3. 输出信息可以修改</span></span><br><span class="line">            System.out.println(<span class="string">"求和结果: "</span> + sum);</span><br><span class="line"><span class="comment">//        }</span></span><br><span class="line"></span><br><span class="line">        scanner.close();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>可以在用户输入时给一些提示，例如:</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yupi.acm;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ACM 输入模板（多数之和）</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainTemplate</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        System.out.println(<span class="string">"请输入元素个数："</span>);</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (scanner.hasNext()) {</span><br><span class="line">            <span class="comment">// 读取输入元素个数</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> scanner.nextInt();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 读取数组</span></span><br><span class="line">            <span class="type">int</span>[] arr = <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) {</span><br><span class="line">                System.out.println(<span class="string">"请输入第"</span>+(i+<span class="number">1</span>)+<span class="string">"个元素："</span>);</span><br><span class="line">                arr[i] = scanner.nextInt();</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 处理问题逻辑，根据需要进行输出</span></span><br><span class="line">            <span class="comment">// 示例：计算数组元素的和</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> num : arr) {</span><br><span class="line">                sum += num;</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            System.out.println(n+<span class="string">"个元素总和为: "</span> + sum);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        scanner.close();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<h3 id="动态生成的核心原理"><a href="#动态生成的核心原理" class="headerlink" title="动态生成的核心原理"></a>动态生成的核心原理</h3><p>那么如何实现这些功能呢？在开篇教程中就已经讲过了，我们再复习一遍。</p>
<p>最经典的实现方法就是：提前基于基础文件 “挖坑”，编写 <strong>模板文件</strong> ，然后将用户输入的 <strong>参数</strong> “填坑”，替换到模板文件中，从而生成完整代码。</p>
<p>举个例子，用户输入参数：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">author = yupi</span><br></pre></td></tr></tbody></table></figure>

<p>模板文件代码：</p>
<p>将参数注入到模板文件中，得到生成的完整代码：</p>
<p>如果想要使用这套模板文件来生成其他的代码，只需要改变输入参数的值即可，而不需要改变模板文件。</p>
<p>听起来好像很简单，那么问题来了，如何编写模板文件呢？程序怎么知道应该把哪些变量替换为用户实际输入的参数呢？又该如何执行替换操作呢？</p>
<p>难道需要自己定义一套模板语法和规则，比如指定两个尖括号 <code>{{ 参数 }}</code> 中的内容为需要替换的参数，然后通过正则表达式或者字符串匹配扫描文件来进行替换么？</p>
<p>显然这太麻烦了！而且如果我需要根据用户的输入来生成不同次数的重复代码（也就是循环），又该如何实现呢？</p>
<p>所以建议大家直接使用已有的 <strong>模板引擎</strong> 技术，轻松实现模板编写和动态内容生成。</p>
<h2 id="五、FreeMarker-模板引擎入门"><a href="#五、FreeMarker-模板引擎入门" class="headerlink" title="五、FreeMarker 模板引擎入门"></a>五、FreeMarker 模板引擎入门</h2><h3 id="什么是模板引擎？为什么需要它？"><a href="#什么是模板引擎？为什么需要它？" class="headerlink" title="什么是模板引擎？为什么需要它？"></a>什么是模板引擎？为什么需要它？</h3><p>模板引擎是一种用于生成动态内容的类库（或框架），通过将预定义的模板与特定数据合并，来生成最终的输出。</p>
<p>使用模板引擎有很多的优点，首先就是提供现成的模板文件语法和解析能力。开发者只要按照特定要求去编写模板文件，比如使用 <code>${参数}</code> 语法，模板引擎就能自动将参数注入到模板中，得到完整文件，不用再自己编写解析逻辑了。</p>
<p>其次，模板引擎可以将数据和模板分离，让不同的开发人员独立工作。比如后端专心开发业务逻辑提供数据，前端专心写模板等，让系统更易于维护。</p>
<p>此外，模板引擎可能还具有一些安全特性，比如防止跨站脚本攻击等。所以强烈大家掌握至少一种模板引擎的用法。</p>
<p>有很多现成的模板引擎技术，比如 Java 的 Thymeleaf、FreeMarker、Velocity，前端的 Mustache 等。</p>
<p>本项目中，我会以知名的、稳定的经典模板引擎 FreeMarker 为例，带大家掌握模板引擎的使用方法。</p>
<h3 id="什么是-FreeMarker？"><a href="#什么是-FreeMarker？" class="headerlink" title="什么是 FreeMarker？"></a>什么是 FreeMarker？</h3><p>FreeMarker 是 Apache 的开源模板引擎，优点是入门简单、灵活易扩展。它不用和 Spring 开发框架、Servlet 环境、第三方依赖绑定，任何 Java 项目都可以使用。</p>
<p>我个人推荐的 FreeMarker 学习方式是直接阅读官方文档，虽然是英文的，但每一节基本都有代码示例，还是比较好理解的。</p>
<blockquote>
<p>FreeMarker 官方文档：<a target="_blank" rel="noopener" href="https://freemarker.apache.org/docs/index.html">https://freemarker.apache.org/docs/index.html</a></p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/10/17/6710c054b4e7c.png" alt="image-20240617131917910"></p>
<p>看不懂英文也没关系，鱼皮下面就带大家学习 FreeMarker，只讲常用的特性，主打一个快速入门！</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://freemarker.foofun.cn/toc.html">FreeMarker 中文官方参考手册</a></p>
</blockquote>
<h3 id="模板引擎的作用"><a href="#模板引擎的作用" class="headerlink" title="模板引擎的作用"></a>模板引擎的作用</h3><p>上面已经讲过了模板引擎的作用，这里就再用 FreeMarker 官网的一张图，强化下大家的理解。</p>
<p>如下图，FreeMarker 模板引擎的作用就是接受模板和 Java 对象，对它们进行处理，输出完整的内容。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/10/17/6710c055011fc.png" alt="image-20240617131903808"></p>
<p>下面我们先依次来学习 FreeMarker 的核心概念（模板和数据模型），然后通过一个 Demo 快速入门。</p>
<h3 id="模板"><a href="#模板" class="headerlink" title="模板"></a>模板</h3><p>FreeMarker 拥有自己的模板编写规则，一般用 FTL 表示 FreeMarker 模板语言。比如 <code>myweb.html.ftl</code> 就是一个 FreeMarker 的模板文件。</p>
<p>模板文件由 4 个核心部分组成：</p>
<p>1）文本：固定的内容，会按原样输出。</p>
<p>2）插值：用 <code>${...}</code> 语法来占位，尖括号中的内容在经过计算和替换后，才会输出。</p>
<p>3）FTL 指令：有点像 HTML 的标签语法，通过 <code>&lt;#xxx ... &gt;</code> 来实现各种特殊功能。比如 <code>&lt;#list elements as element&gt;</code> 实现循环输出。</p>
<p>4）注释：和 HTML 注释类似，使用 <code>&lt;#-- ... --&gt;</code> 语法，注释中的内容不会输出。</p>
<p>让我们以《時光官网》为例，举一个 FreeMarker 模板文件的例子：</p>
<blockquote>
<p>学过前端开发框架的同学应该会觉得很眼熟~</p>
</blockquote>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>時光官网<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=utf-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>欢迎来到時光官网<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    &lt;#-- 循环渲染导航条 --&gt;</span><br><span class="line">    &lt;#list menuItems as item&gt;</span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"${item.url}"</span>&gt;</span>${item.label}<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    &lt;/#list&gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">&lt;#-- 底部版权信息（注释部分，不会被输出）--&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">footer</span>&gt;</span></span><br><span class="line">    ${currentYear} 時光官网. All rights reserved.</span><br><span class="line"><span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="数据模型"><a href="#数据模型" class="headerlink" title="数据模型"></a>数据模型</h3><p>我们把为模板准备的所有数据整体统称为 <strong>数据模型</strong> 。</p>
<p>在 FreeMarker 中，数据模型一般是树形结构，可以是复杂的 Java 对象、也可以是 HashMap 等更通用的结构。</p>
<p>比如为上述《鱼皮官网》模板准备的数据模型，结构可能是这样的：</p>
<figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"currentYear"</span><span class="punctuation">:</span> <span class="number">2024</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"menuItems"</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">{</span></span><br><span class="line">      <span class="attr">"url"</span><span class="punctuation">:</span> <span class="string">"https://www.shiguang666.eu.org"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"label"</span><span class="punctuation">:</span> <span class="string">"時光主页"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">{</span></span><br><span class="line">      <span class="attr">"url"</span><span class="punctuation">:</span> <span class="string">"https://blog.shiguangdev.cn"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"label"</span><span class="punctuation">:</span> <span class="string">"時光的博客园子"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">{</span></span><br><span class="line">      <span class="attr">"url"</span><span class="punctuation">:</span> <span class="string">"https://nav.shiguang666.eu.org"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"label"</span><span class="punctuation">:</span> <span class="string">"時光导航站"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">}</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="Demo-实战"><a href="#Demo-实战" class="headerlink" title="Demo 实战"></a>Demo 实战</h3><p>在了解模板和数据模型后，让我们通过 FreeMarker 对二者进行组合处理。</p>
<h4 id="1、引入依赖"><a href="#1、引入依赖" class="headerlink" title="1、引入依赖"></a>1、引入依赖</h4><p>首先创建一个 Maven 项目（这里就用我们的 <code>yuzi-generator-basic</code> 项目），在 <code>pom.xml</code> 中引入 FreeMarker：</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://freemarker.apache.org/index.html --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.freemarker<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>freemarker<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.32<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>如果是 Spring Boot 项目的话，可以直接引入 starter 依赖：</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-freemarker<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<h4 id="2、创建配置对象"><a href="#2、创建配置对象" class="headerlink" title="2、创建配置对象"></a>2、创建配置对象</h4><p>在 <code>test/java</code> 目录下新建一个单元测试类 <code>FreeMarkerTest</code> ，在 Test 方法中创建一个 FreeMarker 的全局配置对象，可以统一指定模板文件所在的路径、模板文件的字符集等。</p>
<p>示例代码如下：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// new 出 Configuration 对象，参数为 FreeMarker 版本号</span></span><br><span class="line"><span class="type">Configuration</span> <span class="variable">configuration</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Configuration</span>(Configuration.VERSION_2_3_32);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 指定模板文件所在的路径</span></span><br><span class="line">configuration.setDirectoryForTemplateLoading(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">"src/main/resources/templates"</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置模板文件使用的字符集</span></span><br><span class="line">configuration.setDefaultEncoding(<span class="string">"utf-8"</span>);</span><br></pre></td></tr></tbody></table></figure>

<h4 id="3、准备模版并加载"><a href="#3、准备模版并加载" class="headerlink" title="3、准备模版并加载"></a>3、准备模版并加载</h4><p>我们将上述《時光官网》的模板代码保存为 <code>myweb.html.ftl</code> 文件，存放在上面指定的目录下。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/10/17/6710c055714e6.png" alt="image-20240617131852777"></p>
<p>准备好模板文件后，通过创建 Template 对象来加载该模板。示例代码如下：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建模板对象，加载指定模板</span></span><br><span class="line"><span class="type">Template</span> <span class="variable">template</span> <span class="operator">=</span> configuration.getTemplate(<span class="string">"myweb.html.ftl"</span>);</span><br></pre></td></tr></tbody></table></figure>

<h4 id="4、创建数据模型"><a href="#4、创建数据模型" class="headerlink" title="4、创建数据模型"></a>4、创建数据模型</h4><p>如果想保证数据的质量和规范性，可以使用对象来保存 “喂” 给模板的数据；反之，如果想更灵活地构造数据模型，推荐使用 HashMap 结构。</p>
<p>比如我们想构造《鱼皮官网》的数据模型，需要制定当前年份和导航菜单项，示例代码如下：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 数据模型</span></span><br><span class="line">Map&lt;String, Object&gt; dataModel = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">dataModel.put(<span class="string">"currentYear"</span>, <span class="number">2024</span>);</span><br><span class="line"></span><br><span class="line">List&lt;Map&lt;String, Object&gt;&gt; menuItems = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">Map&lt;String, Object&gt; menuItem1 = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">menuItem1.put(<span class="string">"url"</span>, <span class="string">"https://shiguang666.eu.org"</span>);</span><br><span class="line">menuItem1.put(<span class="string">"label"</span>, <span class="string">"時光主页"</span>);</span><br><span class="line"></span><br><span class="line">Map&lt;String, Object&gt; menuItem2 = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">menuItem2.put(<span class="string">"url"</span>, <span class="string">"https://blog.shiguangdev.cn"</span>);</span><br><span class="line">menuItem2.put(<span class="string">"label"</span>, <span class="string">"時光博客园子"</span>);</span><br><span class="line"></span><br><span class="line">Map&lt;String, Object&gt; menuItem3 = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">menuItem3.put(<span class="string">"url"</span>, <span class="string">"https://nav.shiguang666.eu.org"</span>);</span><br><span class="line">menuItem3.put(<span class="string">"label"</span>, <span class="string">"時光导航站"</span>);</span><br><span class="line"></span><br><span class="line">menuItems.add(menuItem1);</span><br><span class="line">menuItems.add(menuItem2);</span><br><span class="line">menuItems.add(menuItem3);</span><br><span class="line">dataModel.put(<span class="string">"menuItems"</span>, menuItems);</span><br></pre></td></tr></tbody></table></figure>

<h4 id="5、指定生成的文件"><a href="#5、指定生成的文件" class="headerlink" title="5、指定生成的文件"></a>5、指定生成的文件</h4><p>可以直接使用 FileWriter 对象，指定生成的文件路径和名称：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Writer</span> <span class="variable">out</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileWriter</span>(<span class="string">"myweb.html"</span>);</span><br></pre></td></tr></tbody></table></figure>

<h4 id="6、生成文件"><a href="#6、生成文件" class="headerlink" title="6、生成文件"></a>6、生成文件</h4><p>一切准备就绪，最后只需要调用 template 对象的 process 方法，就可以处理并生成文件了。</p>
<p>示例代码如下：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">template.process(dataModel, out);</span><br><span class="line">out.close();</span><br></pre></td></tr></tbody></table></figure>

<p>生成后的文件如下：</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>時光官网<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=utf-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>欢迎来到時光官网<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"https://shiguang666.eu.org"</span>&gt;</span>時光主页<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"https://blog.shiguangdev.cn"</span>&gt;</span>時光博客园子<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"https://nav.shiguang666.eu.org"</span>&gt;</span>時光导航站<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">footer</span>&gt;</span></span><br><span class="line">    2,024 時光官网. All rights reserved.</span><br><span class="line"><span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>运行如下所示：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/10/17/6710c055b5e6d.png" alt="image-20240617212004852"></p>
<p>这里添加 <code>&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8"&gt;</code> 是为了防止在IDEA预览时乱码,如果出现乱码问题，可参考文章</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/wdw18668109050/article/details/82720238">IDEA环境解决网页中文乱码的问题</a></p>
</blockquote>
<h4 id="7、完整代码"><a href="#7、完整代码" class="headerlink" title="7、完整代码"></a>7、完整代码</h4><p>组合上面的所有代码并执行，发现在项目的根路径下生成了网页文件，至此 Demo 结束，很简单吧~</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/10/17/6710c05600bcd.png" alt="image-20240617212332366"></p>
<p><code>FreeMarkerTest.java</code> 文件的完整代码：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> freemarker.template.Configuration;</span><br><span class="line"><span class="keyword">import</span> freemarker.template.Template;</span><br><span class="line"><span class="keyword">import</span> freemarker.template.TemplateException;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileWriter;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.Writer;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created By Shiguang On 2024/6/17 20:42</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FreeMarkerTest</span> {</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> <span class="keyword">throws</span> IOException, TemplateException {</span><br><span class="line">        <span class="comment">// new 出 Configuration 对象，参数为 FreeMarker 版本号</span></span><br><span class="line"></span><br><span class="line">        <span class="type">Configuration</span> <span class="variable">configuration</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Configuration</span>(Configuration.VERSION_2_3_32);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 指定模板文件所在的路径</span></span><br><span class="line">        configuration.setDirectoryForTemplateLoading(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">"src/main/resources/templates"</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置模板文件使用的字符集</span></span><br><span class="line">        configuration.setDefaultEncoding(<span class="string">"utf-8"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建模板对象，加载指定模板</span></span><br><span class="line">        <span class="type">Template</span> <span class="variable">template</span> <span class="operator">=</span> configuration.getTemplate(<span class="string">"myweb.html.ftl"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 数据模型</span></span><br><span class="line">        Map&lt;String, Object&gt; dataModel = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        dataModel.put(<span class="string">"currentYear"</span>, <span class="number">2024</span>);</span><br><span class="line"></span><br><span class="line">        List&lt;Map&lt;String, Object&gt;&gt; menuItems = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        Map&lt;String, Object&gt; menuItem1 = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        menuItem1.put(<span class="string">"url"</span>, <span class="string">"https://shiguang666.eu.org"</span>);</span><br><span class="line">        menuItem1.put(<span class="string">"label"</span>, <span class="string">"時光主页"</span>);</span><br><span class="line"></span><br><span class="line">        Map&lt;String, Object&gt; menuItem2 = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        menuItem2.put(<span class="string">"url"</span>, <span class="string">"https://blog.shiguangdev.cn"</span>);</span><br><span class="line">        menuItem2.put(<span class="string">"label"</span>, <span class="string">"時光博客园子"</span>);</span><br><span class="line"></span><br><span class="line">        Map&lt;String, Object&gt; menuItem3 = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        menuItem3.put(<span class="string">"url"</span>, <span class="string">"https://nav.shiguang666.eu.org"</span>);</span><br><span class="line">        menuItem3.put(<span class="string">"label"</span>, <span class="string">"時光导航站"</span>);</span><br><span class="line"></span><br><span class="line">        menuItems.add(menuItem1);</span><br><span class="line">        menuItems.add(menuItem2);</span><br><span class="line">        menuItems.add(menuItem3);</span><br><span class="line">        dataModel.put(<span class="string">"menuItems"</span>, menuItems);</span><br><span class="line"></span><br><span class="line">        <span class="type">Writer</span> <span class="variable">out</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileWriter</span>(<span class="string">"myweb.html"</span>);</span><br><span class="line"></span><br><span class="line">        template.process(dataModel, out);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 关闭输出流</span></span><br><span class="line">        out.close();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="常用语法"><a href="#常用语法" class="headerlink" title="常用语法"></a>常用语法</h3><p>学会了 FreeMarker 的基本开发流程后，我们来学习一些 FreeMarker 中的实用特性。</p>
<p>注意，FreeMarker 的语法和特性非常多，本文仅带大家学习常用的、易用的语法。无需记忆，日后需要用到 FreeMarker 时，再去对照官方文档查漏补缺即可。</p>
<h4 id="1、插值"><a href="#1、插值" class="headerlink" title="1、插值"></a>1、插值</h4><p>在上面的 Demo 中，已经给大家演示了差值的基本语法（ <code>${xxx}</code> ）。但插值还有很多花样可以玩，比如支持传递表达式：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">表达式：<span class="variable">${100 + money}</span></span><br></pre></td></tr></tbody></table></figure>

<p>不过个人不建议在模板文件中写表达式，为什么不在创建数据模型时就计算好要展示的值呢？</p>
<h4 id="2、分支和判空"><a href="#2、分支和判空" class="headerlink" title="2、分支和判空"></a>2、分支和判空</h4><p>和程序开发一样，FreeMarker 模板也支持分支表达式（if … else），示例代码如下：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;#<span class="keyword">if</span> user == <span class="string">"鱼皮"</span>&gt;</span><br><span class="line">  我是鱼皮</span><br><span class="line">&lt;#<span class="keyword">else</span>&gt;</span><br><span class="line">  我是猪皮</span><br><span class="line">&lt;/#<span class="keyword">if</span>&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>分支语句的一个常用场景就是判空，比如要判断 user 参数是否存在，可以用下面的语法：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;#<span class="keyword">if</span> user??&gt;</span><br><span class="line">  存在用户</span><br><span class="line">&lt;#<span class="keyword">else</span>&gt;</span><br><span class="line">  用户不存在</span><br><span class="line">&lt;/#<span class="keyword">if</span>&gt;</span><br></pre></td></tr></tbody></table></figure>

<h4 id="3、默认值"><a href="#3、默认值" class="headerlink" title="3、默认值"></a>3、默认值</h4><p>FreeMarker 对变量的空值校验是很严格的，如果模板中某个对象为空，FreeMarker 将会报错而导致模板生成中断。</p>
<p>为了防止这个问题，建议给可能为空的参数都设置默认值。使用 <code>表达式!默认值</code> 的语法，示例代码如下：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">${user!"用户为空"}</span></span><br></pre></td></tr></tbody></table></figure>

<p>上述代码中，如果 user 对象为空，则会输出 “用户为空” 字符串。</p>
<h4 id="4、循环"><a href="#4、循环" class="headerlink" title="4、循环"></a>4、循环</h4><p>在上述 Demo 实战部分，已经给大家演示了循环的用法。即 <code>&lt;#list items as item&gt;</code> 表达式，可以遍历某个序列类型的参数并重复输出多条内容。</p>
<p>示例代码如下：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;#list <span class="built_in">users</span> as user&gt;</span><br><span class="line">  <span class="variable">${user}</span></span><br><span class="line">&lt;/#list&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>其中，users 是整个列表，而 user 是遍历列表每个元素时临时存储的变量，跟 for 循环一样，会依次输出每个 user 的值。</p>
<h4 id="5、宏定义"><a href="#5、宏定义" class="headerlink" title="5、宏定义"></a>5、宏定义</h4><p>学过 C 语言和 C++ 的同学应该对 “宏” 这个词并不陌生。可以把 “宏” 理解为一个预定义的模板片段。支持给宏传入变量，来复用模板片段。</p>
<blockquote>
<p>其实类似于前端开发中组件复用的思想。</p>
</blockquote>
<p>在 FreeMarker 中，使用 <code>macro</code> 指令来定义宏。</p>
<p>让我们来定义一个宏，用于输出特定格式的用户昵称，比如：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;#macro card userName&gt;     </span><br><span class="line">---------    </span><br><span class="line"><span class="variable">${userName}</span></span><br><span class="line">---------</span><br><span class="line">&lt;/#macro&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>其中，card 是宏的名称，userName 是宏接受的参数。</p>
<p>可以用 <code>@</code> 语法来使用宏，示例代码如下：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;@card userName=<span class="string">"鱼皮"</span>/&gt;</span><br><span class="line">&lt;@card userName=<span class="string">"二黑"</span>/&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>实际生成的输出结果为：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">---------    </span><br><span class="line">鱼皮</span><br><span class="line">---------</span><br><span class="line">---------    </span><br><span class="line">二黑</span><br><span class="line">---------</span><br></pre></td></tr></tbody></table></figure>

<p>宏标签中支持嵌套内容，不过还是有些复杂的（再讲下去就成前端课了），大家需要用到时查看官方文档就好。</p>
<blockquote>
<p>自定义指令：<a target="_blank" rel="noopener" href="http://freemarker.foofun.cn/dgui_misc_userdefdir.html">http://freemarker.foofun.cn/dgui_misc_userdefdir.html</a></p>
</blockquote>
<h4 id="6、内建函数"><a href="#6、内建函数" class="headerlink" title="6、内建函数"></a>6、内建函数</h4><p>内建函数是 FreeMarker 为了提高开发者处理参数效率而提供的的语法糖，可以通过 <code>?</code> 来调用内建函数。</p>
<p>比如将字符串转为大写：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">${userName?upper_case}</span></span><br></pre></td></tr></tbody></table></figure>

<p>比如输出序列的长度：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">${myList?size}</span></span><br></pre></td></tr></tbody></table></figure>

<p>把内建函数想象成调用 Java 对象的方法，就很好理解了。</p>
<p>内建函数是 FreeMarker 非常强大的一个能力，比如想在循环语法中依次输出元素的下标，就可以使用循环表达式自带的 <code>index</code> 内建函数：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;#list <span class="built_in">users</span> as user&gt;</span><br><span class="line">  <span class="variable">${user?index}</span></span><br><span class="line">&lt;/#list&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>内建函数种类丰富、数量极多，因此不建议大家记忆，需要用到的时候去查阅官方文档即可。</p>
<blockquote>
<p>内建函数大全参考：<a target="_blank" rel="noopener" href="http://freemarker.foofun.cn/ref_builtins.html">http://freemarker.foofun.cn/ref_builtins.html</a></p>
</blockquote>
<h4 id="7、其他"><a href="#7、其他" class="headerlink" title="7、其他"></a>7、其他</h4><p>还有更多特性，比如命名空间，其实就相当于 Java 中的包，用于隔离代码、宏、变量等。</p>
<p>不过没必要细讲，因为掌握上述常用语法后，基本就能够开发大多数模板文件了。更多内容自主查阅官方文档学习即可。</p>
<h3 id="问题解决示例"><a href="#问题解决示例" class="headerlink" title="问题解决示例"></a>问题解决示例</h3><p>给大家分享一个通过查阅官方文档解决具体问题的例子，比如之前生成的网站文件中，我们发现数字中间加了一个逗号分割符，如下图：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/10/17/6710c05638cde.png" alt="image-20240617131833778"></p>
<p>这是因为 FreeMarker 使用 Java 平台的本地化敏感的数字格式信息，如果想把分割符取消掉，怎么办呢？</p>
<p>我们可以通过查阅官方文档看到以下信息：</p>
<blockquote>
<p>地址：<a target="_blank" rel="noopener" href="http://freemarker.foofun.cn/app_faq.html#faq_number_grouping">http://freemarker.foofun.cn/app_faq.html#faq_number_grouping</a></p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/10/17/6710c05688867.png" alt="image-20240617132004501"></p>
<p>按照文档的提示，修改 configuration 配置类的 number_format 设置，即可调整默认生成的数字格式啦。</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">configuration.setNumberFormat(<span class="string">"0.######"</span>);</span><br></pre></td></tr></tbody></table></figure>

<h3 id="更多学习资源"><a href="#更多学习资源" class="headerlink" title="更多学习资源"></a>更多学习资源</h3><p>官方文档：<a target="_blank" rel="noopener" href="https://freemarker.apache.org/docs/index.html">https://freemarker.apache.org/docs/index.html</a></p>
<p>中文教程：<a target="_blank" rel="noopener" href="http://freemarker.foofun.cn/toc.html">http://freemarker.foofun.cn/toc.html</a></p>
<p>FreeMarker 教程网：<a target="_blank" rel="noopener" href="http://www.freemarker.net/">http://www.freemarker.net/</a></p>
<h2 id="六、动态文件生成实现"><a href="#六、动态文件生成实现" class="headerlink" title="六、动态文件生成实现"></a>六、动态文件生成实现</h2><p>学完了 FreeMarker 模板引擎后，让我们立刻实战一番，实现 ACM 示例模板项目的动态生成吧！</p>
<p>核心步骤为：</p>
<ol>
<li>定义数据模型</li>
<li>编写动态模板</li>
<li>组合生成</li>
<li>完善优化</li>
</ol>
<h3 id="1、定义数据模型"><a href="#1、定义数据模型" class="headerlink" title="1、定义数据模型"></a>1、定义数据模型</h3><p>针对上述需求，我们在 <code>com.shiguang.model</code> 包下新建一个模板配置对象，用来接收要传递给模板的参数。</p>
<p>注意要根据替换需求选择参数的类型，比如可选生成用 boolean、字符串替换用 String，示例代码如下：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.shiguang.model;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 静态模板配置</span></span><br><span class="line"><span class="comment"> * Created By Shiguang On 2024/6/17 21:39</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainTemplateConfig</span> {</span><br><span class="line">    <span class="comment">// 明确需求</span></span><br><span class="line">    <span class="comment">//1.在代码开头增加作者 @Author 注释（增加代码）</span></span><br><span class="line">    <span class="comment">//2.修改程序输出的信息提示（替换代码）</span></span><br><span class="line">    <span class="comment">//3.将循环读取输入改为单次读取（可选代码）</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 是否生成循环</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> loop;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 作者注释</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String author;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 输出信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String outputText;</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>其实也可以使用 HashMap，但是不如定义对象更清晰、更规范。</p>
<h3 id="2、编写动态模板"><a href="#2、编写动态模板" class="headerlink" title="2、编写动态模板"></a>2、编写动态模板</h3><p>在 <code>resources/templates</code> 目录下新建 FTL 模板文件 <code>MainTemplate.java.ftl</code>（模板和上面定义的数据模型名称保持一致）。</p>
<p>制作模板的方法很简单：先复制原始代码，再挖坑。</p>
<p>完整动态模板代码如下：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.shiguang.acm;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ACM 输入模板（多数之和）</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> ${author}</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainTemplate</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        &lt;#<span class="keyword">if</span> loop&gt;</span><br><span class="line">            <span class="keyword">while</span> (scanner.hasNext()) {</span><br><span class="line">        &lt;/#<span class="keyword">if</span>&gt;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 读取输入元素个数</span></span><br><span class="line">                <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> scanner.nextInt();</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 读取数组</span></span><br><span class="line">                <span class="type">int</span>[] arr = <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) {</span><br><span class="line">                    arr[i] = scanner.nextInt();</span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 处理问题逻辑，根据需要进行输出</span></span><br><span class="line">                <span class="comment">// 示例：计算数组元素的和</span></span><br><span class="line">                <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> num : arr) {</span><br><span class="line">                    sum += num;</span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">                System.out.println(<span class="string">"${outputText}: "</span> + sum);</span><br><span class="line"></span><br><span class="line">        &lt;#<span class="keyword">if</span> loop&gt;</span><br><span class="line">            }</span><br><span class="line">        &lt;/#<span class="keyword">if</span>&gt;</span><br><span class="line"></span><br><span class="line">        scanner.close();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>其中，我们使用插值表达式 <code>${author}</code> 接受作者名称，使用 <code>&lt;#if loop&gt; ... &lt;/#if&gt;</code> 分支来控制是否生成循环代码，使用 <code>${outputText}</code> 控制输出信息。</p>
<h3 id="3、组合生成"><a href="#3、组合生成" class="headerlink" title="3、组合生成"></a>3、组合生成</h3><p>同静态文件生成器一样，我们在 <code>com.shiguang.generator</code> 目录下新建动态文件生成器类 <code>DynamicGenerator</code>。</p>
<p>和上述 FreeMarker Demo 实战一样，在 Main 方法中编写生成逻辑，依次完成：创建 Configuration 对象、模板对象、创建数据模型、指定输出路径、执行生成。</p>
<p>完整代码如下：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TemplateException {</span><br><span class="line">    <span class="comment">// new 出 Configuration 对象，参数为 FreeMarker 版本号</span></span><br><span class="line">    <span class="type">Configuration</span> <span class="variable">configuration</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Configuration</span>(Configuration.VERSION_2_3_32);</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">projectPath</span> <span class="operator">=</span> System.getProperty(<span class="string">"user.dir"</span>) + File.separator + <span class="string">"yuzi-generator-basic"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">File</span> <span class="variable">parentFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(projectPath);</span><br><span class="line">    <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(parentFile, <span class="string">"src/main/resources/templates"</span>);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">"projectPath: "</span> + projectPath);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">"filePath: "</span> + file.getPath());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 指定模板文件所在的路径</span></span><br><span class="line">    configuration.setDirectoryForTemplateLoading(file);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置模板文件使用的字符集</span></span><br><span class="line">    configuration.setDefaultEncoding(<span class="string">"utf-8"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// FreeMarker 使用Java平台的本地化敏感的数字格式信息。</span></span><br><span class="line">    <span class="comment">// 默认的本地化数字格式可能是分组或其他不想要的格式。</span></span><br><span class="line">    <span class="comment">// 为了避免这种情况，你不得不使用 FreeMarker 设置 中的 number_format 来重写Java平台建议的数字格式</span></span><br><span class="line">    <span class="comment">// 设置数字格式不显示逗号分隔符</span></span><br><span class="line">    configuration.setNumberFormat(<span class="string">"0.######"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建模板对象，加载指定模板</span></span><br><span class="line">    <span class="type">Template</span> <span class="variable">template</span> <span class="operator">=</span> configuration.getTemplate(<span class="string">"MainTemplateConfig.java.ftl"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 数据模型</span></span><br><span class="line">    <span class="type">MainTemplateConfig</span> <span class="variable">mainTemplateConfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MainTemplateConfig</span>();</span><br><span class="line">    mainTemplateConfig.setAuthor(<span class="string">"時光"</span>);</span><br><span class="line">    mainTemplateConfig.setOutputText(<span class="string">"输出结果"</span>);</span><br><span class="line">    mainTemplateConfig.setLoop(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">outPath</span> <span class="operator">=</span> projectPath + File.separator + <span class="string">"MainTemplateConfig.java"</span>;</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">"outPath: "</span> + outPath);</span><br><span class="line"></span><br><span class="line">    <span class="type">Writer</span> <span class="variable">out</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileWriter</span>(outPath);</span><br><span class="line"></span><br><span class="line">    template.process(mainTemplateConfig, out);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 关闭输出流</span></span><br><span class="line">    out.close();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>执行后可以发现，在项目根目录下，生成了 <code>MainTemplate.java</code> 文件，内容符合我们的预期：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/10/17/6710c056e81e6.png" alt="image-20240617224757397"></p>
<h3 id="4、完善优化"><a href="#4、完善优化" class="headerlink" title="4、完善优化"></a>4、完善优化</h3><p>虽然已经实现了动态文件生成，但我们还要进一步优化代码的健壮性、灵活性。</p>
<h4 id="完善模板"><a href="#完善模板" class="headerlink" title="完善模板"></a>完善模板</h4><p>经过测试发现，如果数据模型的字符串变量不设置任何值，那么会报如下错误：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/10/17/6710c057397e6.png" alt="image-20240617131659594"></p>
<p>所以建议给所有字符串指定一个默认值，这里有两种方法：</p>
<p>1）方法 1，直接给 POJO 设置默认值：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="type">String</span> <span class="variable">outputText</span> <span class="operator">=</span> <span class="string">"sum = "</span>;</span><br></pre></td></tr></tbody></table></figure>

<p>2）方法 2，使用 FreeMarker 的默认值操作符：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(<span class="string">"${outputText!'sum = '}"</span> + sum);</span><br></pre></td></tr></tbody></table></figure>

<p>个人更推荐第一种方式，不用多学一套语法，也不用让其他开发者理解模板文件。</p>
<p>让我们修改 <code>MainTemplateConfig</code> 文件，给数据模型增加默认值：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainTemplateConfig</span> {</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> loop;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">author</span> <span class="operator">=</span> <span class="string">"yupi"</span>;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">outputText</span> <span class="operator">=</span> <span class="string">"sum = "</span>;</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<h4 id="抽取方法"><a href="#抽取方法" class="headerlink" title="抽取方法"></a>抽取方法</h4><p>上述代码中，我们是把模板文件路径、数据模型、输出路径全部硬编码在了 Main 方法中。而为了提高代码的可复用性，我们可以将生成逻辑封装为一个方法，将硬编码的参数作为方法输入参数，可以用调用方指定。</p>
<p>代码如下：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 生成文件</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> inputPath  模板文件输入路径</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> outputPath 输出路径</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> model      数据模型</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@throws</span> TemplateException</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">doGenerate</span><span class="params">(String inputPath, String outputPath, Object model)</span> <span class="keyword">throws</span> IOException, TemplateException {</span><br><span class="line">    <span class="comment">// new 出 Configuration 对象，参数为 FreeMarker 版本号</span></span><br><span class="line">    <span class="type">Configuration</span> <span class="variable">configuration</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Configuration</span>(Configuration.VERSION_2_3_32);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 指定模板文件所在的路径</span></span><br><span class="line">    <span class="type">File</span> <span class="variable">templateDir</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(inputPath).getParentFile();</span><br><span class="line">    configuration.setDirectoryForTemplateLoading(templateDir);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置模板文件使用的字符集</span></span><br><span class="line">    configuration.setDefaultEncoding(<span class="string">"utf-8"</span>);</span><br><span class="line">    <span class="comment">// 设置数字格式不显示分隔符</span></span><br><span class="line">    configuration.setNumberFormat(<span class="string">"0.######"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建模板对象，加载指定模板</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">templateName</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(inputPath).getName();</span><br><span class="line">    <span class="type">Template</span> <span class="variable">template</span> <span class="operator">=</span> configuration.getTemplate(templateName);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 生成</span></span><br><span class="line">    <span class="type">Writer</span> <span class="variable">out</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileWriter</span>(outputPath);</span><br><span class="line">    template.process(model, out);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 生成文件后别忘了关闭哦</span></span><br><span class="line">    out.close();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>然后 Main 方法（调用方）的代码就可以大大简化了，如下：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TemplateException {</span><br><span class="line">        <span class="type">String</span> <span class="variable">projectPath</span> <span class="operator">=</span> System.getProperty(<span class="string">"user.dir"</span>) + File.separator + <span class="string">"yuzi-generator-basic"</span>;</span><br><span class="line"><span class="comment">//        String inputPath = projectPath + File.separator + "src" + File.separator + "main" + File.separator + "resources" + File.separator + "templates" + File.separator + "MainTemplateConfig.java.ftl";</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">inputPath</span> <span class="operator">=</span> projectPath + File.separator + <span class="string">"src/main/resources/templates/MainTemplateConfig.java.ftl"</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">outputPath</span> <span class="operator">=</span> projectPath + File.separator + <span class="string">"MainTemplateConfig.java"</span>;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"projectPath: "</span> + projectPath);</span><br><span class="line">        System.out.println(<span class="string">"inputPath: "</span> + inputPath);</span><br><span class="line">        System.out.println(<span class="string">"outputPath: "</span> + outputPath);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 数据模型</span></span><br><span class="line">        <span class="type">MainTemplateConfig</span> <span class="variable">mainTemplateConfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MainTemplateConfig</span>();</span><br><span class="line">        mainTemplateConfig.setAuthor(<span class="string">"時光"</span>);</span><br><span class="line">        mainTemplateConfig.setOutputText(<span class="string">"输出结果"</span>);</span><br><span class="line">        mainTemplateConfig.setLoop(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        doGenerate(inputPath, outputPath, mainTemplateConfig);</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>

<p>注意，上述代码中，我们通过 <code>System.getProperty("user.dir")</code> 获取到的路径是 <code>yuzi-generator</code>，那么需要给 <code>projectPath</code> 再拼接 <code>yuzi-generator-basic</code> 路径。</p>
<p>如果在你实际运行代码的过程中发现 <code>System.getProperty("user.dir")</code> 获取到的路径是 <code>yuzi-generator/yuzi-generator-basic</code>，那么可以直接使用相对路径获取到模板地址。</p>
<h3 id="完整代码-1"><a href="#完整代码-1" class="headerlink" title="完整代码"></a>完整代码</h3><p>整个动态文件生成器 <code>DynamicGenerator.java</code> 的完整代码如下：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.shiguang.generator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.shiguang.model.MainTemplateConfig;</span><br><span class="line"><span class="keyword">import</span> freemarker.template.Configuration;</span><br><span class="line"><span class="keyword">import</span> freemarker.template.Template;</span><br><span class="line"><span class="keyword">import</span> freemarker.template.TemplateException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileWriter;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.Writer;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 动态文件生成器</span></span><br><span class="line"><span class="comment"> * Created By Shiguang On 2024/6/17 21:56</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DynamicGenerator</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TemplateException {</span><br><span class="line">        <span class="type">String</span> <span class="variable">projectPath</span> <span class="operator">=</span> System.getProperty(<span class="string">"user.dir"</span>) + File.separator + <span class="string">"yuzi-generator-basic"</span>;</span><br><span class="line"><span class="comment">//        String inputPath = projectPath + File.separator + "src" + File.separator + "main" + File.separator + "resources" + File.separator + "templates" + File.separator + "MainTemplateConfig.java.ftl";</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">inputPath</span> <span class="operator">=</span> projectPath + File.separator + <span class="string">"src/main/resources/templates/MainTemplateConfig.java.ftl"</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">outputPath</span> <span class="operator">=</span> projectPath + File.separator + <span class="string">"MainTemplateConfig.java"</span>;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"projectPath: "</span> + projectPath);</span><br><span class="line">        System.out.println(<span class="string">"inputPath: "</span> + inputPath);</span><br><span class="line">        System.out.println(<span class="string">"outputPath: "</span> + outputPath);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 数据模型</span></span><br><span class="line">        <span class="type">MainTemplateConfig</span> <span class="variable">mainTemplateConfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MainTemplateConfig</span>();</span><br><span class="line">        mainTemplateConfig.setAuthor(<span class="string">"時光"</span>);</span><br><span class="line">        mainTemplateConfig.setOutputText(<span class="string">"输出结果"</span>);</span><br><span class="line">        mainTemplateConfig.setLoop(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        doGenerate(inputPath, outputPath, mainTemplateConfig);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生成文件</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> inputPath  模板文件输入路径</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> outputPath 输出路径</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> model      数据模型</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> TemplateException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">doGenerate</span><span class="params">(String inputPath, String outputPath, Object model)</span> <span class="keyword">throws</span> IOException, TemplateException {</span><br><span class="line">        <span class="comment">// new 出 Configuration 对象，参数为 FreeMarker 版本号</span></span><br><span class="line">        <span class="type">Configuration</span> <span class="variable">configuration</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Configuration</span>(Configuration.VERSION_2_3_32);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 指定模板文件所在的路径</span></span><br><span class="line">        <span class="type">File</span> <span class="variable">templateDir</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(inputPath).getParentFile();</span><br><span class="line">        configuration.setDirectoryForTemplateLoading(templateDir);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置模板文件使用的字符集</span></span><br><span class="line">        configuration.setDefaultEncoding(<span class="string">"utf-8"</span>);</span><br><span class="line">        <span class="comment">// 设置数字格式不显示分隔符</span></span><br><span class="line">        configuration.setNumberFormat(<span class="string">"0.######"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建模板对象，加载指定模板</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">templateName</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(inputPath).getName();</span><br><span class="line">        <span class="type">Template</span> <span class="variable">template</span> <span class="operator">=</span> configuration.getTemplate(templateName);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 生成</span></span><br><span class="line">        <span class="type">Writer</span> <span class="variable">out</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileWriter</span>(outputPath);</span><br><span class="line">        template.process(model, out);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 生成文件后别忘了关闭哦</span></span><br><span class="line">        out.close();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<h2 id="七、动静结合-生成完整代码"><a href="#七、动静结合-生成完整代码" class="headerlink" title="七、动静结合 - 生成完整代码"></a>七、动静结合 - 生成完整代码</h2><p>完成了静态和动态文件生成后，我们想要生成一套完整的 ACM 模板代码，就非常简单了。只需要编写一个类，组合调用这两个生成器，先复制静态文件、再动态生成文件来覆盖即可。</p>
<p>在 <code>com.shiguang.generator</code> 包下新建 <code>MainGenerator.java</code> 类，编写一个 <code>doGenerator</code> 生成方法，接受外层传来的 Model 数据模型。</p>
<p>完整代码如下：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.shiguang.generator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.shiguang.model.MainTemplateConfig;</span><br><span class="line"><span class="keyword">import</span> freemarker.template.TemplateException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainGenerator</span> {</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">doGenerate</span><span class="params">(Object model)</span> <span class="keyword">throws</span> TemplateException, IOException {</span><br><span class="line">        <span class="type">String</span> <span class="variable">projectPath</span> <span class="operator">=</span> System.getProperty(<span class="string">"user.dir"</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="type">File</span> <span class="variable">parentFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(projectPath).getParentFile();</span><br><span class="line">        </span><br><span class="line">        <span class="type">String</span> <span class="variable">inputPath</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(parentFile, <span class="string">"yuzi-generator-demo-projects/acm-template"</span>).getAbsolutePath();</span><br><span class="line">        <span class="type">String</span> <span class="variable">outputPath</span> <span class="operator">=</span> projectPath;</span><br><span class="line">        </span><br><span class="line">        StaticGenerator.copyFilesByRecursive(inputPath, outputPath);</span><br><span class="line">        </span><br><span class="line">        <span class="type">String</span> <span class="variable">inputDynamicFilePath</span> <span class="operator">=</span> projectPath + File.separator + <span class="string">"src/main/resources/templates/MainTemplate.java.ftl"</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">outputDynamicFilePath</span> <span class="operator">=</span> outputPath + File.separator + <span class="string">"acm-template/src/com/yupi/acm/MainTemplate.java"</span>;</span><br><span class="line">        DynamicGenerator.doGenerate(inputDynamicFilePath, outputDynamicFilePath, model);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> TemplateException, IOException {</span><br><span class="line">        <span class="type">MainTemplateConfig</span> <span class="variable">mainTemplateConfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MainTemplateConfig</span>();</span><br><span class="line">        mainTemplateConfig.setAuthor(<span class="string">"yupi"</span>);</span><br><span class="line">        mainTemplateConfig.setLoop(<span class="literal">false</span>);</span><br><span class="line">        mainTemplateConfig.setOutputText(<span class="string">"求和结果："</span>);</span><br><span class="line">        doGenerate(mainTemplateConfig);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>执行上述代码，我们就能够完整地生成 ACM 示例代码模板了，改变 Main 方法中的数据模型参数，就能修改生成的模板代码。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/10/17/6710c0579acb2.png" alt="image-20240617131646892"></p>
<p>需要注意的是，上述代码中，无论是要复制的静态文件、还是要生成的动态模板文件，我们都是在代码中写死了文件的路径。对于制作一个本地的代码生成器而言，这么做就足够了，但如果要生成一个动态文件非常多的项目，难道要一个个去指定动态文件所在的路径么？</p>
<p>这个问题，留给大家去思考。</p>
<h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><p>以上就是本期教程，我们已经实现了本地的代码生成器。</p>
<p>但是现在这种方式实现的代码生成器虽然可以让懂 Java 编程的同学来使用（只需要修改 Main 方法中的数据模型），但如果是没学过 Java 的同学呢？有没有更方便快捷的使用方式呢？</p>
<p>下期教程，带大家解决这个问题！</p>
<h2 id="本期作业"><a href="#本期作业" class="headerlink" title="本期作业"></a>本期作业</h2><p>1）学习拆解需求和实现步骤的思路</p>
<p>2）掌握静态文件和 FreeMarker 模板引擎动态生成文件的方法</p>
<p>3）提前思考最后一个问题，如何提高现有程序的易用性？</p>
<p>4）自己编写代码实现本节项目，并且在自己的代码仓库完成一次提交</p>
<h2 id="本期代码"><a href="#本期代码" class="headerlink" title="本期代码"></a>本期代码</h2><p><a target="_blank" rel="noopener" href="https://github.com/liyupi/yuzi-generator/commit/d7ea8b8755902901edd97f27bbdca2556334c11c">https://github.com/liyupi/yuzi-generator/commit/d7ea8b8755902901edd97f27bbdca2556334c11c</a></p>
</div></article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/avatar.png" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/avatar.png" title="头像" alt="头像"></a><div class="post-copyright__author_name">時光</div><div class="post-copyright__author_desc">心寄朗朗乾坤，胸怀真修之道。</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="https://blog.shiguang666.eu.org/2024/06/17/ed009d43d177/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('https://blog.shiguang666.eu.org/2024/06/17/ed009d43d177/')">【定制化代码生成项目】03-代码生成</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="/img/wechat.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/wechat.png" alt="微信"></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/alipay.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/alipay.png" alt="支付宝"></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://blog.shiguang666.eu.org/2024/06/17/ed009d43d177/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=【定制化代码生成项目】03-代码生成&amp;url=https://blog.shiguang666.eu.org/2024/06/17/ed009d43d177/&amp;pic=https://img.shiguangdev.cn/i/2024/10/18/67125168b4f6a.png?_r_=133f57da-f767-a7cc-eb11-f5006393e988" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://blog.shiguang666.eu.org" target="_blank">時光</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/%E9%A1%B9%E7%9B%AE/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>项目<span class="tagsPageCount">3</span></a><a class="post-meta__box__tags" href="/tags/%E5%AE%9A%E5%88%B6%E5%8C%96%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90%E9%A1%B9%E7%9B%AE/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>定制化代码生成项目<span class="tagsPageCount">3</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://img.shiguangdev.cn/i/2024/12/16/675fdff3aa4bb.webp" data-sites="wechat,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/06/07/1af0742884cd/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/10/18/671251983e830.png?_r_=830e81c8-7ef8-5816-9d12-21c76a224d21" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">ChatGPT越狱提示词</div></div></a></div><div class="next-post pull-right"><a href="/2024/06/19/0e3b651095f9/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/11/17/6738c2c53119d.webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">【Hexo】Butterfly主题在主页添加GitHub贡献日历</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/2023/11/13/e7a5483dfa64/" title="【定制化代码生成项目】01-项目介绍"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/10/18/671251f4ea790.png?_r_=a5fa9a5c-4eb2-cf7e-e7b5-b5cd9e285335" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-11-13</div><div class="title">【定制化代码生成项目】01-项目介绍</div></div></a></div><div><a href="/2023/11/13/dd7e3ed86dba/" title="【定制化代码生成项目】02-项目设计与学习阶段"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/10/18/671251d0295a3.png?_r_=382e3db5-c667-ffd9-4994-64a573a2e014" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-11-13</div><div class="title">【定制化代码生成项目】02-项目设计与学习阶段</div></div></a></div></div></div><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)" style="display: none">匿名评论</a><a href="/privacy" style="margin-left: 4px">隐私政策</a></div><div class="comment-tips" id="comment-tips"><span>✅ 你无需删除空行，直接评论以获取最佳展示效果</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://emotion.acs.pw/emotion/Heo/送福.png" alt="status"></div></div><div class="author-info__description">代码成就万事基积沙镇海,<br>梦想永在凌云意意气风发。</div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">時光</h1><div class="author-info__desc">心寄朗朗乾坤，胸怀真修之道。</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/shiguang-coding" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a></div></div></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bullhorn anzhiyu-shake"></i><span>公告</span></div><div class="announcement_content"><span>🌟欢迎光临時光的博客园子🌟</span><br> <span><a target="_blank" rel="noopener" href="https://blog.shiguangdev.cn"><b>blog.shiguangdev.cn</b></a></span><br> <span><a target="_blank" rel="noopener" href="https://blog.shiguang88.icu"><b>blog.shiguang88.icu</b></a></span><br> <span><a href="https://blog.shiguang666.eu.org"><b>blog.shiguang666.eu.org</b></a></span><br> <span>🤔 如有问题欢迎评论区交流！</span><br> <span>📧 如需联系我：<a href="mailto:an_shiguang@163.com"><b>发送邮件🚀</b></a></span> <div id="welcome-info"></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E9%A1%B9%E7%9B%AE%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-number">1.</span> <span class="toc-text">一、项目初始化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%88%9D%E5%A7%8B%E5%8C%96%E6%A0%B9%E7%9B%AE%E5%BD%95"><span class="toc-number">1.1.</span> <span class="toc-text">1、初始化根目录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E5%BF%BD%E7%95%A5%E6%97%A0%E7%94%A8%E6%8F%90%E4%BA%A4"><span class="toc-number">1.2.</span> <span class="toc-text">2、忽略无用提交</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E5%88%9B%E5%BB%BA-Demo-%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81%E5%B7%A5%E7%A8%8B"><span class="toc-number">1.3.</span> <span class="toc-text">3、创建 Demo 示例代码工程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ACM-%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81%E6%A8%A1%E6%9D%BF%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.3.1.</span> <span class="toc-text">ACM 示例代码模板介绍</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E5%88%9B%E5%BB%BA%E6%9C%AC%E5%9C%B0%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90%E5%99%A8%E9%A1%B9%E7%9B%AE"><span class="toc-number">1.4.</span> <span class="toc-text">4、创建本地代码生成器项目</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E5%AE%9E%E7%8E%B0%E6%B5%81%E7%A8%8B"><span class="toc-number">2.</span> <span class="toc-text">二、实现流程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E6%8B%86%E8%A7%A3"><span class="toc-number">2.1.</span> <span class="toc-text">需求拆解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4"><span class="toc-number">2.2.</span> <span class="toc-text">实现步骤</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6%E7%94%9F%E6%88%90"><span class="toc-number">3.</span> <span class="toc-text">三、静态文件生成</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E7%8E%B0%E6%88%90%E7%9A%84%E5%B7%A5%E5%85%B7%E5%BA%93%E5%A4%8D%E5%88%B6%E7%9B%AE%E5%BD%95"><span class="toc-number">3.1.</span> <span class="toc-text">1、现成的工具库复制目录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E9%80%92%E5%BD%92%E9%81%8D%E5%8E%86"><span class="toc-number">3.2.</span> <span class="toc-text">2、递归遍历</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C-API"><span class="toc-number">3.2.1.</span> <span class="toc-text">文件操作 API</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81"><span class="toc-number">3.2.2.</span> <span class="toc-text">示例代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81"><span class="toc-number">3.2.3.</span> <span class="toc-text">完整代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%A9%E5%B1%95%E6%80%9D%E8%B7%AF"><span class="toc-number">3.2.4.</span> <span class="toc-text">扩展思路</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E5%8A%A8%E6%80%81%E6%96%87%E4%BB%B6%E7%94%9F%E6%88%90%E6%80%9D%E8%B7%AF"><span class="toc-number">4.</span> <span class="toc-text">四、动态文件生成思路</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%98%8E%E7%A1%AE%E5%8A%A8%E6%80%81%E7%94%9F%E6%88%90%E9%9C%80%E6%B1%82"><span class="toc-number">4.1.</span> <span class="toc-text">明确动态生成需求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E7%94%9F%E6%88%90%E7%9A%84%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86"><span class="toc-number">4.2.</span> <span class="toc-text">动态生成的核心原理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81FreeMarker-%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E5%85%A5%E9%97%A8"><span class="toc-number">5.</span> <span class="toc-text">五、FreeMarker 模板引擎入门</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%EF%BC%9F%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E5%AE%83%EF%BC%9F"><span class="toc-number">5.1.</span> <span class="toc-text">什么是模板引擎？为什么需要它？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF-FreeMarker%EF%BC%9F"><span class="toc-number">5.2.</span> <span class="toc-text">什么是 FreeMarker？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="toc-number">5.3.</span> <span class="toc-text">模板引擎的作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF"><span class="toc-number">5.4.</span> <span class="toc-text">模板</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B"><span class="toc-number">5.5.</span> <span class="toc-text">数据模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Demo-%E5%AE%9E%E6%88%98"><span class="toc-number">5.6.</span> <span class="toc-text">Demo 实战</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81%E5%BC%95%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="toc-number">5.6.1.</span> <span class="toc-text">1、引入依赖</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81%E5%88%9B%E5%BB%BA%E9%85%8D%E7%BD%AE%E5%AF%B9%E8%B1%A1"><span class="toc-number">5.6.2.</span> <span class="toc-text">2、创建配置对象</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E3%80%81%E5%87%86%E5%A4%87%E6%A8%A1%E7%89%88%E5%B9%B6%E5%8A%A0%E8%BD%BD"><span class="toc-number">5.6.3.</span> <span class="toc-text">3、准备模版并加载</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%E3%80%81%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B"><span class="toc-number">5.6.4.</span> <span class="toc-text">4、创建数据模型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5%E3%80%81%E6%8C%87%E5%AE%9A%E7%94%9F%E6%88%90%E7%9A%84%E6%96%87%E4%BB%B6"><span class="toc-number">5.6.5.</span> <span class="toc-text">5、指定生成的文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6%E3%80%81%E7%94%9F%E6%88%90%E6%96%87%E4%BB%B6"><span class="toc-number">5.6.6.</span> <span class="toc-text">6、生成文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7%E3%80%81%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81"><span class="toc-number">5.6.7.</span> <span class="toc-text">7、完整代码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E8%AF%AD%E6%B3%95"><span class="toc-number">5.7.</span> <span class="toc-text">常用语法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81%E6%8F%92%E5%80%BC"><span class="toc-number">5.7.1.</span> <span class="toc-text">1、插值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81%E5%88%86%E6%94%AF%E5%92%8C%E5%88%A4%E7%A9%BA"><span class="toc-number">5.7.2.</span> <span class="toc-text">2、分支和判空</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E3%80%81%E9%BB%98%E8%AE%A4%E5%80%BC"><span class="toc-number">5.7.3.</span> <span class="toc-text">3、默认值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%E3%80%81%E5%BE%AA%E7%8E%AF"><span class="toc-number">5.7.4.</span> <span class="toc-text">4、循环</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5%E3%80%81%E5%AE%8F%E5%AE%9A%E4%B9%89"><span class="toc-number">5.7.5.</span> <span class="toc-text">5、宏定义</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6%E3%80%81%E5%86%85%E5%BB%BA%E5%87%BD%E6%95%B0"><span class="toc-number">5.7.6.</span> <span class="toc-text">6、内建函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7%E3%80%81%E5%85%B6%E4%BB%96"><span class="toc-number">5.7.7.</span> <span class="toc-text">7、其他</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3%E7%A4%BA%E4%BE%8B"><span class="toc-number">5.8.</span> <span class="toc-text">问题解决示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E5%A4%9A%E5%AD%A6%E4%B9%A0%E8%B5%84%E6%BA%90"><span class="toc-number">5.9.</span> <span class="toc-text">更多学习资源</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E5%8A%A8%E6%80%81%E6%96%87%E4%BB%B6%E7%94%9F%E6%88%90%E5%AE%9E%E7%8E%B0"><span class="toc-number">6.</span> <span class="toc-text">六、动态文件生成实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%AE%9A%E4%B9%89%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B"><span class="toc-number">6.1.</span> <span class="toc-text">1、定义数据模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E7%BC%96%E5%86%99%E5%8A%A8%E6%80%81%E6%A8%A1%E6%9D%BF"><span class="toc-number">6.2.</span> <span class="toc-text">2、编写动态模板</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E7%BB%84%E5%90%88%E7%94%9F%E6%88%90"><span class="toc-number">6.3.</span> <span class="toc-text">3、组合生成</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E5%AE%8C%E5%96%84%E4%BC%98%E5%8C%96"><span class="toc-number">6.4.</span> <span class="toc-text">4、完善优化</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%8C%E5%96%84%E6%A8%A1%E6%9D%BF"><span class="toc-number">6.4.1.</span> <span class="toc-text">完善模板</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8A%BD%E5%8F%96%E6%96%B9%E6%B3%95"><span class="toc-number">6.4.2.</span> <span class="toc-text">抽取方法</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81-1"><span class="toc-number">6.5.</span> <span class="toc-text">完整代码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83%E3%80%81%E5%8A%A8%E9%9D%99%E7%BB%93%E5%90%88-%E7%94%9F%E6%88%90%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81"><span class="toc-number">7.</span> <span class="toc-text">七、动静结合 - 生成完整代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%80%E5%90%8E"><span class="toc-number">8.</span> <span class="toc-text">最后</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%AC%E6%9C%9F%E4%BD%9C%E4%B8%9A"><span class="toc-number">9.</span> <span class="toc-text">本期作业</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%AC%E6%9C%9F%E4%BB%A3%E7%A0%81"><span class="toc-number">10.</span> <span class="toc-text">本期代码</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/12/16/d5e9d59f93d4/" title="博客、论坛必备：一键填充评论区昵称、邮箱、网址"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/16/675fdff3aa4bb.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="博客、论坛必备：一键填充评论区昵称、邮箱、网址"></a><div class="content"><a class="title" href="/2024/12/16/d5e9d59f93d4/" title="博客、论坛必备：一键填充评论区昵称、邮箱、网址">博客、论坛必备：一键填充评论区昵称、邮箱、网址</a><time datetime="2024-12-16T06:35:35.000Z" title="发表于 2024-12-16 14:35:35">2024-12-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/12/15/a9c615a71d17/" title="【智能协同云图库】3-用户模块"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/09/6756ee980378a.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【智能协同云图库】3-用户模块"></a><div class="content"><a class="title" href="/2024/12/15/a9c615a71d17/" title="【智能协同云图库】3-用户模块">【智能协同云图库】3-用户模块</a><time datetime="2024-12-15T03:12:06.000Z" title="发表于 2024-12-15 11:12:06">2024-12-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/12/13/2ec3ab3954b3/" title="通过SSH密钥连接Linux"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/13/675c5996649aa.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="通过SSH密钥连接Linux"></a><div class="content"><a class="title" href="/2024/12/13/2ec3ab3954b3/" title="通过SSH密钥连接Linux">通过SSH密钥连接Linux</a><time datetime="2024-12-13T15:37:00.000Z" title="发表于 2024-12-13 23:37:00">2024-12-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/12/13/0616411766f4/" title="【Hexo】一键部署至远程服务器"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/13/675c59eff34f4.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【Hexo】一键部署至远程服务器"></a><div class="content"><a class="title" href="/2024/12/13/0616411766f4/" title="【Hexo】一键部署至远程服务器">【Hexo】一键部署至远程服务器</a><time datetime="2024-12-13T13:35:49.000Z" title="发表于 2024-12-13 21:35:49">2024-12-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/12/12/60bae9f9d9cc/" title="【尚硅谷】JVM-类的加载篇"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/08/28/66cedaf5d014a.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【尚硅谷】JVM-类的加载篇"></a><div class="content"><a class="title" href="/2024/12/12/60bae9f9d9cc/" title="【尚硅谷】JVM-类的加载篇">【尚硅谷】JVM-类的加载篇</a><time datetime="2024-12-12T04:02:59.000Z" title="发表于 2024-12-12 12:02:59">2024-12-12</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="footer_deal"><a class="deal_link" target="_blank" rel="noopener" href="https://github.com/shiguang-coding" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="deal_link" href="mailto:an_shiguang@163.com" title="email"><i class="anzhiyufont anzhiyu-icon-envelope"></i></a><img class="footer_mini_logo" title="返回顶部" alt="返回顶部" onclick="anzhiyu.scrollToDest(0, 500)" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/avatar.png" size="50px"><a class="deal_link" href="/atom.xml" title="RSS"><i class="anzhiyufont anzhiyu-icon-rss"></i></a><a class="deal_link" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC"><i class="anzhiyufont anzhiyu-icon-copyright-line"></i></a></div><div id="anzhiyu-footer"><div class="footer-group"><div class="footer-title">服务</div><div class="footer-links"><a class="footer-item" title="开往" target="_blank" rel="noopener" href="https://www.travellings.cn/go.html">开往</a><a class="footer-item" title="异次元之旅" target="_blank" rel="noopener" href="https://travel.moe/go.html?travel=on">异次元之旅</a><a class="footer-item" title="列表导航" target="_blank" rel="noopener" href="https://zhblogs.ohyee.cc/">列表导航</a><a class="footer-item" title="十年之约" target="_blank" rel="noopener" href="https://www.foreverblog.cn/">十年之约</a></div></div><div class="footer-group"><div class="footer-title">文章</div><div class="footer-links"><a class="footer-item" title="归档" href="/archives/">归档</a><a class="footer-item" title="分类" href="/categories/">分类</a><a class="footer-item" title="标签" href="/tags/">标签</a><a class="footer-item" title="RSS" href="/tom.xml">RSS</a></div></div><div class="footer-group"><div class="footer-title">导航</div><div class="footer-links"><a class="footer-item" title="即刻短文" href="/essay/">即刻短文</a><a class="footer-item" title="留言板" href="/comment/">留言板</a><a class="footer-item" title="关于我" href="/about/">关于我</a></div></div><div class="footer-group"><div class="footer-title-group"><div class="footer-title">友链</div><a class="random-friends-btn" id="footer-random-friends-btn" href="javascript:addFriendLinksInFooter();" title="换一批友情链接"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right"></i></a></div><div class="footer-links" id="friend-links-in-footer"></div></div></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" data-title="博客框架为Hexo_v5.4.0" title="博客框架为Hexo_v5.4.0"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Frame-Hexo.svg" alt="博客框架为Hexo_v5.4.0"></a><a class="github-badge" target="_blank" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" style="margin-inline:5px" data-title="本站使用AnZhiYu主题" title="本站使用AnZhiYu主题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.9/img/Theme-AnZhiYu-2E67D3.svg" alt="本站使用AnZhiYu主题"></a><a class="github-badge" target="_blank" href="https://icp.gov.moe/?keyword=blog.shiguangdev.cn" style="margin-inline:5px" data-title="萌ICP备20246006号" title="萌ICP备20246006号"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shields.io/badge/%E8%90%8Cicp%E5%A4%87-20246006%E5%8F%B7-FF1485" alt="萌ICP备20246006号"></a><a class="github-badge" target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px" data-title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可" title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.2.0/img/badge/Copyright-BY-NC-SA.svg" alt="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"></a></p></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">©2023 - 2024 By <a class="footer-bar-link" href="/" title="時光" target="_blank">時光</a></div></div><div id="footer-type-tips"></div><div class="js-pjax"><script>function subtitleType () {
  fetch('https://v1.hitokoto.cn')
    .then(response => response.json())
    .then(data => {
      if (true) {
        const from = '出自 ' + data.from
        const sub = []
        sub.unshift(data.hitokoto, from)
        window.typed = new Typed('#footer-type-tips', {
          strings: sub,
          startDelay: 300,
          typeSpeed: 150,
          loop: true,
          backSpeed: 50,
        })
      } else {
        document.getElementById('footer-type-tips').innerHTML = data.hitokoto
      }
    })
}

if (true) {
  if (typeof Typed === 'function') {
    subtitleType()
  } else {
    getScript('https://cdn.cbd.int/typed.js@2.1.0/dist/typed.umd.js').then(subtitleType)
  }
} else {
  subtitleType()
}
</script></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a><a class="footer-bar-link" target="_blank" rel="noopener" href="https://img.shiguangdev.cn/" title="图床">图床</a><a class="footer-bar-link" target="_blank" rel="noopener" href="https://beian.miit.gov.cn/" title="豫ICP备2024070732号">豫ICP备2024070732号</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">256</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">188</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">16</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://www.shiguang666.eu.org" title="時光主页"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="時光主页"><span class="back-menu-item-text">時光主页</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://nav.shiguang666.eu.org" title="時光导航站"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="時光导航站"><span class="back-menu-item-text">時光导航站</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://game.shiguang666.eu.org" title="怀旧游戏机"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="怀旧游戏机"><span class="back-menu-item-text">怀旧游戏机</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://games.shiguang666.eu.org" title="在线小游戏"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="在线小游戏"><span class="back-menu-item-text">在线小游戏</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">后台管理</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://img.shiguangdev.cn/" title="時光图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/favicon.ico" alt="時光图床"><span class="back-menu-item-text">時光图床</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://qexo.shiguang666.eu.org/" title="Hexo管理面板"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://qexo.shiguang666.eu.org/favicon.ico" alt="Hexo管理面板"><span class="back-menu-item-text">Hexo管理面板</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 归档</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随机</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/news/"><i class="fa fa-calendar faa-tada"></i><span> 早报亭</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/music/?id=10051718332&amp;server=netease"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/gallery/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/xjj/"><i class="fa fa-rocket faa-tada"></i><span> 养生堂</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/flink/"><i class="anzhiyufont anzhiyu-icon-artstation faa-tada" style="font-size: 0.9em;"></i><span> 朋友圈</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comment/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于我</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/AI/" style="font-size: 0.88rem;">AI<sup>9</sup></a><a href="/tags/Alist/" style="font-size: 0.88rem;">Alist<sup>3</sup></a><a href="/tags/CentOS/" style="font-size: 0.88rem;">CentOS<sup>1</sup></a><a href="/tags/ChatGPT/" style="font-size: 0.88rem;">ChatGPT<sup>13</sup></a><a href="/tags/ChatGPt/" style="font-size: 0.88rem;">ChatGPt<sup>1</sup></a><a href="/tags/Chrome/" style="font-size: 0.88rem;">Chrome<sup>1</sup></a><a href="/tags/CloudFlare/" style="font-size: 0.88rem;">CloudFlare<sup>3</sup></a><a href="/tags/DNS/" style="font-size: 0.88rem;">DNS<sup>1</sup></a><a href="/tags/Ecology/" style="font-size: 0.88rem;">Ecology<sup>1</sup></a><a href="/tags/GPT-4o/" style="font-size: 0.88rem;">GPT-4o<sup>2</sup></a><a href="/tags/Gemini/" style="font-size: 0.88rem;">Gemini<sup>2</sup></a><a href="/tags/Git/" style="font-size: 0.88rem;">Git<sup>8</sup></a><a href="/tags/GitHub/" style="font-size: 0.88rem;">GitHub<sup>6</sup></a><a href="/tags/Hexo/" style="font-size: 0.88rem;">Hexo<sup>24</sup></a><a href="/tags/IDEA/" style="font-size: 0.88rem;">IDEA<sup>3</sup></a><a href="/tags/KeyBoardTestUtility/" style="font-size: 0.88rem;">KeyBoardTestUtility<sup>1</sup></a><a href="/tags/Linux/" style="font-size: 0.88rem;">Linux<sup>4</sup></a><a href="/tags/Lombok/" style="font-size: 0.88rem;">Lombok<sup>1</sup></a><a href="/tags/Markdown/" style="font-size: 0.88rem;">Markdown<sup>2</sup></a><a href="/tags/MindManager/" style="font-size: 0.88rem;">MindManager<sup>1</sup></a><a href="/tags/Mysql/" style="font-size: 0.88rem;">Mysql<sup>2</sup></a><a href="/tags/Perplexity-AI/" style="font-size: 0.88rem;">Perplexity AI<sup>1</sup></a><a href="/tags/PicGo/" style="font-size: 0.88rem;">PicGo<sup>1</sup></a><a href="/tags/QQ/" style="font-size: 0.88rem;">QQ<sup>1</sup></a><a href="/tags/SQL/" style="font-size: 0.88rem;">SQL<sup>12</sup></a><a href="/tags/SSL/" style="font-size: 0.88rem;">SSL<sup>3</sup></a><a href="/tags/SqlServer/" style="font-size: 0.88rem;">SqlServer<sup>1</sup></a><a href="/tags/Sqlserver/" style="font-size: 0.88rem;">Sqlserver<sup>1</sup></a><a href="/tags/Typora/" style="font-size: 0.88rem;">Typora<sup>5</sup></a><a href="/tags/drawio/" style="font-size: 0.88rem;">drawio<sup>1</sup></a><a href="/tags/git/" style="font-size: 0.88rem;">git<sup>1</sup></a><a href="/tags/mysql/" style="font-size: 0.88rem;">mysql<sup>1</sup></a><a href="/tags/%E5%9B%BE%E5%90%A7%E5%B7%A5%E5%85%B7%E7%AE%B1/" style="font-size: 0.88rem;">图吧工具箱<sup>1</sup></a><a href="/tags/%E5%9B%BE%E5%BA%8A/" style="font-size: 0.88rem;">图床<sup>7</sup></a><a href="/tags/%E5%BC%80%E6%BA%90%E5%88%86%E4%BA%AB/" style="font-size: 0.88rem;">开源分享<sup>6</sup></a><a href="/tags/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E/" style="font-size: 0.88rem;">搜索引擎<sup>2</sup></a><a href="/tags/%E6%95%B0%E6%8D%AE%E6%81%A2%E5%A4%8D/" style="font-size: 0.88rem;">数据恢复<sup>1</sup></a><a href="/tags/%E6%A8%A1%E6%9D%BF/" style="font-size: 0.88rem;">模板<sup>4</sup></a><a href="/tags/%E8%B8%A9%E5%9D%91/" style="font-size: 0.88rem;">踩坑<sup>6</sup></a><a href="/tags/%E9%B1%BC%E7%9A%AE/" style="font-size: 0.88rem;">鱼皮<sup>11</sup></a></div></div><hr></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><a id="switch-commentBarrage" href="javascript:anzhiyu.switchCommentBarrage();" title="开关弹幕"><i class="anzhiyufont anzhiyu-icon-danmu"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="10051718332" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="is-center" id="loading-database"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-pulse-icon"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"></div></div><hr><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://music.163.com/#/my/m/music/playlist?id=10051718332&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async="" src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("05/01/2023 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2023 By 安知鱼 V1.6.14",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 時光 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async="" src="/anzhiyu/random.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>(() => {
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://twikoo.shiguangdev.eu.org',
      region: '',
      onCommentLoaded: () => {
        anzhiyu.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') setTimeout(runFn,0)
    else getScript('https://cdn.cbd.int/twikoo@1.6.39/dist/twikoo.all.min.js').then(runFn)
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo.shiguangdev.eu.org',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const runFn = () => {
    init();
    GLOBAL_CONFIG_SITE.isPost && getCount()
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) anzhiyu.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else {
      loadTwikoo()
    }
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"><script async="" src="/js/anzhiyu/comment_barrage.js"></script></div><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getComment = () => {
    const runTwikoo = () => {
      twikoo.getRecentComments({
        envId: 'https://twikoo.shiguangdev.eu.org',
        region: '',
        pageSize: 6,
        includeReply: true
      }).then(function (res) {
        const twikooArray = res.map(e => {
          return {
            'content': changeContent(e.comment),
            'avatar': e.avatar,
            'nick': e.nick,
            'url': e.url + '#' + e.id,
            'date': new Date(e.created).toISOString()
          }
        })

        saveToLocal.set('twikoo-newest-comments', JSON.stringify(twikooArray), 10/(60*24))
        generateHtml(twikooArray)
      }).catch(function (err) {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "无法获取评论，请确认相关配置是否正确"
      })
    }

    if (typeof twikoo === 'object') {
      runTwikoo()
    } else {
      getScript('https://cdn.cbd.int/twikoo@1.6.39/dist/twikoo.all.min.js').then(runTwikoo)
    }
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'><div class='name'><span>${array[i].nick} </span></div></a>`
        }
        
        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom && ($dom.innerHTML= result)
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('twikoo-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script async="" data-pjax="" src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><script src="/js/custom/footer-animal.js" defer=""></script><script src="/api/card-welcome.js"></script><script id="click-heart" src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/click-heart.min.js" async="async" mobile="false"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["meta[property=\"og:image\"]","meta[property=\"og:title\"]","meta[property=\"og:url\"]","meta[property=\"og:type\"]","meta[property=\"og:site_name\"]","meta[property=\"og:description\"]","head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div><!-- hexo injector body_end start -->
  <script data-pjax="" src="/js/hexo_githubcalendar.js"></script>
  <script data-pjax="">
        function GithubCalendarConfig(){
            var git_githubapiurl ="https://githubcalendarapi.shiguang666.eu.org/api?user=shiguang-coding";
            var git_color =['#ebedf0', '#a2f7af', '#6ce480', '#54ad63', '#469252', '#31753c', '#1f5f2a', '#13531f', '#084111', '#032b09', '#000000'];
            var git_user ="shiguang-coding";
            var parent_div_git = document.getElementById('recent-posts');
            var git_div_html = '<div class="recent-post-item" style="width:100%;height:auto;padding:10px;"><div id="github_loading" style="width:10%;height:100%;margin:0 auto;display: block"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"  viewBox="0 0 50 50" style="enable-background:new 0 0 50 50" xml:space="preserve"><path fill="#d0d0d0" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z" transform="rotate(275.098 25 25)"><animateTransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animateTransform></path></svg></div><div id="github_container"></div></div>';
            if(parent_div_git && location.pathname =='/'){
                console.log("已挂载hexo-github-calendar https://github.com/Barry-Flynn/hexo-github-calendar");
                // parent_div_git.innerHTML=git_div_html+parent_div_git.innerHTML // 无报错，但不影响使用(支持pjax跳转)
                parent_div_git.insertAdjacentHTML("afterbegin",git_div_html) // 有报错，但不影响使用(支持pjax跳转)
            };
            GithubCalendar(git_githubapiurl,git_color,git_user)
        }
        if(document.getElementById('recent-posts')){
            GithubCalendarConfig()
        }
    </script>
    <style>#github_container{min-height:280px}@media screen and (max-width:650px) {#github_container{background-image:;min-height:0px}}</style>
    <style></style><!-- hexo injector body_end end -->
    <link rel="stylesheet" href="https://ai.tianli0.top/static/public/postChatUser_summary.min.css">
    <script>
        let tianliGPT_key = '75439fb77e5551eacf54f0df75565616dcf2ad';
        let tianliGPT_postSelector = '#article-container';
        let tianliGPT_Title = '文章摘要';
        let tianliGPT_postURL = '/^https?://[^/]+/[0-9]{4}/[0-9]{2}/[0-9]{2}/';
        let tianliGPT_blacklist = '';
        let tianliGPT_wordLimit = '1000';
        let tianliGPT_typingAnimate = true;
        var postChatConfig = {
          backgroundColor: "#3e86f6",
          bottom: "16px",
          left: "16px",
          fill: "#FFFFFF",
          width: "44px",
          frameWidth: "375px",
          frameHeight: "600px",
          defaultInput: true,
          upLoadWeb: true,
          showInviteLink: true,
          userTitle: "PostChat",
          userDesc: "如果你对网站的内容有任何疑问，可以来问我哦～",
          addButton: true,
          beginningText: "这篇文章介绍了"
        };
    </script>
    <script data-postchat_key="75439fb77e5551eacf54f0df75565616dcf2ad" src="https://ai.tianli0.top/static/public/postChatUser_summary.min.js"></script>
  </body></html>