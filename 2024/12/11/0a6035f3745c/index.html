<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>【尚硅谷】JVM-字节码篇 | 時光</title><meta name="keywords" content="JAVA,尚硅谷,JVM"><meta name="author" content="時光"><meta name="copyright" content="時光"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="【尚硅谷】JVM-字节码篇"><meta name="application-name" content="【尚硅谷】JVM-字节码篇"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="【尚硅谷】JVM-字节码篇"><meta property="og:url" content="https://blog.shiguang666.eu.org/2024/12/11/0a6035f3745c/index.html"><meta property="og:site_name" content="時光"><meta property="og:description" content="官方资料： 在线视频：尚硅谷JVM精讲与GC调优教程（宋红康主讲，含jvm面试真题） 课程资料：尚硅谷宋红康JVM精讲与GC调优 代码仓库： GitHub: https:&amp;#x2F;&amp;#x2F;github.com&amp;#x2F;Shiguang-coding&amp;#x2F;learn-jvm Gitee: https:&amp;#x2F;&amp;#x2F;gitee.com&amp;#x2F;"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://img.shiguangdev.cn/i/2024/08/28/66cedaf5d014a.jpeg"><meta property="article:author" content="時光"><meta property="article:tag" content="博客,時光,時光的博客,時光博客园子,实用博客,开源,共享"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://img.shiguangdev.cn/i/2024/08/28/66cedaf5d014a.jpeg"><meta name="description" content="官方资料： 在线视频：尚硅谷JVM精讲与GC调优教程（宋红康主讲，含jvm面试真题） 课程资料：尚硅谷宋红康JVM精讲与GC调优 代码仓库： GitHub: https:&amp;#x2F;&amp;#x2F;github.com&amp;#x2F;Shiguang-coding&amp;#x2F;learn-jvm Gitee: https:&amp;#x2F;&amp;#x2F;gitee.com&amp;#x2F;"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="https://blog.shiguang666.eu.org/2024/12/11/0a6035f3745c/"><link rel="preconnect" href="//cdn.cbd.int"><meta name="google-site-verification" content="xxx"><meta name="baidu-site-verification" content="code-xxx"><meta name="msvalidate.01" content="xxx"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/swiper/swiper.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: {"enable":true,"title":"与各类博主无限进步","addFriendPlaceholder":"昵称（请勿包含博客等字样）：\n网站地址（要求博客地址，请勿提交个人主页）：\n头像图片url（请提供尽可能清晰的图片，我会上传到我自己的图床）：\n描述：\n站点截图（可选）：\n"},
  peoplecanvas: undefined,
  postHeadAiDescription: undefined,
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: {"enable":true,"default":"晚上好👋","list":[{"greeting":"晚安😴","startTime":0,"endTime":5},{"greeting":"早上好鸭👋, 祝你一天好心情！","startTime":6,"endTime":9},{"greeting":"上午好👋, 状态很好，鼓励一下～","startTime":10,"endTime":10},{"greeting":"11点多啦, 在坚持一下就吃饭啦～","startTime":11,"endTime":11},{"greeting":"午安👋, 宝贝","startTime":12,"endTime":14},{"greeting":"🌈充实的一天辛苦啦！","startTime":14,"endTime":18},{"greeting":"19点喽, 奖励一顿丰盛的大餐吧🍔。","startTime":19,"endTime":19},{"greeting":"晚上好👋, 在属于自己的时间好好放松😌~","startTime":20,"endTime":24}]},
  twikooEnvId: 'https://twikoo.shiguangdev.eu.org',
  commentBarrageConfig:{"enable":true,"maxBarrage":1,"barrageTime":4000,"accessToken":"","mailMd5":""},
  music_page_default: "nav_music",
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: {"skills":["🌟 技术分享领航人","📚 终身学习倡导者","💡 创新思维启发源","📈 成长路径引路人","🚀 科技趋势探索者","🤖️ AI技术探索先锋","🌈 技术创新推动手","💬 社区互动活跃家","🛠️ 代码经验传授师","📢 知识传播倡导员"]},
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":true,"limitCount":300,"languages":{"author":"作者: 時光","link":"链接: ","source":"来源: 時光","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: true,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: '時光',
  title: '【尚硅谷】JVM-字节码篇',
  postAI: '',
  pageFillDescription: '1、JVM概述, 1.1、Java语言及Java生态圈, Oracle JDK与Open JDK什么关系？, JDK与JVM是什么关系？, 如何理解Java是跨平台的语言？, 如何理解JVM跨语言的平台？, Java不存在内存溢出？内存泄漏？, Java发展的几个重大事件？, 说说你认识的JVM？, JVM的生命周期？, 重点说下HotSpot？, 1.2、JVM的架构与知识脉络图, 能否画出JVM架构图？, JVM有哪几块知识脉络？, 2、字节码文件概述, 2.1、字节码文件是跨平台的吗？, class文件里是什么？, 能介绍下生成class文件的编译器吗？, 前端编译器与后端编译器, 前端编译器（Front-End Compiler）, 后端编译器（Back-End Compiler）, 前端与后端的协同工作, 举例, 总结, 前端编译器的种类, javac编译器的编译步骤？, 目前前端编译器的局限性？, 2.2、哪些类型对应有Class的对象？, 2.3、字节码指令, 什么是字节码指令(byte code)？, 为什么要懂字节码指令？, 2.4、如何解读class文件？, 3、Class文件结构细节, 3.1、class文件结构细节概述, 3.2、class文件的魔数是什么？, 3.3、如何确保高版本的JVM可执行低版本的class文件？, 3.4、常量池：class文件的基石？作用是？, 为什么需要常量池计数器？, 常量池表, 字面量和符号引用, 常量类型和结构, 3.5、访问标识, 3.6、类索引、父类索引、接口索引集合, 3.7、字段表集合, 字段计数器, 字段表, 3.8、方法表集合, 方法计数器, 方法表, 3.9、属性表集合, 属性计数器, 属性表, ① ConstantValue 属性, ② Deprecated 属性, ③ Code 属性, ④ InnerClasses 属性, ⑤ LineNumberTable 属性, ⑥ LocalVariableTable 属性, ⑦ Signature 属性, ⑧ SourceFile属性, ⑨ 其他属性, 3.10、小结, 4、oracle官方的反解析工具：javap, 4.1、解析字节码的作用, 4.2、javac -g操作, 4.3、javap的用法, 4.4、使用举例, 4.5、总结, 5、字节码指令集与解析概述, 5.1、字节码与数据类型, 5.2、指令分类, 6、字节码指令, 6.1、加载与存储指令, 操作数栈与局部变量表, 局部变量压栈指令, 常量入栈指令, 出栈装入局部变量表指令, 6.2、算术指令, 所有算术指令, 比较指令的说明, 6.3、类型转换指令, 宽化类型转换, 窄化类型转换, 6.4、对象的创建与访问指令, 创建指令, 字段访问指令, 数组操作指令, 类型检查指令, 6.5、方法调用与返回指令, 方法调用指令, 方法返回指令, 6.6、操作数栈管理指令, 6.7、控制转移指令, 条件跳转指令, 比较条件跳转指令, 多条件分支跳转指令, 无条件跳转指令, 6.8、异常处理指令, 抛出异常指令, 异常处理与异常, 6.9、同步控制指令, 方法级的同步, 方法内指定指令序列的同步, 面试题官方资料在线视频尚硅谷精讲与调优教程宋红康主讲含面试真题课程资料尚硅谷宋红康精讲与调优代码仓库概述语言及生态圈与什么关系官方的说明下载路径下载路径与之间的主要区别版本将每三年发布一次版本而版本每三个月发布一次将更多地关注稳定性它重视更多的企业级用户而经常发布以支持其他性能这可能会导致不稳定支持长期发布的更改而仅支持计划和完成下一个发行版根据二进制代码许可协议获得许可而根据许可获得许可使用平台时会产生一些许可影响如宣布的那样在没有商业许可的情况下在年月之后发布的的公开更新将无法用于商业商业或生产用途但是是完全开源的可以自由使用的构建过程基于因此与之间没有技术差异顶级公司正在使用例如和开发工具其中不太受欢迎具有和功能具有功能这是与之间的显著差异具有良好的选项和更好的渲染器而具有更少的选项并且由于其包含自己的渲染器的分布因此具有较慢的图形渲染器选项在响应性和性能方面与相比提供了更好的性能与相比的开源社区较少社区用户的表现优于发布的功能以提高性能如果使用会产生许可影响而没有这样的问题并且可以以任何方式使用以满足完全开源和免费使用在运行时不会产生任何问题而在为某些用户运行时会产生一些问题根据使用方的使用和许可协议现有应用程序可以从迁移到反之亦然将从其版本将收费用户必须付费或必须依赖才能使用其免费版本不会为即将发布的版本提供长期支持用户每次都必须通过更新到最新版本获得支持来获取最新版本以前的版以前的版本是由开发的后来被收购并为其他版本维护而最初只基于或版本发布时大多数功能都是开源的其中一些功能免于开源并且根据的许可授权而发布了所有功能如开源和免费完全由公司开发而项目由等顶级公司加入和合作与是什么关系如何理解是跨平台的语言一次编译处处运行当源代码成功编译成字节码后如果想在不同的平台上面运行则无须再次编译这个优势不再那么吸引人了等有强大的解释器跨平台似乎已经快成为一门语言必选的特性如何理解跨语言的平台虚拟机根本不关心运行在其内部的程序到底是使用何种编程语言编写的它只关心字节码文件不是最强大的语言但是是最强大的虚拟机不存在内存溢出内存泄漏垃圾收集机制为我们打理了很多繁琐的工作大大提高了开发的效率但是垃圾收集也不是万能的懂得内部的内存结构工作机制是设计高扩展性应用和诊断运行时问题的基础也是工程师进阶的必备能力发展的几个重大事件年发布正式发布成为的默认虚拟机年发布古老的虚拟机退出历史舞台年年底平台的正式发布同年也加入了阵营年发布同年开源并建立了顺理成章虚拟机也成为了中的默认虚拟机年平台迎来了新伙伴年收购了得到了虚拟机年宣布把后台大部分程序从迁移到这是平台的又一次大规模应用年收购了获得商标和最具价值的虚拟机此时拥有市场占用率最高的两款虚拟机和并计划在未来对它们进行整合组织管理语言年发布在中正式启用了新的垃圾回收器年发布将设置为默认替代被标记为同年的开源形成了现在的社区年的侵权案判决赔偿计亿美元同年发布版本的发布革命性的调整授权许可年发布加入领导开发的说说你认识的解释型公司的的不包含解释器服务器端的和年其他的生命周期虚拟机的启动虚拟机的启动是通过引导类加载器创建一个初始类来完成的这个类是由虚拟机的具体实现指定的虚拟机的退出有如下的几种情况某线程调用类或类的方法或类的方法并且安全管理器也允许这次或操作程序正常执行结束程序在执行过程中遇到了异常或错误而异常终止由于操作系统出现错误而导致虚拟机进程终止重点说下的版本从开始运用虚拟机年底开源主要使用实现接口部分用实现是较新的虚拟机使用编译器可以大大提高运行的性能原先是把源代码编译为字节码在虚拟机执行这样执行速度较慢而将常用的部分代码编译为本地原生代码这样显着提高了性能参数可以分为规则参数和非规则参数规则参数相对稳定在未来的版本里不会有太大的改动非规则参数则有因升级而改动的可能的架构与知识脉络图能否画出架构图这个架构可以分成三层看最上层编译器将编译好的字节码文件通过类装载器执行机制把对象或文件存放在划分内存区域中间层称为主要是在代码运行时用于存放数据的从左至右为方法区永久代元数据区堆共享回收对象区域栈程序计数器寄存器本地方法栈私有最下层解释器编译器和垃圾回收器有哪几块知识脉络字节码文件概述字节码文件是跨平台的吗虚拟机不和包括在内的任何语言绑定它只与文件这种特定的二进制文件格式所关联无论使用何种语言进行软件开发只要能将源文件编译为正确的文件那么这种语言就可以在虚拟机上执行可以说统一而强大的文件结构就是虚拟机的基石桥梁想要让一个程序正确地运行在中源码就必须要被编译为符合规范的字节码语言和虚拟机规范所有的全部遵守虚拟机规范也就是说所有的环境都是一样的这样一来字节码文件可以在各种上运行从虚拟机的角度看通过文件可以让更多的计算机语言支持虚拟机平台因此文件结构不仅仅是虚拟机的执行入口更是生态圈的基础和核心文件里是什么源代码经过编译器编译之后便会生成一个字节码文件字节码是一种二进制的类文件它的内容是的指令而不像经由编译器直接生成机器码随着平台的不断发展在将来文件的内容也一定会做进一步的扩充但是其基本的格式和结构不会做重大调整能介绍下生成文件的编译器吗前端编译器与后端编译器前端编译器前端编译器主要负责处理源代码的语法分析语义分析和中间代码生成它的主要任务是将高级语言如等编写的源代码转换为一种中间表示形式这种中间表示形式通常是独立于目标机器的前端编译器的主要任务就是负责将符合语法规范的代码转换为符合规范的字节码文件主要功能词法分析将源代码分解为一个个的词法单元如关键字标识符操作符等语法分析根据语言的语法规则将词法单元组织成语法树或抽象语法树语义分析检查语法树的语义正确性确保代码符合语言的语义规则如类型检查作用域检查等中间代码生成将语法树或抽象语法树转换为中间表示形式如三地址码控制流图等这种中间表示形式通常是独立于目标机器的特点与源语言相关前端编译器的设计和实现与源语言的语法和语义密切相关与目标机器无关前端编译器生成的中间代码通常是独立于目标机器的可以在不同的平台上运行后端编译器后端编译器主要负责优化中间代码并生成目标机器代码它的任务是将前端生成的中间表示形式转换为特定目标机器的机器码或汇编代码主要功能中间代码优化对中间代码进行各种优化如常量折叠死代码消除循环优化等以提高代码的执行效率目标代码生成将优化后的中间代码转换为目标机器的机器码或汇编代码这一步需要考虑目标机器的指令集寄存器分配内存管理等因素机器相关优化根据目标机器的特性进行优化如指令选择寄存器分配指令调度等特点与目标机器相关后端编译器的设计和实现与目标机器的指令集体系结构密切相关与源语言无关后端编译器通常不关心源语言的语法和语义它只处理中间代码并生成目标机器代码前端与后端的协同工作编译流程前端编译器和后端编译器通常是分开的但它们协同工作以完成整个编译过程前端负责将源代码转换为中间表示形式后端负责将中间表示形式转换为目标机器代码可移植性由于中间代码是独立于目标机器的因此可以通过更换后端编译器来生成不同目标机器的代码从而实现代码的可移植性举例是一个典型的多语言编译器集合它包含多个前端如前端前端前端等和多个后端如后端后端等不同的前端处理不同的源语言生成统一的中间表示形式然后由不同的后端生成目标机器代码虚拟机编译器的前端将源代码编译为字节码一种中间表示形式然后由的后端即时编译器将字节码编译为特定平台的机器码总结前端编译器负责源代码的词法语法语义分析生成中间代码与源语言相关与目标机器无关后端编译器负责中间代码的优化和目标代码生成与目标机器相关与源语言无关通过前端和后端的协同工作编译器能够将高级语言的源代码转换为高效的目标机器代码前端编译器的种类源代码的编译结果是字节码那么肯定需要有一种编译器能够将源码编译为字节码承担这个重要责任的就是配置在环境变量中的编译器是一种能够将源码编译为字节码的前端编译器并没有强制要求前端编译器只能使用来编译字节码其实只要编译结果符合规范都可以被所识别即可在的前端编译器领域除了之外还有一种被大家经常用到的前端编译器那就是内置在中的编译器和的全量式编译不同是一种增量式编译器在中当开发人员编写完代码后使用快捷键时编译器所釆取的编译方案是把未编译部分的源码逐行进行编译而非每次都全量编译因此的编译效率会比更加迅速和高效当然编译质量和相比大致还是一样的不仅是的默认内置前端编译器在中同样也是使用编译器来编译文件由于编译器是釆用的开源协议进行源代码公开所以大家可以登录官网下载编译器的源码进行二次开发默认情况下使用编译器还可以自己设置为编译器编译器的编译步骤编译器在将源码编译为一个有效的字节码文件过程中经历了个步骤分别是词法解析语法解析语义解析以及生成字节码大部分的程序代码转换成物理机的目标代码或虚拟机能执行的指令集之前都需要经过上图中的各个步骤目前前端编译器的局限性前端编译器并不会直接涉及编译优化等方面的技术而是将这些具体优化细节移交给的编译器负责复习静态提前编译器引入了编译器静态提前编译器引入了实验性编译工具它借助了编译器将所输入的类文件转换为机器码并存放至生成的动态共享库之中所谓编译是与即时编译相对立的一个概念我们知道即时编译指的是在程序的运行过程中将字节码转换为可在硬件上直接运行的机器码并部署至托管环境中的过程而编译指的则是在程序运行之前便将字节码转换为机器码的过程最大好处虚拟机加载已经预编译成二进制库可以直接执行不必等待即时编译器的预热减少应用给人带来第一次运行慢的不良体验缺点破坏了一次编译到处运行必须为每个不同硬件编译对应的发行包降低了链接过程的动态性加载的代码在编译期就必须全部已知还需要继续优化中最初只支持哪些类型对应有的对象外部类成员成员内部类静态内部类局部内部类匿名内部类接口数组枚举注解基本数据类型只要元素类型与维度一样就是同一个字节码指令什么是字节码指令虚拟机的指令由一个字节长度的代表着某种特定操作含义的操作码以及跟随其后的零至多个代表此操作所需参数的操作数所构成虚拟机中许多指令并不包含操作数只有一个操作码比如为什么要懂字节码指令面试题和有什么区别包装类对象的缓存问题声明的字面量数据都放在字符串常量池中中字符串常量池存放在方法区即永久代中及以后字符串常量池存放在堆空间加上在声明之前运行结果如何解读文件方式一一个一个二进制的看这里用到的是需要安装一个插件也可用其他支持二进制格式的文本阅读器入等或者使用方式二使用指令自带的反解析工具方式三使用插件使用方法每次修改代码后重新编译字节码文件菜单栏打开工具栏然后可查看并分析类加载过程或客户端工具可视化更好文件结构细节官方文档位置类的本质任何一个文件都对应着唯一一个类或接口的定义信息但反过来说文件实际上它并不一定以磁盘文件的形式存在文件是一组以位字节为基础单位的二进制流文件格式的结构不像等描述语言由于它没有任何分隔符号所以在其中的数据项无论是字节顺序还是数量都是被严格限定的哪个字节代表什么含义长度是多少先后顺序如何都不允许改变下雨天留客天留我不留下雨天留客天留我不留下雨天留客天留我不留下雨天留客天留我不留文件格式采用一种类似于语言结构体的方式进行数据存储这种结构中只有两种数据类型无符号数和表无符号数属于基本的数据类型以来分别代表个字节个字节个字节和个字节的无符号数无符号数可以用来描述数字索引引用数量值或者按照编码构成字符串值表是由多个无符号数或者其他表作为数据项构成的复合数据类型所有表都习惯性地以结尾表用于描述有层次关系的复合结构的数据整个文件本质上就是一张表由于表没有固定长度所以通常会在其前面加上个数说明举例对应的字节码文件解读换句话说充分理解了每一个字节码文件的细节自己也可以反编译出源文件来文件结构细节概述文件的结构并不是一成不变的随着虚拟机的不断发展总是不可避免地会对文件结构做出一些调整但是其基本结构和框架是非常稳定的文件的总体结构如下魔数文件版本常量池访问标识或标志类索引父类索引接口索引集合字段表集合方法表集合属性表集合下面是一张字节码总的结构表我们按照上面的顺序逐一进行解读就可以了文件的魔数是什么魔数文件的标志每个文件开头的个字节的无符号整数称为魔数它的唯一作用是确定这个文件是否为一个能被虚拟机接受的有效合法的文件即魔数是文件的标识符魔数值固定为不会改变如果一个文件不以开头虚拟机在进行文件校验的时候就会直接抛出以下错误使用魔数而不是扩展名来进行识别主要是基于安全方面的考虑因为文件扩展名可以随意地改动如何确保高版本的可执行低版本的文件不同版本的编译器编译的文件对应的版本是不一样的目前高版本的虚拟机可以执行由低版本编译器生成的文件但是低版本的虚拟机不能执行由高版本编译器生成的文件否则会抛出异常向下兼容在实际应用中由于开发环境和生产环境的不同可能会导致该问题的发生因此需要我们在开发时特别注意开发编译的版本和生产环境中的版本是否一致文件版本号紧接着魔数的个字节存储的是文件的版本号同样也是个字节第个和第个字节所代表的含义就是编译的副版本号而第个和第个字节就是编译的主版本号它们共同构成了文件的格式版本号譬如某个文件的主版本号为副版本号为那么这个文件的格式版本号就确定为版本号和编译器的对应关系如下表的版本号是从开始的之后的每个大版本发布主版本号向上加虚拟机版本为时对应的文件格式版本号的范围为含两端常量池文件的基石作用是常量池存放所有常量常量池是文件中内容最为丰富的区域之一常量池对于文件中的字段和方法解析也有着至关重要的作用常量池可以理解为文件之中的资源仓库它是文件结构中与其他项目关联最多的数据类型后面的很多数据类型都会指向此处也是占用文件空间最大的数据项目之一常量池表项中用于存放编译时期生成的各种字面量和符号引用这部分内容将在类加载后进入方法区的运行时常量池中存放在版本号之后紧跟着的是常量池的数量以及若干个常量池表项常量池中常量的数量是不固定的所以在常量池的入口需要放置一项类型的无符号数代表常量池容量计数值与中语言习惯不一样的是这个容量计数是从而不是开始的由上表可见文件使用了一个前置的容量计数器加若干个连续的数据项的形式来描述常量池内容我们把这一系列连续常量池数据称为常量池集合为什么需要常量池计数器常量池计数器由于常量池的数量不固定时长时短所以需要放置两个字节来表示常量池容量计数值常量池容量计数值类型从开始表示常量池中有多少项常量即表示常量池中有个常量项的值为其值为十进制值为需要注意的是这实际上只有项常量索引为范围是为什么呢通常我们写代码时都是从开始的但是这里的常量池却是从开始因为它把第项常量空出来了这是为了满足后面某些指向常量池的索引值的数据在特定情况下需要表达不引用任何一个常量池项目的含义这种情况可用索引值来表示常量池表常量池是一种表结构以为索引表明了后面有多少个常量项常量池主要存放两大类常量字面量和符号引用它包含了文件结构及其子结构中引用的所有字符串常量类或接口名字段名和其他常量常量池中的每一项都具备相同的特征第个字节作为类型标记用于确定该项的格式这个字节称为标记字节标签字节字面量和符号引用在对这些常量解读前我们需要搞清楚几个概念常量池主要存放两大类常量字面量和符号引用如下表全限定名这个就是类的全限定名仅仅是把包名的替换成为了使连续的多个全限定名之间不产生混淆在使用时最后一般会加入一个表示全限定名结束简单名称简单名称是指没有类型和参数修饰的方法或者字段名称上面例子中的类的方法和字段的简单名称分别是和描述符描述符的作用是用来描述字段的数据类型方法的参数列表包括数量类型以及顺序和返回值根据描述符规则基本数据类型以及代表无返回值的类型都用一个大写字符来表示而对象类型则用字符加对象的全限定名来表示详见下表数据类型基本数据类型引用数据类型用描述符来描述方法时按照先参数列表后返回值的顺序描述参数列表按照参数的严格顺序放在一组小括号之内如方法的描述符为方法的描述符为谈谈你对符号引用直接引用的理解代码在进行编译的时候并不像和那样有连接这一步骤而是在虚拟机加载文件的时候进行动态链接也就是说在文件中不会保存各个方法字段的最终内存布局信息因此这些字段方法的符号引用不经过运行期转换的话无法得到真正的内存入口地址也就无法直接被虚拟机使用当虚拟机运行时需要从常量池获得对应的符号引用再在类创建时或运行时解析翻译到具体的内存地址之中虚拟机在加载文件时才会进行动态链接也就是说文件中不会保存各个方法和字段的最终内存布局信息因此这些字段和方法的符号引用不经过转换是无法直接被虚拟机使用的当虚拟机运行时需要从常量池中获得对应的符号引用再在类加载过程中的解析阶段将其替换为直接引用并翻译到具体的内存地址中这里说明下符号引用和直接引用的区别与关联符号引用符号引用以一组符号来描述所引用的目标符号可以是任何形式的字面量只要使用时能无歧义地定位到目标即可符号引用与虚拟机实现的内存布局无关引用的目标并不一定已经加载到了内存中直接引用直接引用可以是直接指向目标的指针相对偏移量或是一个能间接定位到目标的句柄直接引用是与虚拟机实现的内存布局相关的同一个符号引用在不同虚拟机实例上翻译出来的直接引用一般不会相同如果有了直接引用那说明引用的目标必定已经存在于内存之中了常量类型和结构常量池中每一项常量都是一个表之后共有种不同的表结构数据如下表格所示根据上图每个类型的描述我们也可以知道每个类型是用来描述常量池中哪些内容主要是字面量符号引用的比如是用来描述常量池中字面量信息的而且只是整型字面量信息标志为的常量项类型是用来支持动态语言调用的时才加入的细节说明结构用于表示类或接口和结构表示字段方法和接口方法结构用于表示类型的常量对象和表示字节和的数值常量和结构表示字节和的数值常量在文件的常量池表中所有的字节常量均占两个表成员项的空间如果一个或结构的项在常量池表中的索引位则常量池表中下一个可用项的索引位此时常量池表中索引为的项仍然有效但必须视为不可用的结构用于表示字段或方法但是和之前的个结构不同结构没有指明该字段或方法所属的类或接口用于表示字符常量的值结构用于表示方法句柄结构表示方法类型结构用于表示指令所用到的引导方法引导方法所用到的动态调用名称参数和返回类型并可以给引导方法传入一系列称为静态参数的常量解析方式一个字节一个字节的解析使用命令解析或工具会更方便总结这种表或者常量项结构的共同点是表开始的第一位是一个类型的标志位代表当前这个常量项使用的是哪种表结构即哪种常量类型在常量池列表中常量项是一种使用改进过的编码格式来存储诸如文字字符串类或者接口的全限定名字段或者方法的简单名称以及描述符等常量字符串信息这种常量项结构还有一个特点是其中个常量项占用的字节固定只有占用字节不固定其大小由决定为什么呢因为从常量池存放的内容可知其存放的是字面量和符号引用最终这些内容都会是一个字符串这些字符串的大小是在编写程序时才确定比如你定义一个类类名可以取长取短所以在没编译前大小不固定编译后通过编码就可以知道其长度访问标识访问标识访问标志访问标记在常量池后紧跟着访问标记该标记使用两个字节表示用于识别一些类或者接口层次的访问信息包括这个是类还是接口是否定义为类型是否定义为类型如果是类的话是否被声明为等各种访问标记如下所示类的访问权限通常为开头的常量每一种类型的表示都是通过设置访问标记的位中的特定位来实现的比如若是的类则该标记为使用可以让类更准确地定位到父类的方法现代编译器都会设置并且使用这个标记补充说明带有标志的文件表示的是接口而不是类反之则表示的是类而不是接口如果一个文件被设置了标志那么同时也得设置标志同时它不能再设置或标志如果没有设置标志那么这个文件可以具有上表中除外的其他所有标志当然和这类互斥的标志除外这两个标志不得同时设置标志用于确定类或接口里面的指令使用的是哪一种执行语义针对虚拟机指令集的编译器都应当设置这个标志对于及后续版本来说无论文件中这个标志的实际值是什么也不管文件的版本号是多少虚拟机都认为每个文件均设置了标志标志是为了向后兼容由旧编译器所编译的代码而设计的目前的标志在由之前的编译器所生成的中是没有确定含义的如果设置了该标志那么的虚拟机实现会将其忽略标志意味着该类或接口是由编译器生成的而不是由源代码生成的注解类型必须设置标志如果设置了标志那么也必须设置标志标志表明该类或其父类为枚举类型表中没有使用的标志是为未来扩充而预留的这些预留的标志在编译器中应该设置为虚拟机实现也应该忽略它们类索引父类索引接口索引集合在访问标记后会指定该类的类别父类类别以及实现的接口格式如下这三项数据来确定这个类的继承关系类索引用于确定这个类的全限定名父类索引用于确定这个类的父类的全限定名由于语言不允许多重继承所以父类索引只有一个除了之外所有的类都有父类因此除了外所有类的父类索引都不为接口索引集合就用来描述这个类实现了哪些接口这些被实现的接口将按语句如果这个类本身是一个接口则应当是语句后的接口顺序从左到右排列在接口索引集合中类索引字节无符号整数指向常量池的索引它提供了类的全限定名如的值必须是对常量池表中某项的一个有效索引值常量池在这个索引处的成员必须为类型结构体该结构体表示这个文件所定义的类或接口父类索引字节无符号整数指向常量池的索引它提供了当前类的父类的全限定名如果我们没有继承任何类其默认继承的是类同时由于不支持多继承所以其父类只有一个指向的父类不能是指向常量池索引集合它提供了一个符号引用到所有已实现的接口由于一个类可以实现多个接口因此需要以数组形式保存多个接口的索引表示接口的每个索引也是一个指向常量池的当然这里就必须是接口而不是类接口计数器项的值表示当前类或接口的直接超接口数量接口索引集合中每个成员的值必须是对常量池表中某项的有效索引值它的长度为每个成员必须为结构其中在中各成员所表示的接口顺序和对应的源代码中给定的接口顺序从左至右一样即对应的是源代码中最左边的接口字段表集合用于描述接口或类中声明的变量字段包括类级变量以及实例级变量但是不包括方法内部代码块内部声明的局部变量字段叫什么名字字段被定义为什么数据类型这些都是无法固定的只能引用常量池中的常量来描述它指向常量池索引集合它描述了每个字段的完整信息比如字段的标识符访问修饰符或是类变量还是实例变量修饰符是否是常量修饰符等注意事项字段表集合中不会列出从父类或者实现的接口中继承而来的字段但有可能列出原本代码之中不存在的字段譬如在内部类中为了保持对外部类的访问性会自动添加指向外部类实例的字段在语言中字段是无法重载的两个字段的数据类型修饰符不管是否相同都必须使用不一样的名称但是对于字节码来讲如果两个字段的描述符不一致那字段重名就是合法的字段计数器字段计数器的值表示当前文件表的成员个数使用两个字节来表示表中每个成员都是一个结构用于表示该类或接口所声明的所有类字段或者实例字段不包括方法内部声明的变量也不包括从父类或父接口继承的那些字段字段表字段表表中的每个成员都必须是一个结构的数据项用于表示当前类或接口中某个字段的完整描述一个字段的信息包括如下这些信息这些信息中各个修饰符都是布尔值要么有要么没有作用域修饰符是实例变量还是类变量修饰符可变性并发可见性修饰符是否强制从主内存读写可否序列化修饰符字段数据类型基本数据类型对象数组字段名称字段表结构字段表作为一个表同样有他自己的结构字段表访问标识我们知道一个字段可以被各种关键字去修饰比如作用域修饰符修饰符修饰符修饰符等等因此其可像类的访问标志那样使用一些标志来标记字段字段的访问标志有如下这些字段名索引根据字段名索引的值查询常量池中的指定索引项即可描述符索引描述符的作用是用来描述字段的数据类型方法的参数列表包括数量类型以及顺序和返回值根据描述符规则基本数据类型及代表无返回值的类型都用一个大写字符来表示而对象则用字符加对象的全限定名来表示如下所示属性表集合一个字段还可能拥有一些属性用于存储更多的额外信息比如初始化值一些注释信息等属性个数存放在中属性具体内容存放在数组中以常量属性为例结构为说明对于常量属性而言值恒为方法表集合指向常量池索引集合它完整描述了每个方法的签名在字节码文件中每一个项都对应着一个类或者接口中的方法信息比如方法的访问修饰符或方法的返回值类型以及方法的参数信息等如果这个方法不是抽象的或者不是的那么字节码中会体现出来一方面表只描述当前类或接口中声明的方法不包括从父类或父接口继承的方法另一方面表有可能会出现由编译器自动添加的方法最典型的便是编译器产生的方法信息比如类接口初始化方法和实例初始化方法使用注意事项在语言中要重载一个方法除了要与原方法具有相同的简单名称之外还要求必须拥有一个与原方法不同的特征签名特征签名就是一个方法中各个参数在常量池中的字段符号引用的集合也就是因为返回值不会包含在特征签名之中因此语言里无法仅仅依靠返回值的不同来对一个已有方法进行重载但在文件格式中特征签名的范围更大一些只要描述符不是完全一致的两个方法就可以共存也就是说如果两个方法有相同的名称和特征签名但返回值不同那么也是可以合法共存于同一个文件中也就是说尽管语法规范并不允许在一个类或者接口中声明多个方法签名相同的方法但是和语法规范相反字节码文件中却恰恰允许存放多个方法签名相同的方法唯一的条件就是这些方法之间的返回值不能相同方法计数器方法计数器的值表示当前文件表的成员个数使用两个字节来表示表中每个成员都是一个结构方法表方法表表中的每个成员都必须是一个结构用于表示当前类或接口中某个方法的完整描述如果某个结构的项既没有设置标志也没有设置标志那么该结构中也应包含实现这个方法所用的虚拟机指令结构可以表示类和接口中定义的所有方法包括实例方法类方法实例初始化方法和类或接口初始化方法方法表的结构实际跟字段表是一样的方法表结构如下方法表访问标志跟字段表一样方法表也有访问标志而且他们的标志有部分相同部分则不同方法表的具体访问标志如下方法名索引根据方法名索引的值查询常量池中的指定索引项即可描述符索引根据描述符索引的值查询常量池中的指定索引项即可属性计数器根据属性计数器的值判断出方法中属性的个数属性表属性计数器后面就是属性表了由于只有一个属性所以这里也只有一个属性表由于涉及到属性表这里简单说下下一节会详细介绍属性表集合属性表集合方法表集合之后的属性表集合指的是文件所携带的辅助信息比如该文件的源文件的名称以及任何带有或者的注解这类信息通常被用于虚拟机的验证和运行以及程序的调试一般无须深入了解此外字段表方法表都可以有自己的属性表用于描述某些场景专有的信息属性表集合的限制没有那么严格不再要求各个属性表具有严格的顺序并且只要不与已有的属性名重复任何人实现的编译器都可以向属性表中写入自己定义的属性信息但虚拟机运行时会忽略掉它不认识的属性属性计数器属性计数器的值表示当前文件属性表的成员个数属性表中每一项都是一个结构属性表属性表属性表的每个项的值必须是结构属性表的结构比较灵活各种不同的属性只要满足以下结构即可属性的通用格式即只需说明属性的名称以及占用位数的长度即可属性表具体的结构可以去自定义属性类型属性表实际上可以有很多类型上面看到的属性只是其中一种里面定义了种属性下面这些是虚拟机中预定义的属性或查看官网属性属性表示一个常量字段的值位于结构的属性表中字段值在常量池中的索引常量池在该索引处的项给出该属性表示的常量值例如值是型的在常量池中便是属性属性是在为了支持注释中的关键词而引入的属性属性就是存放方法体里面的代码但是并非所有方法表都有属性像接口或者抽象方法他们没有具体的方法体因此也就不会有属性了属性表的结构如下图可以看到属性表的前两项跟属性表是一致的即属性表遵循属性表的结构后面那些则是他自定义的结构属性为了方便说明特别定义一个表示类或接口的格式为如果的常量池中包含某个成员且这个成员所表示的类或接口不属于任何一个包那么的结构的属性表中就必须含有对应的属性属性是在中为了支持内部类和内部接口而引入的位于结构的属性表属性属性是可选变长属性位于结构的属性表属性是用来描述源码行号与字节码行号之间的对应关系这个属性可以用来在调试的时候定位代码执行的行数即字节码行号即源代码行号在属性的属性表中属性可以按照任意顺序出现此外多个属性可以共同表示一个行号在源文件中表示的内容即属性不需要与源文件的行一一对应属性表结构属性是可选变长属性位于属性的属性表中它被调试器用于确定方法在执行过程中局部变量的信息在属性的属性表中属性可以按照任意顺序出现属性中的每个局部变量最多只能有一个属性表示这个变量在字节码中的生命周期起始和结束的偏移位置生命周期从头到结尾就是这个变量在局部变量表中的槽位槽位可复用就是变量名称表示局部变量类型描述属性表结构属性属性是可选的定长属性位于或结构的属性表中在语言中任何类接口初始化方法或成员的泛型签名如果包含了类型变量或参数化类型则属性会为它记录泛型签名信息属性属性结构可以看到其长度总是固定的个字节其他属性虚拟机中预定义的属性有多个这里就不一一介绍了通过上面几个属性的介绍只要领会其精髓其他属性的解读也是易如反掌小结官方的反解析工具解析字节码的作用通过反编译生成的字节码文件我们可以深入的了解代码的工作机制但是自己分析类文件结构太麻烦了除了使用第三方的工具之外官方也提供了工具是自带的反解析工具它的作用就是根据字节码文件反解析出当前类对应的区字节码指令局部变量表异常表和代码行偏移量映射表常量池等信息通过局部变量表我们可以查看局部变量的作用域范围所在槽位等信息甚至可以看到槽位复用等信息操作解析字节码文件得到的信息中有些信息如局部变量表指令和代码行偏移量映射表常量池中方法的参数名称等等需要在使用编译成文件时指定参数才能输出比如你直接就不会在生成对应的局部变量表等信息如果你使用就可以生成所有相关信息了如果你使用的或则默认情况下在编译时会帮你生成局部变量表指令和代码行偏移量映射表等信息的的用法的用法格式其中就是你要反编译的文件在命令行中直接输入或可以看到的有如下选项这里重组一下一般常用的是三个选项会输出行号和本地变量表信息会对当前字节码进行反编译生成汇编代码除了包含内容外还会输出行号局部变量表信息常量池等信息使用举例有下面一个类希望输出的信息比较完整的话使用如下操作对应的内容信息为总结通过命令可以查看一个类反汇编得到的文件版本号常量池访问标识变量表指令代码行号表等等信息不显示类索引父类索引接口索引集合等结构通过对前面例子代码反汇编文件的简单分析可以发现一个方法的执行通常会涉及下面几块内存的操作栈中局部变量表操作数栈堆通过对象的地址引用去操作常量池其他如帧数据区方法区的剩余部分等情况测试中没有显示出来这里说明一下平常我们比较关注的是类中每个方法的反汇编中的指令操作过程这些指令都是顺序执行的可以参考官方文档查看每个指令的含义很简单字节码指令集与解析概述字节码对于虚拟机就好像汇编语言对于计算机属于基本执行指令虚拟机的指令由一个字节长度的代表着某种特定操作含义的数字称为操作码以及跟随其后的零至多个代表此操作所需参数称为操作数而构成由于虚拟机采用面向操作数栈而不是寄存器的结构所以大多数的指令都不包含操作数只有一个操作码由于限制了虚拟机操作码的长度为一个字节即这意味着指令集的操作码总数不可能超过条官方文档熟悉虚拟机的指令对于动态字节码生成反编译文件文件修补都有着非常重要的价值因此阅读字节码作为了解虚拟机的基础技能需要熟练掌握常见指令字节码与数据类型在虚拟机的指令集中大多数的指令都包含了其操作所对应的数据类型信息例如指令用于从局部变量表中加载型的数据到操作数栈中而指令加载的则是类型的数据对于大部分与数据类型相关的字节码指令它们的操作码助记符中都有特殊的字符来表明专门为哪种数据类型服务代表对类型的数据操作代表类型的数据操作代表类型的数据操作代表类型的数据操作代表类型的数据操作代表类型的数据操作代表类型的数据操作也有一些指令的助记符中没有明确地指明操作类型的字母如指令它没有代表数据类型的特殊字符但操作数永远只能是一个数组类型的对象还有另外一些指令如无条件跳转指令则是与数据类型无关的大部分的指令都没有支持整数类型和甚至没有任何指令支持类型编译器会在编译期或运行期将和类型的数据带符号扩展为相应的类型数据将和类型数据零位扩展为相应的类型数据与之类似在处理和类型的数组时也会转换为使用对应的类型的字节码指令来处理因此大多数对于和类型数据的操作实际上都是使用相应的类型作为运算类型指令分类由于完全介绍和学习这些指令需要花费大量时间为了让大家能够更快地熟悉和了解这些基本指令这里将中的字节码指令集按用途大致分成类加载与存储指令算术指令类型转换指令对象的创建与访问指令方法调用与返回指令操作数栈管理指令控制转移指令异常处理指令同步控制指令说在前面在做值相关操作时一个指令可以从局部变量表常量池堆中对象方法调用系统调用中等取得数据这些数据可能是值可能是对象的引用被压入操作数栈一个指令也可以从操作数栈中取出一到多个值多次完成赋值加减乘除方法传参系统调用等等操作字节码指令面试题知道字节码吗字节码指令都有哪些百度加载与存储指令作用加载和存储指令用于将数据从栈帧的局部变量表和操作数栈之间来回传递常用指令局部变量压栈指令将一个局部变量加载到操作数栈其中为为到常量入栈指令将一个常量加载到操作数栈出栈装入局部变量表指令将一个数值从操作数栈存储到局部变量表其中为为扩充局部变量表的访问索引的指令上面所列举的指令助记符中有一部分是以尖括号结尾的例如这些指令助记符实际上代表了一组指令例如代表了和这几个指令这几组指令都是某个带有一个操作数的通用指令例如的特殊形式对于这若干组特殊指令来说它们表面上没有操作数不需要进行取操作数的动作但操作数都隐含在指令中比如将局部变量表中索引为位置上的数据压入操作数栈中将局部变量表中索引为位置上的数据压入操作数栈中将局部变量表中索引为位置上的数据压入操作数栈中除此之外它们的语义与原生的通用指令完全一致例如的语义与操作数为时的指令语义完全一致在尖括号之间的字母指定了指令隐含操作数的数据类型代表非负的整数代表是类型数据代表类型代表类型代表类型操作和类型数据时经常用类型的指令来表示操作数栈与局部变量表操作数栈我们知道字节码是虚拟机所使用的指令集因此它与虚拟机基于栈的计算模型是密不可分的在解释执行过程中每当为方法分配栈桢时虚拟机往往需要开辟一块额外的空间作为操作数栈来存放计算的操作数以及返回结果具体来说便是执行每一条指令之前虚拟机要求该指令的操作数已被压入操作数栈中在执行指令时虚拟机会将该指令所需的操作数弹出并且将指令的结果重新压入栈中以加法指令为例假设在执行该指令前栈顶的两个元素分别为值和值那么指令将弹出这两个并将求得的和值压入栈中由于指令只消耗栈顶的两个元素因此对于离栈顶距离为的元素即图中的问号指令并不关心它是否存在更加不会对其进行修改局部变量表方法栈桢的另外一个重要组成部分则是局部变量区字节码程序可以将计算的结果缓存在局部变量区之中实际上虚拟机将局部变量区当成一个数组依次存放指针仅非静态方法所传入的参数以及字节码中的局部变量和操作数栈一样类型以及类型的值将占据两个单元其余类型仅占据一个单元举例对应的图示在栈帧中与性能调优关系最为密切的部分就是局部变量表局部变量表中的变量也是重要的垃圾回收根节点只要被局部变量表中直接或间接引用的对象都不会被回收在方法执行时虚拟机使用局部变量表完成方法的传递局部变量压栈指令局部变量压栈指令将给定的局部变量表中的数据压入操作数栈这类指令大体可以分为为为到为说明在这里的取值表示数据类型指令表示将第个局部变量压入操作数栈比如等指令其中表示将一个对象引用压栈指令通过指定参数的形式把局部变量压入操作数栈当使用这个命令时表示局部变量的数量可能超过了个比如指令等常量入栈指令常量入栈指令的功能是将常数压入操作数栈根据数据类型和入栈内容的不同又可以分为系列系列和指令指令系列用于对特定的常量入栈入栈的常量隐含在指令本身里指令有从到从到从到从到比如将压入操作数栈为到将压入栈分别将长整数和压入栈分别将浮点数压入栈和分别将型和压入栈将压入操作数栈从指令的命名上不难找出规律指令助记符的第一个字符总是喜欢表示数据类型表示整数表示长整数表示浮点数表示双精度浮点习惯上用表示对象引用如果指令隐含操作的参数会以下划线形式给出指令系列主要包括和它们的区别在于接收数据类型的不同接收位整数作为参数接收位整数它们都将参数压入栈指令系列如果以上指令都不能满足需求那么可以使用万能的指令它可以接收一个位的参数该参数指向常量池中的或者的索引将指定的内容压入堆栈类似的还有它接收两个位参数能支持的索引范围大于如果要压入的元素是或者类型的则使用指令使用方式都是类似的总结如下出栈装入局部变量表指令出栈装入局部变量表指令用于将操作数栈中栈顶元素弹岀后装入局部变量表的指定位置用于给局部变量赋值这类指令主要以的形式存在比如为为为至其中指令将从操作数栈中弹出一个整数并把它赋值给局部变量索引位置指令由于没有隐含参数信息故需要提供一个类型的参数类指定目标局部变量表的位置说明一般说来类似像这样的命令需要带一个参数用来指明将弹出的元素放在局部变量表的第几个位置但是为了尽可能压缩指令大小使用专门的指令表示将弹出的元素放置在局部变量表第个位置类似的还有它们分别表示从操作数栈顶弹出一个元素存放在局部变量表第个位置由于局部变量表前几个位置总是非常常用因此这种做法虽然增加了指令数量但是可以大大压缩生成的字节码的体积如果局部变量表很大需要存储的槽位大于那么可以使用指令外加一个参数用来表示需要存放的槽位位置算术指令作用算术指令用于对两个操作数栈上的值进行某种特定运算并把结果重新压入操作数栈分类大体上算术指令可以分为两种对整型数据进行运算的指令与对浮点类型数据进行运算的指令和类型说明在每一大类中都有针对虚拟机具体数据类型的专用算术指令但没有直接支持和类型的算术指令对于这些数据的运算都使用类型的指令来处理此外在处理和类型的数组时也会转换为使用对应的类型的字节码指令来处理运算时的溢出数据运算可能会导致溢出例如两个很大的正整数相加结果可能是一个负数其实虚拟机规范并无明确规定过整型数据溢出的具体结果仅规定了在处理整型数据时只有除法指令以及求余指令中当出现除数为时会导致虚拟机抛出异常运算模式向最接近数舍入模式要求在进行浮点数计算时所有的运算结果都必须舍入到适当的精度非精确结果必须舍入为可被表示的最接近的精确值如果有两种可表示的形式与该值一样接近将优先选择最低有效位为零的向零舍入模式将浮点数转换为整数时采用该模式该模式将在目标数值类型中选择一个最接近但是不大于原值的数字作为最精确的舍入结果值使用当一个操作产生溢出时将会使用有符号的无穷大表示如果某个操作结果没有明确的数学定义的话将会使用值来表示而且所有使用值作为操作数的算术操作结果都会返回所有算术指令所有的算术指令包括加法指令减法指令乘法指令除法指令求余指令余数取反指令取反自增指令位运算指令又可分为位移指令按位或指令按位与指令按位异或指令比较指令举例字节码指令对应的图示举例字节码对应的内存解析举例字节码对应的内存解析比较指令的说明比较指令的作用是比较栈顶两个元素的大小并将比较结果入栈比较指令有与前面讲解的指令类似首字符表示类型表示表示对于和类型的数字由于的存在各有两个版本的比较指令以为例有和两个指令它们的区别在于在数字比较时若遇到值处理结果不同指令和也是类似的根据其命名可以推测其含义在此不再赘述指令针对型整数由于型整数没有值故无需准备两套指令举例指令和都从栈中弹出两个操作数并将它们做比较设栈顶的元素为栈顶顺位第位的元素为若则压入若则压入若则压入两个指令的不同之处在于如果遇到值会压入而会压入数值类型的数据才可以谈大小引用数据类型不能比较大小类型转换指令类型转换指令说明类型转换指令可以将两种不同的数值类型进行相互转换这些转换操作一般用于实现用户代码中的显式类型转换操作或者用来处理字节码指令集中数据类型相关指令无法与数据类型一一对应的问题宽化类型转换宽化类型转换转换规则虚拟机直接支持以下数值的宽化类型转换小范围类型向大范围类型的安全转换也就是说并不需要指令执行包括从类型到或者类型对应的指令为从类型到类型对应的指令为从类型到类型对应的指令为简化为精度损失问题宽化类型转换是不会因为超过目标类型最大值而丢失信息的例如从转换到或者从转换到都不会丢失任何信息转换前后的值是精确相等的从类型数值转换到或者类型数值转换到时将可能发生精度丢失可能丢失掉几个最低有效位上的值转换后的浮点数值是根据最接近舍入模式所得到的正确整数值尽管宽化类型转换实际上是可能发生精度丢失的但是这种转换永远不会导致虚拟机抛出运行时异常补充说明从和类型到类型的宽化类型转换实际上是不存在的对于类型转为虚拟机并没有做实质性的转化处理只是简单地通过操作数栈交换了两个数据而将转为时使用的是可以看到在内部在这里已经等同于类型处理类似的还有类型这种处理方式有两个特点一方面可以减少实际的数据类型如果为和都准备一套指令那么指令的数量就会大增而虚拟机目前的设计上只愿意使用一个字节表示指令因此指令总数不能超过个为了节省指令资源将和当做处理也在情理之中另一方面由于局部变量表中的槽位固定为位无论是或者存入局部变量表都会占用位空间从这个角度说也没有必要特意区分这几种数据类型窄化类型转换窄化类型转换转换规则虚拟机也直接支持以下窄化类型转换从类型至或者类型对应的指令有从类型到类型对应的指令有从类型到或者类型对应的指令有从类型到或者类型对应的指令有精度损失问题窄化类型转换可能会导致转换结果具备不同的正负号不同的数量级因此转换过程很可能会导致数值丢失精度尽管数据类型窄化转换可能会发生上限溢出下限溢出和精度丢失等情况但是虚拟机规范中明确规定数值类型的窄化转换指令永远不可能导致虚拟机抛出运行时异常补充说明当将一个浮点值窄化转换为整数类型限于或类型之一的时候将遵循以下转换规则如果浮点值是那转换结果就是或类型的如果浮点值不是无穷大的话浮点值使用的向零舍入模式取整获得整数值如果在目标类型或的表示范围之内那转换结果就是否则将根据的符号转换为所能表示的最大或者最小正数当将一个类型窄化转换为类型时将遵循以下转换规则通过向最接近数舍入模式舍入一个可以使用类型表示的数字最后结果根据下面这条规则判断如果转换结果的绝对值太小而无法使用来表示将返回类型的正负零如果转换结果的绝对值太大而无法使用来表示将返回类型的正负无穷大对于类型的值将按规定转换为类型的值对象的创建与访问指令是面向对象的程序设计语言虚拟机平台从字节码层面就对面向对象做了深层次的支持有一系列指令专门用于对象操作可进一步细分为创建指令字段访问指令数组操作指令类型检查指令创建指令虽然类实例和数组都是对象但虚拟机对类实例和数组的创建与操作使用了不同的字节码指令创建类实例的指令创建类实例的指令它接收一个操作数为指向常量池的索引表示要创建的类型执行完成后将对象的引用压入栈创建数组的指令创建数组的指令创建基本类型数组创建引用类型数组创建多维数组上述创建指令可以用于创建对象或者数组由于对象和数组在中的广泛使用这些指令的使用频率也非常高字段访问指令对象创建后就可以通过对象访问指令获取对象实例或数组实例中的字段或者数组元素访问类字段字段或者称为类变量的指令访问类实例字段非字段或者称为实例变量的指令举例以指令为例它含有一个操作数为指向常量池的索引它的作用就是获取指定的对象或者值并将其压入操作数栈对应的字节码指令图示数组操作指令数组操作指令主要有和指令具体为把一个数组元素加载到操作数栈的指令将一个操作数栈的值存储到数组元素中的指令即取数组长度的指令该指令弹出栈顶的数组元素获取数组的长度将长度压入栈说明指令表示将数组的元素压栈比如分别表示压入数组和数组指令在执行时要求操作数中栈顶元素为数组索引栈顶顺位第个元素为数组引用该指令会弹岀栈顶这两个元素并将重新压入栈则专门针对数组操作以为例它用于给一个数组的给定索引赋值在执行前操作数栈顶需要以此准备个元素值索引数组引用会弹出这个值并将值赋给数组中指定索引的位置类型检查指令检查类实例或数组类型的指令指令用于检查类型强制转换是否可以进行如果可以进行那么指令不会改变操作数栈否则它会抛出异常指令用来判断给定对象是否是某一个类的实例它会将判断结果压入操作数栈方法调用与返回指令方法调用指令方法调用指令以下条指令用于方法调用指令用于调用对象的实例方法根据对象的实际类型进行分派虚方法分派支持多态这也是语言中最常见的方法分派方式指令用于调用接口方法它会在运行时搜索由特定对象所实现的这个接口方法并找出适合的方法进行调用指令用于调用一些需要特殊处理的实例方法包括实例初始化方法构造器私有方法和父类方法这些方法都是静态类型绑定的不会在调用时进行动态派发指令用于调用命名类中的类方法方法这是静态绑定的调用动态绑定的方法这个是后新加入的指令用于在运行时动态解析出调用点限定符所引用的方法并执行该方法前面条调用指令的分派逻辑都固化在虚拟机内部而指令的分派逻辑是由用户所设定的引导方法决定的代码举例尚硅谷方法返回指令方法调用结束前需要进行返回方法返回指令是根据返回值的类型区分的包括当返回值是和类型时使用和另外还有一条指令供声明为的方法实例初始化方法以及类和接口的类初始化方法使用举例通过指令将当前函数操作数栈的顶层元素弹出并将这个元素压入调用者函数的操作数栈中因为调用者非常关心函数的返回值所有在当前函数操作数栈中的其他元素都会被丢弃如果当前返回的是方法那么还会执行一个隐含的指令退出临界区最后会丢弃当前方法的整个帧恢复调用者的帧并将控制权转交给调用者对应的代码操作数栈管理指令如同操作一个普通数据结构中的堆栈那样提供的操作数栈管理指令可以用于直接操作操作数栈的指令这类指令包括如下内容将一个或两个元素从栈顶弹出并且直接废弃复制栈顶一个或两个数值并将复制值或双份的复制值重新压入栈顶将栈最顶端的两个数值位置交换虚拟机没有提供交换两个位数据类型数值的指令指令是一个非常特殊的指令它的字节码为和汇编语言中的一样它表示什么都不做这条指令一般可用于调试占位等这些指令属于通用型对栈的压入或者弹出无需指明数据类型说明不带的指令是复制栈顶数据并压入栈顶包括两个指令和的系数代表要复制的个数开头的指令用于复制个的数据例如个或个类型数据开头的指令用于复制个的数据例如个或个或个个类型数据带的指令是复制栈顶数据并插入栈顶以下的某个位置共有个指令对于带的复制插入指令只要将指令的和的系数相加结果即为需要插入的位置因此插入位置即栈顶个下面插入位置即栈顶个下面插入位置即栈顶个下面插入位置即栈顶个下面将栈顶的个数值出栈例如个类型数值将栈顶的个数值出栈例如个类型数值或者个类型数值控制转移指令程序流程离不开条件控制为了支持条件跳转虚拟机提供了大量字节码指令大体上可以分为比较指令条件跳转指令比较条件跳转指令多条件分支跳转指令无条件跳转指令等条件跳转指令条件跳转指令通常和比较指令结合使用在条件跳转指令执行前一般可以先用比较指令进行栈顶元素的准备然后进行条件跳转条件跳转指令有这些指令都接收两个字节的操作数用于计算跳转的位置位符号整数作为当前位置的它们的统一含义为弹出栈顶元素测试它是否满足某一条件如果满足条件则跳转到给定位置具体说明注意与前面运算规则一致对于类型的条件分支比较操作都是使用类型的比较指令完成对于类型的条件分支比较操作则会先执行相应类型的比较运算指令运算指令会返回一个整型值到操作数栈中随后再执行类型的条件分支比较操作来完成整个分支跳转由于各类型的比较最终都会转为类型的比较操作所以虚拟机提供的类型的条件分支指令是最为丰富和强大的比较条件跳转指令比较条件跳转指令类似于比较指令和条件跳转指令的结合体它将比较和跳转两个步骤合二为一这类指令有和其中指令助记符加上后以字符开头的指令针对型整数操作也包括和类型以字符开头的指令表示对象引用的比较具体说明这些指令都接收两个字节的操作数作为参数用于计算跳转的位置同时在执行指令时栈顶需要准备两个元素进行比较指令执行完成后栈顶的这两个元素被清空且没有任何数据入栈如果预设条件成立则执行跳转否则继续执行下一条语句多条件分支跳转指令多条件分支跳转指令是专为语句设计的主要有和从助记符上看两者都是语句的实现它们的区别要求多个条件分支值是连续的它内部只存放起始值和终止值以及若干个跳转偏移量通过给定的操作数可以立即定位到跳转偏移量位置因此效率比较高指令内部存放着各个离散的对每次执行都要搜索全部的对找到匹配的值并根据对应的计算跳转地址因此效率较低指令的示意图如下图所示由于的值是连续的因此只需要记录最低值和最高值以及每一项对应的偏移量根据给定的值通过简单的计算即可直接定位到指令处理的是离散的值但是出于效率考虑将对按照值大小排序给定时需要査找与相等的获得其如果找不到则跳转到指令如下图所示无条件跳转指令目前主要的无条件跳转指令为指令接收两个字节的操作数共同组成一个带符号的整数用于指定指令的偏移量指令执行的目的就是跳转到偏移量给定的位置处如果指令偏移量太大超过双字节的带符号整数的范围则可以使用指令它和有相同的作用但是它接收个字节的操作数可以表示更大的地址范围指令虽然也是无条件跳转的但主要用于语句且已经被虚拟机逐渐废弃故不在这里介绍这两个指令异常处理指令抛出异常指令指令在程序中显示抛出异常的操作语句都是由指令来实现除了使用语句显示抛出异常情况之外规范还规定了许多运行时异常会在其他虚拟机指令检测到异常状况时自动抛出例如在之前介绍的整数运算时当除数为零时虚拟机会在或指令中抛出异常注意正常情况下操作数栈的压入弹出都是一条条指令完成的唯一的例外情况是在抛异常时虚拟机会清除操作数栈上的所有内容而后将异常实例压入调用者操作数栈上异常及异常的处理过程一异常对象的生成过程手动自动指令过程二异常的处理抓抛模型使用异常表异常处理与异常处理异常在虚拟机中处理异常语句不是由字节码指令来实现的早期使用指令而是采用异常表来完成的异常表如果一个方法定义了一个或者的异常处理就会创建一个异常表它包含了每个异常处理或者块的信息异常表保存了每个异常处理信息比如起始位置结束位置程序计数器记录的代码处理的偏移地址被捕获的异常类在常量池中的索引当一个异常被抛出时会在当前的方法里寻找一个匹配的处理如果没有找到这个方法会强制结束并弹出当前栈帧并且异常会重新抛给上层调用的方法在调用方法栈帧如果在所有栈帧弹出前仍然没有找到合适的异常处理这个线程将终止如果这个异常在最后一个非守护线程里抛出将会导致自己终止比如这个线程是个线程不管什么时候抛出异常如果异常处理最终匹配了所有异常类型代码就会继续执行在这种情况下如果方法结束后没有抛出异常仍然执行块在前它直接跳到块来完成目标同步控制指令虚拟机支持两种同步结构方法级的同步和方法内部一段指令序列的同步这两种同步都是使用来支持的方法级的同步方法级的同步是隐式的即无须通过字节码指令来控制它实现在方法调用和返回操作之中虚拟机可以从方法常量池的方法表结构中的访问标志得知一个方法是否声明为同步方法当调用方法时调用指令将会检查方法的访问标志是否设置如果设置了执行线程将先持有同步锁然后执行方法最后在方法完成无论是正常完成还是非正常完成时释放同步锁在方法执行期间执行线程持有了同步锁其他任何线程都无法再获得同一个锁如果一个同步方法执行期间抛出了异常并且在方法内部无法处理此异常那这个同步方法所持有的锁将在异常抛到同步方法之外时自动释放举例对应的字节码说明这段代码和普通的无同步操作的代码没有什么不同没有使用和进行同步区控制这是因为对于同步方法而言当虚拟机通过方法的访问标示符判断是一个同步方法时会自动在方法调用前进行加锁当同步方法执行完毕后不管方法是正常结束还是有异常抛岀均会由虚拟机释放这个锁因此对于同步方法而言和指令是隐式存在的并未直接出现在字节码中方法内指定指令序列的同步同步一段指令集序列通常是由中的语句块来表示的的指令集有和两条指令来支持关键字的语义当一个线程进入同步代码块时它使用指令请求进入如果当前对象的监视器计数器为则它会被准许进入若为则判断持有当前监视器的线程是否为自己如果是则进入否则进行等待直到对象的监视器计数器为才会被允许进入同步块当线程退岀同步块时需要使用声明退出在虚拟机中任何对象都有一个监视器与之相关联用来判断对象是否被锁定当监视器被持有后对象处于锁定状态指令和在执行时都需要在操作数栈顶压入对象之后和的锁定和释放都是针对这个对象的监视器进行的下图展示了监视器如何保护临界区代码不同时被多个线程访问只有当线程离开临界区后线程才有可能进入举例对应的字节码编译器必须确保无论方法通过何种方式完成方法中调用过的每条指令都必须执行其对应的指令而无论这个方法是正常结束还是异常结束为了保证在方法异常完成时和指令依然可以正确配对执行编译器会自动产生一个异常处理器这个异常处理器声明可处理所有的异常它的目的就是用来执行指令面试题如何取得的值圆通比较都经过哪些步骤百度虚拟机中数据类型可以分为哪几类阿里虚拟机是通过某些数据类型来执行计算的数据类型可以分为两种基本类型和引用类型基本类型的变量持有原始值而引用类型的变量持有引用值语言中的所有基本类型同样也都是虚拟机中的基本类型但是有点特别虽然虚拟机也把看做基本类型但是指令集对只有很有限的支持当编译器把源代码编译为字节码时它会用或者来表示在虚拟机中是由整数零来表示的所有非零整数都表示涉及值的操作则会使用另外数组是当做数组来访问的虚拟机还有一个只在内部使用的基本类型程序员不能使用这个类型这个基本类型被用来实现程序中的子句该类型是以及指令需要使用到的它的值是指令的操作码的指针类型不是简单意义上的数值不属于任何一种基本类型并且它的值是不能被运行中的程序所修改的虚拟机的引用类型被统称为引用有三种引用类型类类型接口类型以及数组类型它们的值都是对动态创建对象的引用类类型的值是对类实例的引用数组类型的值是对数组对象的引用在虚拟机中数组是个真正的对象而接口类型的值则是对实现了该接口的某个类实例的引用还有一种特殊的引用值是它表示该引用变量没有引用任何对象为什么不把基本类型放堆中呢阿里首先是栈堆的特点不同堆比栈要大但是栈比堆的运算速度要快将复杂数据类型放在堆中的目的是为了不影响栈的效率而是通过引用的方式去堆中查找八大基本类型的大小创建时候已经确立大小三大引用类型创建时候无法确定大小简单数据类型比较稳定并且它只占据很小的内存将它放在空间小运算速度快的栈中能够提高效率中的参数传递是传值呢还是传引用阿里中有没有指针的概念阿里指针具有您可能或可能不会通常使用的额外操作引用缺少这些操作因为这些操作可能不安全例如如果您使用指针来索引数组的第一个元素如下所示您可能想要取消引用指针并获取值还可以继续获得值获得值这是因为操作将指针在内存中向前移动了一个单位指针将一个地址存储在内存中并且操作将适当数量的字节添加到该地址在许多系统上会加四个字节但是如果指针是指针则只能加一个字节由于指针的基础数据类型是内存中的地址因此以下内容是合法的但不建议这样做',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-12-11 23:17:32',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><script async="" defer="" src="https://umami.shiguangdev.cn/script.js" data-website-id="ac8d5698-b224-4ea4-aa79-eefb80c47eef"></script><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="時光" type="application/atom+xml">
</head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="/img/avatar.png"><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://www.shiguang666.eu.org" title="時光主页"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="時光主页"><span class="back-menu-item-text">時光主页</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://nav.shiguang666.eu.org" title="時光导航站"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="時光导航站"><span class="back-menu-item-text">時光导航站</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://game.shiguang666.eu.org" title="怀旧游戏机"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="怀旧游戏机"><span class="back-menu-item-text">怀旧游戏机</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://games.shiguang666.eu.org" title="在线小游戏"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="在线小游戏"><span class="back-menu-item-text">在线小游戏</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">后台管理</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://img.shiguangdev.cn/" title="時光图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/favicon.ico" alt="時光图床"><span class="back-menu-item-text">時光图床</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://qexo.shiguang666.eu.org/" title="Hexo管理面板"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://qexo.shiguang666.eu.org/favicon.ico" alt="Hexo管理面板"><span class="back-menu-item-text">Hexo管理面板</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">時光</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 归档</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随机</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/news/"><i class="fa fa-calendar faa-tada"></i><span> 早报亭</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/music/?id=10051718332&amp;server=netease"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/gallery/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/xjj/"><i class="fa fa-rocket faa-tada"></i><span> 养生堂</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/flink/"><i class="anzhiyufont anzhiyu-icon-artstation faa-tada" style="font-size: 0.9em;"></i><span> 朋友圈</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comment/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于我</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button only-home" id="travellings_button" title="随机前往一个开往项目网站"><a class="site-page" onclick="anzhiyu.totraveling()" title="随机前往一个开往项目网站" href="javascript:void(0);" rel="external nofollow" data-pjax-state="external"><i class="anzhiyufont anzhiyu-icon-train"></i></a></div><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="/img/wechat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/wechat.png"></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/alipay.png"></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/12/"><span class="card-archive-list-date">十二月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">10</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/11/"><span class="card-archive-list-date">十一月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">8</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/10/"><span class="card-archive-list-date">十月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">31</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/09/"><span class="card-archive-list-date">九月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">38</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/08/"><span class="card-archive-list-date">八月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">9</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/07/"><span class="card-archive-list-date">七月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">18</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/06/"><span class="card-archive-list-date">六月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">30</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/05/"><span class="card-archive-list-date">五月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">20</span><span>篇</span></div></a></li></ul></div><hr></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item on" id="consoleCommentBarrage" onclick="anzhiyu.switchCommentBarrage()" title="热评开关"><a class="commentBarrage"><i class="anzhiyufont anzhiyu-icon-message"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" itemprop="url">学习笔记</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/JAVA/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>JAVA</span></a><a class="article-meta__tags" href="/tags/%E5%B0%9A%E7%A1%85%E8%B0%B7/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>尚硅谷</span></a><a class="article-meta__tags" href="/tags/JVM/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>JVM</span></a></span></div></div><h1 class="post-title" itemprop="name headline">【尚硅谷】JVM-字节码篇</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2024-12-11T00:33:29.000Z" title="发表于 2024-12-11 08:33:29">2024-12-11</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2024-12-11T15:17:32.722Z" title="更新于 2024-12-11 23:17:32">2024-12-11</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">27k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>92分钟</span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为上海"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>上海</span><span class="post-meta-separator"></span><span class="post-meta-commentcount"><i class="anzhiyufont anzhiyu-icon-comments post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/2024/12/11/0a6035f3745c/#post-comment" tabindex="-1"><span id="twikoo-count"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></a></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://img.shiguangdev.cn/i/2024/08/28/66cedaf5d014a.jpeg"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope="" itemtype="https://blog.shiguang666.eu.org/2024/12/11/0a6035f3745c/"><header><a class="post-meta-categories" href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" itemprop="url">学习笔记</a><a href="/tags/JAVA/" tabindex="-1" itemprop="url">JAVA</a><a href="/tags/%E5%B0%9A%E7%A1%85%E8%B0%B7/" tabindex="-1" itemprop="url">尚硅谷</a><a href="/tags/JVM/" tabindex="-1" itemprop="url">JVM</a><h1 id="CrawlerTitle" itemprop="name headline">【尚硅谷】JVM-字节码篇</h1><span itemprop="author" itemscope="" itemtype="http://schema.org/Person">時光</span><time itemprop="dateCreated datePublished" datetime="2024-12-11T00:33:29.000Z" title="发表于 2024-12-11 08:33:29">2024-12-11</time><time itemprop="dateCreated datePublished" datetime="2024-12-11T15:17:32.722Z" title="更新于 2024-12-11 23:17:32">2024-12-11</time></header><div id="postchat_postcontent"><blockquote>
<p>官方资料：</p>
<p>在线视频：<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Dz4y1A7FB">尚硅谷JVM精讲与GC调优教程（宋红康主讲，含jvm面试真题）</a></p>
<p>课程资料：<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1ITPpXOuTwfBW2e5dksgqNw?pwd=yyds">尚硅谷宋红康JVM精讲与GC调优</a></p>
<p>代码仓库：</p>
<p>GitHub: <a target="_blank" rel="noopener" href="https://github.com/Shiguang-coding/learn-jvm">https://github.com/Shiguang-coding/learn-jvm</a></p>
<p>Gitee: <a target="_blank" rel="noopener" href="https://gitee.com/an_shiguang/learn-jvm">https://gitee.com/an_shiguang/learn-jvm</a></p>
</blockquote>
<h1 id="1、JVM概述"><a href="#1、JVM概述" class="headerlink" title="1、JVM概述"></a>1、JVM概述</h1><h2 id="1-1、Java语言及Java生态圈"><a href="#1-1、Java语言及Java生态圈" class="headerlink" title="1.1、Java语言及Java生态圈"></a>1.1、Java语言及Java生态圈</h2><h3 id="Oracle-JDK与Open-JDK什么关系？"><a href="#Oracle-JDK与Open-JDK什么关系？" class="headerlink" title="Oracle JDK与Open JDK什么关系？"></a>Oracle JDK与Open JDK什么关系？</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/6758e4ed69a55.webp" alt="image-20241211090340800"></p>
<p>官方的说明：<br><a target="_blank" rel="noopener" href="https://www.oracle.com/cn/java/technologies/javase-downloads.html">https://www.oracle.com/cn/java/technologies/javase-downloads.html</a><br>Oracle Customers and ISVs targeting Oracle LTS releases: Oracle JDK is Oracle’s supported Java SE version for customers and for developing, testing, prototyping or demonstrating your Java applications.<br>End users and developers looking for free JDK versions:<strong><font color="red"> Oracle OpenJDK offers the same features and performance as Oracle JDK under the GPL license .</font></strong></p>
<p>Oracle JDK下载路径：<br><a target="_blank" rel="noopener" href="https://www.oracle.com/java/technologies/javase-jdk15-downloads.html">https://www.oracle.com/java/technologies/javase-jdk15-downloads.html</a><br>Open JDK下载路径：<br><a target="_blank" rel="noopener" href="https://cn.azul.com/downloads/zulu-community/?version=java-11-lts&amp;os=windows&amp;architecture=x86-64-bit">https://cn.azul.com/downloads/zulu-community/?version=java-11-lts&amp;os=windows&amp;architecture=x86-64-bit</a></p>
<p>Oracle与OpenJDK之间的主要区别</p>
<ol>
<li>Oracle JDK版本将每三年发布一次LTS版本，而OpenJDK版本每三个月发布一次。</li>
<li>Oracle JDK将更多地关注稳定性，它重视更多的企业级用户，而OpenJDK经常发布以支持其他性能，这可能会导致不稳定。</li>
<li>Oracle JDK支持长期发布的更改，而Open JDK仅支持计划和完成下一个发行版。</li>
<li>Oracle JDK根据二进制代码许可协议获得许可，而OpenJDK根据GPL v2许可获得许可。 使用Oracle平台时会产生一些许可影响。如Oracle 宣布的那样，在没有商业许可的情况下，在2019年1月之后发布的Oracle Java SE 8的公开更新将无法用于商业，商业或生产用途。但是，OpenJDK是完全开源的，可以自由使用。</li>
<li>Oracle JDK的构建过程基于OpenJDK，因此OpenJDK与Oracle JDK之间没有技术差异。</li>
<li>顶级公司正在使用Oracle JDK，例如Android Studio，Minecraft和IntelliJ IDEA开发工具，其中Open JDK不太受欢迎。</li>
<li>Oracle JDK具有Flight Recorder，Java Mission Control和Application Class-Data Sharing功能，Open JDK具有Font Renderer功能，这是OpenJDK与Oracle JDK之间的显著差异。</li>
<li>Oracle JDK具有良好的GC选项和更好的渲染器，而OpenJDK具有更少的GC选项，并且由于其包含自己的渲染器的分布，因此具有较慢的图形渲染器选项。</li>
<li>在响应性和JVM性能方面，Oracle JDK与OpenJDK相比提供了更好的性能。</li>
<li>与OpenJDK相比，Oracle JDK的开源社区较少，OpenJDK社区用户的表现优于Oracle JDK发布的功能，以提高性能。</li>
<li>如果使用Oracle JDK会产生许可影响，而OpenJDK没有这样的问题，并且可以以任何方式使用，以满足完全开源和免费使用。</li>
<li>Oracle JDK在运行JDK时不会产生任何问题，而OpenJDK在为某些用户运行JDK时会产生一些问题。</li>
<li>根据使用方的使用和许可协议，现有应用程序可以从Oracle JDK迁移到Open JDK，反之亦然。</li>
<li>Oracle JDK将从其10.0.X版本将收费，用户必须付费或必须依赖OpenJDK才能使用其免费版本。</li>
<li>Oracle JDK不会为即将发布的版本提供长期支持，用户每次都必须通过更新到最新版本获得支持来获取最新版本。</li>
<li>Oracle JDK以前的1.0版以前的版本是由Sun开发的，后来被Oracle收购并为其他版本维护，而OpenJDK最初只基于Java SDK或JDK版本7。</li>
<li>Oracle JDK发布时大多数功能都是开源的，其中一些功能免于开源，并且根据Sun的许可授权，而OpenJDK发布了所有功能，如开源和免费。</li>
<li>Oracle JDK完全由Oracle公司开发，而Open JDK项目由IBM，Apple，SAP AG，Redhat等顶级公司加入和合作。</li>
</ol>
<h3 id="JDK与JVM是什么关系？"><a href="#JDK与JVM是什么关系？" class="headerlink" title="JDK与JVM是什么关系？"></a>JDK与JVM是什么关系？</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/6758e6b98fc36.webp" alt="image-20241211091121822"></p>
<h4 id="如何理解Java是跨平台的语言？"><a href="#如何理解Java是跨平台的语言？" class="headerlink" title="如何理解Java是跨平台的语言？"></a>如何理解Java是跨平台的语言？</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/6758e70371c43.webp" alt="image-20241211091235855"></p>
<p><strong><font color="red">“write once, run anywhere.”</font>（一次编译，处处运行）</strong></p>
<p>当Java源代码成功编译成字节码后，如果想在不同的平台上面运行，则无须再次编译。<br>这个优势不再那么吸引人了。Python、PHP、Perl、Ruby、Lisp等有强大的解释器。跨平台似乎已经快成为一门语言必选的特性。</p>
<h4 id="如何理解JVM跨语言的平台？"><a href="#如何理解JVM跨语言的平台？" class="headerlink" title="如何理解JVM跨语言的平台？"></a>如何理解JVM跨语言的平台？</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/6758e76cc758d.webp" alt="image-20241211091421097"></p>
<p>Java虚拟机根本不关心运行在其内部的程序到底是使用何种编程语言编写的，<font color="red">它只关心“字节码”文件</font>。</p>
<p><strong><font color="red">Java不是最强大的语言，但是JVM是最强大的虚拟机。</font></strong></p>
<h3 id="Java不存在内存溢出？内存泄漏？"><a href="#Java不存在内存溢出？内存泄漏？" class="headerlink" title="Java不存在内存溢出？内存泄漏？"></a>Java不存在内存溢出？内存泄漏？</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/6758e7d763211.webp" alt="image-20241211091607820"></p>
<p>java = (c++)–;</p>
<p>垃圾收集机制为我们打理了很多繁琐的工作，大大提高了开发的效率，但是，垃圾收集也不是万能的，懂得JVM内部的内存结构、工作机制，是设计高扩展性应用和诊断运行时问题的基础，也是Java工程师进阶的必备能力。</p>
<h3 id="Java发展的几个重大事件？"><a href="#Java发展的几个重大事件？" class="headerlink" title="Java发展的几个重大事件？"></a>Java发展的几个重大事件？</h3><ul>
<li><p>2000年，JDK 1.3发布，<strong>Java HotSpot Virtual Machine正式发布，成为Java的默认虚拟机。</strong></p>
</li>
<li><p>2002年，JDK 1.4发布，古老的Classic虚拟机退出历史舞台。</p>
</li>
<li><p>2003年年底，<strong>Java平台的Scala正式发布，同年Groovy也加入了 Java阵营。</strong></p>
</li>
<li><p>2006年，JDK 6发布。同年，<strong>Java开源并建立了 OpenJDK</strong>。顺理成章，<strong>Hotspot虚拟机也成为了 OpenJDK中的默认虚拟机。</strong></p>
</li>
<li><p>2007年，<strong>Java平台迎来了新伙伴Clojure。</strong></p>
</li>
<li><p>2008 年，Oracle 收购了 BEA,<strong>得到了 JRockit 虚拟机。</strong></p>
</li>
<li><p>2009年，Twitter宣布把后台大部分程序从Ruby迁移到Scala，这是Java平台的又一次大规模应用。</p>
</li>
<li><p>2010年，Oracle收购了Sun，<strong>获得Java商标和最具价值的HotSpot虚拟机。</strong>此时，Oracle拥有市场占用率最高的两款虚拟机HotSpot和JRockit，并计划在未来对它们进行整合：HotRockit.  JCP组织管理：Java语言</p>
</li>
<li><p>2011年，JDK7发布。在JDK 1.7u4中，<strong>正式启用了新的垃圾回收器G1</strong>。</p>
</li>
<li><p>2017年，JDK9发布。<strong>将G1设置为默认GC，替代CMS (被标记为Deprecated)</strong><br>同年，<strong>IBM的J9开源</strong>，形成了现在的Open J9社区</p>
</li>
<li><p>2018年，Android的Java侵权案判决，Google赔偿Oracle计88亿美元</p>
<p>同年，JDK11发布，LTS版本的JDK,<strong>发布革命性的ZGC,调整JDK授权许可</strong></p>
</li>
<li><p>2019年，JDK12发布，加入RedHat领导开发的<strong>Shenandoah GC</strong></p>
</li>
</ul>
<h4 id="说说你认识的JVM？"><a href="#说说你认识的JVM？" class="headerlink" title="说说你认识的JVM？"></a>说说你认识的JVM？</h4><ul>
<li><p>Sun Classic VM  –&gt;解释型</p>
</li>
<li><p>Exact VM   –&gt; Solaris</p>
</li>
<li><p><strong><font color="red">SUN公司的 HotSpot VM</font></strong></p>
</li>
<li><p><strong><font color="red">BEA 的 JRockit  –&gt; 不包含解释器，服务器端，JMC</font></strong></p>
</li>
<li><p><strong><font color="red">IBM 的 J9</font></strong></p>
</li>
<li><p>KVM和CDC/CLDC Hotspot</p>
</li>
<li><p>Azul VM</p>
</li>
<li><p>Liquid VM</p>
</li>
<li><p>Apache Harmony</p>
</li>
<li><p>Microsoft JVM</p>
</li>
<li><p>TaobaoJVM</p>
</li>
<li><p><strong>Graal VM –&gt; 2018年,“Run Programs Faster Anywhere”</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/6758e9ff8f96d.webp" alt="image-20241211092519936"></p>
</li>
<li><p>Dalvik VM</p>
</li>
<li><p>其他JVM：Java Card VM、Squawk VM、JavaInJava、Maxine VM、Jikes RVM、IKVM.NET、Jam VM、Cacao VM、Sable VM、Kaffe、Jelatine JVM、Nano VM、MRP、Moxie JVM</p>
</li>
</ul>
<h4 id="JVM的生命周期？"><a href="#JVM的生命周期？" class="headerlink" title="JVM的生命周期？"></a>JVM的生命周期？</h4><p><strong>虚拟机的启动</strong><br>Java虚拟机的启动是通过引导类加载器(bootstrap class loader)创建一个初始类(initial class)来完成的，这个类是由虚拟机的具体实现指定的。</p>
<p><strong>虚拟机的退出有如下的几种情况：</strong></p>
<ul>
<li>某线程调用Runtime类或System类的exit方法，或 Runtime类的halt方法，并且Java安全管理器也允许这次exit或halt操作。</li>
<li>程序正常执行结束</li>
<li>程序在执行过程中遇到了异常或错误而异常终止</li>
<li>由于操作系统出现错误而导致Java虚拟机进程终止</li>
</ul>
<h4 id="重点说下HotSpot？"><a href="#重点说下HotSpot？" class="headerlink" title="重点说下HotSpot？"></a>重点说下HotSpot？</h4><ul>
<li><strong>SUN</strong>的<strong>JDK</strong>版本从<strong>1.3.1</strong>开始运用<strong>HotSpot</strong>虚拟机， <strong>2006</strong>年底开源，主要使用C++实现，<strong>JNI</strong>接口部分用<strong>C</strong>实现</li>
<li><strong>HotSpot</strong>是较新的<strong>Java</strong>虚拟机，使用<strong>JIT(Just in Time)<strong>编译器，可以大大提高</strong>Java</strong>运行的性能。 </li>
<li><strong>Java</strong>原先是把源代码编译为字节码在虚拟机执行，这样执行速度较慢。而<strong>HotSpot</strong>将常用的部分代码编译为本地(原生，native)代码，这样显着提高了性能。 </li>
<li><strong>HotSpot JVM</strong> 参数可以分为规则参数**(standard options)<strong>和非规则参数</strong>(non-standard options)<strong>。 规则参数相对稳定，在</strong>JDK<strong>未来的版本里不会有太大的改动。 非规则参数则有因升级</strong>JDK**而改动的可能。</li>
</ul>
<h2 id="1-2、JVM的架构与知识脉络图"><a href="#1-2、JVM的架构与知识脉络图" class="headerlink" title="1.2、JVM的架构与知识脉络图"></a>1.2、JVM的架构与知识脉络图</h2><h3 id="能否画出JVM架构图？"><a href="#能否画出JVM架构图？" class="headerlink" title="能否画出JVM架构图？"></a>能否画出JVM架构图？</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/6758ec28e453d.webp" alt="image-20241211093433238"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/6758ecc63b57d.webp" alt="image-20241211093710567"></p>
<p>这个架构可以分成三层看：</p>
<ul>
<li>最上层：javac编译器将编译好的字节码class文件，通过java 类装载器执行机制，把对象或class文件存放在 jvm划分内存区域。</li>
<li>中间层：称为Runtime Data Area，主要是在Java代码运行时用于存放数据的，从左至右为方法区(永久代、元数据区)、堆(共享,GC回收对象区域)、栈、程序计数器、寄存器、本地方法栈(私有)。</li>
<li>最下层：解释器、JIT(just in time)编译器和 GC（Garbage Collection，垃圾回收器）</li>
</ul>
<h3 id="JVM有哪几块知识脉络？"><a href="#JVM有哪几块知识脉络？" class="headerlink" title="JVM有哪几块知识脉络？"></a>JVM有哪几块知识脉络？</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/6758ede53852f.webp" alt="image-20241211094157613"></p>
<h1 id="2、字节码文件概述"><a href="#2、字节码文件概述" class="headerlink" title="2、字节码文件概述"></a>2、字节码文件概述</h1><h2 id="2-1、字节码文件是跨平台的吗？"><a href="#2-1、字节码文件是跨平台的吗？" class="headerlink" title="2.1、字节码文件是跨平台的吗？"></a>2.1、字节码文件是跨平台的吗？</h2><p><font color="red">Java 虚拟机不和包括 Java 在内的任何语言绑定，它只与“Class 文件”这种特定的二进制文件格式所关联。</font><br>无论使用何种语言进行软件开发，只要能将源文件编译为正确的Class文件，那么这种语言就可以在Java虚拟机上执行。可以说，统一而强大的Class文件结构，就是Java虚拟机的基石、桥梁。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/6758f6d9bdab2.webp" alt="image-20241211102010213"></p>
<p>想要让一个Java程序正确地运行在JVM中，Java源码就必须要被编译为符合JVM规范的字节码。</p>
<blockquote>
<p>Java 语言和虚拟机规范：<a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/specs/index.html">https://docs.oracle.com/javase/specs/index.html</a></p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/6758f70ce04b5.webp" alt="image-20241211102101408"></p>
<p>所有的JVM全部遵守Java虚拟机规范，也就是说所有的JVM环境都是一样的，这样一来字节码文件可以在各种JVM上运行。</p>
<p>从Java虚拟机的角度看，通过Class文件，可以让更多的计算机语言支持Java虚拟机平台。因此，<font color="red">Class文件结构不仅仅是Java虚拟机的执行入口，更是Java生态圈的基础和核心</font>。</p>
<h3 id="class文件里是什么？"><a href="#class文件里是什么？" class="headerlink" title="class文件里是什么？"></a>class文件里是什么？</h3><p>源代码经过编译器编译之后便会生成一个字节码文件，字节码是一种二进制的类文件，它的内容是JVM的指令，而不像C、C++经由编译器直接生成<strong>机器码</strong>。</p>
<p>随着Java平台的不断发展，在将来，Class文件的内容也一定会做进一步的扩充，但是其基本的格式和结构不会做重大调整。</p>
<h3 id="能介绍下生成class文件的编译器吗？"><a href="#能介绍下生成class文件的编译器吗？" class="headerlink" title="能介绍下生成class文件的编译器吗？"></a>能介绍下生成class文件的编译器吗？</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/6758fe75596ea.webp" alt="image-20241211105237099"></p>
<h4 id="前端编译器与后端编译器"><a href="#前端编译器与后端编译器" class="headerlink" title="前端编译器与后端编译器"></a>前端编译器与后端编译器</h4><h5 id="前端编译器（Front-End-Compiler）"><a href="#前端编译器（Front-End-Compiler）" class="headerlink" title="前端编译器（Front-End Compiler）"></a><font size="3">前端编译器（Front-End Compiler）</font></h5><p>前端编译器主要负责处理源代码的语法分析、语义分析和中间代码生成。它的主要任务是将高级语言（如C、C++、Java等）编写的源代码转换为一种中间表示形式（Intermediate Representation, IR），这种中间表示形式通常是独立于目标机器的。</p>
<p><strong>前端编译器的主要任务就是负责将符合Java语法规范的Java代码转换为符合JVM规范的字节码文件。</strong></p>
<p>主要功能：</p>
<ul>
<li><strong>词法分析（Lexical Analysis）</strong>：将源代码分解为一个个的词法单元（tokens），如关键字、标识符、操作符等。</li>
<li><strong>语法分析（Syntax Analysis）</strong>：根据语言的语法规则，将词法单元组织成语法树（Syntax Tree）或抽象语法树（Abstract Syntax Tree, AST）。</li>
<li><strong>语义分析（Semantic Analysis）</strong>：检查语法树的语义正确性，确保代码符合语言的语义规则，如类型检查、作用域检查等。</li>
<li><strong>中间代码生成（Intermediate Code Generation）</strong>：将语法树或抽象语法树转换为中间表示形式（如三地址码、控制流图等），这种中间表示形式通常是独立于目标机器的。</li>
</ul>
<p>特点：</p>
<ul>
<li><strong>与源语言相关</strong>：前端编译器的设计和实现与源语言的语法和语义密切相关。</li>
<li><strong>与目标机器无关</strong>：前端编译器生成的中间代码通常是独立于目标机器的，可以在不同的平台上运行。</li>
</ul>
<h5 id="后端编译器（Back-End-Compiler）"><a href="#后端编译器（Back-End-Compiler）" class="headerlink" title="后端编译器（Back-End Compiler）"></a><font size="3">后端编译器（Back-End Compiler）</font></h5><p>后端编译器主要负责优化中间代码并生成目标机器代码。它的任务是将前端生成的中间表示形式转换为特定目标机器的机器码或汇编代码。</p>
<p>主要功能：</p>
<ul>
<li><strong>中间代码优化（Intermediate Code Optimization）</strong>：对中间代码进行各种优化，如常量折叠、死代码消除、循环优化等，以提高代码的执行效率。</li>
<li><strong>目标代码生成（Target Code Generation）</strong>：将优化后的中间代码转换为目标机器的机器码或汇编代码。这一步需要考虑目标机器的指令集、寄存器分配、内存管理等因素。</li>
<li><strong>机器相关优化（Machine-Specific Optimization）</strong>：根据目标机器的特性进行优化，如指令选择、寄存器分配、指令调度等。</li>
</ul>
<p>特点：</p>
<ul>
<li><strong>与目标机器相关</strong>：后端编译器的设计和实现与目标机器的指令集、体系结构密切相关。</li>
<li><strong>与源语言无关</strong>：后端编译器通常不关心源语言的语法和语义，它只处理中间代码并生成目标机器代码。</li>
</ul>
<h5 id="前端与后端的协同工作"><a href="#前端与后端的协同工作" class="headerlink" title="前端与后端的协同工作"></a><font size="3">前端与后端的协同工作</font></h5><ul>
<li><strong>编译流程</strong>：前端编译器和后端编译器通常是分开的，但它们协同工作以完成整个编译过程。前端负责将源代码转换为中间表示形式，后端负责将中间表示形式转换为目标机器代码。</li>
<li><strong>可移植性</strong>：由于中间代码是独立于目标机器的，因此可以通过更换后端编译器来生成不同目标机器的代码，从而实现代码的可移植性。</li>
</ul>
<h5 id="举例"><a href="#举例" class="headerlink" title="举例"></a><font size="3">举例</font></h5><ul>
<li><strong>GCC（GNU Compiler Collection）</strong>：GCC是一个典型的多语言编译器集合，它包含多个前端（如C前端、C++前端、Fortran前端等）和多个后端（如x86后端、ARM后端等）。不同的前端处理不同的源语言，生成统一的中间表示形式，然后由不同的后端生成目标机器代码。</li>
<li><strong>Java虚拟机（JVM）</strong>：Java编译器的前端将Java源代码编译为字节码（一种中间表示形式），然后由JVM的后端（即时编译器JIT）将字节码编译为特定平台的机器码。</li>
</ul>
<h5 id="总结"><a href="#总结" class="headerlink" title="总结"></a><font size="3">总结</font></h5><ul>
<li><strong>前端编译器</strong>：负责源代码的词法、语法、语义分析，生成中间代码，与源语言相关，与目标机器无关。</li>
<li><strong>后端编译器</strong>：负责中间代码的优化和目标代码生成，与目标机器相关，与源语言无关。</li>
</ul>
<p>通过前端和后端的协同工作，编译器能够将高级语言的源代码转换为高效的目标机器代码。</p>
<h4 id="前端编译器的种类"><a href="#前端编译器的种类" class="headerlink" title="前端编译器的种类"></a>前端编译器的种类</h4><p>Java源代码的编译结果是字节码，那么肯定需要有一种编译器能够将Java源码编译为字节码，承担这个重要责任的就是配置在path环境变量中的<strong>javac编译器</strong>。javac是一种能够将Java源码编译为字节码的<strong>前端编译器</strong>。</p>
<p>HotSpot VM并没有强制要求前端编译器只能使用javac来编译字节码，其实只要编译结果符合JVM规范都可以被JVM所识别即可。<br>在Java的前端编译器领域，除了javac之外，还有一种被大家经常用到的前端编译器，那就是内置在Eclipse中的<strong>ECJ (Eclipse Compiler for Java)编译器</strong>。和Javac的全量式编译不同，ECJ是一种增量式编译器。</p>
<ul>
<li>在Eclipse中，当开发人员编写完代码后，使用“Ctrl+S”快捷键时，ECJ编译器所釆取的<strong>编译方案</strong>是把未编译部分的源码逐行进行编译，而非每次都全量编译。因此ECJ的编译效率会比javac更加迅速和高效，当然编译质量和javac相比大致还是一样的。</li>
<li>ECJ不仅是Eclipse的默认内置前端编译器，在Tomcat中同样也是使用ECJ编译器来编译jsp文件。由于ECJ编译器是釆用GPLv2的开源协议进行源代码公开，所以，大家可以登录eclipse官网下载ECJ编译器的源码进行二次开发。</li>
<li>默认情况下，IntelliJ IDEA 使用 javac 编译器。(还可以自己设置为AspectJ编译器 ajc)</li>
</ul>
<h3 id="javac编译器的编译步骤？"><a href="#javac编译器的编译步骤？" class="headerlink" title="javac编译器的编译步骤？"></a>javac编译器的编译步骤？</h3><p>javac编译器在将Java源码编译为一个有效的字节码文件过程中经历了4个步骤，分别是<strong>词法解析、语法解析、语义解析以及生成字节码</strong>。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/675933ac8e21b.webp" alt="image-20241211143940249"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/675933c7f15c6.webp" alt="image-20241211144008634"></p>
<p>大部分的程序代码转换成物理机的目标代码或虚拟机能执行的指令集之前，都需要经过上图中的各个步骤。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/675933dbc7d8a.webp" alt="image-20241211144028403"></p>
<h3 id="目前前端编译器的局限性？"><a href="#目前前端编译器的局限性？" class="headerlink" title="目前前端编译器的局限性？"></a>目前前端编译器的局限性？</h3><p>前端编译器并不会直接涉及编译优化等方面的技术，而是将这些具体优化细节移交给HotSpot的JIT编译器负责。</p>
<p>复习：<strong>AOT</strong>(静态提前编译器，<strong>Ahead Of Time Compiler</strong>)</p>
<ul>
<li>jdk9引入了AOT编译器(静态提前编译器，Ahead Of Time Compiler)</li>
<li>Java 9 引入了实验性 AOT 编译工具<strong>jaotc</strong>。它借助了 Graal 编译器，将所输入的 Java 类文件转换为机器码，并存放至生成的动态共享库之中。</li>
<li>所谓 AOT 编译，是与即时编译相对立的一个概念。我们知道，即时编译指的是<strong>在程序的运行过程中</strong>，将字节码转换为可在硬件上直接运行的机器码，并部署至托管环境中的过程。而 AOT 编译指的则是，<strong>在程序运行之前</strong>，便将字节码转换为机器码的过程。<ul>
<li><strong>.java -&gt; .class -&gt; .so</strong></li>
</ul>
</li>
<li>最大好处：Java虚拟机加载已经预编译成二进制库，可以直接执行。不必等待即时编译器的预热，减少Java应用给人带来“第一次运行慢”的不良体验。</li>
<li>缺点：<ul>
<li>破坏了java“一次编译，到处运行”，必须为每个不同硬件、OS编译对应的发行包。</li>
<li><strong>降低了Java链接过程的动态性</strong>，加载的代码在编译期就必须全部已知。</li>
</ul>
</li>
</ul>
<p>还需要继续优化中，最初只支持Linux x64 java base</p>
<h2 id="2-2、哪些类型对应有Class的对象？"><a href="#2-2、哪些类型对应有Class的对象？" class="headerlink" title="2.2、哪些类型对应有Class的对象？"></a>2.2、哪些类型对应有Class的对象？</h2><p>（1）class：<br>外部类，成员(成员内部类，静态内部类)，局部内部类，匿名内部类<br>（2）interface：接口<br>（3）[]：数组<br>（4）enum：枚举<br>（5）annotation：注解@interface<br>（6）primitive type：基本数据类型<br>（7）void</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>{</span><br><span class="line">    <span class="type">Class</span> <span class="variable">c1</span> <span class="operator">=</span> Object.class;</span><br><span class="line">    <span class="type">Class</span> <span class="variable">c2</span> <span class="operator">=</span> Comparable.class;</span><br><span class="line">    <span class="type">Class</span> <span class="variable">c3</span> <span class="operator">=</span> String[].class;</span><br><span class="line">    <span class="type">Class</span> <span class="variable">c4</span> <span class="operator">=</span> <span class="type">int</span>[][].class;</span><br><span class="line">    <span class="type">Class</span> <span class="variable">c5</span> <span class="operator">=</span> ElementType.class;</span><br><span class="line">    <span class="type">Class</span> <span class="variable">c6</span> <span class="operator">=</span> Override.class;</span><br><span class="line">    <span class="type">Class</span> <span class="variable">c7</span> <span class="operator">=</span> <span class="type">int</span>.class;</span><br><span class="line">    <span class="type">Class</span> <span class="variable">c8</span> <span class="operator">=</span> <span class="keyword">void</span>.class;</span><br><span class="line">    <span class="type">Class</span> <span class="variable">c9</span> <span class="operator">=</span> Class.class;</span><br><span class="line"> </span><br><span class="line">    <span class="type">int</span>[] a = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">10</span>];</span><br><span class="line">    <span class="type">int</span>[] b = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">100</span>];</span><br><span class="line">    <span class="type">Class</span> <span class="variable">c10</span> <span class="operator">=</span> a.getClass();</span><br><span class="line">    <span class="type">Class</span> <span class="variable">c11</span> <span class="operator">=</span> b.getClass();</span><br><span class="line">    <span class="comment">// 只要元素类型与维度一样，就是同一个Class</span></span><br><span class="line">    System.out.println(c10 == c11);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="2-3、字节码指令"><a href="#2-3、字节码指令" class="headerlink" title="2.3、字节码指令"></a>2.3、字节码指令</h2><h3 id="什么是字节码指令-byte-code-？"><a href="#什么是字节码指令-byte-code-？" class="headerlink" title="什么是字节码指令(byte code)？"></a>什么是字节码指令(byte code)？</h3><p>Java虚拟机的指令由一个字节长度的、代表着某种特定操作含义的<strong>操作码（opcode）</strong>以及跟随其后的零至多个代表此操作所需参数的<strong>操作数（operand）</strong>所构成。虚拟机中许多指令并不包含操作数，只有一个操作码。<br>比如： </p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/675937ba3091b.webp" alt="image-20241211145658924"></p>
<h3 id="为什么要懂字节码指令？"><a href="#为什么要懂字节码指令？" class="headerlink" title="为什么要懂字节码指令？"></a>为什么要懂字节码指令？</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ByteCodeInterview</span> {</span><br><span class="line">    <span class="comment">//面试题： i++和++i有什么区别？</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span>{</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line"><span class="comment">//        i++;</span></span><br><span class="line">        ++i;</span><br><span class="line"></span><br><span class="line">        System.out.println(i);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test2</span><span class="params">()</span>{</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">        i = i++;</span><br><span class="line">        System.out.println(i);<span class="comment">// 10</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test3</span><span class="params">()</span>{</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line">        i *= i++; <span class="comment">//i = i * i++</span></span><br><span class="line">        System.out.println(i); <span class="comment">// 4</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test4</span><span class="params">()</span>{</span><br><span class="line">        <span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">        k = k + (k++) + (++k); <span class="comment">//</span></span><br><span class="line">        System.out.println(k);<span class="comment">//32</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//包装类对象的缓存问题</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test5</span><span class="params">()</span>{</span><br><span class="line"></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">i1</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">i2</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">        System.out.println(i1 == i2);<span class="comment">//true</span></span><br><span class="line"></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">i3</span> <span class="operator">=</span> <span class="number">128</span>;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">i4</span> <span class="operator">=</span> <span class="number">128</span>;</span><br><span class="line">        System.out.println(i3 == i4);<span class="comment">//false</span></span><br><span class="line"></span><br><span class="line">        <span class="type">Boolean</span> <span class="variable">b1</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="type">Boolean</span> <span class="variable">b2</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">        System.out.println(b1 == b2);<span class="comment">//true</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//String声明的字面量数据都放在字符串常量池中</span></span><br><span class="line">    <span class="comment">//jdk 6中字符串常量池存放在方法区（即永久代中）</span></span><br><span class="line">    <span class="comment">//jdk7 及以后字符串常量池存放在堆空间</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test6</span><span class="params">()</span>{</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">"hello"</span>) + <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">"world"</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">str1</span> <span class="operator">=</span> <span class="string">"helloworld"</span>;</span><br><span class="line">        str.intern();</span><br><span class="line">        System.out.println(str == str1);<span class="comment">//false --&gt; true (加上intern() 在str声明之前)</span></span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/6759450b7b3e5.webp" alt="image-20241211155347999"></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Father</span> {</span><br><span class="line">    <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Father</span><span class="params">()</span> {</span><br><span class="line">        <span class="built_in">this</span>.print();</span><br><span class="line">        x = <span class="number">20</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">print</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"Father.x = "</span> + x);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Son</span> <span class="keyword">extends</span> <span class="title class_">Father</span> {</span><br><span class="line">    <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> <span class="number">30</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Son</span><span class="params">()</span> {</span><br><span class="line">        <span class="built_in">this</span>.print();</span><br><span class="line">        x = <span class="number">40</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">print</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"Son.x = "</span> + x);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ByteCodeInterview1</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="type">Father</span> <span class="variable">f</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Son</span>();</span><br><span class="line">        System.out.println(f.x);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>运行结果</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Son.x = 0</span><br><span class="line">Son.x = 30</span><br><span class="line">20</span><br></pre></td></tr></tbody></table></figure>

<h2 id="2-4、如何解读class文件？"><a href="#2-4、如何解读class文件？" class="headerlink" title="2.4、如何解读class文件？"></a>2.4、如何解读class文件？</h2><p>方式一：一个一个二进制的看。这里用到的是Notepad++,需要安装一个HEX-Editor插件，也可用其他支持二进制格式的文本阅读器，入Notepad–，UltraEdit，Sublime Text 等</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/67594ea998812.webp" alt="image-20241211163450435"></p>
<p>或者使用 Binary Viewer</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/675956ed0591f.webp" alt="image-20241211171005685"></p>
<p>方式二：使用javap指令：jdk自带的反解析工具</p>
<p>方式三：使用IDEA插件：jclasslib<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/67594eef24db6.webp" alt="image-20241211163559950"></p>
<p>使用方法：</p>
<p>每次修改代码后重新编译字节码文件</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/675950047e27d.webp" alt="image-20241211164037320"></p>
<p>菜单栏 <code>View -&gt; Show Bytecode With Jclasslib</code>  打开工具栏</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/67595020df2cd.webp" alt="image-20241211164105749"></p>
<p>然后可查看并分析类加载过程</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/6759505ab7796.webp" alt="image-20241211164203401"></p>
<p>或jclasslib bytecode viewer客户端工具。（可视化更好)</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/67594e7e0fb80.webp" alt="image-20241211163406846"></p>
<h1 id="3、Class文件结构细节"><a href="#3、Class文件结构细节" class="headerlink" title="3、Class文件结构细节"></a>3、Class文件结构细节</h1><blockquote>
<p>官方文档位置：<a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-4.html">https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-4.html</a></p>
</blockquote>
<p><strong>Class 类的本质 :</strong></p>
<p>任何一个Class文件都对应着唯一一个类或接口的定义信息，但反过来说，Class文件实际上它并不一定以磁盘文件的形式存在。Class 文件是一组以8位字节为基础单位的<strong>二进制流</strong>。</p>
<p><strong>Class文件格式</strong></p>
<p> Class 的结构不像 XML 等描述语言，由于它没有任何分隔符号。所以在其中的数据项，无论是字节顺序还是数量，都是被严格限定的，哪个字节代表什么含义，长度是多少，先后顺序如何，都不允许改变。 </p>
<p>“下雨天留客天留我不留”<br>“下雨天，留客天，留我不留？”<br>“下雨天，留客天，留我不？留！”<br>“下雨，天留客？天留，我不留！”</p>
<p>Class 文件格式采用一种类似于 C语言结构体的方式进行数据存储，这种结构中只有两种数据类型：<strong>无符号数和表</strong>。</p>
<ul>
<li>无符号数属于基本的数据类型，以 u1、u2、u4、u8 来分别代表 1 个字节、2 个字节、4 个字节和 8 个字节的无符号数，无符号数可以用来描述数字、索引引用、数量值或者按照 UTF-8 编码构成字符串值。</li>
<li>表是由多个无符号数或者其他表作为数据项构成的复合数据类型，所有表都习惯性地以“_info”结尾。表用于描述有层次关系的复合结构的数据，整个 Class 文件本质上就是一张表。 由于表没有固定长度，所以通常会在其前面加上个数说明</li>
</ul>
<p>举例：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo</span> {</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">add</span><span class="params">()</span>{</span><br><span class="line">        num = num + <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">return</span> num;</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p> 对应的字节码文件（jdk8）：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">00000000 CA FE BA BE 00 00 00 34 00 16 0A 00 04 00 12 09 .......4........</span><br><span class="line">00000010 00 03 00 13 07 00 14 07 00 15 01 00 03 6E 75 6D .............num</span><br><span class="line">00000020 01 00 01 49 01 00 06 3C 69 6E 69 74 3E 01 00 03 ...I...&lt;init&gt;...</span><br><span class="line">00000030 28 29 56 01 00 04 43 6F 64 65 01 00 0F 4C 69 6E ()V...Code...Lin</span><br><span class="line">00000040 65 4E 75 6D 62 65 72 54 61 62 6C 65 01 00 12 4C eNumberTable...L</span><br><span class="line">00000050 6F 63 61 6C 56 61 72 69 61 62 6C 65 54 61 62 6C ocalVariableTabl</span><br><span class="line">00000060 65 01 00 04 74 68 69 73 01 00 18 4C 63 6F 6D 2F e...this...Lcom/</span><br><span class="line">00000070 61 74 67 75 69 67 75 2F 6A 61 76 61 31 2F 44 65 atguigu/java1/De</span><br><span class="line">00000080 6D 6F 3B 01 00 03 61 64 64 01 00 03 28 29 49 01 mo;...add...()I.</span><br><span class="line">00000090 00 0A 53 6F 75 72 63 65 46 69 6C 65 01 00 09 44 ..SourceFile...D</span><br><span class="line">000000A0 65 6D 6F 2E 6A 61 76 61 0C 00 07 00 08 0C 00 05 emo.java........</span><br><span class="line">000000B0 00 06 01 00 16 63 6F 6D 2F 61 74 67 75 69 67 75 .....com/atguigu</span><br><span class="line">000000C0 2F 6A 61 76 61 31 2F 44 65 6D 6F 01 00 10 6A 61 /java1/Demo...ja</span><br><span class="line">000000D0 76 61 2F 6C 61 6E 67 2F 4F 62 6A 65 63 74 00 21 va/lang/Object.!</span><br><span class="line">000000E0 00 03 00 04 00 00 00 01 00 02 00 05 00 06 00 00 ................</span><br><span class="line">000000F0 00 02 00 01 00 07 00 08 00 01 00 09 00 00 00 38 ...............8</span><br><span class="line">00000100 00 02 00 01 00 00 00 0A 2A B7 00 01 2A 04 B5 00 ........*...*...</span><br><span class="line">00000110 02 B1 00 00 00 02 00 0A 00 00 00 0A 00 02 00 00 ................</span><br><span class="line">00000120 00 09 00 04 00 0A 00 0B 00 00 00 0C 00 01 00 00 ................</span><br><span class="line">00000130 00 0A 00 0C 00 0D 00 00 00 01 00 0E 00 0F 00 01 ................</span><br><span class="line">00000140 00 09 00 00 00 3D 00 03 00 01 00 00 00 0F 2A 2A .....=........**</span><br><span class="line">00000150 B4 00 02 05 60 B5 00 02 2A B4 00 02 AC 00 00 00 ....`...*.......</span><br><span class="line">00000160 02 00 0A 00 00 00 0A 00 02 00 00 00 0D 00 0A 00 ................</span><br><span class="line">00000170 0E 00 0B 00 00 00 0C 00 01 00 00 00 0F 00 0C 00 ................</span><br><span class="line">00000180 0D 00 00 00 01 00 10 00 00 00 02 00 11 -- -- -- .............</span><br></pre></td></tr></tbody></table></figure>

<p>解读：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/67595c3db5097.webp" alt="image-20241211173246468"></p>
<p><strong>换句话说，充分理解了每一个字节码文件的细节，自己也可以反编译出Java源文件来。</strong></p>
<h2 id="3-1、class文件结构细节概述"><a href="#3-1、class文件结构细节概述" class="headerlink" title="3.1、class文件结构细节概述"></a>3.1、class文件结构细节概述</h2><p>Class文件的结构并不是一成不变的，随着Java虚拟机的不断发展，总是不可避免地会对Class文件结构做出一些调整，但是其基本结构和框架是非常稳定的。<br>Class文件的总体结构如下：</p>
<ul>
<li>魔数</li>
<li>Class文件版本</li>
<li>常量池</li>
<li>访问标识(或标志)</li>
<li>类索引，父类索引，接口索引集合</li>
<li>字段表集合</li>
<li>方法表集合</li>
<li>属性表集合</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/6759535a72de8.webp" alt="image-20241211165451329"></p>
<p>下面是一张Java字节码总的结构表，我们按照上面的顺序逐一进行解读就可以了。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/675954162a3da.webp" alt="image-20241211165758962"></p>
<h2 id="3-2、class文件的魔数是什么？"><a href="#3-2、class文件的魔数是什么？" class="headerlink" title="3.2、class文件的魔数是什么？"></a>3.2、class文件的魔数是什么？</h2><p><strong>Magic Number（魔数）：class文件的标志</strong></p>
<ul>
<li><p>每个 Class 文件开头的4个字节的无符号整数称为魔数（Magic Number）</p>
</li>
<li><p>它的唯一作用是确定这个文件是否为一个能被虚拟机接受的有效合法的Class文件。即：魔数是Class文件的标识符。</p>
</li>
<li><p>魔数值固定为0xCAFEBABE。不会改变。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/675955341bfca.webp" alt="image-20241211170244961"></p>
</li>
<li><p>如果一个Class文件不以0xCAFEBABE开头，虚拟机在进行文件校验的时候就会直接抛出以下错误：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Error: A JNI error has occurred, please check your installation and try again</span><br><span class="line">Exception in thread "main" java.lang.ClassFormatError: Incompatible magic value 1885430635 in class file StringTest</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>使用魔数而不是扩展名来进行识别主要是基于安全方面的考虑，因为文件扩展名可以随意地改动。</p>
</li>
</ul>
<h2 id="3-3、如何确保高版本的JVM可执行低版本的class文件？"><a href="#3-3、如何确保高版本的JVM可执行低版本的class文件？" class="headerlink" title="3.3、如何确保高版本的JVM可执行低版本的class文件？"></a>3.3、如何确保高版本的JVM可执行低版本的class文件？</h2><ul>
<li><strong>不同版本的Java编译器编译的Class文件对应的版本是不一样的。目前，高版本的Java虚拟机可以执行由低版本编译器生成的Class文件,但是低版本的Java虚拟机不能执行由高版本编译器生成的Class文件。否则JVM会抛出java.lang.UnsupportedClassVersionError异常。 （向下兼容）</strong></li>
<li>在实际应用中，由于开发环境和生产环境的不同，可能会导致该问题的发生。因此，需要我们在开发时，特别注意开发编译的JDK版本和生产环境中的JDK版本是否一致。</li>
</ul>
<p><strong>class文件版本号</strong></p>
<ul>
<li><p>紧接着魔数的 4 个字节存储的是 Class 文件的版本号。同样也是4个字节。第5个和第6个字节所代表的含义就是编译的副版本号minor_version，而第7个和第8个字节就是编译的主版本号major_version。</p>
</li>
<li><p>它们共同构成了class文件的格式版本号。譬如某个 Class 文件的主版本号为 M，副版本号为 m，那么这个Class 文件的格式版本号就确定为 M.m。</p>
</li>
<li><p>版本号和Java编译器的对应关系如下表：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/67595df4274ec.webp" alt="image-20241211174004950"></p>
</li>
<li><p>Java 的版本号是从45开始的，JDK 1.1之后的每个JDK大版本发布主版本号向上加1。</p>
</li>
<li><p>虚拟机JDK版本为1.k （k &gt;= 2）时，对应的class文件格式版本号的范围为45.0 - 44+k.0 （含两端）。</p>
</li>
</ul>
<h2 id="3-4、常量池：class文件的基石？作用是？"><a href="#3-4、常量池：class文件的基石？作用是？" class="headerlink" title="3.4、常量池：class文件的基石？作用是？"></a>3.4、常量池：class文件的基石？作用是？</h2><p>常量池：存放所有常量</p>
<ul>
<li>常量池是Class文件中内容最为丰富的区域之一。常量池对于Class文件中的字段和方法解析也有着至关重要的作用。</li>
<li><strong>常量池：可以理解为Class文件之中的资源仓库，它是Class文件结构中与其他项目关联最多的数据类型（后面的很多数据类型都会指向此处），也是占用Class文件空间最大的数据项目之一。</strong></li>
<li><strong>常量池表项</strong>中，用于存放编译时期生成的各种<strong>字面量</strong>和<strong>符号引用</strong>，这部分内容将在类加载后进入方法区的<strong>运行时常量池中</strong>存放。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/67595f790b4cb.webp" alt="image-20241211174633901"></p>
<ul>
<li><p>在版本号之后，紧跟着的是常量池的数量，以及若干个常量池表项。</p>
</li>
<li><p>常量池中常量的数量是不固定的，所以在常量池的入口需要放置一项u2类型的无符号数，代表常量池容量计数值（constant_pool_count）。与Java中语言习惯不一样的是，这个容量计数是从1而不是0开始的。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/67595fb2c3063.webp" alt="image-20241211174731372"></p>
<p>由上表可见，Class文件使用了一个前置的容量计数器（constant_pool_count）加若干个连续的数据项（constant_pool）的形式来描述常量池内容。我们把这一系列连续常量池数据称为常量池集合。</p>
</li>
</ul>
<h3 id="为什么需要常量池计数器？"><a href="#为什么需要常量池计数器？" class="headerlink" title="为什么需要常量池计数器？"></a>为什么需要常量池计数器？</h3><p><strong>constant_pool_count （常量池计数器）：</strong></p>
<ul>
<li><p>由于常量池的数量不固定，时长时短，所以需要放置两个字节来表示常量池容量计数值。</p>
</li>
<li><p>常量池容量计数值（u2类型）：<strong>从1开始</strong>，表示常量池中有多少项常量。即<strong>constant_pool_count=1</strong>表示常量池中有0个常量项。</p>
</li>
<li><p>Demo的值为：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/6759606418fd8.webp" alt="image-20241211175029018"></p>
<p>其值为0x0016,十进制值为22</p>
<p>需要注意的是，这实际上只有21项常量。索引为范围是1-21。为什么呢？</p>
<p>通常我们写代码时都是从0开始的，但是这里的常量池却是从1开始，因为它把第0项常量空出来了。这是为了满足后面某些指向常量池的索引值的数据在特定情况下需要表达“不引用任何一个常量池项目”的含义，这种情况可用索引值0来表示。</p>
</li>
</ul>
<h3 id="常量池表"><a href="#常量池表" class="headerlink" title="常量池表"></a>常量池表</h3><p><strong>constant_pool []（常量池）：</strong></p>
<ul>
<li>constant_pool是一种表结构，以 1 ~ constant_pool_count - 1为索引。表明了后面有多少个常量项。</li>
<li>常量池主要存放两大类常量：<strong>字面量（Literal）</strong>和 <strong>符号引用（Symbolic References）</strong></li>
<li>它包含了class文件结构及其子结构中引用的所有字符串常量、类或接口名、字段名和其他常量。常量池中的每一项都具备相同的特征。第1个字节作为类型标记，用于确定该项的格式，这个字节称为tag byte （标记字节、标签字节）。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/67596477bd554.webp" alt="image-20241211180751358"></p>
<h4 id="字面量和符号引用"><a href="#字面量和符号引用" class="headerlink" title="字面量和符号引用"></a>字面量和符号引用</h4><p>在对这些常量解读前，我们需要搞清楚几个概念。<br>常量池主要存放两大类常量：字面量（Literal）和符号引用（Symbolic References）。如下表：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/675965434ac88.webp" alt="image-20241211181115847"></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">"atguigu"</span>;</span><br><span class="line"><span class="keyword">final</span> <span class="type">int</span> <span class="variable">NUM</span> <span class="operator">=</span> <span class="number">10</span>;</span><br></pre></td></tr></tbody></table></figure>

<p> <strong>全限定名</strong><br>com/atguigu/test/Demo这个就是类的全限定名，仅仅是把包名的”.”替换成”/“，为了使连续的多个全限定名之间不产生混淆，在使用时最后一般会加入一个“;”表示全限定名结束。</p>
<p><strong>简单名称</strong><br>简单名称是指没有类型和参数修饰的方法或者字段名称，上面例子中的类的add()方法和num字段的简单名称分别是add和num。</p>
<p><strong>描述符</strong><br>描述符的作用是用来描述字段的数据类型、方法的参数列表（包括数量、类型以及顺序）和返回值。根据描述符规则，基本数据类型（byte、char、double、float、int、long、short、boolean）以及代表无返回值的void类型都用一个大写字符来表示，而对象类型则用字符L加对象的全限定名来表示，详见下表:   （数据类型：基本数据类型 、 引用数据类型）</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/6759668ce831f.webp" alt="image-20241211181645770"></p>
<p>用描述符来描述方法时，按照<strong>先参数列表，后返回值</strong>的顺序描述，参数列表按照参数的严格顺序放在一组小括号“()”之内。如：<br>方法java.lang.String toString()的描述符为() Ljava/lang/String;，<br>方法int abc(int[] x, int y)的描述符为([II) I。</p>
<p><strong>谈谈你对符号引用、直接引用的理解？</strong></p>
<p>Java代码在进行Javac编译的时候，并不像C和C++那样有“连接”这一步骤，而是在虚拟机加载Class文件的时候进行动态链接。也就是说，<strong>在Class文件中不会保存各个方法、字段的最终内存布局信息，因此这些字段、方法的符号引用不经过运行期转换的话无法得到真正的内存入口地址，也就无法直接被虚拟机使用。</strong>当虚拟机运行时，需要从常量池获得对应的符号引用，再在类创建时或运行时解析、翻译到具体的内存地址之中。 </p>
<p>虚拟机在加载Class文件时才会进行动态链接，也就是说，Class文件中不会保存各个方法和字段的最终内存布局信息，因此，这些字段和方法的符号引用不经过转换是无法直接被虚拟机使用的。<strong>当虚拟机运行时，需要从常量池中获得对应的符号引用，再在类加载过程中的解析阶段将其替换为直接引用，并翻译到具体的内存地址中</strong>。</p>
<p>这里说明下符号引用和直接引用的区别与关联：</p>
<ul>
<li>符号引用：符号引用以<strong>一组符号</strong>来描述所引用的目标，符号可以是任何形式的字面量，只要使用时能无歧义地定位到目标即可。<strong>符号引用与虚拟机实现的内存布局无关</strong>，引用的目标并不一定已经加载到了内存中。 </li>
<li>直接引用：直接引用可以是直接<strong>指向目标的指针、相对偏移量或是一个能间接定位到目标的句柄</strong>。<strong>直接引用是与虚拟机实现的内存布局相关的</strong>，同一个符号引用在不同虚拟机实例上翻译出来的直接引用一般不会相同。如果有了直接引用，那说明引用的目标必定已经存在于内存之中了。</li>
</ul>
<h4 id="常量类型和结构"><a href="#常量类型和结构" class="headerlink" title="常量类型和结构"></a>常量类型和结构</h4><p>常量池中每一项常量都是一个表，JDK1.7之后共有14种不同的表结构数据。如下表格所示：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/6759695f2ea93.webp" alt="image-20241211182847663"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/6759696e63baf.webp" alt="image-20241211182903160"></p>
<ul>
<li>根据上图每个类型的描述我们也可以知道每个类型是用来描述常量池中哪些内容（主要是字面量、符号引用）的。比如：CONSTANT_Integer_info是用来描述常量池中字面量信息的，而且只是整型字面量信息。</li>
<li>标志为15、16、18的常量项类型是用来支持动态语言调用的（jdk1.7时才加入的）。<br> 细节说明：<ul>
<li>CONSTANT_Class_info 结构用于表示类或接口</li>
<li>CONSTANT_Fieldref_info、CONSTANT_Methodref_info和CONSTANT_InterfaceMethodref_info结构表示字段、方法和接口方法</li>
<li>CONSTANT_String_info结构用于表示String类型的常量对象</li>
<li>CONSTANT_Integer_info和CONSTANT_Float_info 表示4字节（int和float）的数值常量</li>
<li>CONSTANT_Long_info和CONSTANT_Double_info结构表示8字节(long和double)的数值常量<br>在class文件的常量池表中，所有的8字节常量均占两个表成员（项）的空间。如果一个CONSTANT_Long_info或CONSTANT_Double_info结构的项在常量池表中的索引位n，则常量池表中下一个可用项的索引位n+2，此时常量池表中索引为n+1的项仍然有效但必须视为不可用的</li>
<li>CONSTANT_NameAndType_info结构用于表示字段或方法，但是和之前的3个结构不同，CONSTANT_NameAndType_info结构没有指明该字段或方法所属的类或接口。</li>
<li>CONSTANT_Utf8_info用于表示字符常量的值</li>
<li>CONSTANT_MethodHandle_info结构用于表示方法句柄</li>
<li>CONSTANT_MethodType_info结构表示方法类型</li>
<li>CONSTANT_InvokeDynamic_info结构用于表示invokedynamic指令所用到的引导方法(bootstrap method)、引导方法所用到的动态调用名称(dynamic invocation name)、参数和返回类型，并可以给引导方法传入一系列称为静态参数(static argument)的常量。</li>
</ul>
</li>
<li>解析方式：<br>一个字节一个字节的解析</li>
<li>使用javap命令解析：javap -verbose Demo.class 或 jclasslib工具会更方便。</li>
</ul>
<p><strong>总结：</strong></p>
<ul>
<li>这14种表（或者常量项结构）的共同点是：表开始的第一位是一个u1类型的标志位（tag），代表当前这个常量项使用的是哪种表结构，即哪种常量类型。</li>
<li>在常量池列表中，CONSTANT_Utf8_info常量项是一种使用改进过的UTF-8编码格式来存储诸如文字字符串、类或者接口的全限定名、字段或者方法的简单名称以及描述符等常量字符串信息。</li>
<li>这14种常量项结构还有一个特点是，其中13个常量项占用的字节固定，只有CONSTANT_Utf8_info占用字节不固定，其大小由length决定。为什么呢？<strong>因为从常量池存放的内容可知，其存放的是字面量和符号引用，最终这些内容都会是一个字符串，这些字符串的大小是在编写程序时才确定</strong>，比如你定义一个类，类名可以取长取短，所以在没编译前，大小不固定，编译后，通过utf-8编码，就可以知道其长度。</li>
</ul>
<h2 id="3-5、访问标识"><a href="#3-5、访问标识" class="headerlink" title="3.5、访问标识"></a>3.5、访问标识</h2><p><strong>访问标识(access_flag、访问标志、访问标记)</strong></p>
<ul>
<li><p>在常量池后，紧跟着访问标记。该标记使用两个字节表示，用于识别一些类或者接口层次的访问信息，包括：这个 Class 是类还是接口；是否定义为 public 类型；是否定义为 abstract 类型；如果是类的话，是否被声明为 final 等。各种访问标记如下所示：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/67596b64ec5ad.webp" alt="image-20241211183725757"></p>
</li>
<li><p>类的访问权限通常为 <strong>ACC_</strong> 开头的常量。</p>
</li>
<li><p>每一种类型的表示都是通过设置访问标记的32位中的特定位来实现的。比如，若是public final的类，则该标记为ACC_PUBLIC | ACC_FINAL。</p>
</li>
<li><p>使用<strong>ACC_SUPER</strong>可以让类更准确地定位到父类的方法<strong>super.method()</strong>,现代编译器都会设置并且使用这个标记。</p>
</li>
</ul>
<p><strong>补充说明：</strong></p>
<ol>
<li>带有<strong>ACC_INTERFACE</strong>标志的class文件表示的是接口而不是类，反之则表示的是类而不是接口。<br> <strong>1）如果一个class文件被设置了 ACC_INTERFACE 标志，那么同时也得设置ACC_ABSTRACT 标志。同时它不能再设置 ACC_FINAL、ACC_SUPER 或 ACC_ENUM 标志。</strong><br><strong>2）如果没有设置ACC_INTERFACE标志，那么这个class文件可以具有上表中除 ACC_ANNOTATION外的其他所有标志。当然，ACC_FINAL和ACC_ABSTRACT这类互斥的标志除外。这两个标志不得同时设置。</strong></li>
<li>ACC_SUPER标志用于确定类或接口里面的invokespecial指令使用的是哪一种执行语义。<strong>针对Java虚拟机指令集的编译器都应当设置这个标志</strong>。对于Java SE 8及后续版本来说，无论class文件中这个标志的实际值是什么，也不管class文件的版本号是多少，Java虚拟机都认为每个class文件均设置了ACC_SUPER标志。<br> <strong>1）ACC_SUPER标志是为了向后兼容由旧Java编译器所编译的代码而设计的。目前的 ACC_SUPER标志在由JDK 1.0.2之前的编译器所生成的access_flags中是没有确定含义的，如果设置了该标志，那么Oracle的Java虚拟机实现会将其忽略。</strong></li>
<li>ACC_SYNTHETIC标志意味着该类或接口是由编译器生成的，而不是由源代码生成的。</li>
<li>注解类型必须设置ACC_ANNOTATION标志。如果设置了 ACC_ANNOTATION标志， 那么也必须设置ACC_INTERFACE标志。</li>
<li>ACC_ENUM标志表明该类或其父类为枚举类型。</li>
<li>表中没有使用的access_flags标志是为未来扩充而预留的，这些预留的标志在编译器中应该设置为0, Java虚拟机实现也应该忽略它们。</li>
</ol>
<h2 id="3-6、类索引、父类索引、接口索引集合"><a href="#3-6、类索引、父类索引、接口索引集合" class="headerlink" title="3.6、类索引、父类索引、接口索引集合"></a>3.6、类索引、父类索引、接口索引集合</h2><ul>
<li><p>在访问标记后，会指定该类的类别、父类类别以及实现的接口，格式如下：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/67596c8571a0d.webp" alt="image-20241211184214286"></p>
</li>
<li><p>这三项数据来确定这个类的继承关系。</p>
<ul>
<li>类索引用于确定这个类的全限定名</li>
<li>父类索引用于确定这个类的父类的全限定名。由于 Java语言不允许多重继承，所以父类索引只有一个，除了java.lang.Object 之外，所有的Java类都有父类，因此除了java.lang.Object 外，所有Java类的父类索引都不为 0。</li>
<li>接口索引集合就用来描述这个类实现了哪些接口，这些被实现的接口将按 implements 语句（如果这个类本身是一个接口，则应当是 extends 语句）后的接口顺序从左到右排列在接口索引集合中。</li>
</ul>
</li>
</ul>
<ol>
<li><p><strong>this_class（类索引）</strong><br>2字节无符号整数，指向常量池的索引。它提供了类的全限定名,如com/atguigu/java1/Demo。this_class的值必须是对常量池表中某项的一个有效索引值。常量池在这个索引处的成员必须为CONSTANT_Class_info类型结构体，该结构体表示这个class文件所定义的类或接口。</p>
</li>
<li><p><strong>super_class （父类索引）</strong></p>
<ul>
<li>2字节无符号整数，指向常量池的索引。它提供了当前类的父类的全限定名。如果我们没有继承任何类，其默认继承的是java/lang/Object类。同时，由于Java不支持多继承，所以其父类只有一个</li>
<li>superclass指向的父类不能是final。</li>
</ul>
</li>
<li><p><strong>interfaces</strong></p>
</li>
</ol>
<ul>
<li>指向常量池索引集合，它提供了一个符号引用到所有已实现的接口</li>
<li>由于一个类可以实现多个接口，因此需要以数组形式保存多个接口的索引，表示接口的每个索引也是一个指向常量池的CONSTANT_Class (当然这里就必须是接口，而不是类)。</li>
<li><strong>interfaces_count (接口计数器)</strong><br>interfaces_count项的值表示当前类或接口的直接超接口数量。</li>
<li><strong>interfaces [](接口索引集合)</strong><br>interfaces []中每个成员的值必须是对常量池表中某项的有效索引值，它的长度为 interfaces_count。 每个成员 interfaces[i]必须为 CONSTANT_Class_info结构，其中 0 &lt;= i &lt; interfaces_count。在 interfaces[]中，各成员所表示的接口顺序和对应的源代码中给定的接口顺序（从左至右）一样，<strong>即 interfaces[0]对应的是源代码中最左边的接口。</strong></li>
</ul>
<h2 id="3-7、字段表集合"><a href="#3-7、字段表集合" class="headerlink" title="3.7、字段表集合"></a>3.7、字段表集合</h2><p><strong>fields：</strong></p>
<ul>
<li>用于描述接口或类中声明的变量。字段（field）包括<strong>类级变量以及实例级变量</strong>，但是不包括方法内部、代码块内部声明的局部变量。(local variables)</li>
<li>字段叫什么名字、字段被定义为什么数据类型，这些都是无法固定的，只能引用常量池中的常量来描述。</li>
<li>它指向常量池索引集合，它描述了每个字段的完整信息。比如<strong>字段的标识符、访问修饰符（public、private或protected）、是类变量还是实例变量（static修饰符）、是否是常量（final修饰符）</strong>等。</li>
</ul>
<p><strong>注意事项：</strong></p>
<ul>
<li>字段表集合中不会列出从父类或者实现的接口中继承而来的字段，但有可能列出原本Java代码之中不存在的字段。譬如在内部类中为了保持对外部类的访问性，会自动添加指向外部类实例的字段。</li>
<li>在Java语言中字段是无法重载的，两个字段的数据类型、修饰符不管是否相同，都必须使用不一样的名称，但是对于字节码来讲，如果两个字段的描述符不一致，那字段重名就是合法的。</li>
</ul>
<h3 id="字段计数器"><a href="#字段计数器" class="headerlink" title="字段计数器"></a>字段计数器</h3><p><strong>fields_count （字段计数器）</strong><br>fields_count的值表示当前class文件fields表的成员个数。使用两个字节来表示。</p>
<p>fields表中每个成员都是一个field_info结构，用于表示该类或接口所声明的所有类字段或者实例字段，不包括方法内部声明的变量，也不包括从父类或父接口继承的那些字段。</p>
<h3 id="字段表"><a href="#字段表" class="headerlink" title="字段表"></a>字段表</h3><p><strong>fields []（字段表）：</strong></p>
<ul>
<li>fields表中的每个成员都必须是一个fields_info结构的数据项，用于表示当前类或接口中某个字段的完整描述</li>
<li>一个字段的信息包括如下这些信息。这些信息中，<strong>各个修饰符都是布尔值，要么有，要么没有</strong>。<ul>
<li>作用域（public、private、protected修饰符）</li>
<li>是实例变量还是类变量（static修饰符）</li>
<li>可变性（final）</li>
<li>并发可见性（volatile修饰符，是否强制从主内存读写）</li>
<li>可否序列化（transient修饰符）</li>
<li>字段数据类型（基本数据类型、对象、数组）</li>
<li>字段名称</li>
<li>字段表结构</li>
</ul>
</li>
</ul>
<p>字段表作为一个表，同样有他自己的结构：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/67596f1378fc4.webp" alt="image-20241211185308310"></p>
<p><strong>字段表访问标识：</strong></p>
<p>我们知道，一个字段可以被各种关键字去修饰，比如：作用域修饰符（public、private、protected）、static修饰符、final修饰符、volatile修饰符等等。因此，其可像类的访问标志那样，使用一些标志来标记字段。字段的访问标志有如下这些：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/67596f3b91e08.webp" alt="image-20241211185348485"></p>
<p><strong>字段名索引：</strong></p>
<p>根据字段名索引的值，查询常量池中的指定索引项即可。</p>
<p><strong>描述符索引：</strong></p>
<p>描述符的作用是用来描述字段的数据类型、方法的参数列表（包括数量、类型以及顺序）和返回值。根据描述符规则，基本数据类型（byte,char,double,float,int,long,short,boolean）及代表无返回值的void类型都用一个大写字符来表示，而对象则用字符L加对象的全限定名来表示，如下所示：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/67596f8e28f70.webp" alt="image-20241211185511078"></p>
<p><strong>属性表集合：</strong></p>
<p>一个字段还可能拥有一些属性，用于存储更多的额外信息。比如初始化值、一些注释信息等。属性个数存放在attribute_count中，属性具体内容存放在attributes数组中。</p>
<p>以常量属性为例，结构为：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ConstantValue_attribute{</span><br><span class="line">    u2 attribute_name_index;</span><br><span class="line">    u4 attribute_length;</span><br><span class="line">    u2 constantvalue_index;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>说明：对于常量属性而言，attribute_length值恒为2。</p>
<h2 id="3-8、方法表集合"><a href="#3-8、方法表集合" class="headerlink" title="3.8、方法表集合"></a>3.8、方法表集合</h2><p>methods：指向常量池索引集合，它完整描述了每个方法的签名。</p>
<ul>
<li>在字节码文件中，<strong>每一个method_info项都对应着一个类或者接口中的方法信息</strong>。比如方法的访问修饰符(public、private或protected),方法的返回值类型以及方法的参数信息等。</li>
<li>如果这个方法不是抽象的或者不是native的，那么字节码中会体现出来。</li>
<li>一方面，methods表只描述当前类或接口中声明的方法，<strong>不包括从父类或父接口继承的方法</strong>。另一方面，methods表有可能会出现由编译器自动添加的方法，最典型的便是编译器产生的方法信息(比如：<strong>类(接口)初始化方法&lt;clinit&gt;()和实例初始化方法&lt;init&gt;()</strong>)。</li>
</ul>
<p><strong>使用注意事项：</strong></p>
<p>在Java语言中，要重载(Overload)一个方法，除了要与原方法具有相同的简单名称之外，还要求必须拥有一个与原方法不同的特征签名，特征签名就是一个方法中各个参数在常量池中的字段符号引用的集合，也就是因为返回值不会包含在特征签名之中，因此Java语言里无法仅仅依靠返回值的不同来对一个已有方法进行重载。但在Class文件格式中，特征签名的范围更大一些，只要描述符不是完全一致的两个方法就可以共存。也就是说，如果两个方法有相同的名称和特征签名，但返回值不同，那么也是可以合法共存于同一个class文件中。</p>
<p>也就是说，尽管Java语法规范并不允许在一个类或者接口中声明多个方法签名相同的方法，但是和<strong>Java语法规范相反，字节码文件中却恰恰允许存放多个方法签名相同的方法，唯一的条件就是这些方法之间的返回值不能相同</strong>。</p>
<h3 id="方法计数器"><a href="#方法计数器" class="headerlink" title="方法计数器"></a>方法计数器</h3><p><strong>methods_count （方法计数器）:</strong></p>
<p>methods_count的值表示当前class文件methods表的成员个数。使用两个字节来表示。<br>methods 表中每个成员都是一个method_info结构。</p>
<h3 id="方法表"><a href="#方法表" class="headerlink" title="方法表"></a>方法表</h3><p><strong>methods []（方法表）:</strong></p>
<ul>
<li><p>methods表中的每个成员都必须是一个method_info结构，用于表示当前类或接口中某个方法的完整描述。如果某个method_info结构的access_flags项既没有设置 <strong>ACC_NATIVE</strong> 标志也没有设置<strong>ACC_ABSTRACT</strong>标志，那么该结构中也应包含实现这个方法所用的Java虚拟机指令。</p>
</li>
<li><p>method_info结构可以表示类和接口中定义的所有方法，包括实例方法、类方法、实例初始化方法和类或接口初始化方法</p>
</li>
<li><p>方法表的结构实际跟字段表是一样的，方法表结构如下：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/6759711378545.webp" alt="image-20241211190140402"></p>
</li>
</ul>
<p><strong>方法表访问标志：</strong></p>
<p>跟字段表一样，方法表也有访问标志，而且他们的标志有部分相同，部分则不同，方法表的具体访问标志如下：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/6759712f6e88e.webp" alt="image-20241211190208322"></p>
<p> <strong>方法名索引：</strong></p>
<p>根据方法名索引的值，查询常量池中的指定索引项即可。</p>
<p><strong>描述符索引：</strong></p>
<p>根据描述符索引的值，查询常量池中的指定索引项即可。</p>
<p><strong>属性计数器：</strong></p>
<p>根据属性计数器的值，判断出方法中属性的个数。</p>
<p><strong>属性表：</strong></p>
<p>属性计数器后面就是属性表了，由于只有一个属性，所以这里也只有一个属性表。<br>由于涉及到属性表，这里简单说下，下一节会详细介绍。</p>
<h2 id="3-9、属性表集合"><a href="#3-9、属性表集合" class="headerlink" title="3.9、属性表集合"></a>3.9、属性表集合</h2><p><strong>属性表集合(attributes)：</strong></p>
<p>方法表集合之后的属性表集合，<strong>指的是class文件所携带的辅助信息</strong>，比如该 class 文件的源文件的名称。以及任何带有RetentionPolicy.CLASS 或者RetentionPolicy.RUNTIME的注解。这类信息通常被用于Java虚拟机的验证和运行，以及Java程序的调试，<strong>一般无须深入了解</strong>。</p>
<p>此外，字段表、方法表都可以有自己的属性表。用于描述某些场景专有的信息。</p>
<p>属性表集合的限制没有那么严格，不再要求各个属性表具有严格的顺序，并且只要不与已有的属性名重复，任何人实现的编译器都可以向属性表中写入自己定义的属性信息，但Java虚拟机运行时会忽略掉它不认识的属性。</p>
<h3 id="属性计数器"><a href="#属性计数器" class="headerlink" title="属性计数器"></a>属性计数器</h3><p><strong>attributes_count （属性计数器）：</strong></p>
<p>attributes_count的值表示当前class文件属性表的成员个数。属性表中每一项都是一个attribute_info结构。</p>
<h3 id="属性表"><a href="#属性表" class="headerlink" title="属性表"></a>属性表</h3><p><strong>attributes []（属性表）：</strong></p>
<p>属性表的每个项的值必须是attribute_info结构。属性表的结构比较灵活，各种不同的属性只要满足以下结构即可。</p>
<p>属性的通用格式：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/67597214e587e.webp" alt="image-20241211190557847"></p>
<p>即只需说明属性的名称以及占用位数的长度即可，属性表具体的结构可以去自定义。</p>
<p><strong>属性类型：</strong></p>
<p>属性表实际上可以有很多类型，上面看到的Code属性只是其中一种，Java8里面定义了23种属性。<br>下面这些是虚拟机中预定义的属性：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/6759723232476.webp" alt="image-20241211190627074"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/6759724522da1.webp" alt="image-20241211190646028"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/67597250437b8.webp" alt="image-20241211190657178"></p>
<p>或（查看官网）</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/6759725fe4588.webp" alt="image-20241211190712796"></p>
<h4 id="①-ConstantValue-属性"><a href="#①-ConstantValue-属性" class="headerlink" title="① ConstantValue 属性"></a>① ConstantValue 属性</h4><p>ConstantValue 属性表示一个常量字段的值。位于 field_info结构的属性表中。</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ConstantValue_attribute {</span><br><span class="line">    u2 attribute_name_index;</span><br><span class="line">    u4 attribute_length;</span><br><span class="line">    u2 constantvalue_index;<span class="comment">//字段值在常量池中的索引，常量池在该索引处的项给出该属性表示的常量值。（例如，值是long型的，在常量池中便是CONSTANT_Long）</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h4 id="②-Deprecated-属性"><a href="#②-Deprecated-属性" class="headerlink" title="② Deprecated 属性"></a>② Deprecated 属性</h4><p>Deprecated 属性是在 JDK 1.1 为了支持注释中的关键词@deprecated 而引入的。</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Deprecated_attribute {</span><br><span class="line">    u2 attribute_name_index;</span><br><span class="line">     u4 attribute_length;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h4 id="③-Code-属性"><a href="#③-Code-属性" class="headerlink" title="③ Code 属性"></a>③ Code 属性</h4><p>Code属性就是存放方法体里面的代码。但是，并非所有方法表都有Code属性。像接口或者抽象方法，他们没有具体的方法体，因此也就不会有Code属性了。</p>
<p>Code属性表的结构,如下图：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/675973482d708.webp" alt="image-20241211191105048"></p>
<p>可以看到：Code属性表的前两项跟属性表是一致的，即Code属性表遵循属性表的结构，后面那些则是他自定义的结构。</p>
<h4 id="④-InnerClasses-属性"><a href="#④-InnerClasses-属性" class="headerlink" title="④ InnerClasses 属性"></a>④ InnerClasses 属性</h4><p>为了方便说明特别定义一个表示类或接口的 Class 格式为 C。如果 C 的常量池中包含某个CONSTANT_Class_info 成员，且这个成员所表示的类或接口不属于任何一个包，那么 C 的ClassFile 结构的属性表中就必须含有对应的 InnerClasses 属性。InnerClasses 属性是在 JDK 1.1 中为了支持内部类和内部接口而引入的,位于 ClassFile结构的属性表。</p>
<h4 id="⑤-LineNumberTable-属性"><a href="#⑤-LineNumberTable-属性" class="headerlink" title="⑤ LineNumberTable 属性"></a>⑤ LineNumberTable 属性</h4><p>LineNumberTable 属性是可选变长属性，位于 Code结构的属性表。</p>
<p>LineNumberTable属性是<strong>用来描述Java源码行号与字节码行号之间的对应关系</strong>。这个属性可以用来在调试的时候定位代码执行的行数。</p>
<p><strong>start_pc,即字节码行号;line_number，即Java源代码行号</strong>。</p>
<p>在 Code 属性的属性表中,LineNumberTable 属性可以按照任意顺序出现，此外，多个 LineNumberTable属性可以共同表示一个行号在源文件中表示的内容，即 LineNumberTable 属性不需要与源文件的行一一对应。</p>
<p>LineNumberTable属性表结构:</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/675973c1422f0.webp" alt="image-20241211191306138"></p>
<h4 id="⑥-LocalVariableTable-属性"><a href="#⑥-LocalVariableTable-属性" class="headerlink" title="⑥ LocalVariableTable 属性"></a>⑥ LocalVariableTable 属性</h4><p>LocalVariableTable 是可选变长属性，位于 Code属性的属性表中。它被调试器<strong>用于确定方法在执行过程中局部变量的信息</strong>。在 Code 属性的属性表中，LocalVariableTable 属性可以按照任意顺序出现。 Code 属性中的每个局部变量最多只能有一个 LocalVariableTable 属性。</p>
<ul>
<li><strong>start pc + length表示这个变量在字节码中的生命周期起始和结束的偏移位置（this生命周期从头0到结尾）</strong></li>
<li><strong>index就是这个变量在局部变量表中的槽位（槽位可复用）</strong></li>
<li><strong>name就是变量名称</strong></li>
<li><strong>Descriptor</strong>表示局部变量类型描述</li>
</ul>
<p>LocalVariableTable 属性表结构:</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/6759743d383ae.webp" alt="image-20241211191510120"></p>
<h4 id="⑦-Signature-属性"><a href="#⑦-Signature-属性" class="headerlink" title="⑦ Signature 属性"></a>⑦ Signature 属性</h4><p>Signature 属性是可选的定长属性，位于 ClassFile， field_info或 method_info结构的属性表中。在 Java 语言中，任何类、 接口、 初始化方法或成员的泛型签名如果包含了类型变量（ Type Variables） 或参数化类型（ Parameterized Types），则 Signature 属性会为它记录泛型签名信息。</p>
<h4 id="⑧-SourceFile属性"><a href="#⑧-SourceFile属性" class="headerlink" title="⑧ SourceFile属性"></a>⑧ SourceFile属性</h4><p>SourceFile属性结构：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/67597486d575e.webp" alt="image-20241211191623770"></p>
<p>可以看到，其长度总是固定的8个字节。</p>
<h4 id="⑨-其他属性"><a href="#⑨-其他属性" class="headerlink" title="⑨ 其他属性"></a>⑨ 其他属性</h4><p>Java虚拟机中预定义的属性有20多个，这里就不一一介绍了，通过上面几个属性的介绍，只要领会其精髓，其他属性的解读也是易如反掌。</p>
<h2 id="3-10、小结"><a href="#3-10、小结" class="headerlink" title="3.10、小结"></a>3.10、小结</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/6759923fe0272.webp" alt="image-20241211212310508"></p>
<h1 id="4、oracle官方的反解析工具：javap"><a href="#4、oracle官方的反解析工具：javap" class="headerlink" title="4、oracle官方的反解析工具：javap"></a>4、oracle官方的反解析工具：javap</h1><h2 id="4-1、解析字节码的作用"><a href="#4-1、解析字节码的作用" class="headerlink" title="4.1、解析字节码的作用"></a>4.1、解析字节码的作用</h2><p>通过反编译生成的字节码文件，我们可以深入的了解java代码的工作机制。但是，自己分析类文件结构太麻烦了！除了使用第三方的jclasslib工具之外，oracle官方也提供了工具：javap。</p>
<p>javap是jdk自带的反解析工具。它的作用就是根据class字节码文件，反解析出当前类对应的code区（字节码指令）、局部变量表、异常表和代码行偏移量映射表、常量池等信息。</p>
<p>通过局部变量表，我们可以查看局部变量的作用域范围、所在槽位等信息，甚至可以看到槽位复用等信息。</p>
<h2 id="4-2、javac-g操作"><a href="#4-2、javac-g操作" class="headerlink" title="4.2、javac -g操作"></a>4.2、javac -g操作</h2><p>解析字节码文件得到的信息中，有些信息（如局部变量表、指令和代码行偏移量映射表、常量池中方法的参数名称等等）需要在使用javac编译成class文件时，指定参数才能输出。</p>
<p>比如，你直接javac xx.java，就不会在生成对应的局部变量表等信息，如果你使用javac -g xx.java就可以生成所有相关信息了。如果你使用的eclipse或IDEA，则默认情况下，eclipse、IDEA在编译时会帮你生成局部变量表、指令和代码行偏移量映射表等信息的。</p>
<h2 id="4-3、javap的用法"><a href="#4-3、javap的用法" class="headerlink" title="4.3、javap的用法"></a>4.3、javap的用法</h2><p><strong>javap的用法格式：</strong><br><strong>javap &lt;options&gt; &lt;classes&gt;</strong><br>其中，classes就是你要反编译的class文件。<br>在命令行中直接输入javap或javap -help可以看到javap的options有如下选项：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/6759936e7f96c.webp" alt="image-20241211212814211"></p>
<p>这里重组一下：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/67599386c1489.webp" alt="image-20241211212838170"></p>
<p><strong>一般常用的是-v -l -c三个选项。</strong></p>
<ul>
<li>javap -l 会输出行号和本地变量表信息。</li>
<li>javap -c 会对当前class字节码进行反编译生成汇编代码。</li>
<li>javap -v classxx 除了包含-c内容外，还会输出行号、局部变量表信息、常量池等信息。</li>
</ul>
<h2 id="4-4、使用举例"><a href="#4-4、使用举例" class="headerlink" title="4.4、使用举例"></a>4.4、使用举例</h2><p>有下面一个类</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.java1;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> shkstart</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JavapTest</span> {</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> num;</span><br><span class="line">    <span class="type">boolean</span> flag;</span><br><span class="line">    <span class="keyword">protected</span> <span class="type">char</span> gender;</span><br><span class="line">    <span class="keyword">public</span> String info;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">COUNTS</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">static</span>{</span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">"www.atguigu.com"</span>;</span><br><span class="line">    }</span><br><span class="line">    {</span><br><span class="line">        info = <span class="string">"java"</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">JavapTest</span><span class="params">()</span>{</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">JavapTest</span><span class="params">(<span class="type">boolean</span> flag)</span>{</span><br><span class="line">        <span class="built_in">this</span>.flag = flag;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">methodPrivate</span><span class="params">()</span>{</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">    <span class="type">int</span> <span class="title function_">getNum</span><span class="params">(<span class="type">int</span> i)</span>{</span><br><span class="line">        <span class="keyword">return</span> num + i;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">protected</span> <span class="type">char</span> <span class="title function_">showGender</span><span class="params">()</span>{</span><br><span class="line">        <span class="keyword">return</span> gender;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">showInfo</span><span class="params">()</span>{</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">        System.out.println(info + i);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>希望输出的信息比较完整的话，使用如下操作：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javap -v -p JavapTest.class</span><br></pre></td></tr></tbody></table></figure>

<p>对应的内容信息为：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br></pre></td><td class="code"><pre><span class="line">Classfile /C:/Users/songhk/Desktop/2/JavapTest.class</span><br><span class="line">  Last modified 2020-9-6; size 1358 bytes</span><br><span class="line">  MD5 checksum 526b4a845e4d98180438e4c5781b7e88</span><br><span class="line">  Compiled from <span class="string">"JavapTest.java"</span></span><br><span class="line">public class com.atguigu.java1.JavapTest</span><br><span class="line">  minor version: 0</span><br><span class="line">  major version: 52</span><br><span class="line">  flags: ACC_PUBLIC, ACC_SUPER</span><br><span class="line">Constant pool:</span><br><span class="line">   <span class="comment">#1 = Methodref          #16.#46        // java/lang/Object."&lt;init&gt;":()V</span></span><br><span class="line">   <span class="comment">#2 = String             #47            // java</span></span><br><span class="line">   <span class="comment">#3 = Fieldref           #15.#48        // com/atguigu/java1/JavapTest.info:Ljava/lang/String;</span></span><br><span class="line">   <span class="comment">#4 = Fieldref           #15.#49        // com/atguigu/java1/JavapTest.flag:Z</span></span><br><span class="line">   <span class="comment">#5 = Fieldref           #15.#50        // com/atguigu/java1/JavapTest.num:I</span></span><br><span class="line">   <span class="comment">#6 = Fieldref           #15.#51        // com/atguigu/java1/JavapTest.gender:C</span></span><br><span class="line">   <span class="comment">#7 = Fieldref           #52.#53        // java/lang/System.out:Ljava/io/PrintStream;</span></span><br><span class="line">   <span class="comment">#8 = Class              #54            // java/lang/StringBuilder</span></span><br><span class="line">   <span class="comment">#9 = Methodref          #8.#46         // java/lang/StringBuilder."&lt;init&gt;":()V</span></span><br><span class="line">  <span class="comment">#10 = Methodref          #8.#55         // java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;</span></span><br><span class="line">  <span class="comment">#11 = Methodref          #8.#56         // java/lang/StringBuilder.append:(I)Ljava/lang/StringBuilder;</span></span><br><span class="line">  <span class="comment">#12 = Methodref          #8.#57         // java/lang/StringBuilder.toString:()Ljava/lang/String;</span></span><br><span class="line">  <span class="comment">#13 = Methodref          #58.#59        // java/io/PrintStream.println:(Ljava/lang/String;)V</span></span><br><span class="line">  <span class="comment">#14 = String             #60            // www.atguigu.com</span></span><br><span class="line">  <span class="comment">#15 = Class              #61            // com/atguigu/java1/JavapTest</span></span><br><span class="line">  <span class="comment">#16 = Class              #62            // java/lang/Object</span></span><br><span class="line">  <span class="comment">#17 = Utf8               num</span></span><br><span class="line">  <span class="comment">#18 = Utf8               I</span></span><br><span class="line">  <span class="comment">#19 = Utf8               flag</span></span><br><span class="line">  <span class="comment">#20 = Utf8               Z</span></span><br><span class="line">  <span class="comment">#21 = Utf8               gender</span></span><br><span class="line">  <span class="comment">#22 = Utf8               C</span></span><br><span class="line">  <span class="comment">#23 = Utf8               info</span></span><br><span class="line">  <span class="comment">#24 = Utf8               Ljava/lang/String;</span></span><br><span class="line">  <span class="comment">#25 = Utf8               COUNTS</span></span><br><span class="line">  <span class="comment">#26 = Utf8               ConstantValue</span></span><br><span class="line">  <span class="comment">#27 = Integer            1</span></span><br><span class="line">  <span class="comment">#28 = Utf8               &lt;init&gt;</span></span><br><span class="line">  <span class="comment">#29 = Utf8               ()V</span></span><br><span class="line">  <span class="comment">#30 = Utf8               Code</span></span><br><span class="line">  <span class="comment">#31 = Utf8               LineNumberTable</span></span><br><span class="line">  <span class="comment">#32 = Utf8               LocalVariableTable</span></span><br><span class="line">  <span class="comment">#33 = Utf8               this</span></span><br><span class="line">  <span class="comment">#34 = Utf8               Lcom/atguigu/java1/JavapTest;</span></span><br><span class="line">  <span class="comment">#35 = Utf8               (Z)V</span></span><br><span class="line">  <span class="comment">#36 = Utf8               methodPrivate</span></span><br><span class="line">  <span class="comment">#37 = Utf8               getNum</span></span><br><span class="line">  <span class="comment">#38 = Utf8               (I)I</span></span><br><span class="line">  <span class="comment">#39 = Utf8               i</span></span><br><span class="line">  <span class="comment">#40 = Utf8               showGender</span></span><br><span class="line">  <span class="comment">#41 = Utf8               ()C</span></span><br><span class="line">  <span class="comment">#42 = Utf8               showInfo</span></span><br><span class="line">  <span class="comment">#43 = Utf8               &lt;clinit&gt;</span></span><br><span class="line">  <span class="comment">#44 = Utf8               SourceFile</span></span><br><span class="line">  <span class="comment">#45 = Utf8               JavapTest.java</span></span><br><span class="line">  <span class="comment">#46 = NameAndType        #28:#29        // "&lt;init&gt;":()V</span></span><br><span class="line">  <span class="comment">#47 = Utf8               java</span></span><br><span class="line">  <span class="comment">#48 = NameAndType        #23:#24        // info:Ljava/lang/String;</span></span><br><span class="line">  <span class="comment">#49 = NameAndType        #19:#20        // flag:Z</span></span><br><span class="line">  <span class="comment">#50 = NameAndType        #17:#18        // num:I</span></span><br><span class="line">  <span class="comment">#51 = NameAndType        #21:#22        // gender:C</span></span><br><span class="line">  <span class="comment">#52 = Class              #63            // java/lang/System</span></span><br><span class="line">  <span class="comment">#53 = NameAndType        #64:#65        // out:Ljava/io/PrintStream;</span></span><br><span class="line">  <span class="comment">#54 = Utf8               java/lang/StringBuilder</span></span><br><span class="line">  <span class="comment">#55 = NameAndType        #66:#67        // append:(Ljava/lang/String;)Ljava/lang/StringBuilder;</span></span><br><span class="line">  <span class="comment">#56 = NameAndType        #66:#68        // append:(I)Ljava/lang/StringBuilder;</span></span><br><span class="line">  <span class="comment">#57 = NameAndType        #69:#70        // toString:()Ljava/lang/String;</span></span><br><span class="line">  <span class="comment">#58 = Class              #71            // java/io/PrintStream</span></span><br><span class="line">  <span class="comment">#59 = NameAndType        #72:#73        // println:(Ljava/lang/String;)V</span></span><br><span class="line">  <span class="comment">#60 = Utf8               www.atguigu.com</span></span><br><span class="line">  <span class="comment">#61 = Utf8               com/atguigu/java1/JavapTest</span></span><br><span class="line">  <span class="comment">#62 = Utf8               java/lang/Object</span></span><br><span class="line">  <span class="comment">#63 = Utf8               java/lang/System</span></span><br><span class="line">  <span class="comment">#64 = Utf8               out</span></span><br><span class="line">  <span class="comment">#65 = Utf8               Ljava/io/PrintStream;</span></span><br><span class="line">  <span class="comment">#66 = Utf8               append</span></span><br><span class="line">  <span class="comment">#67 = Utf8               (Ljava/lang/String;)Ljava/lang/StringBuilder;</span></span><br><span class="line">  <span class="comment">#68 = Utf8               (I)Ljava/lang/StringBuilder;</span></span><br><span class="line">  <span class="comment">#69 = Utf8               toString</span></span><br><span class="line">  <span class="comment">#70 = Utf8               ()Ljava/lang/String;</span></span><br><span class="line">  <span class="comment">#71 = Utf8               java/io/PrintStream</span></span><br><span class="line">  <span class="comment">#72 = Utf8               println</span></span><br><span class="line">  <span class="comment">#73 = Utf8               (Ljava/lang/String;)V</span></span><br><span class="line">{</span><br><span class="line">  private int num;</span><br><span class="line">    descriptor: I</span><br><span class="line">    flags: ACC_PRIVATE</span><br><span class="line"></span><br><span class="line">  boolean flag;</span><br><span class="line">    descriptor: Z</span><br><span class="line">    flags:</span><br><span class="line"></span><br><span class="line">  protected char gender;</span><br><span class="line">    descriptor: C</span><br><span class="line">    flags: ACC_PROTECTED</span><br><span class="line"></span><br><span class="line">  public java.lang.String info;</span><br><span class="line">    descriptor: Ljava/lang/String;</span><br><span class="line">    flags: ACC_PUBLIC</span><br><span class="line"></span><br><span class="line">  public static final int COUNTS;</span><br><span class="line">    descriptor: I</span><br><span class="line">    flags: ACC_PUBLIC, ACC_STATIC, ACC_FINAL</span><br><span class="line">    ConstantValue: int 1</span><br><span class="line"></span><br><span class="line">  public com.atguigu.java1.JavapTest();</span><br><span class="line">    descriptor: ()V</span><br><span class="line">    flags: ACC_PUBLIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=2, locals=1, args_size=1</span><br><span class="line">         0: aload_0</span><br><span class="line">         1: invokespecial <span class="comment">#1                  // Method java/lang/Object."&lt;init&gt;":()V</span></span><br><span class="line">         4: aload_0</span><br><span class="line">         5: ldc           <span class="comment">#2                  // String java</span></span><br><span class="line">         7: putfield      <span class="comment">#3                  // Field info:Ljava/lang/String;</span></span><br><span class="line">        10: <span class="built_in">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line 20: 0</span><br><span class="line">        line 18: 4</span><br><span class="line">        line 22: 10</span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            0      11     0  this   Lcom/atguigu/java1/JavapTest;</span><br><span class="line"></span><br><span class="line">  private com.atguigu.java1.JavapTest(boolean);</span><br><span class="line">    descriptor: (Z)V</span><br><span class="line">    flags: ACC_PRIVATE</span><br><span class="line">    Code:</span><br><span class="line">      stack=2, locals=2, args_size=2</span><br><span class="line">         0: aload_0</span><br><span class="line">         1: invokespecial <span class="comment">#1                  // Method java/lang/Object."&lt;init&gt;":()V</span></span><br><span class="line">         4: aload_0</span><br><span class="line">         5: ldc           <span class="comment">#2                  // String java</span></span><br><span class="line">         7: putfield      <span class="comment">#3                  // Field info:Ljava/lang/String;</span></span><br><span class="line">        10: aload_0</span><br><span class="line">        11: iload_1</span><br><span class="line">        12: putfield      <span class="comment">#4                  // Field flag:Z</span></span><br><span class="line">        15: <span class="built_in">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line 23: 0</span><br><span class="line">        line 18: 4</span><br><span class="line">        line 24: 10</span><br><span class="line">        line 25: 15</span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            0      16     0  this   Lcom/atguigu/java1/JavapTest;</span><br><span class="line">            0      16     1  flag   Z</span><br><span class="line"></span><br><span class="line">  private void methodPrivate();</span><br><span class="line">    descriptor: ()V</span><br><span class="line">    flags: ACC_PRIVATE</span><br><span class="line">    Code:</span><br><span class="line">      stack=0, locals=1, args_size=1</span><br><span class="line">         0: <span class="built_in">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line 28: 0</span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            0       1     0  this   Lcom/atguigu/java1/JavapTest;</span><br><span class="line"></span><br><span class="line">  int getNum(int);</span><br><span class="line">    descriptor: (I)I</span><br><span class="line">    flags:</span><br><span class="line">    Code:</span><br><span class="line">      stack=2, locals=2, args_size=2</span><br><span class="line">         0: aload_0</span><br><span class="line">         1: getfield      <span class="comment">#5                  // Field num:I</span></span><br><span class="line">         4: iload_1</span><br><span class="line">         5: iadd</span><br><span class="line">         6: ireturn</span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line 30: 0</span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            0       7     0  this   Lcom/atguigu/java1/JavapTest;</span><br><span class="line">            0       7     1     i   I</span><br><span class="line"></span><br><span class="line">  protected char showGender();</span><br><span class="line">    descriptor: ()C</span><br><span class="line">    flags: ACC_PROTECTED</span><br><span class="line">    Code:</span><br><span class="line">      stack=1, locals=1, args_size=1</span><br><span class="line">         0: aload_0</span><br><span class="line">         1: getfield      <span class="comment">#6                  // Field gender:C</span></span><br><span class="line">         4: ireturn</span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line 33: 0</span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            0       5     0  this   Lcom/atguigu/java1/JavapTest;</span><br><span class="line"></span><br><span class="line">  public void showInfo();</span><br><span class="line">    descriptor: ()V</span><br><span class="line">    flags: ACC_PUBLIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=3, locals=2, args_size=1</span><br><span class="line">         0: bipush        10</span><br><span class="line">         2: istore_1</span><br><span class="line">         3: getstatic     <span class="comment">#7                  // Field java/lang/System.out:Ljava/io/PrintStream;</span></span><br><span class="line">         6: new           <span class="comment">#8                  // class java/lang/StringBuilder</span></span><br><span class="line">         9: dup</span><br><span class="line">        10: invokespecial <span class="comment">#9                  // Method java/lang/StringBuilder."&lt;init&gt;":()V</span></span><br><span class="line">        13: aload_0</span><br><span class="line">        14: getfield      <span class="comment">#3                  // Field info:Ljava/lang/String;</span></span><br><span class="line">        17: invokevirtual <span class="comment">#10                 // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;</span></span><br><span class="line">        20: iload_1</span><br><span class="line">        21: invokevirtual <span class="comment">#11                 // Method java/lang/StringBuilder.append:(I)Ljava/lang/StringBuilder;</span></span><br><span class="line">        24: invokevirtual <span class="comment">#12                 // Method java/lang/StringBuilder.toString:()Ljava/lang/String;</span></span><br><span class="line">        27: invokevirtual <span class="comment">#13                 // Method java/io/PrintStream.println:(Ljava/lang/String;)V</span></span><br><span class="line">        30: <span class="built_in">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line 36: 0</span><br><span class="line">        line 37: 3</span><br><span class="line">        line 38: 30</span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            0      31     0  this   Lcom/atguigu/java1/JavapTest;</span><br><span class="line">            3      28     1     i   I</span><br><span class="line"></span><br><span class="line">  static {};</span><br><span class="line">    descriptor: ()V</span><br><span class="line">    flags: ACC_STATIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=1, locals=1, args_size=0</span><br><span class="line">         0: ldc           <span class="comment">#14                 // String www.atguigu.com</span></span><br><span class="line">         2: astore_0</span><br><span class="line">         3: <span class="built_in">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line 15: 0</span><br><span class="line">        line 16: 3</span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">}</span><br><span class="line">SourceFile: <span class="string">"JavapTest.java"</span></span><br></pre></td></tr></tbody></table></figure>

<h2 id="4-5、总结"><a href="#4-5、总结" class="headerlink" title="4.5、总结"></a>4.5、总结</h2><p>1、通过javap命令可以查看一个java类反汇编得到的Class文件版本号、常量池、访问标识、变量表、指令代码行号表等等信息。不显示类索引、父类索引、接口索引集合、&lt;clinit&gt;()、&lt;init&gt;()等结构</p>
<p>2、通过对前面例子代码反汇编文件的简单分析，可以发现，一个方法的执行通常会涉及下面几块内存的操作：<br>（1）java栈中：局部变量表、操作数栈。<br>（2）java堆。通过对象的地址引用去操作。<br>（3）常量池。<br>（4）其他如帧数据区、方法区的剩余部分等情况，测试中没有显示出来，这里说明一下。</p>
<p>3、平常，我们比较关注的是java类中每个方法的反汇编中的指令操作过程，这些指令都是顺序执行的，可以参考官方文档查看每个指令的含义，很简单：<br><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/specs/jvms/se7/html/jvms-6.html">https://docs.oracle.com/javase/specs/jvms/se7/html/jvms-6.html</a></p>
<h1 id="5、字节码指令集与解析概述"><a href="#5、字节码指令集与解析概述" class="headerlink" title="5、字节码指令集与解析概述"></a>5、字节码指令集与解析概述</h1><p>Java字节码对于虚拟机，就好像汇编语言对于计算机，属于基本执行指令。</p>
<p>Java 虚拟机的指令由<strong>一个字节长度</strong>的、代表着某种特定操作含义的数字（称为<strong>操作码，Opcode</strong>）以及跟随其后的零至多个代表此操作所需参数（称为操作<strong>数，Operands</strong>）而构成。由于 Java 虚拟机采用面向操作数栈而不是寄存器的结构，所以大多数的指令都不包含操作数，只有一个操作码。</p>
<p>由于限制了 Java 虚拟机操作码的长度为一个字节（即 0～255），这意味着指令集的操作码总数不可能超过 256 条。</p>
<p>官方文档：<a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-6.html">https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-6.html</a></p>
<p>熟悉虚拟机的指令对于动态字节码生成、反编译Class文件、Class文件修补都有着非常重要的价值。因此，阅读字节码作为了解 Java 虚拟机的基础技能，需要熟练掌握常见指令。</p>
<h2 id="5-1、字节码与数据类型"><a href="#5-1、字节码与数据类型" class="headerlink" title="5.1、字节码与数据类型"></a>5.1、字节码与数据类型</h2><p>在Java虚拟机的指令集中，大多数的指令都包含了其操作所对应的数据类型信息。例如，iload指令用于从局部变量表中加载int型的数据到操作数栈中，而fload指令加载的则是float类型的数据。</p>
<p>对于大部分与数据类型相关的字节码指令，<strong>它们的操作码助记符中都有特殊的字符来表明专门为哪种数据类型服务</strong>：</p>
<ul>
<li>i代表对int类型的数据操作</li>
<li>l代表long类型的数据操作</li>
<li>s代表short类型的数据操作</li>
<li>b代表byte类型的数据操作</li>
<li>c代表char类型的数据操作</li>
<li>f代表float类型的数据操作</li>
<li>d代表double类型的数据操作</li>
</ul>
<p>也有一些指令的助记符中<strong>没有明确地指明操作类型的字母</strong>，如arraylength指令，它没有代表数据类型的特殊字符，但操作数永远只能是一个数组类型的对象。</p>
<p>还有另外一些指令，如无条件跳转指令goto则是与<strong>数据类型无关的</strong>。</p>
<p><strong>大部分的指令都没有支持整数类型byte、char和short，甚至没有任何指令支持boolean类型</strong>。编译器会在编译期或运行期将byte和short类型的数据带符号扩展（Sign-Extend）为相应的int类型数据，将boolean和char类型数据零位扩展（Zero-Extend）为相应的int类型数据。与之类似，在处理boolean、byte、short和char类型的数组时，也会转换为使用对应的int类型的字节码指令来处理。因此<strong>，大多数对于boolean、byte、short和char类型数据的操作，实际上都是使用相应的int类型作为运算类型</strong>。</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">byte</span> <span class="variable">b1</span> <span class="operator">=</span> <span class="number">12</span>;</span><br><span class="line"><span class="type">short</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> b1 + s1;</span><br></pre></td></tr></tbody></table></figure>

<h2 id="5-2、指令分类"><a href="#5-2、指令分类" class="headerlink" title="5.2、指令分类"></a>5.2、指令分类</h2><p>由于完全介绍和学习这些指令需要花费大量时间。为了让大家能够更快地熟悉和了解这些基本指令，这里将JVM中的字节码指令集按用途大致分成 9 类:</p>
<ul>
<li>加载与存储指令</li>
<li>算术指令</li>
<li>类型转换指令</li>
<li>对象的创建与访问指令</li>
<li>方法调用与返回指令</li>
<li>操作数栈管理指令</li>
<li>控制转移指令</li>
<li>异常处理指令</li>
<li>同步控制指令</li>
</ul>
<p>(说在前面)在做值相关操作时：</p>
<ul>
<li>一个指令，可以从局部变量表、常量池、堆中对象、方法调用、系统调用中等取得数据，这些数据（可能是值，可能是对象的引用）被压入操作数栈。</li>
<li>一个指令，也可以从操作数栈中取出一到多个值（pop多次），完成赋值、加减乘除、方法传参、系统调用等等操作。</li>
</ul>
<h1 id="6、字节码指令"><a href="#6、字节码指令" class="headerlink" title="6、字节码指令"></a>6、字节码指令</h1><blockquote>
<p>面试题：知道字节码吗？字节码指令都有哪些？（百度）</p>
</blockquote>
<h2 id="6-1、加载与存储指令"><a href="#6-1、加载与存储指令" class="headerlink" title="6.1、加载与存储指令"></a>6.1、加载与存储指令</h2><p><strong>1、作用</strong></p>
<p>加载和存储指令用于将数据从栈帧的局部变量表和操作数栈之间来回传递。</p>
<p><strong>2、常用指令</strong></p>
<p>1、【局部变量压栈指令】将一个局部变量加载到操作数栈：xload、xload_&lt;n&gt;（其中x为i、l、f、d、a，n 为 0 到 3）</p>
<p>2、【常量入栈指令】将一个常量加载到操作数栈：bipush、sipush、ldc、ldc_w、ldc2_w、aconst_null、iconst_m1、iconst_&lt;i&gt;、lconst_&lt;l&gt;、fconst_&lt;f&gt;、dconst_&lt;d&gt;</p>
<p>3、【出栈装入局部变量表指令】将一个数值从操作数栈存储到局部变量表：xstore、xstore_&lt;n&gt;（其中x为i、l、f、d、a，n 为 </p>
<p>4、扩充局部变量表的访问索引的指令 ：wide。</p>
<p>上面所列举的指令助记符中，有一部分是以尖括号结尾的（例如iload_&lt;n&gt;）。这些指令助记符实际上代表了一组指令（例如 iload_&lt;n&gt;代表了iload_0、iload_1、iload_2和iload_3这几个指令）。这几组指令都是某个带有一个操作数的通用指令（例如 iload）的特殊形式，<strong>对于这若干组特殊指令来说，它们表面上没有操作数，不需要进行取操作数的动作，但操作数都隐含在指令中</strong>。 </p>
<p>比如：<br>iload_0:将局部变量表中索引为0位置上的数据压入操作数栈中。<br>iload 0:将局部变量表中索引为0位置上的数据压入操作数栈中。<br>iload 4:将局部变量表中索引为4位置上的数据压入操作数栈中。</p>
<p>除此之外，它们的语义与原生的通用指令完全一致（例如 iload_0的语义与操作数为0时的 iload 指令语义完全一致）。在尖括号之间的字母指定了指令隐含操作数的数据类型，&lt;n&gt;代表非负的整数， &lt;i&gt; 代表是int类型数据，&lt;l&gt; 代表long类型，&lt;f&gt;代表float类型，&lt;d&gt; 代表double类型。</p>
<p>操作byte、char、short和boolean类型数据时，经常用int类型的指令来表示。</p>
<h3 id="操作数栈与局部变量表"><a href="#操作数栈与局部变量表" class="headerlink" title="操作数栈与局部变量表"></a>操作数栈与局部变量表</h3><p><strong>1、操作数栈(Operand Stacks)</strong></p>
<p>我们知道，Java字节码是Java虚拟机所使用的指令集。因此，它与Java虚拟机基于栈的计算模型是密不可分的。<br>在解释执行过程中，每当为Java方法分配栈桢时，Java虚拟机往往需要开辟一块额外的空间作为<strong>操作数栈，来存放计算的操作数以及返回结果</strong>。具体来说便是：<strong>执行每一条指令之前，Java 虚拟机要求该指令的操作数已被压入操作数栈中。在执行指令时，Java 虚拟机会将该指令所需的操作数弹出，并且将指令的结果重新压入栈中</strong>。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/6759998622624.webp" alt="image-20241211215413418"></p>
<p>以加法指令 iadd 为例。假设在执行该指令前，栈顶的两个元素分别为 int 值 1 和 int 值 2，那么 iadd 指令将弹出这两个 int，并将求得的和 int 值 3 压入栈中。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/675999a2ac4d9.webp" alt="image-20241211215442485"></p>
<p>由于 iadd 指令只消耗栈顶的两个元素，因此，对于离栈顶距离为 2 的元素，即图中的问号，iadd 指令并不关心它是否存在，更加不会对其进行修改。</p>
<p><strong>2、局部变量表(Local Variables)</strong></p>
<p>Java 方法栈桢的另外一个重要组成部分则是局部变量区，<strong>字节码程序可以将计算的结果缓存在局部变量区之中</strong>。</p>
<p>实际上，Java 虚拟机将局部变量区<strong>当成一个数组</strong>，依次存放 <strong>this</strong> 指针（仅非静态方法），所传入的参数，以及字节码中的局部变量。</p>
<p>和操作数栈一样，long 类型以及 double 类型的值将占据两个单元，其余类型仅占据一个单元。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/67599a00f285d.webp" alt="image-20241211215616711"></p>
<p>举例：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">foo</span><span class="params">(<span class="type">long</span> l, <span class="type">float</span> f)</span> {</span><br><span class="line">    {</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    {</span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="string">"Hello, World"</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>对应的图示：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/67599a1eda909.webp" alt="image-20241211215646633"></p>
<p>在栈帧中，与性能调优关系最为密切的部分就是局部变量表。局部变量表中的变量也是重要的垃圾回收根节点，只要被局部变量表中直接或间接引用的对象都不会被回收。</p>
<p>在方法执行时，虚拟机使用局部变量表完成方法的传递。</p>
<h4 id="局部变量压栈指令"><a href="#局部变量压栈指令" class="headerlink" title="局部变量压栈指令"></a>局部变量压栈指令</h4><p><strong>局部变量压栈指令将给定的局部变量表中的数据压入操作数栈。</strong></p>
<p>这类指令大体可以分为：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; xload_&lt;n&gt; (x为i、l、f、d、a，n为 0 到 3)</span><br><span class="line">&gt; xload (x为i、l、f、d、a)  </span><br></pre></td></tr></tbody></table></figure>

<p>说明：在这里，x的取值表示数据类型。</p>
<p>指令xload_n表示将第n个局部变量压入操作数栈，比如iload_1、fload_0、aload_0等指令。其中aload_n表示将一个对象引用压栈。</p>
<p>指令xload通过指定参数的形式，把局部变量压入操作数栈，当使用这个命令时，表示局部变量的数量可能超过了4个，比如指令iload、fload等。</p>
<h4 id="常量入栈指令"><a href="#常量入栈指令" class="headerlink" title="常量入栈指令"></a>常量入栈指令</h4><p>常量入栈指令的功能是将常数压入操作数栈，根据数据类型和入栈内容的不同，又可以分为const系列、push系列和ldc指令。</p>
<p><strong>指令const系列</strong>：用于对特定的常量入栈，入栈的常量隐含在指令本身里。指令有：iconst_&lt;i&gt; (i从-1到5)、lconst_&lt;l&gt; (l从0到1)、fconst_&lt;f&gt; (f从0到2)、dconst_&lt;d&gt; (d从0到1)、aconst_null。<br>比如:</p>
 <figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">iconst_m1将-1压入操作数栈；</span><br><span class="line">iconst_x（x为0到5）将x压入栈：</span><br><span class="line">lconst_0、lconst_1分别将长整数0和1压入栈； </span><br><span class="line">fconst_0、fconst_1、fconst_2分别将浮点数0、1、2压入栈；</span><br><span class="line">dconst_0和dconst_1分别将double型0和1压入栈。</span><br><span class="line">aconst_null将null压入操作数栈；</span><br></pre></td></tr></tbody></table></figure>

<p>从指令的命名上不难找出规律，指令助记符的第一个字符总是喜欢表示数据类型，i表示整数，l表示长整数，f表示浮点数，d表示双精度浮点，习惯上用a表示对象引用。如果指令隐含操作的参数，会以下划线形式给出。</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">int i = 3;   iconst_3</span><br><span class="line">int j = 6;   iconst 6? bipush 6?</span><br><span class="line">int k = 32768 ldc ?</span><br></pre></td></tr></tbody></table></figure>

<p><strong>指令push系列</strong>：主要包括bipush和sipush。它们的区别在于接收数据类型的不同，bipush接收8位整数作为参数，sipush接收16位整数，它们都将参数压入栈。</p>
<p><strong>指令ldc系列</strong>：如果以上指令都不能满足需求，那么可以使用万能的<strong>ldc</strong>指令，它可以接收一个8位的参数，该参数指向常量池中的int、float或者String的索引，将指定的内容压入堆栈。</p>
<p>类似的还有<strong>ldc_w</strong>，它接收两个8位参数，能支持的索引范围大于<strong>ldc</strong>。</p>
<p>如果要压入的元素是long或者double类型的,则使用<strong>ldc2_w</strong>指令，使用方式都是类似的。</p>
<p>总结如下：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/67599b9bb69a3.webp" alt="image-20241211220307481"></p>
<h4 id="出栈装入局部变量表指令"><a href="#出栈装入局部变量表指令" class="headerlink" title="出栈装入局部变量表指令"></a>出栈装入局部变量表指令</h4><p>出栈装入局部变量表指令用于将操作数栈中栈顶元素弹岀后，装入局部变量表的指定位置，用于给局部变量赋值。</p>
<p>这类指令主要以store的形式存在，比如xstore （x为i、l、f、d、a）、 xstore_n （x 为 i、l、f、d、a, n 为 0 至 3）。</p>
<ul>
<li>其中，指令istore_n将从操作数栈中弹出一个整数，并把它赋值给局部变量索引n位置。</li>
<li>指令xstore由于没有隐含参数信息，故需要提供一个byte类型的参数类指定目标局部变量表的位置。</li>
</ul>
<p><strong>说明：</strong> </p>
<p><strong>一般说来，类似像store这样的命令需要带一个参数，用来指明将弹出的元素放在局部变量表的第几个位置。</strong>但是，为了尽可能压缩指令大小，使用专门的istore_1指令表示将弹出的元素放置在局部变量表第1个位置。类似的还有istore_0、istore_2、istore_3,它们分别表示从操作数栈顶弹出一个元素，存放在局部变量表第0、2、3个位置。</p>
<p>由于局部变量表前几个位置总是非常常用，因此<strong>这种做法虽然增加了指令数量，但是可以大大压缩生成的字节码的体积</strong>。如果局部变量表很大，需要存储的槽位大于3,那么可以使用istore指令，外加一个参数，用来表示需要存放的槽位位置。</p>
<h2 id="6-2、算术指令"><a href="#6-2、算术指令" class="headerlink" title="6.2、算术指令"></a>6.2、算术指令</h2><p><strong>1、作用</strong></p>
<p>算术指令用于对两个操作数栈上的值进行某种特定运算，并把结果重新压入操作数栈。 </p>
<p><strong>2、分类：</strong></p>
<p>大体上算术指令可以分为两种：对<strong>整型数据</strong>进行运算的指令与对<strong>浮点类型数据</strong>进行运算的指令。</p>
<p><strong>3、byte、short、char和boolean类型说明</strong></p>
<p>在每一大类中，都有针对Java虚拟机具体数据类型的专用算术指令。但没有直接支持byte、short、char和boolean类型的算术指令，对于这些数据的运算，都使用int类型的指令来处理。此外，在处理boolean、byte、short和char类型的数组时，也会转换为使用对应的int类型的字节码指令来处理。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/67599c6525094.webp" alt="image-20241211220628695"></p>
<p><strong>4、运算时的溢出</strong></p>
<p>数据运算可能会导致溢出，例如两个很大的正整数相加，结果可能是一个负数。其实Java虚拟机规范并无明确规定过整型数据溢出的具体结果，仅规定了在处理整型数据时，只有除法指令以及求余指令中当出现除数为0时会导致虚拟机抛出异常ArithmeticException。</p>
<p><strong>5、运算模式</strong></p>
<ul>
<li>向最接近数舍入模式：JVM要求在进行浮点数计算时，所有的运算结果都必须舍入到适当的精度，非精确结果必须舍入为可被表示的最接近的精确值，如果有两种可表示的形式与该值一样接近，将优先选择最低有效位为零的；</li>
<li>向零舍入模式：将浮点数转换为整数时，采用该模式，该模式将在目标数值类型中选择一个最接近但是不大于原值的数字作为最精确的舍入结果；</li>
</ul>
<p><strong>6、NaN值使用</strong></p>
<p>当一个操作产生溢出时，将会使用有符号的无穷大表示，如果某个操作结果没有明确的数学定义的话，将会使用 <strong>NaN</strong>值来表示。而且所有使用<strong>NaN</strong>值作为操作数的算术操作，结果都会返回 <strong>NaN</strong>；</p>
<h3 id="所有算术指令"><a href="#所有算术指令" class="headerlink" title="所有算术指令"></a>所有算术指令</h3><p>所有的算术指令包括：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">加法指令：iadd、ladd、fadd、dadd</span><br><span class="line">减法指令：isub、lsub、fsub、dsub</span><br><span class="line">乘法指令:imul、lmul、 fmul、dmul</span><br><span class="line">除法指令：idiv、ldiv、fdiv、ddiv</span><br><span class="line">求余指令：irem、lrem、frem、drem    //remainder:余数</span><br><span class="line">取反指令：ineg、lneg、fneg、dneg    //negation:取反</span><br><span class="line">自增指令：iinc</span><br><span class="line"></span><br><span class="line">位运算指令，又可分为：</span><br><span class="line">位移指令：ishl、ishr、iushr、lshl、lshr、lushr</span><br><span class="line">按位或指令：ior、lor</span><br><span class="line">按位与指令：iand、land</span><br><span class="line">按位异或指令：ixor、lxor</span><br><span class="line"> </span><br><span class="line">比较指令：dcmpg、dcmpl、fcmpg、fcmpl、lcmp</span><br></pre></td></tr></tbody></table></figure>

<p><strong>举例1：</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">bar</span><span class="params">(<span class="type">int</span> i)</span> {</span><br><span class="line">    <span class="keyword">return</span> ((i + <span class="number">1</span>) - <span class="number">2</span>) * <span class="number">3</span> / <span class="number">4</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>字节码指令对应的图示：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/67599dfd89115.webp" alt="图像"></p>
<p><strong>举例2：</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">()</span>{</span><br><span class="line">    <span class="type">byte</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">15</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">8</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> i + j;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>字节码对应的内存解析:</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/67599e59ced15.webp" alt="image-20241211221449435"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/67599e718554a.webp" alt="image-20241211221513153"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/67599e8a95de4.webp" alt="image-20241211221538042"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/67599e9cd5c58.webp" alt="image-20241211221556307"></p>
<p><strong>举例3：</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">    <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> <span class="number">500</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">y</span> <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> x / y;</span><br><span class="line">    <span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> <span class="number">50</span>;</span><br><span class="line">    System.out.println(a + b);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>字节码对应的内存解析:</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/67599ed6ee62f.webp" alt="image-20241211221654607"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/67599ede86fc4.webp" alt="image-20241211221702210"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/67599eeaeaa89.webp" alt="image-20241211221714644"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/67599ef2af591.webp" alt="image-20241211221722381"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/67599efa2082d.webp" alt="image-20241211221729812"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/67599f00d48da.webp" alt="image-20241211221736517"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/67599f090ad17.webp" alt="image-20241211221744671"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/67599f0fd00a7.webp" alt="image-20241211221751527"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/67599f1806c01.webp" alt="image-20241211221759638"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/67599f1fe6028.webp" alt="image-20241211221807508"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/67599f26c54ca.webp" alt="image-20241211221814431"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/67599f2dd0d7f.webp" alt="image-20241211221821445"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/67599f3418dbf.webp" alt="image-20241211221827771"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/67599f3b7a0e2.webp" alt="image-20241211221835136"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/67599f4558a24.webp" alt="image-20241211221844977"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/67599f4caeb75.webp" alt="image-20241211221852401"></p>
<h3 id="比较指令的说明"><a href="#比较指令的说明" class="headerlink" title="比较指令的说明"></a>比较指令的说明</h3><ul>
<li><p>比较指令的作用是比较栈顶两个元素的大小，并将比较结果入栈。</p>
</li>
<li><p><strong>比较指令有：dcmpg, dcmpl、fcmpg、fcmpl、lcmp</strong>。</p>
<p>与前面讲解的指令类似，首字符d表示double类型，f表示float,l表示long。</p>
</li>
<li><p>对于double和float类型的数字，由于<strong>NaN</strong>的存在，各有两个版本的比较指令。以float为例，有fcmpg和fcmpl两个指令，它们的区别在于在数字比较时，若遇到<strong>NaN</strong>值，处理结果不同。</p>
</li>
<li><p>指令dcmpl和dcmpg也是类似的，根据其命名可以推测其含义，在此不再赘述。</p>
</li>
<li><p>指令lcmp针对long型整数，由于long型整数没有NaN值，故无需准备两套指令。</p>
</li>
</ul>
<p><strong>举例：</strong><br>指令fcmpg和fcmpl都从栈中弹出两个操作数，并将它们做比较，设栈顶的元素为v2,栈顶顺位第2位的元素为v1,若v1=v2,则压入0；若v1&gt;v2则压入1；若v1&lt;v2则压入-1。</p>
<p>两个指令的不同之处在于，如果遇到<strong>NaN</strong>值，fcmpg会压入1,而fcmpl会压入-1。</p>
<p>数值类型的数据，才可以谈大小！ （byte\short\char\int；long\float\double)</p>
<p>boolean、引用数据类型不能比较大小。</p>
<h2 id="6-3、类型转换指令"><a href="#6-3、类型转换指令" class="headerlink" title="6.3、类型转换指令"></a>6.3、类型转换指令</h2><p><strong>类型转换指令说明</strong></p>
<p>① 类型转换指令可以将两种不同的数值类型进行相互转换。<br>② 这些转换操作一般用于实现用户代码中的<strong>显式类型转换操作</strong>，或者用来处理<strong>字节码指令集中数据类型相关指令</strong>无法与<strong>数据类型</strong>一一对应的问题。</p>
<h3 id="宽化类型转换"><a href="#宽化类型转换" class="headerlink" title="宽化类型转换"></a>宽化类型转换</h3><p><strong>宽化类型转换（Widening Numeric Conversions）</strong></p>
<p><strong>1、转换规则</strong></p>
<p>Java虚拟机直接支持以下数值的宽化类型转换（widening numeric conversion，小范围类型向大范围类型的安全转换）。也就是说，并不需要指令执行，包括：</p>
<ul>
<li>从int类型到long、float或者double类型。对应的指令为：i2l、i2f、i2d</li>
<li>从long类型到float、double类型。对应的指令为：l2f、l2d</li>
<li>从float类型到double类型。对应的指令为：f2d</li>
</ul>
<p><strong>简化为：int –&gt; long –&gt; float –&gt; double</strong></p>
<p><strong>2、精度损失问题</strong></p>
<ul>
<li>宽化类型转换是不会因为超过目标类型最大值而丢失信息的，例如，从int转换到 long，或者从int转换到double，都不会丢失任何信息，转换前后的值是精确相等的。 </li>
<li>从int、long类型数值转换到float，或者long类型数值转换到double时，将可能发生精度丢失——可能丢失掉几个最低有效位上的值，转换后的浮点数值是根据IEEE754最接近舍入模式所得到的正确整数值。</li>
</ul>
<p>尽管宽化类型转换实际上是可能发生精度丢失的，但是这种转换永远不会导致Java虚拟机抛出运行时异常。 </p>
<p><strong>3、补充说明</strong></p>
<p><strong>从byte、char和short类型到int类型的宽化类型转换实际上是不存在的</strong>。对于byte类型转为int,虚拟机并没有做实质性的转化处理，只是简单地通过操作数栈交换了两个数据。而将byte转为long时，使用的是i2l,可以看到在内部byte在这里已经等同于int类型处理，类似的还有short类型，这种处理方式有两个特点：</p>
<p>一方面可以减少实际的数据类型，如果为short和byte都准备一套指令，那么指令的数量就会大增，而<strong>虚拟机目前的设计上，只愿意使用一个字节表示指令，因此指令总数不能超过256个，为了节省指令资源，将short和byte当做int处理也在情理之中</strong>。</p>
<p>另一方面，由于局部变量表中的槽位固定为32位，无论是byte或者short存入局部变量表，都会占用32位空间。从这个角度说，也没有必要特意区分这几种数据类型。</p>
<h3 id="窄化类型转换"><a href="#窄化类型转换" class="headerlink" title="窄化类型转换"></a>窄化类型转换</h3><p><strong>窄化类型转换（Narrowing Numeric Conversion）</strong></p>
<p><strong>1、转换规则</strong></p>
<p>Java虚拟机也直接支持以下<strong>窄化类型转换</strong>：</p>
<ul>
<li>从int类型至byte、short或者char类型。<strong>对应的指令有：i2b、i2s、i2c</strong></li>
<li>从long类型到int类型。<strong>对应的指令有：l2i</strong></li>
<li>从float类型到int或者long类型。<strong>对应的指令有：f2i、f2l</strong></li>
<li>从double类型到int、long或者float类型。<strong>对应的指令有：d2i、d2l、d2f</strong></li>
</ul>
<p><strong>2、精度损失问题</strong></p>
<p>窄化类型转换可能会导致转换结果具备不同的正负号、不同的数量级，因此，转换过程很可能会导致数值丢失精度。</p>
<p>尽管数据类型窄化转换可能会发生上限溢出、下限溢出和精度丢失等情况，但是Java虚拟机规范中明确规定数值类型的窄化转换指令永远不可能导致虚拟机抛出运行时异常</p>
<p><strong>3、补充说明</strong></p>
<p>3.1、 当将一个浮点值窄化转换为整数类型T（T限于int或long类型之一）的时候，将遵循以下转换规则：</p>
<ul>
<li>如果浮点值是<strong>NaN</strong>，那转换结果就是int或long类型的0。</li>
<li>如果浮点值不是无穷大的话，浮点值使用IEEE 754的向零舍入模式取整，获得整数值v，如果v在目标类型T（int或long）的表示范围之内，那转换结果就是v。否则，将根据v的符号，转换为T所能表示的最大或者最小正数。</li>
</ul>
<p>3.2、 当将一个 double 类型窄化转换为 float 类型时，将遵循以下转换规则：</p>
<p>通过向最接近数舍入模式舍入一个可以使用float类型表示的数字。最后结果根据下面这3条规则判断：</p>
<ul>
<li>如果转换结果的绝对值太小而无法使用 float来表示，将返回 float类型的正负零。</li>
<li>如果转换结果的绝对值太大而无法使用 float来表示，将返回 float类型的正负无穷大。</li>
<li>对于double 类型的 <strong>NaN</strong> 值将按规定转换为 float类型的 **NaN **值。</li>
</ul>
<h2 id="6-4、对象的创建与访问指令"><a href="#6-4、对象的创建与访问指令" class="headerlink" title="6.4、对象的创建与访问指令"></a>6.4、对象的创建与访问指令</h2><p>Java是面向对象的程序设计语言，虚拟机平台从字节码层面就对面向对象做了深层次的支持。有一系列指令专门用于对象操作，可进一步细分为创建指令、字段访问指令、数组操作指令、类型检查指令。</p>
<h3 id="创建指令"><a href="#创建指令" class="headerlink" title="创建指令"></a>创建指令</h3><p>虽然类实例和数组都是对象，但Java虚拟机对类实例和数组的创建与操作使用了不同的字节码指令：</p>
<p><strong>1、创建类实例的指令：</strong></p>
<ul>
<li>创建类实例的指令：new<br>它接收一个操作数，为指向常量池的索引，表示要创建的类型，执行完成后，将对象的引用压入栈。</li>
</ul>
<p><strong>2、创建数组的指令：</strong></p>
<ul>
<li><strong>创建数组的指令：newarray、anewarray、multianewarray</strong>。<ul>
<li>newarray：创建基本类型数组</li>
<li>anewarray：创建引用类型数组</li>
<li>multianewarray：创建多维数组</li>
</ul>
</li>
</ul>
<p>上述创建指令可以用于创建对象或者数组，由于对象和数组在Java中的广泛使用，这些指令的使用频率也非常高。</p>
<h3 id="字段访问指令"><a href="#字段访问指令" class="headerlink" title="字段访问指令"></a>字段访问指令</h3><p>对象创建后，就可以通过对象访问指令获取对象实例或数组实例中的字段或者数组元素。</p>
<ul>
<li><strong>访问类字段（static字段，或者称为类变量）的指令：getstatic、putstatic</strong></li>
<li><strong>访问类实例字段（非static字段，或者称为实例变量）的指令：getfield、putfield</strong></li>
</ul>
<p><strong>举例：</strong></p>
<p>以getstatic指令为例，它含有一个操作数，为指向常量池的Fieldref索引，它的作用就是获取Fieldref指定的对象或者值，并将其压入操作数栈。</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sayHello</span><span class="params">()</span> {</span><br><span class="line">    System.out.println(<span class="string">"hello"</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>对应的字节码指令：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">0 getstatic <span class="comment">#8 &lt;java/lang/System.out&gt;</span></span><br><span class="line">3 ldc <span class="comment">#9 &lt;hello&gt;</span></span><br><span class="line">5 invokevirtual <span class="comment">#10 &lt;java/io/PrintStream.println&gt;</span></span><br><span class="line">8 <span class="built_in">return</span></span><br></pre></td></tr></tbody></table></figure>

<p>图示：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/6759a2c15c403.webp" alt="image-20241211223337018"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/6759a2cb59f3f.webp" alt="image-20241211223347136"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/6759a2d28dd82.webp" alt="image-20241211223354330"></p>
<h3 id="数组操作指令"><a href="#数组操作指令" class="headerlink" title="数组操作指令"></a>数组操作指令</h3><p>数组操作指令主要有：xastore和xaload指令。具体为：</p>
<ul>
<li>把一个数组元素加载到操作数栈的指令：baload、caload、saload、iaload、laload、faload、daload、aaload</li>
<li>将一个操作数栈的值存储到数组元素中的指令：bastore、 castore、 sastore、iastore、 lastore、fastore、dastore、aastore</li>
</ul>
<p>即：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/6759a33c0cd35.webp" alt="image-20241211223539794"></p>
<ul>
<li>取数组长度的指令：arraylength<br>该指令弹出栈顶的数组元素，获取数组的长度，将长度压入栈。</li>
</ul>
<p><strong>说明:</strong></p>
<ul>
<li>指令xaload表示将数组的元素压栈，比如saload、caload分别表示压入short数组和char数组。指令xaload在执行时，要求操作数中栈顶元素为数组索引i,栈顶顺位第2个元素为数组引用a,该指令会弹岀栈顶这两个元素，并将a[i]重新压入栈。</li>
<li>xastore则专门针对数组操作，以iastore为例，它用于给一个int数组的给定索引赋值。在iastore执行前，操作数栈顶需要以此准备3个元素：值、索引、数组引用，iastore会弹出这3个值，并将值赋给数组中指定索引的位置。</li>
</ul>
<h3 id="类型检查指令"><a href="#类型检查指令" class="headerlink" title="类型检查指令"></a>类型检查指令</h3><p>检查类实例或数组类型的指令：instanceof、checkcast。</p>
<ul>
<li>指令checkcast用于检查类型强制转换是否可以进行。如果可以进行，那么checkcast指令不会改变操作数栈，否则它会抛出ClassCastException异常。</li>
<li>指令instanceof用来判断给定对象是否是某一个类的实例，它会将判断结果压入操作数栈。</li>
</ul>
<h2 id="6-5、方法调用与返回指令"><a href="#6-5、方法调用与返回指令" class="headerlink" title="6.5、方法调用与返回指令"></a>6.5、方法调用与返回指令</h2><h3 id="方法调用指令"><a href="#方法调用指令" class="headerlink" title="方法调用指令"></a><font color="red">方法调用指令</font></h3><p><strong>方法调用指令</strong>：invokevirtual、invokeinterface、invokespecial、invokestatic 、invokedynamic</p>
<p>以下5条指令用于方法调用：</p>
<ul>
<li>invokevirtual指令用于调用对象的实例方法，根据对象的实际类型进行分派（虚方法分派），支持多态。这也是Java语言中<strong>最常见的方法分派方式</strong>。</li>
<li>invokeinterface指令用于<strong>调用接口方法</strong>，它会在运行时搜索由特定对象所实现的这个接口方法，并找出适合的方法进行调用。</li>
<li>invokespecial指令用于调用一些需要特殊处理的实例方法，包括<strong>实例初始化方法（构造器）、私有方法和父类方法</strong>。这些方法都是<strong>静态类型绑定</strong>的，不会在调用时进行动态派发。</li>
<li>invokestatic指令用于调用命名类中的<strong>类方法（static方法）</strong>。这是<strong>静态绑定</strong>的。</li>
<li>invokedynamic：调用动态绑定的方法，这个是JDK 1.7后新加入的指令。用于在运行时动态解析出调用点限定符所引用的方法，并执行该方法。前面4条调用指令的分派逻辑都固化在 java 虚拟机内部，而 invokedynamic指令的分派逻辑是由用户所设定的引导方法决定的。</li>
</ul>
<p><strong>代码举例：</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.java1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Comparator;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> shkstart</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 14:47</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MethodInvokeTest</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="type">Father</span> <span class="variable">f</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Father</span>();</span><br><span class="line">        <span class="type">Son</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Son</span>();</span><br><span class="line">        System.out.println(f.getInfo());</span><br><span class="line">        System.out.println(s.getInfo());</span><br><span class="line"></span><br><span class="line">        Comparator&lt;Integer&gt; comparator = <span class="keyword">new</span> <span class="title class_">Comparator</span>&lt;Integer&gt;() {</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compare</span><span class="params">(Integer o1, Integer o2)</span> {</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            }</span><br><span class="line">        };</span><br><span class="line">        <span class="comment">//comparator = Integer::compare;</span></span><br><span class="line"></span><br><span class="line">        comparator.compare(<span class="number">12</span>,<span class="number">32</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Father</span> {</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">info</span> <span class="operator">=</span> <span class="string">"atguigu"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setInfo</span><span class="params">(String info)</span> {</span><br><span class="line">        <span class="built_in">this</span>.info = info;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getInfo</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> info;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Son</span> <span class="keyword">extends</span> <span class="title class_">Father</span> {</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">info</span> <span class="operator">=</span> <span class="string">"尚硅谷"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setInfo</span><span class="params">(String info)</span> {</span><br><span class="line">        <span class="built_in">this</span>.info = info;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getInfo</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> info;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="方法返回指令"><a href="#方法返回指令" class="headerlink" title="方法返回指令"></a>方法返回指令</h3><p>方法调用结束前，需要进行返回。方法返回指令是<strong>根据返回值的类型区分</strong>的。</p>
<ul>
<li>包括ireturn（当返回值是 boolean、byte、char、short和int 类型时使用）、lreturn、freturn、dreturn和areturn</li>
<li>另外还有一条return 指令供声明为 void的方法、实例初始化方法以及类和接口的类初始化方法使用。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/6759a4f32cc1f.webp" alt="image-20241211224257923"></p>
<p><strong>举例：</strong></p>
<p>通过ireturn指令,将当前函数操作数栈的顶层元素弹出，并将这个元素压入调用者函数的操作数栈中（因为调用者非常关心函数的返回值），所有在当前函数操作数栈中的其他元素都会被丢弃。</p>
<p>如果当前返回的是synchronized方法，那么还会执行一个隐含的monitorexit指令，退出临界区。</p>
<p>最后，会丢弃当前方法的整个帧，恢复调用者的帧，并将控制权转交给调用者。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/6759a524d85b2.webp" alt="image-20241211224348441"></p>
<p>对应的代码：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">methodReturn</span><span class="params">()</span>{</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">500</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">200</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">50</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (i + j) / k;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="6-6、操作数栈管理指令"><a href="#6-6、操作数栈管理指令" class="headerlink" title="6.6、操作数栈管理指令"></a>6.6、操作数栈管理指令</h2><p>如同操作一个普通数据结构中的堆栈那样，JVM提供的操作数栈管理指令，可以用于直接操作操作数栈的指令。</p>
<p>这类指令包括如下内容：</p>
<ul>
<li>将一个或两个元素从栈顶弹出，并且直接废弃： <strong>pop，pop2</strong>；</li>
<li>复制栈顶一个或两个数值并将复制值或双份的复制值重新压入栈顶： <strong>dup, dup2, dup_x1, dup2_x1, dup_x2, dup2_x2</strong>； </li>
<li>将栈最顶端的两个Slot数值位置交换： <strong>swap</strong>。Java虚拟机没有提供交换两个64位数据类型（long、double）数值的指令。</li>
<li>指令<strong>nop</strong>,是一个非常特殊的指令，它的字节码为<strong>0x00</strong>。和汇编语言中的nop一样，它表示什么都不做。这条指令一般可用于调试、占位等。</li>
</ul>
<p>这些指令属于通用型，对栈的压入或者弹出无需指明数据类型。</p>
<p><strong>说明：</strong> </p>
<ul>
<li>不带_x的指令是复制栈顶数据并压入栈顶。包括两个指令，dup和dup2。dup的系数代表要复制的Slot个数。<ul>
<li>dup开头的指令用于复制1个Slot的数据。例如1个int或1个reference类型数据</li>
<li>dup2开头的指令用于复制2个Slot的数据。例如1个long，或2个int，或1个int+1个float类型数据</li>
</ul>
</li>
<li>带_x的指令是复制栈顶数据并插入栈顶以下的某个位置。共有4个指令,dup_x1, dup2_x1, dup_x2, dup2_x2。对于带_x的复制插入指令，只要将指令的dup和x的系数相加，结果即为需要插入的位置。因此<ul>
<li>dup_x1插入位置：1+1=2，即栈顶2个Slot下面</li>
<li>dup_x2插入位置：1+2=3，即栈顶3个Slot下面</li>
<li>dup2_x1插入位置：2+1=3，即栈顶3个Slot下面</li>
<li>dup2_x2插入位置：2+2=4，即栈顶4个Slot下面</li>
</ul>
</li>
<li>pop：将栈顶的1个Slot数值出栈。例如1个short类型数值</li>
<li>pop2：将栈顶的2个Slot数值出栈。例如1个double类型数值，或者2个int类型数值</li>
</ul>
<h2 id="6-7、控制转移指令"><a href="#6-7、控制转移指令" class="headerlink" title="6.7、控制转移指令"></a>6.7、控制转移指令</h2><p>程序流程离不开条件控制，为了支持条件跳转，虚拟机提供了大量字节码指令，大体上可以分为：</p>
<ol>
<li>比较指令</li>
<li>条件跳转指令</li>
<li>比较条件跳转指令</li>
<li>多条件分支跳转指令</li>
<li>无条件跳转指令等。</li>
</ol>
<h3 id="条件跳转指令"><a href="#条件跳转指令" class="headerlink" title="条件跳转指令"></a>条件跳转指令</h3><p>条件跳转指令通常和比较指令结合使用。在条件跳转指令执行前，一般可以先用比较指令进行栈顶元素的准备，然后进行条件跳转。</p>
<p>条件跳转指令有： <strong>ifeq, iflt, ifle, ifne, ifgt, ifge</strong>, ifnull, ifnonnull。这些指令都接收两个字节的操作数，用于计算跳转的位置(16位符号整数作为当前位置的offset)。</p>
<p>它们的统一含义为：<strong>弹出栈顶元素，测试它是否满足某一条件，如果满足条件，则跳转到给定位置</strong>。</p>
<p><strong>具体说明：</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/6759a67296324.webp" alt="image-20241211224922347"></p>
<p><strong>注意：</strong></p>
<ol>
<li>与前面运算规则一致：</li>
</ol>
<ul>
<li>对于boolean、byte、char、short类型的条件分支比较操作，都是使用int类型的比较指令完成</li>
<li>对于long、float、double类型的条件分支比较操作，则会先执行相应类型的比较运算指令，运算指令会返回一个整型值到操作数栈中，随后再执行int类型的条件分支比较操作来完成整个分支跳转</li>
</ul>
<ol start="2">
<li>由于各类型的比较最终都会转为 int 类型的比较操作，所以Java虚拟机提供的int类型的条件分支指令是最为丰富和强大的。</li>
</ol>
<h3 id="比较条件跳转指令"><a href="#比较条件跳转指令" class="headerlink" title="比较条件跳转指令"></a>比较条件跳转指令</h3><p>比较条件跳转指令类似于比较指令和条件跳转指令的结合体，它将比较和跳转两个步骤合二为一。</p>
<p>这类指令有：<strong>if_icmpeq、if_icmpne、if_icmplt、if_icmpgt、if_icmple、if_icmpge</strong>、if_acmpeq和if_acmpne。其中指令助记符加上“if_”后，以字符“i”开头的指令针对int型整数操作(也包括short和byte类型)，以字符“a”开头的指令表示对象引用的比较。</p>
<p><strong>具体说明：</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/6759a70584a42.webp" alt="image-20241211225149306"></p>
<p>这些指令都接收两个字节的操作数作为参数，用于计算跳转的位置。同时在执行指令时，栈顶需要准备两个元素进行比较。指令执行完成后，栈顶的这两个元素被清空，且没有任何数据入栈。<strong>如果预设条件成立，则执行跳转，否则，继续执行下一条语句</strong>。</p>
<h3 id="多条件分支跳转指令"><a href="#多条件分支跳转指令" class="headerlink" title="多条件分支跳转指令"></a>多条件分支跳转指令</h3><p>多条件分支跳转指令是专为switch-case语句设计的，主要有tableswitch和lookupswitch。 </p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/6759a73b8ccb1.webp" alt="image-20241211225243375"></p>
<p>从助记符上看，两者都是switch语句的实现，它们的区别:</p>
<ul>
<li>tableswitch要求<strong>多个条件分支值是连续的</strong>，它内部只存放起始值和终止值，以及若干个跳转偏移量，通过给定的操作数index, 可以立即定位到跳转偏移量位置，<strong>因此效率比较高</strong>。</li>
<li>指令lookupswitch内部<strong>存放着各个离散的case-offset对</strong>，每次执行都要搜索全部的case-offset对，找到匹配的case值，并根据对应的offset计算跳转地址，<strong>因此效率较低</strong>。</li>
</ul>
<p>指令tableswitch的示意图如下图所示。由于tableswitch的case值是连续的，因此只需要记录最低值和最高值，以及每一项对应的offset偏移量，根据给定的index值通过简单的计算即可直接定位到offset。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/6759a77ac3050.webp" alt="image-20241211225346455"></p>
<p>指令lookupswitch处理的是离散的case值，但是出于效率考虑，<strong>将case-offset对按照case 值大小排序</strong>，给定index时，需要査找与index相等的case,获得其offset,如果找不到则跳转到default。指令lookupswitch 如下图所示。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/6759a7932be34.webp" alt="image-20241211225410762"></p>
<h3 id="无条件跳转指令"><a href="#无条件跳转指令" class="headerlink" title="无条件跳转指令"></a>无条件跳转指令</h3><p>目前主要的无条件跳转指令为<strong>goto</strong>。指令goto接收两个字节的操作数，共同组成一个带符号的整数，<strong>用于指定指令的偏移量，指令执行的目的就是跳转到偏移量给定的位置处</strong>。</p>
<p>如果指令偏移量太大，超过双字节的带符号整数的范围，则可以使用指令goto_w,它和goto有相同的作用，但是它接收4个字节的操作数，可以表示更大的地址范围。</p>
<p>指令jsr、jsr_w、ret虽然也是无条件跳转的，但主要用于 try-finally语句，且已经被虚拟机逐渐废弃，故不在这里介绍这两个指令。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/6759a7d108f7f.webp" alt="image-20241211225512720"></p>
<h2 id="6-8、异常处理指令"><a href="#6-8、异常处理指令" class="headerlink" title="6.8、异常处理指令"></a>6.8、异常处理指令</h2><h3 id="抛出异常指令"><a href="#抛出异常指令" class="headerlink" title="抛出异常指令"></a>抛出异常指令</h3><p><strong>(1) athrow指令</strong></p>
<p>在Java程序中显示抛出异常的操作（throw语句）都是由athrow指令来实现。</p>
<p>除了使用throw语句显示抛出异常情况之外，<strong>JVM规范还规定了许多运行时异常会在其他Java虚拟机指令检测到异常状况时自动抛出</strong>。例如，在之前介绍的整数运算时，当除数为零时，虚拟机会在 idiv或 ldiv指令中抛出 ArithmeticException异常。</p>
<p><strong>(2) 注意</strong><br>正常情况下，操作数栈的压入弹出都是一条条指令完成的。唯一的例外情况是<strong>在抛异常时，Java 虚拟机会清除操作数栈上的所有内容，而后将异常实例压入调用者操作数栈上</strong>。</p>
<p><strong>异常及异常的处理：</strong><br>过程一：异常对象的生成过程 —&gt; throw (手动 / 自动)   —&gt; 指令：athrow<br>过程二：异常的处理：抓抛模型。 try-catch-finally     —&gt; 使用异常表</p>
<h3 id="异常处理与异常"><a href="#异常处理与异常" class="headerlink" title="异常处理与异常"></a>异常处理与异常</h3><p><strong>1、处理异常：</strong></p>
<p>在Java虚拟机中，<strong>处理异常</strong>（catch语句）不是由字节码指令来实现的（早期使用jsr、ret指令），而是<strong>采用异常表来完成的</strong>。</p>
<p><strong>2、异常表</strong></p>
<p>如果一个方法定义了一个try-catch 或者try-finally的异常处理，就会创建一个异常表。它包含了每个异常处理或者finally块的信息。异常表保存了每个异常处理信息。比如：</p>
<ul>
<li>起始位置</li>
<li>结束位置</li>
<li>程序计数器记录的代码处理的偏移地址</li>
<li>被捕获的异常类在常量池中的索引</li>
</ul>
<p><strong>当一个异常被抛出时，JVM会在当前的方法里寻找一个匹配的处理，如果没有找到，这个方法会强制结束并弹出当前栈帧</strong>，并且异常会重新抛给上层调用的方法(在调用方法栈帧)。如果在所有栈帧弹出前仍然没有找到合适的异常处理，这个线程将终止。如果这个异常在最后一个非守护线程里抛出，将会导致JVM自己终止，比如这个线程是个main线程。</p>
<p><strong>不管什么时候抛出异常，如果异常处理最终匹配了所有异常类型，代码就会继续执行</strong>。在这种情况下，如果方法结束后没有抛出异常，仍然执行finally块，在return前，它直接跳到finally块来完成目标</p>
<h2 id="6-9、同步控制指令"><a href="#6-9、同步控制指令" class="headerlink" title="6.9、同步控制指令"></a>6.9、同步控制指令</h2><p>java虚拟机支持两种同步结构：<strong>方法级的同步</strong> 和 <strong>方法内部一段指令序列的同步</strong>，这两种同步都是使用monitor来支持的。</p>
<h3 id="方法级的同步"><a href="#方法级的同步" class="headerlink" title="方法级的同步"></a>方法级的同步</h3><p> 方法级的同步：<strong>是隐式的</strong>， 即无须通过字节码指令来控制，它实现在方法调用和返回操作之中。虚拟机可以从方法常量池的方法表结构中的 <strong>ACC_SYNCHRONIZED</strong> 访问标志得知一个方法是否声明为同步方法；</p>
<p>当调用方法时，调用指令将会检查方法的<strong>ACC_SYNCHRONIZED</strong>访问标志是否设置。</p>
<ul>
<li>如果设置了，执行线程将先持有同步锁，然后执行方法。<strong>最后</strong>在方法完成（无论是正常完成还是非正常完成）时<strong>释放同步锁</strong>。</li>
<li>在方法执行期间，执行线程持有了同步锁，其他任何线程都无法再获得同一个锁。</li>
<li>如果一个同步方法执行期间抛出了异常，并且在方法内部无法处理此异常，那这个同步方法所持有的锁将在异常抛到同步方法之外时自动释放。</li>
</ul>
<p><strong>举例：</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">()</span>{</span><br><span class="line">    i++;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>对应的字节码：</p>
 <figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">0 aload_0</span><br><span class="line">1 dup</span><br><span class="line">2 getfield <span class="comment">#2 &lt;com/atguigu/java1/SynchronizedTest.i&gt;</span></span><br><span class="line">5 iconst_1</span><br><span class="line">6 iadd</span><br><span class="line">7 putfield <span class="comment">#2 &lt;com/atguigu/java1/SynchronizedTest.i&gt;</span></span><br><span class="line">10 <span class="built_in">return</span></span><br></pre></td></tr></tbody></table></figure>

<p><strong>说明：</strong></p>
<p>这段代码和普通的无同步操作的代码没有什么不同，没有使用monitorenter和monitorexit进行同步区控制。这是因为，对于同步方法而言，<strong>当虚拟机通过方法的访问标示符判断是一个同步方法时，会自动在方法调用前进行加锁</strong>，当同步方法执行完毕后，不管方法是正常结束还是有异常抛岀，均会由虚拟机释放这个锁。因此，对于同步方法而言，monitorenter 和monitorexit指令是隐式存在的，并未直接出现在字节码中。</p>
<h3 id="方法内指定指令序列的同步"><a href="#方法内指定指令序列的同步" class="headerlink" title="方法内指定指令序列的同步"></a>方法内指定指令序列的同步</h3><p>同步一段指令集序列：通常是由java中的synchronized语句块来表示的。jvm的指令集有 monitorenter 和 monitorexit 两条指令来支持 synchronized关键字的语义。</p>
<p>当一个线程进入同步代码块时，它使用monitorenter指令请求进入。如果当前对象的监视器计数器为0,则它会被准许进入，若为1,则判断持有当前监视器的线程是否为自己，如果是，则进入，否则进行等待，直到对象的监视器计数器为0,才会被允许进入同步块。</p>
<p>当线程退岀同步块时，需要使用monitorexit声明退出。在Java虚拟机中，任何对象都有一个监视器与之相关联，用来判断对象是否被锁定，当监视器被持有后，对象处于锁定状态。</p>
<p>指令monitorenter和monitorexit在执行时，都需要在操作数栈顶压入对象,之后monitorenter和monitorexit的锁定和释放都是针对这个对象的监视器进行的。</p>
<p>下图展示了监视器如何保护临界区代码不同时被多个线程访问，只有当线程4离开临界区后，线程1、2、3才有可能进入。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/6759a9f4d539d.webp" alt="image-20241211230420455"></p>
<p><strong>举例：</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">subtract</span><span class="params">()</span>{</span><br><span class="line">    <span class="keyword">synchronized</span> (<span class="built_in">this</span>){</span><br><span class="line">        i--;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>对应的字节码：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">0: aload_0</span><br><span class="line">1: dup</span><br><span class="line">2: astore_1</span><br><span class="line">3: monitorenter</span><br><span class="line">4: aload_0</span><br><span class="line">5: dup</span><br><span class="line">6: getfield      <span class="comment">#2                  // Field i:I</span></span><br><span class="line">9: iconst_1</span><br><span class="line">10: isub</span><br><span class="line">11: putfield      <span class="comment">#2                  // Field i:I</span></span><br><span class="line">14: aload_1</span><br><span class="line">15: monitorexit</span><br><span class="line">16: goto          24</span><br><span class="line">19: astore_2</span><br><span class="line">20: aload_1</span><br><span class="line">21: monitorexit</span><br><span class="line">22: aload_2</span><br><span class="line">23: athrow</span><br><span class="line">24: <span class="built_in">return</span></span><br><span class="line">Exception table:</span><br><span class="line">from    to  target <span class="built_in">type</span></span><br><span class="line">4    16    19   any</span><br><span class="line">19    22    19   any</span><br></pre></td></tr></tbody></table></figure>

<p>编译器必须确保无论方法通过何种方式完成，方法中调用过的每条monitorenter指令都必须执行其对应的monitorexit指令，而无论这个方法是正常结束还是异常结束。</p>
<p>为了保证在方法异常完成时monitorenter和monitorexit指令依然可以正确配对执行，<strong>编译器会自动产生一个异常处理器，这个异常处理器声明可处理所有的异常</strong>，它的目的就是用来执行monitorexit指令</p>
<h1 id="面试题"><a href="#面试题" class="headerlink" title="面试题"></a>面试题</h1><p><strong>int a = 1;JVM如何取得a的值（圆通）</strong></p>
<p><strong>Integer x = 5;int y = 5;比较 x == y 都经过哪些步骤？（百度）</strong></p>
<p><strong>Java虚拟机中，数据类型可以分为哪几类？  (阿里)</strong></p>
<ol>
<li><p>Java虚拟机是通过某些数据类型来执行计算的，数据类型可以分为两种：<strong>基本类型和引用类型</strong>，基本类型的变量持有原始值，而引用类型的变量持有引用值。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/11/6759aa9f233ef.webp" alt="image-20241211230709880"></p>
</li>
<li><p>Java语言中的所有基本类型同样也都是Java虚拟机中的基本类型。但是boolean有点特别，虽然Java虚拟机也把boolean看做基本类型，但是指令集对boolean只有很有限的支持，当编译器把Java源代码编译为字节码时，它会用int或者byte来表示boolean。在Java虚拟机中，false是由整数零来表示的，所有非零整数都表示true，涉及<strong>boolean值的操作则会使用int</strong>。另外，<strong>boolean数组是当做byte数组来访问的</strong>。</p>
</li>
<li><p>Java虚拟机还有一个只在内部使用的基本类型：<strong>returnAddress</strong>，Java程序员不能使用这个类型，<strong>这个基本类型被用来实现Java程序中的finally子句</strong>。该类型是<strong>jsr, ret以及jsr_w指令</strong>需要使用到的，它的值是JVM指令的操作码的指针。returnAddress类型不是简单意义上的数值，不属于任何一种基本类型，并且它的值是不能被运行中的程序所修改的。</p>
</li>
<li><p>Java虚拟机的引用类型被统称为“引用（reference）”，有三种引用类型：<strong>类类型、接口类型、以及数组类型</strong>，它们的值都是对动态创建对象的引用。类类型的值是对类实例的引用；数组类型的值是对数组对象的引用，在Java虚拟机中，数组是个真正的对象；<strong>而接口类型的值，则是对实现了该接口的某个类实例的引用</strong>。还有<strong>一种特殊的引用值是null，它表示该引用变量没有引用任何对象</strong>。</p>
</li>
</ol>
<p><strong>为什么不把基本类型放堆中呢？  (阿里)</strong></p>
<p>首先是栈、堆的特点不同。（堆比栈要大，但是栈比堆的运算速度要快。）</p>
<p>将复杂数据类型放在堆中的目的是为了不影响栈的效率，而是通过引用的方式去堆中查找。（八大基本类型的大小创建时候已经确立大小。三大引用类型创建时候无法确定大小）</p>
<p>简单数据类型比较稳定，并且它只占据很小的内存，将它放在空间小、运算速度快的栈中，能够提高效率。</p>
<p><strong>Java中的参数传递是传值呢？还是传引用？ (阿里)</strong></p>
<p><strong>Java中有没有指针的概念？  (阿里)</strong></p>
<p>指针具有您可能（或可能不会）通常使用的额外操作；引用缺少这些操作，因为这些操作可能不安全。例如，如果您使用指针来索引数组的第一个元素，如下所示：int squares[] = {1, 4, 9, 16, 25, 36, 49};int* intPointer = squares;您可能想要取消引用指针并获取值“ 1”。还可以继续intPointer++获得值“4”，intPointer++获得值“9”。这是因为++操作将指针在内存中向前移动了一个“单位”。指针将一个地址存储在内存中，并且++操作将适当数量的字节添加到该地址。在许多系统上，int会加四个字节，但是如果指针是char指针，则只能加一个字节。由于指针的基础数据类型是内存中的地址，因此以下内容是合法的（但不建议这样做）：char* charPointer = squares;charPointer++;void* voidPointer = squares;voidPointer++。</p>
</div></article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/avatar.png" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/avatar.png" title="头像" alt="头像"></a><div class="post-copyright__author_name">時光</div><div class="post-copyright__author_desc">心寄朗朗乾坤，胸怀真修之道。</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="https://blog.shiguang666.eu.org/2024/12/11/0a6035f3745c/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('https://blog.shiguang666.eu.org/2024/12/11/0a6035f3745c/')">【尚硅谷】JVM-字节码篇</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="/img/wechat.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/wechat.png" alt="微信"></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/alipay.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/alipay.png" alt="支付宝"></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://blog.shiguang666.eu.org/2024/12/11/0a6035f3745c/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=【尚硅谷】JVM-字节码篇&amp;url=https://blog.shiguang666.eu.org/2024/12/11/0a6035f3745c/&amp;pic=https://img.shiguangdev.cn/i/2024/08/28/66cedaf5d014a.jpeg" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://blog.shiguang666.eu.org" target="_blank">時光</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/JAVA/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>JAVA<span class="tagsPageCount">13</span></a><a class="post-meta__box__tags" href="/tags/%E5%B0%9A%E7%A1%85%E8%B0%B7/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>尚硅谷<span class="tagsPageCount">42</span></a><a class="post-meta__box__tags" href="/tags/JVM/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>JVM<span class="tagsPageCount">2</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://img.shiguangdev.cn/i/2024/12/09/6756ee980378a.webp" data-sites="wechat,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/12/09/68b16c939c95/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/09/6756ee980378a.webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">【智能协同云图库】2-项目初始化</div></div></a></div><div class="next-post pull-right"><a href="/2024/12/12/60bae9f9d9cc/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/08/28/66cedaf5d014a.jpeg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">【尚硅谷】JVM-类的加载篇</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/2024/12/12/60bae9f9d9cc/" title="【尚硅谷】JVM-类的加载篇"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/08/28/66cedaf5d014a.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-12-12</div><div class="title">【尚硅谷】JVM-类的加载篇</div></div></a></div><div><a href="/2024/09/17/56a6db38519d/" title="【尚硅谷】JAVA基础-IO流"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/08/28/66cedaf5d014a.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-09-17</div><div class="title">【尚硅谷】JAVA基础-IO流</div></div></a></div><div><a href="/2024/09/16/a32606420cb2/" title="【尚硅谷】JAVA基础-API"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/08/28/66cedaf5d014a.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-09-16</div><div class="title">【尚硅谷】JAVA基础-API</div></div></a></div><div><a href="/2024/09/17/ef5bcf52c331/" title="【尚硅谷】JAVA基础-JDK新特性"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/08/28/66cedaf5d014a.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-09-17</div><div class="title">【尚硅谷】JAVA基础-JDK新特性</div></div></a></div><div><a href="/2024/09/16/277ab91cb5a0/" title="【尚硅谷】JAVA基础-多线程"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/08/28/66cedaf5d014a.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-09-16</div><div class="title">【尚硅谷】JAVA基础-多线程</div></div></a></div><div><a href="/2024/09/16/fadbedc8dc87/" title="【尚硅谷】JAVA基础-异常&amp;Object"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/08/28/66cedaf5d014a.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-09-16</div><div class="title">【尚硅谷】JAVA基础-异常&amp;Object</div></div></a></div></div></div><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)" style="display: none">匿名评论</a><a href="/privacy" style="margin-left: 4px">隐私政策</a></div><div class="comment-tips" id="comment-tips"><span>✅ 你无需删除空行，直接评论以获取最佳展示效果</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://emotion.acs.pw/emotion/Heo/送福.png" alt="status"></div></div><div class="author-info__description">代码成就万事基积沙镇海,<br>梦想永在凌云意意气风发。</div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">時光</h1><div class="author-info__desc">心寄朗朗乾坤，胸怀真修之道。</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/shiguang-coding" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a></div></div></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bullhorn anzhiyu-shake"></i><span>公告</span></div><div class="announcement_content"><span>🌟欢迎光临時光的博客园子🌟</span><br> <span><a target="_blank" rel="noopener" href="https://blog.shiguangdev.cn"><b>blog.shiguangdev.cn</b></a></span><br> <span><a target="_blank" rel="noopener" href="https://blog.shiguang88.icu"><b>blog.shiguang88.icu</b></a></span><br> <span><a href="https://blog.shiguang666.eu.org"><b>blog.shiguang666.eu.org</b></a></span><br> <span>🤔 如有问题欢迎评论区交流！</span><br> <span>📧 如需联系我：<a href="mailto:an_shiguang@163.com"><b>发送邮件🚀</b></a></span> <div id="welcome-info"></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1%E3%80%81JVM%E6%A6%82%E8%BF%B0"><span class="toc-number">1.</span> <span class="toc-text">1、JVM概述</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1%E3%80%81Java%E8%AF%AD%E8%A8%80%E5%8F%8AJava%E7%94%9F%E6%80%81%E5%9C%88"><span class="toc-number">1.1.</span> <span class="toc-text">1.1、Java语言及Java生态圈</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Oracle-JDK%E4%B8%8EOpen-JDK%E4%BB%80%E4%B9%88%E5%85%B3%E7%B3%BB%EF%BC%9F"><span class="toc-number">1.1.1.</span> <span class="toc-text">Oracle JDK与Open JDK什么关系？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JDK%E4%B8%8EJVM%E6%98%AF%E4%BB%80%E4%B9%88%E5%85%B3%E7%B3%BB%EF%BC%9F"><span class="toc-number">1.1.2.</span> <span class="toc-text">JDK与JVM是什么关系？</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E7%90%86%E8%A7%A3Java%E6%98%AF%E8%B7%A8%E5%B9%B3%E5%8F%B0%E7%9A%84%E8%AF%AD%E8%A8%80%EF%BC%9F"><span class="toc-number">1.1.2.1.</span> <span class="toc-text">如何理解Java是跨平台的语言？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E7%90%86%E8%A7%A3JVM%E8%B7%A8%E8%AF%AD%E8%A8%80%E7%9A%84%E5%B9%B3%E5%8F%B0%EF%BC%9F"><span class="toc-number">1.1.2.2.</span> <span class="toc-text">如何理解JVM跨语言的平台？</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Java%E4%B8%8D%E5%AD%98%E5%9C%A8%E5%86%85%E5%AD%98%E6%BA%A2%E5%87%BA%EF%BC%9F%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F%EF%BC%9F"><span class="toc-number">1.1.3.</span> <span class="toc-text">Java不存在内存溢出？内存泄漏？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Java%E5%8F%91%E5%B1%95%E7%9A%84%E5%87%A0%E4%B8%AA%E9%87%8D%E5%A4%A7%E4%BA%8B%E4%BB%B6%EF%BC%9F"><span class="toc-number">1.1.4.</span> <span class="toc-text">Java发展的几个重大事件？</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%B4%E8%AF%B4%E4%BD%A0%E8%AE%A4%E8%AF%86%E7%9A%84JVM%EF%BC%9F"><span class="toc-number">1.1.4.1.</span> <span class="toc-text">说说你认识的JVM？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#JVM%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%EF%BC%9F"><span class="toc-number">1.1.4.2.</span> <span class="toc-text">JVM的生命周期？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%87%8D%E7%82%B9%E8%AF%B4%E4%B8%8BHotSpot%EF%BC%9F"><span class="toc-number">1.1.4.3.</span> <span class="toc-text">重点说下HotSpot？</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2%E3%80%81JVM%E7%9A%84%E6%9E%B6%E6%9E%84%E4%B8%8E%E7%9F%A5%E8%AF%86%E8%84%89%E7%BB%9C%E5%9B%BE"><span class="toc-number">1.2.</span> <span class="toc-text">1.2、JVM的架构与知识脉络图</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%83%BD%E5%90%A6%E7%94%BB%E5%87%BAJVM%E6%9E%B6%E6%9E%84%E5%9B%BE%EF%BC%9F"><span class="toc-number">1.2.1.</span> <span class="toc-text">能否画出JVM架构图？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JVM%E6%9C%89%E5%93%AA%E5%87%A0%E5%9D%97%E7%9F%A5%E8%AF%86%E8%84%89%E7%BB%9C%EF%BC%9F"><span class="toc-number">1.2.2.</span> <span class="toc-text">JVM有哪几块知识脉络？</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2%E3%80%81%E5%AD%97%E8%8A%82%E7%A0%81%E6%96%87%E4%BB%B6%E6%A6%82%E8%BF%B0"><span class="toc-number">2.</span> <span class="toc-text">2、字节码文件概述</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1%E3%80%81%E5%AD%97%E8%8A%82%E7%A0%81%E6%96%87%E4%BB%B6%E6%98%AF%E8%B7%A8%E5%B9%B3%E5%8F%B0%E7%9A%84%E5%90%97%EF%BC%9F"><span class="toc-number">2.1.</span> <span class="toc-text">2.1、字节码文件是跨平台的吗？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#class%E6%96%87%E4%BB%B6%E9%87%8C%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-number">2.1.1.</span> <span class="toc-text">class文件里是什么？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%83%BD%E4%BB%8B%E7%BB%8D%E4%B8%8B%E7%94%9F%E6%88%90class%E6%96%87%E4%BB%B6%E7%9A%84%E7%BC%96%E8%AF%91%E5%99%A8%E5%90%97%EF%BC%9F"><span class="toc-number">2.1.2.</span> <span class="toc-text">能介绍下生成class文件的编译器吗？</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E7%BC%96%E8%AF%91%E5%99%A8%E4%B8%8E%E5%90%8E%E7%AB%AF%E7%BC%96%E8%AF%91%E5%99%A8"><span class="toc-number">2.1.2.1.</span> <span class="toc-text">前端编译器与后端编译器</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E7%BC%96%E8%AF%91%E5%99%A8%EF%BC%88Front-End-Compiler%EF%BC%89"><span class="toc-number">2.1.2.1.1.</span> <span class="toc-text">前端编译器（Front-End Compiler）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF%E7%BC%96%E8%AF%91%E5%99%A8%EF%BC%88Back-End-Compiler%EF%BC%89"><span class="toc-number">2.1.2.1.2.</span> <span class="toc-text">后端编译器（Back-End Compiler）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E4%B8%8E%E5%90%8E%E7%AB%AF%E7%9A%84%E5%8D%8F%E5%90%8C%E5%B7%A5%E4%BD%9C"><span class="toc-number">2.1.2.1.3.</span> <span class="toc-text">前端与后端的协同工作</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%BE%E4%BE%8B"><span class="toc-number">2.1.2.1.4.</span> <span class="toc-text">举例</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">2.1.2.1.5.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E7%BC%96%E8%AF%91%E5%99%A8%E7%9A%84%E7%A7%8D%E7%B1%BB"><span class="toc-number">2.1.2.2.</span> <span class="toc-text">前端编译器的种类</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#javac%E7%BC%96%E8%AF%91%E5%99%A8%E7%9A%84%E7%BC%96%E8%AF%91%E6%AD%A5%E9%AA%A4%EF%BC%9F"><span class="toc-number">2.1.3.</span> <span class="toc-text">javac编译器的编译步骤？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%AE%E5%89%8D%E5%89%8D%E7%AB%AF%E7%BC%96%E8%AF%91%E5%99%A8%E7%9A%84%E5%B1%80%E9%99%90%E6%80%A7%EF%BC%9F"><span class="toc-number">2.1.4.</span> <span class="toc-text">目前前端编译器的局限性？</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2%E3%80%81%E5%93%AA%E4%BA%9B%E7%B1%BB%E5%9E%8B%E5%AF%B9%E5%BA%94%E6%9C%89Class%E7%9A%84%E5%AF%B9%E8%B1%A1%EF%BC%9F"><span class="toc-number">2.2.</span> <span class="toc-text">2.2、哪些类型对应有Class的对象？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3%E3%80%81%E5%AD%97%E8%8A%82%E7%A0%81%E6%8C%87%E4%BB%A4"><span class="toc-number">2.3.</span> <span class="toc-text">2.3、字节码指令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%AD%97%E8%8A%82%E7%A0%81%E6%8C%87%E4%BB%A4-byte-code-%EF%BC%9F"><span class="toc-number">2.3.1.</span> <span class="toc-text">什么是字节码指令(byte code)？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E6%87%82%E5%AD%97%E8%8A%82%E7%A0%81%E6%8C%87%E4%BB%A4%EF%BC%9F"><span class="toc-number">2.3.2.</span> <span class="toc-text">为什么要懂字节码指令？</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4%E3%80%81%E5%A6%82%E4%BD%95%E8%A7%A3%E8%AF%BBclass%E6%96%87%E4%BB%B6%EF%BC%9F"><span class="toc-number">2.4.</span> <span class="toc-text">2.4、如何解读class文件？</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3%E3%80%81Class%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84%E7%BB%86%E8%8A%82"><span class="toc-number">3.</span> <span class="toc-text">3、Class文件结构细节</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1%E3%80%81class%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84%E7%BB%86%E8%8A%82%E6%A6%82%E8%BF%B0"><span class="toc-number">3.1.</span> <span class="toc-text">3.1、class文件结构细节概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2%E3%80%81class%E6%96%87%E4%BB%B6%E7%9A%84%E9%AD%94%E6%95%B0%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-number">3.2.</span> <span class="toc-text">3.2、class文件的魔数是什么？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3%E3%80%81%E5%A6%82%E4%BD%95%E7%A1%AE%E4%BF%9D%E9%AB%98%E7%89%88%E6%9C%AC%E7%9A%84JVM%E5%8F%AF%E6%89%A7%E8%A1%8C%E4%BD%8E%E7%89%88%E6%9C%AC%E7%9A%84class%E6%96%87%E4%BB%B6%EF%BC%9F"><span class="toc-number">3.3.</span> <span class="toc-text">3.3、如何确保高版本的JVM可执行低版本的class文件？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-4%E3%80%81%E5%B8%B8%E9%87%8F%E6%B1%A0%EF%BC%9Aclass%E6%96%87%E4%BB%B6%E7%9A%84%E5%9F%BA%E7%9F%B3%EF%BC%9F%E4%BD%9C%E7%94%A8%E6%98%AF%EF%BC%9F"><span class="toc-number">3.4.</span> <span class="toc-text">3.4、常量池：class文件的基石？作用是？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E5%B8%B8%E9%87%8F%E6%B1%A0%E8%AE%A1%E6%95%B0%E5%99%A8%EF%BC%9F"><span class="toc-number">3.4.1.</span> <span class="toc-text">为什么需要常量池计数器？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E9%87%8F%E6%B1%A0%E8%A1%A8"><span class="toc-number">3.4.2.</span> <span class="toc-text">常量池表</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%97%E9%9D%A2%E9%87%8F%E5%92%8C%E7%AC%A6%E5%8F%B7%E5%BC%95%E7%94%A8"><span class="toc-number">3.4.2.1.</span> <span class="toc-text">字面量和符号引用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E9%87%8F%E7%B1%BB%E5%9E%8B%E5%92%8C%E7%BB%93%E6%9E%84"><span class="toc-number">3.4.2.2.</span> <span class="toc-text">常量类型和结构</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-5%E3%80%81%E8%AE%BF%E9%97%AE%E6%A0%87%E8%AF%86"><span class="toc-number">3.5.</span> <span class="toc-text">3.5、访问标识</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-6%E3%80%81%E7%B1%BB%E7%B4%A2%E5%BC%95%E3%80%81%E7%88%B6%E7%B1%BB%E7%B4%A2%E5%BC%95%E3%80%81%E6%8E%A5%E5%8F%A3%E7%B4%A2%E5%BC%95%E9%9B%86%E5%90%88"><span class="toc-number">3.6.</span> <span class="toc-text">3.6、类索引、父类索引、接口索引集合</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-7%E3%80%81%E5%AD%97%E6%AE%B5%E8%A1%A8%E9%9B%86%E5%90%88"><span class="toc-number">3.7.</span> <span class="toc-text">3.7、字段表集合</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%97%E6%AE%B5%E8%AE%A1%E6%95%B0%E5%99%A8"><span class="toc-number">3.7.1.</span> <span class="toc-text">字段计数器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%97%E6%AE%B5%E8%A1%A8"><span class="toc-number">3.7.2.</span> <span class="toc-text">字段表</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-8%E3%80%81%E6%96%B9%E6%B3%95%E8%A1%A8%E9%9B%86%E5%90%88"><span class="toc-number">3.8.</span> <span class="toc-text">3.8、方法表集合</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E8%AE%A1%E6%95%B0%E5%99%A8"><span class="toc-number">3.8.1.</span> <span class="toc-text">方法计数器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E8%A1%A8"><span class="toc-number">3.8.2.</span> <span class="toc-text">方法表</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-9%E3%80%81%E5%B1%9E%E6%80%A7%E8%A1%A8%E9%9B%86%E5%90%88"><span class="toc-number">3.9.</span> <span class="toc-text">3.9、属性表集合</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B1%9E%E6%80%A7%E8%AE%A1%E6%95%B0%E5%99%A8"><span class="toc-number">3.9.1.</span> <span class="toc-text">属性计数器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B1%9E%E6%80%A7%E8%A1%A8"><span class="toc-number">3.9.2.</span> <span class="toc-text">属性表</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A0-ConstantValue-%E5%B1%9E%E6%80%A7"><span class="toc-number">3.9.2.1.</span> <span class="toc-text">① ConstantValue 属性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A1-Deprecated-%E5%B1%9E%E6%80%A7"><span class="toc-number">3.9.2.2.</span> <span class="toc-text">② Deprecated 属性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A2-Code-%E5%B1%9E%E6%80%A7"><span class="toc-number">3.9.2.3.</span> <span class="toc-text">③ Code 属性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A3-InnerClasses-%E5%B1%9E%E6%80%A7"><span class="toc-number">3.9.2.4.</span> <span class="toc-text">④ InnerClasses 属性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A4-LineNumberTable-%E5%B1%9E%E6%80%A7"><span class="toc-number">3.9.2.5.</span> <span class="toc-text">⑤ LineNumberTable 属性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A5-LocalVariableTable-%E5%B1%9E%E6%80%A7"><span class="toc-number">3.9.2.6.</span> <span class="toc-text">⑥ LocalVariableTable 属性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A6-Signature-%E5%B1%9E%E6%80%A7"><span class="toc-number">3.9.2.7.</span> <span class="toc-text">⑦ Signature 属性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A7-SourceFile%E5%B1%9E%E6%80%A7"><span class="toc-number">3.9.2.8.</span> <span class="toc-text">⑧ SourceFile属性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A8-%E5%85%B6%E4%BB%96%E5%B1%9E%E6%80%A7"><span class="toc-number">3.9.2.9.</span> <span class="toc-text">⑨ 其他属性</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-10%E3%80%81%E5%B0%8F%E7%BB%93"><span class="toc-number">3.10.</span> <span class="toc-text">3.10、小结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4%E3%80%81oracle%E5%AE%98%E6%96%B9%E7%9A%84%E5%8F%8D%E8%A7%A3%E6%9E%90%E5%B7%A5%E5%85%B7%EF%BC%9Ajavap"><span class="toc-number">4.</span> <span class="toc-text">4、oracle官方的反解析工具：javap</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1%E3%80%81%E8%A7%A3%E6%9E%90%E5%AD%97%E8%8A%82%E7%A0%81%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="toc-number">4.1.</span> <span class="toc-text">4.1、解析字节码的作用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2%E3%80%81javac-g%E6%93%8D%E4%BD%9C"><span class="toc-number">4.2.</span> <span class="toc-text">4.2、javac -g操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-3%E3%80%81javap%E7%9A%84%E7%94%A8%E6%B3%95"><span class="toc-number">4.3.</span> <span class="toc-text">4.3、javap的用法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-4%E3%80%81%E4%BD%BF%E7%94%A8%E4%B8%BE%E4%BE%8B"><span class="toc-number">4.4.</span> <span class="toc-text">4.4、使用举例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-5%E3%80%81%E6%80%BB%E7%BB%93"><span class="toc-number">4.5.</span> <span class="toc-text">4.5、总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5%E3%80%81%E5%AD%97%E8%8A%82%E7%A0%81%E6%8C%87%E4%BB%A4%E9%9B%86%E4%B8%8E%E8%A7%A3%E6%9E%90%E6%A6%82%E8%BF%B0"><span class="toc-number">5.</span> <span class="toc-text">5、字节码指令集与解析概述</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1%E3%80%81%E5%AD%97%E8%8A%82%E7%A0%81%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">5.1.</span> <span class="toc-text">5.1、字节码与数据类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2%E3%80%81%E6%8C%87%E4%BB%A4%E5%88%86%E7%B1%BB"><span class="toc-number">5.2.</span> <span class="toc-text">5.2、指令分类</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6%E3%80%81%E5%AD%97%E8%8A%82%E7%A0%81%E6%8C%87%E4%BB%A4"><span class="toc-number">6.</span> <span class="toc-text">6、字节码指令</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#6-1%E3%80%81%E5%8A%A0%E8%BD%BD%E4%B8%8E%E5%AD%98%E5%82%A8%E6%8C%87%E4%BB%A4"><span class="toc-number">6.1.</span> <span class="toc-text">6.1、加载与存储指令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%95%B0%E6%A0%88%E4%B8%8E%E5%B1%80%E9%83%A8%E5%8F%98%E9%87%8F%E8%A1%A8"><span class="toc-number">6.1.1.</span> <span class="toc-text">操作数栈与局部变量表</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B1%80%E9%83%A8%E5%8F%98%E9%87%8F%E5%8E%8B%E6%A0%88%E6%8C%87%E4%BB%A4"><span class="toc-number">6.1.1.1.</span> <span class="toc-text">局部变量压栈指令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E9%87%8F%E5%85%A5%E6%A0%88%E6%8C%87%E4%BB%A4"><span class="toc-number">6.1.1.2.</span> <span class="toc-text">常量入栈指令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%87%BA%E6%A0%88%E8%A3%85%E5%85%A5%E5%B1%80%E9%83%A8%E5%8F%98%E9%87%8F%E8%A1%A8%E6%8C%87%E4%BB%A4"><span class="toc-number">6.1.1.3.</span> <span class="toc-text">出栈装入局部变量表指令</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-2%E3%80%81%E7%AE%97%E6%9C%AF%E6%8C%87%E4%BB%A4"><span class="toc-number">6.2.</span> <span class="toc-text">6.2、算术指令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%80%E6%9C%89%E7%AE%97%E6%9C%AF%E6%8C%87%E4%BB%A4"><span class="toc-number">6.2.1.</span> <span class="toc-text">所有算术指令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AF%94%E8%BE%83%E6%8C%87%E4%BB%A4%E7%9A%84%E8%AF%B4%E6%98%8E"><span class="toc-number">6.2.2.</span> <span class="toc-text">比较指令的说明</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-3%E3%80%81%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2%E6%8C%87%E4%BB%A4"><span class="toc-number">6.3.</span> <span class="toc-text">6.3、类型转换指令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%BD%E5%8C%96%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2"><span class="toc-number">6.3.1.</span> <span class="toc-text">宽化类型转换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AA%84%E5%8C%96%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2"><span class="toc-number">6.3.2.</span> <span class="toc-text">窄化类型转换</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-4%E3%80%81%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%88%9B%E5%BB%BA%E4%B8%8E%E8%AE%BF%E9%97%AE%E6%8C%87%E4%BB%A4"><span class="toc-number">6.4.</span> <span class="toc-text">6.4、对象的创建与访问指令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%8C%87%E4%BB%A4"><span class="toc-number">6.4.1.</span> <span class="toc-text">创建指令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%97%E6%AE%B5%E8%AE%BF%E9%97%AE%E6%8C%87%E4%BB%A4"><span class="toc-number">6.4.2.</span> <span class="toc-text">字段访问指令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E7%BB%84%E6%93%8D%E4%BD%9C%E6%8C%87%E4%BB%A4"><span class="toc-number">6.4.3.</span> <span class="toc-text">数组操作指令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E5%9E%8B%E6%A3%80%E6%9F%A5%E6%8C%87%E4%BB%A4"><span class="toc-number">6.4.4.</span> <span class="toc-text">类型检查指令</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-5%E3%80%81%E6%96%B9%E6%B3%95%E8%B0%83%E7%94%A8%E4%B8%8E%E8%BF%94%E5%9B%9E%E6%8C%87%E4%BB%A4"><span class="toc-number">6.5.</span> <span class="toc-text">6.5、方法调用与返回指令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E8%B0%83%E7%94%A8%E6%8C%87%E4%BB%A4"><span class="toc-number">6.5.1.</span> <span class="toc-text">方法调用指令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E8%BF%94%E5%9B%9E%E6%8C%87%E4%BB%A4"><span class="toc-number">6.5.2.</span> <span class="toc-text">方法返回指令</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-6%E3%80%81%E6%93%8D%E4%BD%9C%E6%95%B0%E6%A0%88%E7%AE%A1%E7%90%86%E6%8C%87%E4%BB%A4"><span class="toc-number">6.6.</span> <span class="toc-text">6.6、操作数栈管理指令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-7%E3%80%81%E6%8E%A7%E5%88%B6%E8%BD%AC%E7%A7%BB%E6%8C%87%E4%BB%A4"><span class="toc-number">6.7.</span> <span class="toc-text">6.7、控制转移指令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E8%B7%B3%E8%BD%AC%E6%8C%87%E4%BB%A4"><span class="toc-number">6.7.1.</span> <span class="toc-text">条件跳转指令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AF%94%E8%BE%83%E6%9D%A1%E4%BB%B6%E8%B7%B3%E8%BD%AC%E6%8C%87%E4%BB%A4"><span class="toc-number">6.7.2.</span> <span class="toc-text">比较条件跳转指令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E6%9D%A1%E4%BB%B6%E5%88%86%E6%94%AF%E8%B7%B3%E8%BD%AC%E6%8C%87%E4%BB%A4"><span class="toc-number">6.7.3.</span> <span class="toc-text">多条件分支跳转指令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A0%E6%9D%A1%E4%BB%B6%E8%B7%B3%E8%BD%AC%E6%8C%87%E4%BB%A4"><span class="toc-number">6.7.4.</span> <span class="toc-text">无条件跳转指令</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-8%E3%80%81%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E6%8C%87%E4%BB%A4"><span class="toc-number">6.8.</span> <span class="toc-text">6.8、异常处理指令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%9B%E5%87%BA%E5%BC%82%E5%B8%B8%E6%8C%87%E4%BB%A4"><span class="toc-number">6.8.1.</span> <span class="toc-text">抛出异常指令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E4%B8%8E%E5%BC%82%E5%B8%B8"><span class="toc-number">6.8.2.</span> <span class="toc-text">异常处理与异常</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-9%E3%80%81%E5%90%8C%E6%AD%A5%E6%8E%A7%E5%88%B6%E6%8C%87%E4%BB%A4"><span class="toc-number">6.9.</span> <span class="toc-text">6.9、同步控制指令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E7%BA%A7%E7%9A%84%E5%90%8C%E6%AD%A5"><span class="toc-number">6.9.1.</span> <span class="toc-text">方法级的同步</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E5%86%85%E6%8C%87%E5%AE%9A%E6%8C%87%E4%BB%A4%E5%BA%8F%E5%88%97%E7%9A%84%E5%90%8C%E6%AD%A5"><span class="toc-number">6.9.2.</span> <span class="toc-text">方法内指定指令序列的同步</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%9D%A2%E8%AF%95%E9%A2%98"><span class="toc-number">7.</span> <span class="toc-text">面试题</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/12/15/a9c615a71d17/" title="【智能协同云图库】3-用户模块"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/09/6756ee980378a.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【智能协同云图库】3-用户模块"></a><div class="content"><a class="title" href="/2024/12/15/a9c615a71d17/" title="【智能协同云图库】3-用户模块">【智能协同云图库】3-用户模块</a><time datetime="2024-12-15T03:12:06.000Z" title="发表于 2024-12-15 11:12:06">2024-12-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/12/13/2ec3ab3954b3/" title="通过SSH密钥连接Linux"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/13/675c5996649aa.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="通过SSH密钥连接Linux"></a><div class="content"><a class="title" href="/2024/12/13/2ec3ab3954b3/" title="通过SSH密钥连接Linux">通过SSH密钥连接Linux</a><time datetime="2024-12-13T15:37:00.000Z" title="发表于 2024-12-13 23:37:00">2024-12-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/12/13/0616411766f4/" title="【Hexo】一键部署至远程服务器"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/12/13/675c59eff34f4.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【Hexo】一键部署至远程服务器"></a><div class="content"><a class="title" href="/2024/12/13/0616411766f4/" title="【Hexo】一键部署至远程服务器">【Hexo】一键部署至远程服务器</a><time datetime="2024-12-13T13:35:49.000Z" title="发表于 2024-12-13 21:35:49">2024-12-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/12/12/60bae9f9d9cc/" title="【尚硅谷】JVM-类的加载篇"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/08/28/66cedaf5d014a.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【尚硅谷】JVM-类的加载篇"></a><div class="content"><a class="title" href="/2024/12/12/60bae9f9d9cc/" title="【尚硅谷】JVM-类的加载篇">【尚硅谷】JVM-类的加载篇</a><time datetime="2024-12-12T04:02:59.000Z" title="发表于 2024-12-12 12:02:59">2024-12-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/12/11/0a6035f3745c/" title="【尚硅谷】JVM-字节码篇"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/i/2024/08/28/66cedaf5d014a.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【尚硅谷】JVM-字节码篇"></a><div class="content"><a class="title" href="/2024/12/11/0a6035f3745c/" title="【尚硅谷】JVM-字节码篇">【尚硅谷】JVM-字节码篇</a><time datetime="2024-12-11T00:33:29.000Z" title="发表于 2024-12-11 08:33:29">2024-12-11</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="footer_deal"><a class="deal_link" target="_blank" rel="noopener" href="https://github.com/shiguang-coding" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="deal_link" href="mailto:an_shiguang@163.com" title="email"><i class="anzhiyufont anzhiyu-icon-envelope"></i></a><img class="footer_mini_logo" title="返回顶部" alt="返回顶部" onclick="anzhiyu.scrollToDest(0, 500)" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/avatar.png" size="50px"><a class="deal_link" href="/atom.xml" title="RSS"><i class="anzhiyufont anzhiyu-icon-rss"></i></a><a class="deal_link" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC"><i class="anzhiyufont anzhiyu-icon-copyright-line"></i></a></div><div id="anzhiyu-footer"><div class="footer-group"><div class="footer-title">服务</div><div class="footer-links"><a class="footer-item" title="开往" target="_blank" rel="noopener" href="https://www.travellings.cn/go.html">开往</a><a class="footer-item" title="异次元之旅" target="_blank" rel="noopener" href="https://travel.moe/go.html?travel=on">异次元之旅</a><a class="footer-item" title="列表导航" target="_blank" rel="noopener" href="https://zhblogs.ohyee.cc/">列表导航</a><a class="footer-item" title="十年之约" target="_blank" rel="noopener" href="https://www.foreverblog.cn/">十年之约</a></div></div><div class="footer-group"><div class="footer-title">文章</div><div class="footer-links"><a class="footer-item" title="归档" href="/archives/">归档</a><a class="footer-item" title="分类" href="/categories/">分类</a><a class="footer-item" title="标签" href="/tags/">标签</a><a class="footer-item" title="RSS" href="/tom.xml">RSS</a></div></div><div class="footer-group"><div class="footer-title">导航</div><div class="footer-links"><a class="footer-item" title="即刻短文" href="/essay/">即刻短文</a><a class="footer-item" title="留言板" href="/comment/">留言板</a><a class="footer-item" title="关于我" href="/about/">关于我</a></div></div><div class="footer-group"><div class="footer-title-group"><div class="footer-title">友链</div><a class="random-friends-btn" id="footer-random-friends-btn" href="javascript:addFriendLinksInFooter();" title="换一批友情链接"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right"></i></a></div><div class="footer-links" id="friend-links-in-footer"></div></div></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" data-title="博客框架为Hexo_v5.4.0" title="博客框架为Hexo_v5.4.0"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Frame-Hexo.svg" alt="博客框架为Hexo_v5.4.0"></a><a class="github-badge" target="_blank" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" style="margin-inline:5px" data-title="本站使用AnZhiYu主题" title="本站使用AnZhiYu主题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.9/img/Theme-AnZhiYu-2E67D3.svg" alt="本站使用AnZhiYu主题"></a><a class="github-badge" target="_blank" href="https://icp.gov.moe/?keyword=blog.shiguangdev.cn" style="margin-inline:5px" data-title="萌ICP备20246006号" title="萌ICP备20246006号"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shields.io/badge/%E8%90%8Cicp%E5%A4%87-20246006%E5%8F%B7-FF1485" alt="萌ICP备20246006号"></a><a class="github-badge" target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px" data-title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可" title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.2.0/img/badge/Copyright-BY-NC-SA.svg" alt="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"></a></p></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">©2023 - 2024 By <a class="footer-bar-link" href="/" title="時光" target="_blank">時光</a></div></div><div id="footer-type-tips"></div><div class="js-pjax"><script>function subtitleType () {
  fetch('https://v1.hitokoto.cn')
    .then(response => response.json())
    .then(data => {
      if (true) {
        const from = '出自 ' + data.from
        const sub = []
        sub.unshift(data.hitokoto, from)
        window.typed = new Typed('#footer-type-tips', {
          strings: sub,
          startDelay: 300,
          typeSpeed: 150,
          loop: true,
          backSpeed: 50,
        })
      } else {
        document.getElementById('footer-type-tips').innerHTML = data.hitokoto
      }
    })
}

if (true) {
  if (typeof Typed === 'function') {
    subtitleType()
  } else {
    getScript('https://cdn.cbd.int/typed.js@2.1.0/dist/typed.umd.js').then(subtitleType)
  }
} else {
  subtitleType()
}
</script></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a><a class="footer-bar-link" target="_blank" rel="noopener" href="https://img.shiguangdev.cn/" title="图床">图床</a><a class="footer-bar-link" target="_blank" rel="noopener" href="https://beian.miit.gov.cn/" title="豫ICP备2024070732号">豫ICP备2024070732号</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">255</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">191</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">16</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://www.shiguang666.eu.org" title="時光主页"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="時光主页"><span class="back-menu-item-text">時光主页</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://nav.shiguang666.eu.org" title="時光导航站"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="時光导航站"><span class="back-menu-item-text">時光导航站</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://game.shiguang666.eu.org" title="怀旧游戏机"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="怀旧游戏机"><span class="back-menu-item-text">怀旧游戏机</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://games.shiguang666.eu.org" title="在线小游戏"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="在线小游戏"><span class="back-menu-item-text">在线小游戏</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">后台管理</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://img.shiguangdev.cn/" title="時光图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shiguangdev.cn/favicon.ico" alt="時光图床"><span class="back-menu-item-text">時光图床</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://qexo.shiguang666.eu.org/" title="Hexo管理面板"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://qexo.shiguang666.eu.org/favicon.ico" alt="Hexo管理面板"><span class="back-menu-item-text">Hexo管理面板</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 归档</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随机</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/news/"><i class="fa fa-calendar faa-tada"></i><span> 早报亭</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/music/?id=10051718332&amp;server=netease"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/gallery/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/xjj/"><i class="fa fa-rocket faa-tada"></i><span> 养生堂</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/flink/"><i class="anzhiyufont anzhiyu-icon-artstation faa-tada" style="font-size: 0.9em;"></i><span> 朋友圈</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comment/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于我</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/AI/" style="font-size: 0.88rem;">AI<sup>9</sup></a><a href="/tags/Alist/" style="font-size: 0.88rem;">Alist<sup>3</sup></a><a href="/tags/CentOs/" style="font-size: 0.88rem;">CentOs<sup>1</sup></a><a href="/tags/ChatGPT/" style="font-size: 0.88rem;">ChatGPT<sup>13</sup></a><a href="/tags/ChatGPt/" style="font-size: 0.88rem;">ChatGPt<sup>1</sup></a><a href="/tags/Chrome/" style="font-size: 0.88rem;">Chrome<sup>1</sup></a><a href="/tags/CloudFlare/" style="font-size: 0.88rem;">CloudFlare<sup>3</sup></a><a href="/tags/DNS/" style="font-size: 0.88rem;">DNS<sup>1</sup></a><a href="/tags/Ecology/" style="font-size: 0.88rem;">Ecology<sup>1</sup></a><a href="/tags/GPT-4o/" style="font-size: 0.88rem;">GPT-4o<sup>2</sup></a><a href="/tags/Gemini/" style="font-size: 0.88rem;">Gemini<sup>2</sup></a><a href="/tags/Git/" style="font-size: 0.88rem;">Git<sup>8</sup></a><a href="/tags/GitHub/" style="font-size: 0.88rem;">GitHub<sup>6</sup></a><a href="/tags/Hexo/" style="font-size: 0.88rem;">Hexo<sup>24</sup></a><a href="/tags/IDEA/" style="font-size: 0.88rem;">IDEA<sup>3</sup></a><a href="/tags/KeyBoardTestUtility/" style="font-size: 0.88rem;">KeyBoardTestUtility<sup>1</sup></a><a href="/tags/Linux/" style="font-size: 0.88rem;">Linux<sup>4</sup></a><a href="/tags/Lombok/" style="font-size: 0.88rem;">Lombok<sup>1</sup></a><a href="/tags/Markdown/" style="font-size: 0.88rem;">Markdown<sup>2</sup></a><a href="/tags/MindManager/" style="font-size: 0.88rem;">MindManager<sup>1</sup></a><a href="/tags/Mysql/" style="font-size: 0.88rem;">Mysql<sup>2</sup></a><a href="/tags/Navicat/" style="font-size: 0.88rem;">Navicat<sup>1</sup></a><a href="/tags/Perplexity-AI/" style="font-size: 0.88rem;">Perplexity AI<sup>1</sup></a><a href="/tags/PicGo/" style="font-size: 0.88rem;">PicGo<sup>1</sup></a><a href="/tags/QQ/" style="font-size: 0.88rem;">QQ<sup>1</sup></a><a href="/tags/SQL/" style="font-size: 0.88rem;">SQL<sup>12</sup></a><a href="/tags/SSL/" style="font-size: 0.88rem;">SSL<sup>3</sup></a><a href="/tags/Sqlserver/" style="font-size: 0.88rem;">Sqlserver<sup>1</sup></a><a href="/tags/Typora/" style="font-size: 0.88rem;">Typora<sup>5</sup></a><a href="/tags/drawio/" style="font-size: 0.88rem;">drawio<sup>1</sup></a><a href="/tags/git/" style="font-size: 0.88rem;">git<sup>1</sup></a><a href="/tags/mysql/" style="font-size: 0.88rem;">mysql<sup>1</sup></a><a href="/tags/%E5%9B%BE%E5%90%A7%E5%B7%A5%E5%85%B7%E7%AE%B1/" style="font-size: 0.88rem;">图吧工具箱<sup>1</sup></a><a href="/tags/%E5%9B%BE%E5%BA%8A/" style="font-size: 0.88rem;">图床<sup>7</sup></a><a href="/tags/%E5%BC%80%E6%BA%90%E5%88%86%E4%BA%AB/" style="font-size: 0.88rem;">开源分享<sup>6</sup></a><a href="/tags/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E/" style="font-size: 0.88rem;">搜索引擎<sup>2</sup></a><a href="/tags/%E6%95%B0%E6%8D%AE%E6%81%A2%E5%A4%8D/" style="font-size: 0.88rem;">数据恢复<sup>1</sup></a><a href="/tags/%E6%A8%A1%E6%9D%BF/" style="font-size: 0.88rem;">模板<sup>4</sup></a><a href="/tags/%E8%B8%A9%E5%9D%91/" style="font-size: 0.88rem;">踩坑<sup>6</sup></a><a href="/tags/%E9%B1%BC%E7%9A%AE/" style="font-size: 0.88rem;">鱼皮<sup>11</sup></a></div></div><hr></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><a id="switch-commentBarrage" href="javascript:anzhiyu.switchCommentBarrage();" title="开关弹幕"><i class="anzhiyufont anzhiyu-icon-danmu"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="10051718332" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="is-center" id="loading-database"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-pulse-icon"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"></div></div><hr><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://music.163.com/#/my/m/music/playlist?id=10051718332&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async="" src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("05/01/2023 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2023 By 安知鱼 V1.6.14",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 時光 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async="" src="/anzhiyu/random.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>(() => {
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://twikoo.shiguangdev.eu.org',
      region: '',
      onCommentLoaded: () => {
        anzhiyu.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') setTimeout(runFn,0)
    else getScript('https://cdn.cbd.int/twikoo@1.6.39/dist/twikoo.all.min.js').then(runFn)
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo.shiguangdev.eu.org',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const runFn = () => {
    init();
    GLOBAL_CONFIG_SITE.isPost && getCount()
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) anzhiyu.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else {
      loadTwikoo()
    }
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"><script async="" src="/js/anzhiyu/comment_barrage.js"></script></div><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getComment = () => {
    const runTwikoo = () => {
      twikoo.getRecentComments({
        envId: 'https://twikoo.shiguangdev.eu.org',
        region: '',
        pageSize: 6,
        includeReply: true
      }).then(function (res) {
        const twikooArray = res.map(e => {
          return {
            'content': changeContent(e.comment),
            'avatar': e.avatar,
            'nick': e.nick,
            'url': e.url + '#' + e.id,
            'date': new Date(e.created).toISOString()
          }
        })

        saveToLocal.set('twikoo-newest-comments', JSON.stringify(twikooArray), 10/(60*24))
        generateHtml(twikooArray)
      }).catch(function (err) {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "无法获取评论，请确认相关配置是否正确"
      })
    }

    if (typeof twikoo === 'object') {
      runTwikoo()
    } else {
      getScript('https://cdn.cbd.int/twikoo@1.6.39/dist/twikoo.all.min.js').then(runTwikoo)
    }
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'><div class='name'><span>${array[i].nick} </span></div></a>`
        }
        
        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom && ($dom.innerHTML= result)
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('twikoo-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script async="" data-pjax="" src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><script src="/js/custom/footer-animal.js" defer=""></script><script src="/api/card-welcome.js"></script><script id="click-heart" src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/click-heart.min.js" async="async" mobile="false"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["meta[property=\"og:image\"]","meta[property=\"og:title\"]","meta[property=\"og:url\"]","meta[property=\"og:type\"]","meta[property=\"og:site_name\"]","meta[property=\"og:description\"]","head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div><!-- hexo injector body_end start -->
  <script data-pjax="" src="/js/hexo_githubcalendar.js"></script>
  <script data-pjax="">
        function GithubCalendarConfig(){
            var git_githubapiurl ="https://githubcalendarapi.shiguang666.eu.org/api?user=shiguang-coding";
            var git_color =['#ebedf0', '#a2f7af', '#6ce480', '#54ad63', '#469252', '#31753c', '#1f5f2a', '#13531f', '#084111', '#032b09', '#000000'];
            var git_user ="shiguang-coding";
            var parent_div_git = document.getElementById('recent-posts');
            var git_div_html = '<div class="recent-post-item" style="width:100%;height:auto;padding:10px;"><div id="github_loading" style="width:10%;height:100%;margin:0 auto;display: block"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"  viewBox="0 0 50 50" style="enable-background:new 0 0 50 50" xml:space="preserve"><path fill="#d0d0d0" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z" transform="rotate(275.098 25 25)"><animateTransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animateTransform></path></svg></div><div id="github_container"></div></div>';
            if(parent_div_git && location.pathname =='/'){
                console.log("已挂载hexo-github-calendar https://github.com/Barry-Flynn/hexo-github-calendar");
                // parent_div_git.innerHTML=git_div_html+parent_div_git.innerHTML // 无报错，但不影响使用(支持pjax跳转)
                parent_div_git.insertAdjacentHTML("afterbegin",git_div_html) // 有报错，但不影响使用(支持pjax跳转)
            };
            GithubCalendar(git_githubapiurl,git_color,git_user)
        }
        if(document.getElementById('recent-posts')){
            GithubCalendarConfig()
        }
    </script>
    <style>#github_container{min-height:280px}@media screen and (max-width:650px) {#github_container{background-image:;min-height:0px}}</style>
    <style></style><!-- hexo injector body_end end -->
    <link rel="stylesheet" href="https://ai.tianli0.top/static/public/postChatUser_summary.min.css">
    <script>
        let tianliGPT_key = '75439fb77e5551eacf54f0df75565616dcf2ad';
        let tianliGPT_postSelector = '#article-container';
        let tianliGPT_Title = '文章摘要';
        let tianliGPT_postURL = '/^https?://[^/]+/[0-9]{4}/[0-9]{2}/[0-9]{2}/';
        let tianliGPT_blacklist = '';
        let tianliGPT_wordLimit = '1000';
        let tianliGPT_typingAnimate = true;
        var postChatConfig = {
          backgroundColor: "#3e86f6",
          bottom: "16px",
          left: "16px",
          fill: "#FFFFFF",
          width: "44px",
          frameWidth: "375px",
          frameHeight: "600px",
          defaultInput: true,
          upLoadWeb: true,
          showInviteLink: true,
          userTitle: "PostChat",
          userDesc: "如果你对网站的内容有任何疑问，可以来问我哦～",
          addButton: true,
          beginningText: "这篇文章介绍了"
        };
    </script>
    <script data-postchat_key="75439fb77e5551eacf54f0df75565616dcf2ad" src="https://ai.tianli0.top/static/public/postChatUser_summary.min.js"></script>
  </body></html>